
/* Smart UI v8.1.0 (2020-Nov) 
Copyright (c) 2011-2020 jQWidgets. 
License: https://htmlelements.com/license/ */ //

!function(e){var t={};function n(i){if(t[i])return t[i].exports;var l=t[i]={i:i,l:!1,exports:{}};return e[i].call(l.exports,l,l.exports,n),l.l=!0,l.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)n.d(i,l,function(t){return e[t]}.bind(null,l));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=95)}({95:function(e,t){Smart("smart-scheduler",class extends Smart.ScrollViewer{static get properties(){return{autoScrollStep:{value:30,type:"number"},colorScheme:{value:["#D50000","#E67C73","#F4511E","#F6BF26","#33B679","#0B8043","#039BE5","#3F51B5","#7986CB","#8E24AA","#616161",""],type:"array"},currentTimeIndicator:{value:!1,type:"boolean"},currentTimeIndicatorInterval:{value:1,validator:"_currentTimeIndicatorIntervalValidator",type:"number"},eventIndicatorTemplate:{value:null,type:"any"},eventTemplate:{value:null,type:"any"},eventRenderMode:{allowedValues:["classic","modern"],value:"modern",type:"string"},tooltipTemplate:{value:null,type:"any"},cellDuration:{value:60,type:"number"},cellTemplate:{value:null,type:"any"},dateCurrent:{value:new Date,type:"any",validator:"_dateValidator"},dataSource:{value:[],type:"any",reflectToAttribute:!1},dataExport:{value:{header:{value:!0,type:"boolean"},style:{value:null,type:"object"},fileName:{value:"smartScheduler",type:"string?"},pageOrientation:{value:"portrait",type:"string"}},type:"object"},dateSelectorFormatFunction:{value:null,reflectToAttribute:!1,type:"function?"},dayFormat:{value:"numeric",allowedValues:["2-digit","numeric"],type:"string"},disableAutoScroll:{value:!1,type:"boolean"},disableDrag:{value:!1,type:"boolean"},disableDrop:{value:!1,type:"boolean"},disableResize:{value:!1,type:"boolean"},disableSelection:{value:!1,type:"boolean"},disableWindowEditor:{value:!1,type:"boolean"},dragFeedbackFormatFunction:{value:null,type:"function?"},dragOffset:{value:[10,10],type:"array"},firstDayOfWeek:{value:0,type:"number",defaultValue:0,validator:"_firstDayOfWeekValidator"},groupByDate:{value:!1,type:"boolean"},groupOrientation:{allowedValues:["horizontal","vertical"],value:"horizontal",type:"string"},groupTemplate:{value:null,type:"any"},groups:{value:[],type:"array"},hourEnd:{value:23,type:"number",validator:"_hourValidator"},hourStart:{value:0,type:"number",validator:"_hourValidator"},hourFormat:{value:"numeric",allowedValues:["numeric","2-digit"],type:"string"},headerTemplate:{value:null,type:"any"},headerDatePosition:{value:"near",allowedValues:["near","far"],type:"string"},headerViewPosition:{value:"far",allowedValues:["near","far"],type:"string"},hideAllDay:{value:!1,type:"boolean"},hideNonworkingWeekdays:{value:!1,type:"boolean"},hideWeekend:{value:!1,type:"boolean"},interval:{value:1,type:"number"},nonworkingDays:{value:[],type:"array",validator:"_nonworkingDayValidator"},nonworkingHours:{value:[],type:"array",validator:"_nonworkingTimeValidator"},max:{value:new Date(2100,0,1),type:"any",validator:"_dateValidator"},min:{value:new Date(1900,0,1),type:"any",validator:"_dateValidator"},messages:{extend:!0,value:{en:{invalidValue:"{{elementType}}: Invalid {{property}} value. {{property}} should be of type {{typeOne}} or {{typeTwo}}.",invalidTimeZone:"{{elementType}}: Invalid timeZone value. TimeZone should be from the IANA time zone database.",incorrectArgument:"{{elementType}}: Incorrect argument {{argumentName}} in method {{methodName}}.",agenda:"Agenda",day:"Day",week:"Week",month:"Month",allDay:"All Day",timelineDay:"Timeline Day",timelineWeek:"Timeline Week",timelineMonth:"Timeline Month",newEvent:"New Event",ok:"Ok",cancel:"Cancel",delete:"Delete",label:"Label",dateStart:"Start Date",dateEnd:"End Date",repeat:"Repeat",description:"Description",repeatFreq:"Repeat",repeatInterval:"Repeat Every",repeatOn:"Repeat On",repeatEnd:"End Repeat",repeatEndOption:"Never",repeatEndOnOption:"On",repeatEndAfterOption:"After",repeatEndAfter:"occurance(s)",hidden:"Hidden",hourly:"Hourly",daily:"Daily",weekly:"Weekly",monthly:"Monthly",yearly:"Yearly",repeatConfirm:"Do you want to edit only the current event or the whole series ?",repeatConfirmLabel:"Edit Repeating Event",createEvent:"Create a new Event",editEvent:"Edit event",editSeries:"Edit series",eventException:"Event Exception",collector:"more",hours:"hours",days:"days",weeks:"weeks",months:"months",years:"years",backgroundColor:"Background Color",status:"Status",resources:"Resources",selectPlaceholder:"Select...",none:"None",free:"Free",busy:"Busy",tentative:"Tentative",outOfOffice:"Out of Office",exceptions:"Exceptions",resetExceptions:"Reset Exceptions"}},type:"object"},minuteFormat:{value:"2-digit",allowedValues:["numeric","2-digit"],type:"string"},monthFormat:{value:"long",allowedValues:["2-digit","numeric","long","short","narrow"],type:"string"},resources:{value:[],type:"any",reflectToAttribute:!1},scrollButtonsPosition:{value:"both",allowedValues:["near","far","both"],type:"string"},shadeUntilCurrentTime:{value:!1,type:"boolean"},spinButtonsDelay:{value:80,type:"number"},spinButtonsInitialDelay:{value:0,type:"number"},statuses:{value:[{label:"None",value:void 0},{label:"Free",value:"free"},{label:"Tentative",value:"tentative"},{label:"Busy",value:"busy"},{label:"Out of Office",value:"outOfOffice"}],type:"array"},timelineHeaderFormatFunction:{value:null,reflectToAttribute:!1,type:"function?"},timelineDayScale:{value:"hour",allowedValues:["hour","halfHour","quarterHour","tenMinutes","fiveMinutes"],type:"string"},timeRulerTicks:{value:!1,type:"boolean"},timeZone:{value:Intl.DateTimeFormat().resolvedOptions().timeZone,type:"string",validator:"_timeZoneValidator"},timeZones:{value:[],type:"array",validator:"_timeZonesValidator"},tooltipDelay:{value:0,type:"number"},tooltipOffset:{value:[],type:"array"},view:{value:"day",type:"string",validator:"_viewValidator"},viewType:{allowedValues:["agenda","day","week","month","timelineDay","timelineWeek","timelineMonth"],defaultReflectToAttribute:!0,value:"day",type:"string",validator:"_viewTypeValidator"},views:{value:["day","week"],type:"array",validator:"_viewsValidator"},viewSelectorType:{allowedValues:["auto","tabs","menu"],value:"auto",type:"string"},weekdayFormat:{value:"short",allowedValues:["long","short","narrow"],type:"string"},yearFormat:{value:"numeric",allowedValues:["2-digit","numeric"],type:"string"},windowCustomizationFunction:{value:null,reflectToAttribute:!1,type:"function?"}}}template(){return'<div id="container" role="presentation">\n                    <div id="header" class="smart-scheduler-header">\n                        <div id="dateSelectorContainer" class="smart-scheduler-date-nav">\n                            <smart-repeat-button prev id="previousDate" initial-delay="[[spinButtonsInitialDelay]]" delay="[[spinButtonsDelay]]"\n                             aria-label="Previous date" class="smart-scheduler-nav"></smart-repeat-button>\n                            <smart-button current id="currentDate" right-to-left="[[rightToLeft]]" class="smart-scheduler-nav"></smart-button>\n                            <smart-repeat-button next id="nextDate" initial-delay="[[spinButtonsInitialDelay]]" delay="[[spinButtonsDelay]]" \n                             aria-label="Previous date" class="smart-scheduler-nav"></smart-repeat-button>\n                        </div>\n                        <div id="viewSelectorContainer" class="smart-scheduler-view-nav">\n                            <div id="viewItemsContainer" class="smart-scheduler-items-container"></div>\n                            <smart-button id="viewItemsButton" class="smart-scheduler-view-items-button smart-visibility-hidden" \n                            aria-label="View items popup" right-to-left="[[rightToLeft]]"></smart-button>\n                        </div>\n                    </div>\n                    <div class="smart-scheduler-view-container">\n                        <div id="timeline" class="smart-scheduler-view">\n                                <div id="timelineHeaderHorizontal" class="smart-scheduler-view-header-horizontal" role="rowgroup">\n                                    <div class="smart-scheduler-view-time-container" id="timelineViewCellsContainer" role="rowgroup">\n                                        <div class="smart-scheduler-view-label-container" id="timelineViewCellsLabelContainer" role="row"></div>\n                                        <div class="smart-scheduler-view-header-horizontal-content" id="timelineHeaderHorizontalContent">\n                                            <div class="smart-scheduler-view-details" role="row"></div>\n                                            <div class="smart-scheduler-view-time">\n                                                <div class="smart-scheduler-cells" role="row"></div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div class="smart-scheduler-view-all-day" id="timelineViewAllDay" role="row">\n                                        <div class="smart-scheduler-view-all-day-label-container" id="timelineAllDayLabelContainer" role="row">\n                                            <div class="smart-scheduler-view-all-day-label" id="timelineViewAllDaylabel"></div>\n                                            <div class="smart-scheduler-time-zone-container" id="timelineTimeZoneLabelContainer"></div>\n                                        </div>\n                                        <div class="smart-scheduler-view-all-day-content" id="timelineViewAllDayContent" role="row">\n                                            <div class="smart-scheduler-cells-container" id="timelineViewAllDayCellsContainer"></div>\n                                            <div class="smart-scheduler-events-container" id="allDayEventsContainer" aria-hidden="true"></div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div id="timelineHeaderVertical" class="smart-scheduler-view-header-vertical" role="rowgroup">\n                                    <div class="smart-scheduler-view-header-vertical-content" id="timelineHeaderVerticalContent">\n                                        <div class="smart-scheduler-view-time">\n                                            <div class="smart-scheduler-cells" role="row"></div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div id="timelineContainer" class="smart-scheduler-scrollable-container">\n                                    <div id="timelineContent" class="smart-scheduler-content">\n                                        <div id="timelineCellsContainer" class="smart-scheduler-cells-container" aria-hidden="true"></div>\n                                        <div id="timelineEventsContainer" class="smart-scheduler-events-container" aria-hidden="true"></div>\n                                        <div id="timelineIndicatorsContainer" class="smart-scheduler-indicators-container" aria-hidden="true"></div>\n                                    </div>\n                                </div>\n                        </div>\n                        <smart-scroll-bar wait id="verticalScrollBar" class="smart-scheduler-view-scroll-bar" orientation="vertical" \n                        right-to-left="[[rightToLeft]]" aria-controls="[[id]]" animation="[[animation]]"></smart-scroll-bar>\n                        <smart-scroll-bar wait id="horizontalScrollBar" class="smart-scheduler-view-scroll-bar"  \n                        right-to-left="[[rightToLeft]]" aria-controls="[[id]]" animation="[[animation]]"></smart-scroll-bar>\n                    </div>\n                    <div id="footer" class="smart-scheduler-footer"></div>\n                    <smart-tooltip id="tooltip" position="auto" arrow open-mode="manual" delay="[[tooltipDelay]]" offset="[[tooltipOffset]]" class="smart-scheduler-tooltip"></smart-tooltip>\n                </div>'}static get listeners(){return{down:"_downHandler","document.move":"_documentMoveHandler","document.up":"_documentUpHandler","document.dragstart":"_dragStartHandler","container.click":"_containerClickHandler","container.contextmenu":"_containerContextMenuHandler","container.wheel":"_mouseWheelHandler","horizontalScrollBar.change":"_horizontalScrollbarHandler","verticalScrollBar.change":"_verticalScrollbarHandler",keydown:"_keyDownHandler",move:"_moveHandler",resize:"_resizeEventHandler","tooltip.opening":"_tooltipVisibilityHandler","tooltip.closing":"_tooltipVisibilityHandler","tooltip.change":"_tooltipChangeHandler","tooltip.click":"_tooltipClickHandler","tooltip.keydown":"_tooltipKeyDownHandler","tooltip.down":"_tooltipDownHandler","tooltip.contextmenu":"_tooltipContextMenuHandler","timeline.focus":"_timelineFocusHandler"}}static get styleUrls(){return["smart.scheduler.css"]}static get requires(){return{"Smart.Window":"smart.window.js","Smart.Calendar":"smart.calendar.js","Smart.Tooltip":"smart.tooltip.js"}}propertyChangedHandler(e,t,n){super.propertyChangedHandler(e,t,n);const i=this;switch(e){case"dataSource":i._createEvents(),i._createTimeline();break;case"currentTimeIndicator":case"shadeUntilCurrentTime":i._setCurrentTimeIndicators();break;case"eventRenderMode":i._refreshEvents();break;case"firstDayOfWeek":case"max":case"min":i._calendar&&(i._calendar[e]=n),i._createTimeline(),i._refreshDateNavButtons();break;case"hideAllDay":["day","week"].indexOf(i.viewType)>-1&&i._createTimeline();break;case"hideWeekend":case"hideNonworkingWeekdays":i.viewType.toLowerCase().indexOf("day")<0&&i._createTimeline();break;case"timeZones":i._createTimelineHeader();break;case"dateCurrent":case"groups":case"groupOrientation":case"hourStart":case"hourEnd":case"nonworkingDays":case"nonworkingHours":case"timelineDayScale":case"resources":i._createTimeline();break;case"view":i._handleViewSelection(),i._createTimeline(),i._refreshDateSelector(),i._scrollToView(),i.$.fireEvent("viewChange",{oldValue:t,value:n});break;case"viewSelectorType":i._setHeader();break;case"cellTemplate":case"groupTemplate":i._templates&&delete i._templates[e],i._createTimeline();break;case"unfocusable":i._setFocusable()}}attached(){const e=this;super.attached(),e._scrollView||(e._scrollView=new Smart.Utilities.Scroll(e.$.timeline,e.$.horizontalScrollBar,e.$.verticalScrollBar));const t=[e.$.schedulerWindow,e.$.confirmSchedulerWindow],n=e.$.tooltip;n.visible&&e.getShadowRootOrBody().appendChild(n);for(let n=0;n<t.length;n++){const i=t[n];if(i&&i.opened){const t=e.$schedulerWindow;e._handleModal(!0),t.listen("open",e._windowOpenHandler.bind(e)),t.listen("close",e._windowCloseHandler.bind(e)),t.listen("closing",e._windowClosingHandler.bind(e)),t.listen("click",e._windowClickHandler.bind(e)),t.listen("change",e._windowChangeHandler.bind(e)),i.hasAnimation&&i.listen("transitionend",e._windowTransitionendHandler.bind(e)),e.getShadowRootOrBody().appendChild(i)}}}detached(){const e=this;super.detached(),e._scrollView&&(e._scrollView.unlisten(),delete e._scrollView),e._scrollView.disableSwipeScroll=e._touchmoveInside=!1,delete e._dragDetails,Smart.Scheduler.schedulerStart===e&&(Smart.Scheduler.feedback.remove(),delete Smart.Scheduler.schedulerStart,delete Smart.Scheduler.hoveredCell,delete Smart.Scheduler.hoveredScheduler,delete Smart.Scheduler.feedback);const t=[e.$.schedulerWindow,e.$.confirmSchedulerWindow],n=e.$.tooltip;e.$.container.contains(n)||e.$.container.appendChild(n);for(let n=0;n<t.length;n++){const i=t[n];if(e._handleModal(),i){i.remove();const t=i===e.$.schedulerWindow?e.$schedulerWindow:e.$confirmSchedulerWindow;t.unlisten("open"),t.unlisten("close"),t.unlisten("closing"),t.unlisten("click"),t.unlisten("change"),t.unlisten("transitionend")}}}ready(){this._customScrollView=!0,super.ready()}render(){const e=this;e._setViewType(),e.setAttribute("role","treegrid"),window.rrule&&window.rrule.RRule||e.error(e.localize("missingReference",{elementType:e.nodeName.toLowerCase(),files:"rrule.min.js"})),e._rRule=window.rrule.RRule,Smart.Utilities.Core.isMobile&&(e._isMobile=!0,e.$.timeline.setAttribute("mobile","")),e._setFocusable(),e._setScrollBars(),e._setHeader(),e._createEvents(),e._createTimeline(),e.checkLicense(),super.render()}refresh(e){const t=this;e?t.isRendered&&t._createTimeline():t._refresh()}get events(){const e=this,t=e._events;return e.isReady&&t&&t.length?t.map(t=>e._cloneObject(t)):[]}containsEvent(e){return!!this._containsEvent(e)}insertEvent(e){const t=this._events;if(t.indexOf(e)>-1||this._containsEvent(e))return;const n=this._createEvents(Array.isArray(e)?e:[e]);n&&(t.push(e),this._refreshTimelineEvents(),this.$.fireEvent("itemInsert",{item:this._cloneObject(n)}))}updateEvent(e,t){if(e=this._containsEvent(e)){for(let n in t)e[n]=t[n];e.dateStart=this._dateValidator(void 0,e.dateStart),e.dateEnd=this._dateValidator(void 0,e.dateEnd),e.dateEnd=new Date(Math.max(e.dateStart.getTime(),e.dateEnd.getTime())),this._refreshTimelineEvents(),this.$.fireEvent("itemUpdate",{item:this._cloneObject(e)})}}removeEvent(e){const t=this._events;(e=this._containsEvent(e))&&(t.splice(t.indexOf(e),1),this._refreshTimelineEvents(),this.$.fireEvent("itemRemove",{item:this._cloneObject(e)}))}insertResource(){}updateResource(){}removeResourse(){}beginUpdate(){}endUpdate(){}scrollToDate(e){const t=this;if(e instanceof Date)e=new Date(e);else{if(e instanceof HTMLElement&&(!e.classList.contains("smart-scheduler-cell")||!t.$.timeline.contains(e)))return;if("object"==typeof e){const n=new Date(t.dateCurrent);e.year=void 0!==e.year?e.year:n.getFullYear(),e.month=void 0!==e.month?e.month:n.getMonth(),e.date=void 0!==e.date?e.date:n.getDate(),e=new Date(e.year,e.month,e.date,e.hours,e.getMinutes)}}e&&!isNaN(e.getTime())&&t._scrollTo(e)}openWindow(e){const t=this;let n=e;if("string"==typeof e&&(n=t._events.find(t=>t.id+""===e),n||(n=new Date(e))),e instanceof Date){if(isNaN(e.getTime()))return;n={allDay:!0,dateStart:new Date(e),dateEnd:new Date(e)}}"object"==typeof e&&n.dateStart&&n.dateEnd&&!isNaN(n.dateStart.getTime())&&!isNaN(n.dateEnd.getTime())&&t._openWindow(n)}closeWindow(){const e=this.$.confirmSchedulerWindow,t=this.$.schedulerWindow;t&&(t.close(),delete t._target),e&&(e.close(),delete e._target)}occurances(e,t=100){const n=this._rRule;if(!n||!e)return;const i=this._getEventRepeatOptions(e);return i?(t=parseInt(t),t=isNaN(t)?100:t,new n(i).all((e,n)=>!(!i.count&&n===t))):void 0}occurancesBetween(e,t,n){const i=this._rRule;if(!i||!e||isNaN(new Date(t).getTime())||isNaN(new Date(n).getTime()))return;const l=this._getEventRepeatOptions(e);return l?(t=new Date(Math.min(t.getTime(),n.getTime())),n=new Date(Math.max(t.getTime(),n.getTime())),new i(l).between(new Date(Date.UTC(...this._getUTCDateArgs(t))),new Date(Date.UTC(...this._getUTCDateArgs(n))),!0)):void 0}occuranceAfter(e,t){return this._occurance(e,t,"after")}occuranceBefore(e,t){return this._occurance(e,t,"before")}getCellDateRange(e){if(e&&this.$.timelineCellsContainer.contains(e)&&e.classList.contains("smart-scheduler-cell"))return e.classList.contains("scale")&&(e=e.children[0]),this._getCellDateRange(e)}_occurance(e,t,n){const i=this._rRule;if(!i||!e||isNaN(new Date(t).getTime()))return;const l=this._getEventRepeatOptions(e);return l?new i(l)[n](new Date(Date.UTC(...this._getUTCDateArgs(t))),!0):void 0}openEventTooltip(e){}closeEventTooltip(){}_checkDoubleClick(e){const t=this;if(void 0===t._dblClickDetails&&(t._dblClickDetails={clicks:0}),clearTimeout(t._dblClickDetails.timeOut),e!==t._dblClickDetails.target&&(t._dblClickDetails.clicks=0),t._dblClickDetails.target=e,t._dblClickDetails.clicks++,t._dblClickDetails.timeOut=setTimeout((function(){t._dblClickDetails&&(t._dblClickDetails.clicks=0),t._openEventMenu&&(t._handleTooltipContent(t._openEventMenu),delete t._openEventMenu)}),250),2===t._dblClickDetails.clicks)return t._doubleClickHandler(e),t._dblClickDetails.clicks=0,delete t._openEventMenu,!0}_cloneObject(e,t){let n={};for(let i in e){let l=e[i];l instanceof Date?n[i]=t?l.toISOString():new Date(l):n[i]=l}return delete n.$,n}_doubleClickHandler(e){const t=this;if(t.disabled||t.disableWindowEditor)return;const n=t.$.tooltip;let i=e.closest?e.closest(".smart-scheduler-cell:not(.scale)"):void 0;if(t.$.timelineContainer.contains(i)||t.$.timelineViewAllDay.contains(i))t._openWindow();else if(i=e.classList.contains("smart-scheduler-event")?e:e.closest(".smart-scheduler-event-content"),i&&(t.$.timeline.contains(i)||n.contains(i))){i=i.closest(".smart-scheduler-event");let e=i&&i.$?i.$:void 0;if(!e||e.events)return;e=e.event;const l=e.$?e.$.event:void 0,r=l&&l.repeat?l.repeat.exceptions:void 0;let a;if(r&&r.indexOf(e)>-1)a=e;else{const t=i.$;a=l?Object.assign({},e,{dateStart:t.dateStart,dateEnd:t.dateEnd}):e}n.close(),t._openWindow(a,l?i:void 0)}}_createEventFromSelection(e){const t=this;if(e||(e=t._selectedCellObj),e instanceof HTMLElement&&e.$&&(e={from:e.$.cellObj,to:e.$.cellObj}),!e||!e.from)return;const n=e.from,i=e.to,l=new Date(Math.min(n.time,i.time)),r=new Date(Math.max(n.time,i.time)),a=n[t.groupOrientation].group;!n.allDay&&t.viewType.toLowerCase().indexOf("month")<0?r.setHours(r.getHours(),r.getMinutes()+60/t._getCellsScaleCount(),0,0):(r.setDate(r.getDate()+1),r.setHours(0,0,0,0));const o={allDay:!!n.allDay,dateStart:l,dateEnd:r};if(a)for(let e in a)o[e]=a[e];return o}_downHandler(e){const t=this,n=t.$.tooltip,i=e.originalEvent;let l=t.shadowRoot||t.isInShadowDOM?i.composedPath()[0]:i.target;if(e.stopPropagation(),0===e.button&&n.contains(t._contextList)&&!n.contains(l)&&n.close(),t._dragDetails)return t._endDrag(),t._endResize(),delete t._dragDetails,clearInterval(t._scrollInterval),void delete t._scrollInterval;if(!t.$.timeline.contains(l)&&!t.$.tooltip.contains(l))return;if(t._isMobile&&(t.$.timelineContent.classList.add("hide-overlay"),l=(t.shadwoRoot||document).elementFromPoint(i.pageX-window.pageXOffset,i.pageY-window.pageYOffset),t.$.timelineContent.classList.remove("hide-overlay")),!l||!l.closest)return;t._dragDetails={target:l,button:e.button};const r=l.closest(".smart-scheduler-cell:not(.scale)");if(r&&r.$&&(t.$.timelineContainer.contains(r)||t.$.timelineViewAllDay.contains(r))){const n=r.$.cellObj;if(!n)return;if(t._dragDetails.timelineCellObj=n,0===e.button&&t._checkDoubleClick(l))return;if(t._isMobile)return;return 0!==e.button?void t._handleCellSelection():void(e.shiftKey&&t._selectedCellObj?t._handleCellSelection(t._selectedCellObj.from,n):t._handleCellSelection(n))}const a=l.closest(".smart-scheduler-event");if(a){if(0===e.button&&t._checkDoubleClick(l))return;t._dragDetails.schedulerEvent=a,t._dragDetails.coordinates={x:e.pageX,y:e.pageY},t._dragDetails.originialEvent=e}}_documentMoveHandler(e){const t=this,n=e.originalEvent,i=t._dragDetails,l=Smart.Scheduler.schedulerStart;let r=t.shadowRoot||t.isInShadowDOM?n.composedPath()[0]:n.target;if(l)t._setDropTarget(e);else if(!i)return void t._checkEventResizability(e);if(i&&0===i.button)if(t.$.timeline.hasAttribute("event-hovered"))t._handleEventResize(e);else if(t.disableDrag||!i.schedulerEvent||l){if(l===t){const n=t.dragOffset,i=Smart.Scheduler.feedback;return i.parentElement||document.body.appendChild(i),i.style.left=e.pageX+n[0]+"px",void(i.style.top=e.pageY+n[1]+"px")}if(!t._isMobile&&!t.disableSelection&&"agenda"!==t.viewType&&!e.shiftKey){Smart.Utilities.Core.Browser.Firefox&&(r=(t.shadwoRoot||document).elementFromPoint(n.pageX-window.pageXOffset,n.pageY-window.pageYOffset));const e=i.timelineCellObj,l=t.$.timeline.contains(r)?r.closest(".smart-scheduler-cell:not(.scale)"):void 0;e&&l&&t._selectCell(e,l)}}else t._setDragStart(e)}_documentUpHandler(e){const t=this,n=e.originalEvent,i=t._dragDetails,l=n.pageX-window.pageXOffset,r=n.pageY-window.pageYOffset;let a=t.shadowRoot||t.isInShadowDOM?n.composedPath()[0]:n.target;if(t._isMobile&&(t.$.timelineContent.classList.add("hide-overlay"),a=(t.shadwoRoot||document).elementFromPoint(l,r),t.$.timelineContent.classList.remove("hide-overlay")),t._upHandler(),clearInterval(t._scrollInterval),delete t._scrollInterval,i&&Smart.Scheduler.schedulerStart)return void t._endDrag(e,a);if(i&&t.hasAttribute("resized"))return void t._endResize(e);const o=t.$.tooltip;if(!o.visible||o.contains(a)||(t.shadowRoot||t).contains(a)||o.close(),a&&a.closest){if(!i){const e=t.$.schedulerWindow;return void(t.contains(a)&&a.classList.contains("smart-scheduler-window-modal")&&e&&e.focus())}{const n=a.closest(".smart-scheduler-event");i.schedulerEvent===n?(t._handleCellSelection(),t.$.fireEvent("itemClick",{item:n,itemObj:t._cloneObject(n.$.event)}),o.contains(a)||!t._isMobile&&0!==i.button||(t._dblClickDetails&&0===t._dblClickDetails.clicks?(t._handleTooltipContent(n),delete t._openEventMenu):t._openEventMenu=n)):(delete t._openEventMenu,0!==i.button||e.shiftKey&&t._selectedCellObj||t._handleCellSelection(i.timelineCellObj,a))}}delete t._dragDetails}_setDropTarget(e){const t=this,n=e.originalEvent;let i,l=t.shadowRoot||t.isInShadowDOM?n.composedPath()[0]:n.target,r=Smart.Scheduler.hoveredCell,a=Smart.Scheduler.hoveredScheduler;if((t.shadowRoot||t).contains(l)&&(a&&a!==t&&(a.removeAttribute("dragged"),clearInterval(a._scrollInterval),delete a._scrollInterval),Smart.Scheduler.hoveredScheduler=a=t),t._isMobile&&a&&(a.$.timelineContent.classList.add("hide-overlay"),l=(t.shadwoRoot||document).elementFromPoint(n.pageX-window.pageXOffset,n.pageY-window.pageYOffset),a.$.timelineContent.classList.remove("hide-overlay")),l&&l.closest&&!l.closest(".smart-scheduler-groups-container")&&(i=l.closest(".smart-scheduler-cell:not(.scale)")),i&&i!==r&&(t.shadowRoot||t).contains(i)){const e=document.body;r&&r.classList.remove("smart-scheduler-feedback"),t.disableDrop?(e.classList.remove("smart-dragging"),e.classList.add("smart-dragging-disabled")):(i.classList.add("smart-scheduler-feedback"),Smart.Scheduler.hoveredCell=i,e.classList.remove("smart-dragging-disabled"),e.classList.add("smart-dragging")),t.setAttribute("dragged",""),Smart.Scheduler.hoveredScheduler=a=t}else i||(a!==t||t.$.container.contains(l)||(t.removeAttribute("dragged"),clearInterval(t._scrollInterval),delete t._scrollInterval,delete Smart.Scheduler.hoveredScheduler),r&&(r.classList.remove("smart-scheduler-feedback"),delete Smart.Scheduler.hoveredCell));a&&a._autoScroll(n)}_setDragStart(e){const t=this,n=t._dragDetails;if(Math.abs(e.pageX-n.coordinates.x)<5&&Math.abs(e.pageY-n.coordinates.y)<5)return;if(n.schedulerEvent.hasAttribute("collector")||"agenda"===t.viewType)return;const i=n.schedulerEvent.$.event;if(!i||i.disableDrag)return;const l=t._cloneObject(i),r=t.$.tooltip;if(t.$.fireEvent("dragStart",{target:n.schedulerEvent,item:l,originalEvent:n.originialEvent}).defaultPrevented)return;n.originalBodyOverflow={overflowX:document.body.style.overflowX,overflowY:document.body.style.overflowY,overflow:document.body.style.overflow};const a=(document.scrollingElement||document.documentElement).scrollHeight>document.documentElement.clientHeight,o=(document.scrollingElement||document.documentElement).scrollWidth>document.documentElement.clientWidth;document.body.style.overflow=document.body.style.overflowX=document.body.style.overflowY="",a&&!o?document.body.style.overflowX="hidden":o&&!a?document.body.style.overflowY="hidden":o||a||(document.body.style.overflow="hidden"),r.contains(n.schedulerEvent)&&(t._list&&(t._list.disableSwipeScroll=t._list._touchmoveInside=!0),r.close()),Smart.Scheduler.schedulerStart=t,Smart.Scheduler.feedback=t._createDragFeedback(l),t._dragDetails.schedulerEventObj=l,t._scrollView.disableSwipeScroll=t._touchmoveInside=!0,t.setAttribute("dragged",""),document.body.classList.add("smart-dragging")}_endDrag(e,t){const n=this;if(!Smart.Scheduler.schedulerStart)return;const i=n._dragDetails,l=Smart.Scheduler.schedulerStart,r=Smart.Scheduler.schedulerStart._dragDetails.schedulerEvent,a=Smart.Scheduler.schedulerStart._dragDetails.schedulerEventObj,o=Smart.Scheduler.hoveredScheduler,s=Smart.Scheduler.hoveredCell,d=document.body;l===n&&(Smart.Scheduler.feedback.remove(),delete Smart.Scheduler.hoveredScheduler,delete Smart.Scheduler.hoveredCell,delete Smart.Scheduler.schedulerStart,delete Smart.Scheduler.feedback,i.originalBodyOverflow&&(d.style.overflow=i.originalBodyOverflow.overflow,d.style.overflowX=i.originalBodyOverflow.overflowX,d.style.overflowY=i.originalBodyOverflow.overflowY),o&&(o.removeAttribute("dragged"),clearInterval(o._scrollInterval),delete o._scrollInterval,s&&(s.classList.remove("smart-scheduler-feedback"),n._completeEventDragDrop({event:e,schedulerEvent:r,hoveredCell:s,hoveredScheduler:o,schedulerEventObj:a}))),e&&n.$.fireEvent("dragEnd",{target:t,item:i.schedulerEventObj,originalEvent:e}),d.classList.remove("smart-dragging"),d.classList.remove("smart-dragging-disabled"),l.removeAttribute("dragged"),n._scrollView.disableSwipeScroll=n._touchmoveInside=!1,n._list&&(n._list.disableSwipeScroll=n._list._touchmoveInside=!1),delete n._dragDetails)}_endResize(e){const t=this,n=t._dragDetails,i=n?n.resizeDetails:void 0;if(t.removeAttribute("resized"),!n||!i)return;const l=n.schedulerEvent;l.removeAttribute("resized"),e?(t.$.fireEvent("resizeEnd",{target:n.schedulerEvent,item:t._cloneObject(l.$.event),originalEvent:e.originialEvent||e}),t._completeEventResize()):(l.style.left=i.originalPosition.x+"px",l.style.top=i.originalPosition.y+"px",l.style.width=i.originalSize.width+"px",l.style.height=i.originalSize.height+"px"),t._scrollView.disableSwipeScroll=t._touchmoveInside=!1,delete t._dragDetails,t._refreshTimelineEvents()}_completeEventResize(){const e=this,t=e._dragDetails,n=t.resizeDetails,i=n.cellObj;if(!i)return;const l=n.side,[r,a]="left"===l||"right"===l?["x","width"]:["y","height"];if(n.originalPosition[r]===n.position[r]&&n.originalSize[a]===n.size[a])return;const o=e.viewType,s=e.rightToLeft,d=t.schedulerEvent,c=60/e._getCellsScaleCount(),u=i.date,h=n.scaleIndex||0;let m,g=d.$.event;if(g.$&&g.$.event&&e._handleEventExceptionDrop(g),"top"===l)m=g.dateStart,m.setHours(u.getHours(),u.getMinutes()+c*h,0,0);else if("bottom"===l)m=g.dateEnd,m.setHours(u.getHours(),u.getMinutes()+c*(h+1),0,0);else{const t="left"===l&&!s||"right"===l&&s?"dateStart":"dateEnd";if("month"===o){const i=e._getCellObjOffset(d,n.position,"dateStart"===t?"bottom":"top").cellObj,l=g[t];m=new Date(l);const r=m.getHours(),a=m.getMinutes(),o="dateEnd"===t&&0===r&&0===a;m=new Date(i.date),m.setDate(m.getDate()+(u.getDay()-e.firstDayOfWeek+7)%7),o?m.setDate(m.getDate()+1):m.setHours(l.getHours(),l.getMinutes(),l.getSeconds())}else m=new Date(u),m.setMinutes(u.getMinutes()+c*(h+("dateStart"===t?0:1)),0,0);g[t]=m}}_completeEventDragDrop(e){const t=this,n=e.event,i=e.schedulerEvent,l=e.hoveredCell,r=e.hoveredScheduler,a=e.schedulerEventObj;if(r.disableDrop||n&&"keydown"===n.type&&"Escape"===n.key)return;const o=t.view,s=t.views.find(e=>e.value&&e.value===o)||{},d=s&&s.groupOrientation?s.groupOrientation:t.groupOrientation,c=i.$.event,u=c.$?c.$.event:void 0,h=l.$.cellObj,m=h[d].group,g=c.dateStart.getTime(),v=l.$.cellObj.time,f=r===t?c:a;if(r===t&&g===v||t._handleEventExceptionDrop(c,f),g!==v){const e=f.dateEnd.getTime()-f.dateStart.getTime();f.dateStart=new Date(v),f.dateEnd=new Date(f.dateStart.getTime()+e)}if(["day","week"].indexOf(t.viewType)>-1&&(f.allDay&&!h.allDay&&(f.dateEnd=t._getCellDateRange(h).dateEnd),f.allDay=!!h.allDay),m&&!t._isEventPartOfGroup(c,m)){t.groups.forEach(e=>delete f[e]);for(let e in m)f[e]=m[e]}r===t?t._refreshTimelineEvents():(u||t.removeEvent(c),r.insertEvent(f))}_checkEventResizability(e){let t=e.originalEvent.target;this.shadowRoot&&t===this&&(t=e.originalEvent.composedPath()[0]);const n=this.$.timeline;if(!t||!t.closest||this.disabled||this.disableResize||"agenda"===this.viewType)return void n.removeAttribute("event-hovered");let i=t.closest(".smart-scheduler-event");const l=i&&i.$?i.$.event:void 0;if(!n.contains(i)||i.hasAttribute("collector")||!l||l.disableResize)return void n.removeAttribute("event-hovered");const r=this.viewType,a=e.pageX-window.pageXOffset,o=e.pageY-window.pageYOffset,s=this._isMobile?20:5,d=i.getBoundingClientRect();if(r.toLowerCase().indexOf("timeline")>-1||"month"===r||l.allDay){if(Math.round(d.left)+s>=a&&Math.round(d.left)-s<=a)return void n.setAttribute("event-hovered","left");if(Math.round(d.right)+s>=a&&Math.round(d.right)-s<=a)return void n.setAttribute("event-hovered","right")}else{if(Math.round(d.top)+s>=o&&Math.round(d.top)-s<=o)return void n.setAttribute("event-hovered","top");if(Math.round(d.bottom)+s>=o&&Math.round(d.bottom)-s<=o)return void n.setAttribute("event-hovered","bottom")}n.removeAttribute("event-hovered")}_handleEventResize(e){const t=this,n=t._dragDetails,i=n?n.schedulerEvent:void 0;if(t.disableResize||!n||!i||"agenda"===t.viewType)return;t.hasAttribute("resized")||t._setResizeStart(i);const l=e.pageX-window.pageXOffset,r=e.pageY-window.pageYOffset,a=n.resizeDetails,o=a.side,s=t.$.timelineContainer.getBoundingClientRect(),d={x:Math.max(0,l-s.left+t.scrollLeft),y:Math.max(0,r-s.top+t.scrollTop)},c=t._getCellObjOffset(i,d,o);if(t._autoScroll(e),c){if("left"===o||"right"===o){if(!t._resizeEventHorizontal(c,o))return}else if(!t._resizeEventVertical(c,o))return;a.cellObj=c.cellObj,a.scaleIndex=c.scaleIndex}}_setResizeStart(e){const t=this,n=t._dragDetails,i=e.$.event,l=t.$.timeline;if(t.$.fireEvent("resizeStart",{target:n.schedulerEvent,item:t._cloneObject(i),originalEvent:n.originialEvent}).defaultPrevented)return void l.removeAttribute("event-hovered");t.$.tooltip.close(),t.setAttribute("resized",""),e.setAttribute("resized",""),t._scrollView.disableSwipeScroll=t._touchmoveInside=!0;const r=parseFloat(e.style.left),a=parseFloat(e.style.top),o=parseFloat(e.style.width),s={width:o,height:parseFloat(e.style.height)},d=l.getAttribute("event-hovered"),c=t.rightToLeft;let u;u=t.rightToLeft?{x:t.$.timelineContent.offsetWidth-(r+o),y:a}:{x:r,y:a},n.resizeDetails={side:d,originalSize:s,originalPosition:u,position:{x:u.x,y:u.y},size:{width:s.width,height:s.height},isAllDay:t.$.timelineViewAllDay.contains(e),resizeFromStart:"bottom"===d||"right"===d&&!c||"left"===d&&c}}_resizeEventHorizontal(e,t){const n=this._dragDetails,i=n.schedulerEvent,l=this.rightToLeft,r=n.resizeDetails;let a,o=r.position.x,s=e.offset;if("left"===t&&!l||"right"===t&&l){const e=r.originalPosition.x;if(o===s)return;if(o<s?(s=o<e?Math.min(e,s):s,a=r.size.width-(s-o)):(s=o>e?Math.max(e,s):s,a=r.size.width+(o-s)),a<=0)return;r.position.x=s,l?(i.style.left="",i.style.right=s+"px"):(i.style.right="",i.style.left=s+"px")}else{if(o+=r.size.width,s+=e.size,o===s)return;if(a=o<s?r.size.width+(s-o):r.size.width-(o-s),a<=0)return}return r.size.width=a,i.style.width=r.size.width+"px",!0}_resizeEventVertical(e,t){const n=this._dragDetails,i=n.schedulerEvent,l=n.resizeDetails;let r,a=l.position.y,o=e.offset;if("top"===t){const e=l.originalPosition.y;if(a===o)return;if(a<o?(o=a<e?Math.min(e,o):o,r=l.size.height-(o-a)):(o=a>e?Math.max(e,o):o,r=l.size.height+(a-o)),r<=0)return;l.position.y=o,i.style.top=o+"px"}else{if(a+=l.size.height,o+=e.size,a===o)return;if(r=a<o?l.size.height+(o-a):l.size.height-(a-o),r<=0)return}return l.size.height=r,i.style.height=l.size.height+"px",!0}_getCellObjOffset(e,t,n){const i=this,l=i._dragDetails.resizeDetails,r=i._timelineCells,a=e.$.event,o=l.isAllDay?1:i._getCellsScaleCount(),[s,d,c,u]="right"===n||"left"===n?["width","left","horizontal","x"]:["height","top","vertical","y"],h=l.resizeFromStart,m=r[c],g=l.originalSize[s];let v,f=l.originalPosition[u],p=f,w=t[u];h?(f+=g,w=Math.max(p,w)):(p+=g,w=Math.min(p,w));for(let e=0;e<m.length;e++){const t=m[e];t.group&&!i._isEventPartOfGroup(a,t.group)||t[d]<=w&&t[d]+t[s]>=w&&(v=t)}if(!v)return;let y,_=v[d],b=parseFloat((v[s]/o).toFixed(2));for(let e=0;e<o;e++){const t=v[d]+b*e;(p!==w&&t===w||t+b===w||t<w&&t+b>=w)&&(_=t,y=e)}return f>_&&f<_+b&&(h&&w<=f?b=f-_:!h&&w>=f&&(_=f)),{offset:_,size:b,cellObj:v,scaleIndex:y}}_handleEventExceptionDrop(e,t){const n=e.$?e.$.event:void 0;if(t||(t=e),e!==t)return delete t.repeat,void delete t.date;if(!n)return;const i=n.repeat;if(t.date||(t.date=new Date(t.dateStart)),delete t.repeat,i){const e=i.exceptions;e?e.indexOf(t)<0&&e.push(t):i.exceptions=[t]}}_dragStartHandler(e){const t=e.target.closest;(this._dragDetails||t&&t.call(this,"smart-scheduler")===this)&&e.preventDefault()}_autoScroll(e){const t=this,n=t.autoScrollStep,i=t._dragDetails;function l(l,r){r?(t.scrollTop-=n*l,i&&(i.coordinates.y+=n*l)):(t.scrollLeft-=(t.rightToLeft?-1:1)*n*l,i&&(i.coordinates.x+=n*l)),t.hasAttribute("resized")&&t._handleEventResize(e)}if(t.disableAutoScroll||!e||t.$.timelineViewAllDay.contains(e.target)||!t.hasAttribute("dragged")&&!t.hasAttribute("resized"))return void clearInterval(t._scrollInterval);clearInterval(t._scrollInterval);const r=t.$.timelineContainer.getBoundingClientRect();t._scrollInterval=setInterval((function(){(t.scrollLeft||t.rightToLeft)&&e.clientX<=r.left+50?l(1):t.scrollLeft!==(t.rightToLeft?0:t.scrollWidth)&&e.clientX>=r.left+r.width-50?l(-1):t.scrollTop&&e.clientY<=r.top+50?l(1,!0):t.scrollTop!==t.scrollHeight&&e.clientY>=r.top+r.height-50?l(-1,!0):(clearInterval(t._scrollInterval),t._scrollInterval=void 0)}),1)}_createDragFeedback(e){const t=this,n=t._dragDetails.schedulerEvent;let i=document.createElement("div");return t.dragFeedbackFormatFunction?i.innerHTML=t.dragFeedbackFormatFunction(e):(i=n.cloneNode(!0),i.setAttribute("view-type",t.viewType),i.setAttribute("event-render-mode",t.eventRenderMode)),i.className="smart-scheduler-drag-feedback",i.setAttribute("parent-scheduler-id",t.id),t.theme&&i.setAttribute("theme",t.theme),i}_containsEvent(e){const t=this._events;if(!e)return;if(t.indexOf(e)>-1)return e;const n=["label","description","dateStart","dateEnd"],i=this.groups;for(let l=0;l<t.length;l++){const r=t[l];if(n.every(t=>r[t]instanceof Date?new Date(r[t]).getTime()===new Date(e[t]).getTime():r[t]===e[t])&&(!i.length||i.every(t=>e[t]===r[t])))return r}}_keyDownHandler(e){const t=this;if(t.readonly||t.hasAttribute("modal"))return;const n=t.$.tooltip;switch(e.key){case"End":case"Home":case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"PageDown":case"PageUp":e.preventDefault(),t._handleKeyNavigation(e);break;case"Enter":case"Escape":if("Enter"===e.key){if(n.contains(e.target)){const i=n.querySelector("[selected]");i.classList.contains("smart-scheduler-event")?t._doubleClickHandler(e.target):e.target.classList.contains("smart-scheduler-event-button")?(t._deleteEventViaWindow(e.target.closest(".smart-scheduler-event").$.event),n.close()):i.classList.contains("smart-scheduler-context-menu-item")&&t._handleContextMenuItemClick(i),e.preventDefault()}else e.target===t.$.timeline&&(t._openWindow(),e.preventDefault());break}"Escape"===e.key&&(Smart.Scheduler.schedulerStart===t?(t._endDrag(e,t),e.preventDefault()):t.hasAttribute("resized")&&(t._endResize(),e.preventDefault())),n.close(),n.selector&&n.selector.focus({preventScroll:!0});break;case"Tab":{const n=e.target;if(n.classList.contains("smart-scheduler-event")){const i=Array.from(t.$.timeline.querySelectorAll(".smart-scheduler-event")),l=i[i.indexOf(n)+(e.shiftKey?-1:1)];l&&(e.preventDefault(),l.focus({preventScroll:!0}))}break}}}_handleContextMenuItemClick(e){const t=this,n=t.$.tooltip,i=n.selector;switch(e.getAttribute("value")){case"createEvent":{let e;if(i.classList.contains("smart-scheduler-cell")){const n=t._getCellDateRange(i);e={dateStart:n.dateStart,dateEnd:n.dateEnd,allDay:i.hasAttribute("all-day")}}else if(i.classList.contains("smart-scheduler-event")){const t=Object.assign({},i.$.event);e={dateStart:new Date(t.dateStart),dateEnd:new Date(t.dateEnd),allDay:t.allDay}}t._openWindow(e);break}case"editEvent":t._doubleClickHandler(i)}n.close()}_handleKeyNavigation(e){const t=this,n=t.enableShadowDOM?e.composedPath()[0]:e.target,i=t.viewType.toLowerCase(),l=i.indexOf("timeline")>-1,r=e.key;if(n===t.$.timeline){const n=t.$.timelineContent,a=t.$.timelineViewAllDay,o=a.offsetHeight>0;if(!t._selectedCellObj)return t._handleCellSelection((o?a:n).querySelector(".smart-scheduler-cell:not(.scale)")),void(t._selectedCellObj&&t._scrollTo(t._selectedCellObj.to));const s=t._selectedCellObj[e.shiftKey?"to":"from"],d=t._getCellsScaleCount(),c=s.scaleIndex||0,u=d-1;let h,m,[g,v,f]=[s.horizontal,s.vertical,c],p=s.allDay;switch(r){case"Home":case"End":h=t._timelineCells[l?"horizontal":"vertical"],[m,f,p]="Home"===r?[h[0],0,!e.shiftKey&&o]:[h[h.length-1],u,!1],[g,v]=l?[m,v]:[g,m];break;case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":{const e=["ArrowUp","ArrowDown"].indexOf(r)>-1,n="ArrowLeft"===r||"ArrowUp"===r?-1:1;[h,m]=e?[t._timelineCells.vertical,v]:[t._timelineCells.horizontal,g],e&&l||!e&&!l?m=h[h.indexOf(m)+n]:(f+=n,(f<0||f>u)&&(m=h[h.indexOf(m)+n],f=f>u?0:u)),[g,v]=e?[g,m]:[m,v];break}case"PageDown":case"PageUp":{if(l||s.allDay)break;const e=s.vertical.top+t._scrollViewSize.height*("PageUp"===r?-1:1),n=t._timelineCells.vertical;v=t._timelineCells.vertical.find(t=>t.top>=e),v||(v="PageUp"===r?n[0]:n[n.length-1]);break}}e.shiftKey||(p&&"ArrowDown"===r?(v=t._timelineCells.vertical[0],f=0,p=!1):"ArrowUp"!==r||v||(p=o));const w=t._getCellByObj({horizontal:g,vertical:v,scaleIndex:f,allDay:p});if(w){const n=t._selectedCellObj.from;t._handleCellSelection("agenda"!==i&&e.shiftKey&&!!n.allDay==!!p?n:w,w)}}else if(n===t.$.viewItemsContainer){const e=t.$.viewItemsContainer.children,i=Array.from(e).find(e=>e.hasAttribute("selected"));let l;i&&"Home"!==r?"End"===r?l=e[e.length-1]:(t.$.tooltip.contains(n)&&("ArrowUp"===r||"ArrowDown"===r)||t.$.header.contains(n)&&("ArrowLeft"===r||"ArrowRight"===r))&&(l=i["ArrowUp"===r||"ArrowLeft"===r?"previousElementSibling":"nextElementSibling"]):l=e[0],l&&i!==l&&t._handleViewSelection(l)}else if(n===t._list){const e=(t._list.contains(t._eventList)?t._eventList:t._contextList).children,n=Array.from(e).find(e=>e.hasAttribute("selected"));let i;n&&"Home"!==r?"End"===r?i=e[e.length-1]:"ArrowUp"!==r&&"ArrowDown"!==r||(i=n["ArrowUp"===r?"previousElementSibling":"nextElementSibling"]):i=e[0],i&&n!==i&&t._handleEventItemSelection(e,i)}}_handleEventItemSelection(e,t){const n=this;if((n._eventList||n._contextList)&&(n._list.contains(n._eventList)?n._eventList:n._contextList)){e||(e=(n._list.contains(n._eventList)?n._eventList:n._contextList).children);for(let n=0;n<e.length;n++){const i=e[n];i===t?i.setAttribute("selected",""):i.removeAttribute("selected")}}}_getCellByObj(e){if(!e)return;if(!this._scrollTo(e))return;const t=e.allDay,n=t?this.$.timelineViewAllDay:this.$.timelineCellsContainer,i=Array.from(n.querySelectorAll(".smart-scheduler-cell:not(.scale)"));t&&delete e.vertical;const l=Object.keys(e);return i.find(t=>l.every(n=>e[n]===t.$.cellObj[n]||void 0===t.$.cellObj[n]))}_scrollTo(e){const t=this,n=t._getCellsScaleCount(),i=t.viewType.toLowerCase().indexOf("timeline")>-1;let l,r,a,o,s,d,c,u;if(e instanceof HTMLElement&&e.classList.contains("smart-scheduler-event")){const n=t._scrollToEvent(e);if(!n)return;[l,r,a,o]=[n.hCell,n.vCell,n.scaleIndex,n.allDay]}else if(e instanceof Date){const n=t._getCellObjByDate(e);if(!n)return;[l,r,a,o]=[n.hCell,n.vCell,n.scaleIndex,n.allDay]}else{if(e instanceof HTMLElement&&e.$&&(e=e.$.cellObj),!e)return;l=e.horizontal||e,r=e.vertical||e,a=e.scaleIndex||0,o=e.allDay}const h=()=>{const e=t[s];e>u?t[s]=u:e+c<u+d&&(t[s]=Math.max(0,u+d-c))};return l&&([s,d,c]=["scrollLeft",l.width/(i?n:1),t._scrollViewSize.width],u=l.left+d*(i?a:0),h()),r&&!o&&([s,d,c]=["scrollTop",r.height/(i?1:n),t._scrollViewSize.height],u=r.top+d*(i?0:a),h()),!0}_scrollToEvent(e){const t=this;if(!e||!e.$||!t.$.timeline.contains(e))return;const n=e.$.event;if(!n)return;const i=t._getEventHorizontallCellObjs(n),l=t._getEventVerticalCellObjs(n),r=i.start||i.first,a=l.start||l.first;let o=0;return n.allDay||(o=t._getEventScaleIndex(n,t.viewType.indexOf("timeline")>-1?r:a).start),{hCell:r,vCell:l,scaleIndex:o,allDay:n.allDay}}_getCellObjByDate(e){if(!(e instanceof Date)||!e||isNaN(e.getTime()))return;const t=this,n=t.viewType.toLowerCase(),i=t._timelineCells.horizontal,l=t._timelineCells.vertical,r=n.indexOf("month")>-1;let a,o,s,[d,c,u,h,m]=[e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getDay()];if("agenda"===n){if(o=l.find(e=>{const t=e.date;return t.getFullYear()===d&&t.getMonth()===c&&t.getDate()===u}),!o)return}else if(n.indexOf("timeline")<0){if(a=i.find(e=>{const t=e.date;return r&&t.getDay()===m||t.getFullYear()===d&&t.getMonth()===c&&t.getDate()===u}),r&&(s=new Date,s.setDate(s.getDate()-s.getDay()+t.firstDayOfWeek),[d,c,u,h,m]=[s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getDay()]),o=l.find(e=>{const t=e.date;return r?t.getFullYear()===d&&t.getMonth()===c&&t.getDate()===u&&t.getHours()===h:t.getHours()===h}),!a||!o)return}else if(a=i.find(e=>{const t=e.date;return t.getFullYear()===d&&t.getMonth()===c&&t.getDate()===u&&(r||t.getHours()===h)}),!a)return;return{hCell:a,vCell:o,scaleIndex:Math.floor(e.getMinutes()/60*t._getCellsScaleCount())}}_mouseWheelHandler(e){const t=this,n=e.target;t.$.viewSelectorContainer.contains(n)?t._handleViewNavigation(e):t.disabled||n.closest(".smart-scheduler-window-modal")||(e.shiftKey&&t.computedHorizontalScrollBarVisibility?t._handleHorizontalScroll(e):t.computedVerticalScrollBarVisibility&&t._handleVerticalScroll(e))}_handleCellSelection(e,t){const n=this;let i,l;n._selectedCellObj&&(i=n._selectedCellObj.from,l=n._selectedCellObj.to),n.disableSelection?n._selectCell():n._selectCell(e,t),n._selectedCellObj&&(i=n._selectedCellObj.from,l=n._selectedCellObj.to)}_selectCell(e,t){const n=this;function i(){const e=n.$.timeline.querySelectorAll(".smart-scheduler-cell[selected]");for(let t=0;t<e.length;t++)e[t].removeAttribute("selected");delete n._selectedCellObj}if(t||(t=e),!e||"agenda"===n.viewType)return void i();let l=e,r=t;if(e.closest){const t=e.closest(".smart-scheduler-cell:not(.scale)");if(!t||!n.$.timeline.contains(t))return;l=t.$?t.$.cellObj:void 0}if(t.closest){const e=t.closest(".smart-scheduler-cell:not(.scale)");if(!e||!n.$.timeline.contains(e))return;r=e.$?e.$.cellObj:void 0}if(!l||!r||n._isMobile&&l!==r)return;if(l.allDay&&!r.allDay){const e=n.$.timelineViewAllDayCellsContainer.children;for(let t=0;t<e.length;t++){const n=e[t];if(!n.$)continue;const i=n.$.cellObj;if(i.horizontal===r.horizontal){r=i;break}}}if(l.allDay!==r.allDay)return;const a=n.view,o=n.views.find(e=>e.value&&e.value===a)||{},s=o&&o.groupOrientation?o.groupOrientation:n.groupOrientation,d=(l[s]||l).group;if(d!==(r[s]||r).group)return;i();let c,[u,h]=[l.time,r.time];if("agenda"===n.viewType&&u!==h)return;let m={};if(u>h){const e=u;u=h,h=e}m.from=Object.assign({},l),m.to=Object.assign({},r),n._selectedCellObj=m;const g=(l.allDay?n.$.timelineViewAllDay:n.$.timelineContent).querySelectorAll(".smart-scheduler-cell:not(.scale)");for(let e=0;e<g.length;e++){if(c=g[e],c.removeAttribute("selected"),!c.$)continue;const t=c.$.cellObj;if((t[s]||t).group!==d)continue;const n=t.time,i=Object.keys(t);n>=u&&n<=h&&c.setAttribute("selected",l===r||i.every(e=>t[e]===l[e])?"start":"")}n._scrollTo(r)}_getCellTime(e){if(!e)return 0;const t=this,n=t.viewType;let i,l;if(e instanceof HTMLElement&&e.closest(".smart-scheduler-cell:not(.scale)")){if(!e.$||!e.$.cellObj)return 0;i=e.$.cellObj}else i=e;if("agenda"===n)return i.vertical.date.getTime();if("month"===n){l=new Date(i.vertical.date);const e=new Date(i.horizontal.date).getDay()-t.firstDayOfWeek;return l.setDate(l.getDate()+(e<0?7+e:e)),l.getTime()}const r=i.scaleIndex||0,a=60/t._getCellsScaleCount()*60*1e3;return n.indexOf("timeline")<0?(l=new Date(i.horizontal.date),i.allDay||l.setHours(i.vertical.date.getHours())):l=new Date(i.horizontal.date),l.getTime()+a*r}_handleVerticalScroll(e){if(!this.computedVerticalScrollBarVisibility)return!0;const t=this.scrollTop;0===t&&e.deltaY<0||t===this.scrollHeight&&e.deltaY>0?e.stopPropagation():(e.stopPropagation(),e.preventDefault(),this.scrollTo(t+this._getScrollCoefficient(e,this.offsetHeight)))}_handleHorizontalScroll(e){const t=this;if(!t.computedHorizontalScrollBarVisibility)return!0;const n=t.scrollLeft;(0===n&&e.deltaX<0||n===t.scrollHeight&&e.deltaX>0)&&e.stopPropagation(),e.stopPropagation(),e.preventDefault(),t.scrollWidth>0&&t.scrollTo(void 0,t.scrollLeft+t._getScrollCoefficient(e,t.offsetWidth))}_horizontalScrollbarHandler(e){e.stopPropagation(),this.$.timelineContainer.scrollLeft=this._getScrollLeft(e.detail.value),this._recycle(e)}_verticalScrollbarHandler(e){e.stopPropagation(),this.$.timelineContainer.scrollTop=Math.round(e.detail.value),this._recycle(e)}_recycle(e){const t=this,n=t._timelineCells,i=t.$.tooltip;if(n.vertical&&n.horizontal){if(i.visible&&i.close(),!e)return t._recycleHeaderCells(t.$.timelineHeaderHorizontalContent),t._recycleHeaderCells(t.$.timelineHeaderVerticalContent),t._refreshTimelineContentCells(),t._refreshTimelineAllDayCells(),void t._refreshEvents();if("horizontal"===e.context.orientation)return t._recycleHeaderCells(t.$.timelineHeaderHorizontalContent),t._refreshTimelineContentCells(),t._refreshTimelineAllDayCells(),void t._refreshEvents();t._recycleHeaderCells(t.$.timelineHeaderVerticalContent),t._refreshTimelineContentCells(),t._refreshEvents()}}_recycleHeaderCells(e){const t=this,[n,i,l,r]=e===t.$.timelineHeaderHorizontalContent?["horizontal","left","width","scrollLeft"]:["vertical","top","height","scrollTop"],a=e.querySelector(".smart-scheduler-view-time"),o=t._timelineCells[n];if(!o||!o.length)return;const s=t._getFirstCellObjInView(n),d=t._getTimelineVisibleCellsCount(n),c=a.children;for(let e=0;e<c.length;e++){const r=c[e],a=r.children;let u=document.createDocumentFragment();for(;a.length;)u.appendChild(r.firstElementChild);t._recycleContainerCells({fragment:u,cellsNeeded:d});let h=o.indexOf(s);for(let r=0;r<u.children.length;r++){const a=u.children[r],s=o[h];if(a.$={cellObj:s},!s)break;"horizontal"===n?a.style[t.rightToLeft?"right":"left"]=s.left+"px":a.style[i]=s[i]+"px",a.style[l]=s[l]+"px",a.innerHTML=`<div>${s.noLabel?"":t._getDateString({date:new Date(s.date),timeZone:c[e].timeZone},n)}</div>`,s.weekend?a.setAttribute("weekend",""):a.removeAttribute("weekend"),s.nonworking?a.setAttribute("nonworking",""):a.removeAttribute("nonworking"),s.separator?a.setAttribute("separator",""):a.removeAttribute("separator"),s.groupSeparator?a.setAttribute("group-separator",""):a.removeAttribute("group-separator"),s.showLabel?a.setAttribute("show-label",s.showLabel):a.removeAttribute("show-label"),h++}r.appendChild(u)}t._refreshHeaderDetailCells(n),t._refreshHeaderGroupCells(n),e[r]=t[r]}_moveHandler(e){this._isMobile||e.stopPropagation(),(this.hasAttribute("dragged")||this.hasAttribute("resized"))&&"touchmove"===e.originalEvent.type&&e.originalEvent.preventDefault()}_getScrollLeft(e,t){const n=this;return n.rightToLeft?(Smart.Utilities.Core.Browser.Chrome?(t||(t=n.scrollWidth),e=t-e):e*=-1,e):e}_containerClickHandler(e){const t=this;if(t.readonly||t.hasAttribute("modal"))return;const n=t.$.tooltip;let i=(e||e.originalEvent).target;if(t.$.dateSelectorContainer.contains(i))t._handleDateSelection(i.closest(".smart-scheduler-nav"));else if(!n.contains(i)){if(i.closest(".smart-scheduler-view-items-button")){const e=n.visible&&!n.contains(t.$.viewItemsContainer);return t._handleTooltipContent(t.$.viewItemsButton),void(e||n.toggle())}if(t._isMobile&&(t.$.timelineContent.classList.add("hide-overlay"),i=(t.shadwoRoot||document).elementFromPoint(e.pageX-window.pageXOffset,e.pageY-window.pageYOffset),t.$.timelineContent.classList.remove("hide-overlay")),!i.closest(".smart-scheduler-event")&&(n.close(),t.$.viewSelectorContainer.contains(i))){const e=i.closest(".smart-scheduler-nav");return e?void t._handleViewNavigation(e):void t._handleViewSelection(i.closest(".smart-scheduler-item"))}}}_containerContextMenuHandler(e){const t=this;let n=e.target;if(t.disableContextMenu)return;const i=e.pageX-window.pageXOffset,l=e.pageY-window.pageYOffset;t._isMobile&&(t.$.timelineContent.classList.add("hide-overlay"),n=(t.shadwoRoot||document).elementFromPoint(i,l),t.$.timelineContent.classList.remove("hide-overlay")),t.$.timelineContent.contains(n)||t.$.timelineViewAllDay.contains(n)?(e.preventDefault(),t._handleCellSelection(),n=n.closest(".smart-scheduler-event")||n.closest(".smart-scheduler-cell"),t._handleTooltipContent(n,{x:i,y:l})):t.$.tooltip.close()}_handleViewNavigation(e){let t;if(!e)return;const n=this.$.viewItemsContainer;t=e instanceof Smart.RepeatButton?10*(e.hasAttribute("prev")?-1:1):e.deltaY,n.scrollLeft+=t;const i=this._viewButtons;if(!i)return;t=n.scrollLeft;const l=i.prev,r=i.next;l.disabled=!t,r.disabled=n.offsetWidth+t===n.scrollWidth}_handleDateSelection(e){const t=this,n=t.$.tooltip;if(e instanceof HTMLElement)if(e.hasAttribute("prev"))n.close(),t._navigateDate(-1);else if(e.hasAttribute("current")){const e=n.visible&&!n.contains(t._calendar);t._handleTooltipContent(t.$.currentDate),e||n.toggle()}else e.hasAttribute("next")&&(n.close(),t._navigateDate(1))}_navigateDate(e){const t=this,n=t.viewType.toLowerCase();let i=t.dateCurrent,l=new Date(i);if(l.setHours(0,0,0,0),n.includes("day"))l.setDate(l.getDate()+e);else if(n.includes("week")||"agenda"===n)l.setDate(l.getDate()+7*e);else{let t=new Date(l);e>0?(t.setDate(1),t.setMonth(t.getMonth()+2),t.setDate(0)):t.setDate(0),l.setMonth(l.getMonth()+e),l.getMonth()!==t.getMonth()&&(l=t)}l.setHours(i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds()),t._refreshDateNavButtons(l),l.getTime()>t.max||l.getTime()<t.min||(t.set("dateCurrent",l),t._calendar&&(t._calendar.selectedDates=[new Date(t.dateCurrent)],t.$.tooltip.contains(t._calendar))||(t._createTimeline(),t._refreshDateSelector()))}_refreshDateNavButtons(e){const t=this;e||(e=t.dateCurrent);const n=t.$.dateSelectorContainer,i=n.querySelector(".smart-scheduler-nav[prev]"),l=n.querySelector(".smart-scheduler-nav[next]");i&&(i.disabled=e.getTime()<=t.min),l&&(l.disabled=e.getTime()>=t.max)}_handleTooltipContent(e,t){const n=this,i=n.$.tooltip;if(e){if(e===n.$.currentDate){i.selector=n.$.currentDate;let e=n._calendar;e||(e=document.createElement("smart-calendar"),e.firstDayOfWeek=n.firstDayOfWeek,e.selectionMode="oneExtended",e.selectedDates=[new Date(n.dateCurrent)],e.max=n.max,e.min=n.min,e.classList.add("smart-scheduler-calendar-popup"),n._calendar=e),l(e)}else if(e===n.$.viewItemsButton)i.selector=n.$.viewItemsButton,l(n.$.viewItemsContainer);else if(e.classList.contains("smart-scheduler-event")||e.classList.contains("smart-scheduler-cell")){let r,a=n._list;if(a||(n._list=a=document.createElement("smart-scroll-viewer"),a.horizontalScrollBarVisibility="hidden"),a.theme=n.theme,a.tabIndex=n.tabIndex,a.rightToLeft=n.rightToLeft,n.inverted?a.setAttribute("inverted",""):a.removeAttribute("inverted"),r=t?n._getContextMenu(e,t):n._getEventList(e),!r||!r.innerHTML)return;if(a.focus({preventScroll:!0}),n._handleEventItemSelection(),a.contains(r)){if(i.selector===e&&i.contains(a)){if(t){const e=n.getBoundingClientRect();return i.style.top=Math.min(t.y+1,e.bottom-i.offsetHeight)+"px",i.style.left=Math.min(t.x+1,e.right-i.offsetWidth)+"px",void i.open()}return i.visible&&i.selector&&i.selector.focus({preventScroll:!0}),void i.toggle()}}else a.isCompleted&&a.removeAll(),a.appendChild(r);if(i.selector=e,l(a),a.refresh(),t){const e=n.getBoundingClientRect();i.style.top=Math.min(t.y+1,e.bottom-i.offsetHeight)+"px",i.style.left=Math.min(t.x+1,e.right-i.offsetWidth)+"px"}i.visible?t||i.reposition():i.open()}}else i.close();function l(e){e&&!i.contains(e)&&(i.clear(),i.appendChild(e))}}_getContextMenu(e){const t=this,n=t.$.tooltip;let i=t._contextList,l=t.contextMenuDataSource;if(e.classList.contains("smart-scheduler-event")&&!e.hasAttribute("collector"))l=l||["createEvent","editEvent"];else{if(!e.classList.contains("smart-scheduler-cell"))return void n.close();l=l||["createEvent"]}n.position="absolute",n.arrow=!1,i||(t._contextList=i=document.createElement("div"),i.classList.add("smart-scheduler-context-menu"));const r=document.createDocumentFragment(),a=Array.from(i.children);for(let e=0;e<a.length;e++){const t=a[e];l.indexOf(t.getAttribute("value"))<0&&t.remove()}for(let e=0;e<l.length;e++){const n=l[e];let i,o,s=a[e];"string"==typeof n?i=o=n:(i=n,o=n),s||(s=document.createElement("div"),s.classList.add("smart-scheduler-context-menu-item"),r.appendChild(s)),s.innerHTML=t.localize(i)||i,s.setAttribute("value",o)}return i.appendChild(r),i}_getEventList(e){const t=this;if(!e.classList.contains("smart-scheduler-event")||!e.$)return;const n=e.hasAttribute("collector"),i=n?e.$.events:[e.cloneNode(!0)];let l=t._eventList;if(!i||!i.length)return void(l&&(l.innerHTML=""));const r=t.$.tooltip;r.position="auto",r.arrow=!0,l||(l=document.createElement("div"),l.classList.add("smart-scheduler-collector-event-list"),t._eventList=l),l._target=e;const a=document.createDocumentFragment(),o=Array.from(l.children),s={isAllDayEvent:t.$.timelineViewAllDay.contains(e)};for(let e=0;e<o.length;e++){const t=o[e];i.indexOf(t)<0&&t.remove()}for(let l=0;l<i.length;l++){const r=i[l];n||(r.$=e.$),s.eventObj=r.$.event,s.isAllDayEvent=s.eventObj.allDay,t._setEventCellContent(r,s),a.appendChild(i[l])}return l.appendChild(a),l}_tooltipVisibilityHandler(e){const t=this,n=t.getRootNode().host||t.getRootNode();if(e.stopPropagation(),n!==document&&!document.body.contains(n))return;const i=t.$.tooltip;if("opening"===e.type){i.classList.remove("smart-visibility-hidden"),t.getShadowRootOrBody().appendChild(i);const e=i.$.content instanceof HTMLElement?i.$.content.querySelector("[tabindex]"):null;e&&e.focus({preventScroll:!0})}else t.hasAnimation?i.addEventListener("animationend",()=>{i.visible||(i.classList.add("smart-visibility-hidden"),i.style.top=i.style.left="",t.$.container.appendChild(i))},{once:!0}):t.$.container.appendChild(i)}_tooltipChangeHandler(e){const t=this,n=t._calendar;if(e.target===n)return e.stopPropagation(),t.set("dateCurrent",n.selectedDates[0]||t.dateCurrent),t._refreshDateSelector(),t._createTimeline(),void e.context.close()}_tooltipClickHandler(e){const t=this,n=t.$.tooltip,i=t.isInShadowDOM?(e||e.originalEvent).composedPath()[0]:(e||e.originalEvent).target;if(t.$.viewItemsContainer.contains(i))return t._handleViewSelection(i.closest(".smart-scheduler-item")),void n.close();const l=i.closest(".smart-scheduler-event");if(l)return i.closest(".smart-scheduler-event-button")?(t._deleteEventViaWindow(l.$.event),void n.close()):void t._doubleClickHandler(i);const r=i.closest(".smart-scheduler-context-menu-item");r&&t._handleContextMenuItemClick(r)}_tooltipKeyDownHandler(e){this._keyDownHandler(e)}_tooltipDownHandler(e){e.stopPropagation(),this._downHandler(e)}_tooltipContextMenuHandler(e){e.preventDefault()}_timelineFocusHandler(){const e=this;if(e.readonly||e.hasAttribute("modal"))return;const t=e.$.timelineViewAllDay,n=t.offsetHeight>0;e._isMobile||e._dragDetails&&e._dragDetails.timelineCellObj||(e._selectedCellObj?e._selectedCellObj.from.time!==e._selectedCellObj.to.time&&e._handleCellSelection(e._selectedCellObj.from):e._handleCellSelection((n?t:e.$.timelineContent).querySelector(".smart-scheduler-cell:not(.scale)")))}_handleViewSelection(e){const t=this,n=t.$.viewItemsContainer.children;let i;e instanceof HTMLElement&&(i=e.$?e.$.value:null),i||(i=t.view);for(let t=0;t<n.length;t++){const l=n[t];l.removeAttribute("selected"),!e&&l.$&&l.$.value===i&&(e=l)}e&&e.setAttribute("selected","");const l=t.view;i!==l&&(t.set("view",i),t._createTimeline(),t._refreshDateSelector(),t._scrollToView(e),t.$.fireEvent("viewChange",{oldValue:l,value:i}))}_scrollToView(e){if("tabs"!==this.viewSelectorType)return;const t=this.$.viewItemsContainer;if(!(e=e||t.querySelector(".smart-scheduler-item[selected]")))return;const n=t.offsetWidth,i=e.offsetLeft,l=e.offsetWidth;let r=t.scrollLeft;r>i?r=t.scrollLeft=i:r+n<i+l&&(r=t.scrollLeft=Math.max(0,i+l-n));const a=this._viewButtons;a.prev.disabled=!r,a.next.disabled=r+n===t.scrollWidth}_resizeEventHandler(){const e=this;clearTimeout(e._resizeTimeout),e._resizeTimeout=setTimeout((function(){if(e._noResizeHandler)return void delete e._noResizeHandler;const t=e.$.tooltip;e._positionWindow(),e._createTimeline(),t.visible&&t.reposition(),e._refreshViewSelector()}),20)}_setScrollBars(){const e=this;e._scrollView||(e._scrollView=new Smart.Utilities.Scroll(e.$.timeline,e.$.horizontalScrollBar,e.$.verticalScrollBar));const t=e._scrollView.vScrollBar,n=e._scrollView.hScrollBar;n.$.addClass("smart-hidden"),t.$.addClass("smart-hidden"),t.hasStyleObserver=!1,n.hasStyleObserver=!1,t.hasResizeObserver=!1,n.hasResizeObserver=!1,n.wait=!1,t.wait=!1,e._refresh()}_setFocusable(){const e=this;if(e.disabled||e.unfocusable)return e.removeAttribute("tabindex"),e.$.timeline.removeAttribute("tabindex"),void e.$.viewItemsContainer.removeAttribute("tabindex");const t=e.tabIndex>0?e.tabIndex:0;e.tabIndex=t,e.$.tooltip.tabIndex=t,e.$.timeline.tabIndex=t,e.$.viewItemsContainer.tabIndex=t}_refresh(){const e=this;function t(){const t=e.$.timelineContent.offsetWidth-e.$.timelineContainer.offsetWidth;return t>0&&"hidden"!==e.horizontalScrollBarVisibility||"visible"===e.horizontalScrollBarVisibility?e.$container.addClass("hscroll"):e.$container.removeClass("hscroll"),t}function n(){const t=e.$.timelineContent.offsetHeight-e.$.timelineContainer.offsetHeight;return t>0&&"hidden"!==e.verticalScrollBarVisibility||"visible"===e.verticalScrollBarVisibility?e.$container.addClass("vscroll"):e.$container.removeClass("vscroll"),t}const i=e.scrollWidth,l=e.scrollHeight;let r=t(),a=n();a&&l===a||(r=t()),r&&i===r||(a=n()),e.scrollWidth=r,e.scrollHeight=a,e.$.horizontalScrollBar.refresh(),e.$.verticalScrollBar.refresh()}_setHeader(){const e=this,t=e.$.header;if(e.headerTemplate)return void(t.innerHTML="");const n=e.$.dateSelectorContainer;t.contains(n)||(t.innerHTML="",t.appendChild(n),t.appendChild(e.$.viewSelectorContainer)),e._refreshDateSelector(),e._refreshViewSelector()}_refreshDateSelector(){const e=this;let t=new Date(e.dateCurrent);isNaN(t.getTime())&&(t=new Date);let n="";if(e.dateSelectorFormatFunction)n=e.dateSelectorFormatFunction(t)+"";else{const i=e.viewType.toLowerCase();if(i.indexOf("day")>-1)n=t.toLocaleDateString(e.locale,{day:e.dayFormat,timeZone:e.timeZone});else if(i.indexOf("week")>-1||"agenda"===i){const l=new Date(t);"agenda"!==i&&l.setDate(l.getDate()-l.getDay()+e.firstDayOfWeek);const r=new Date(l);r.setDate(r.getDate()+6),n=l.toLocaleDateString(e.locale,{day:e.dayFormat,timeZone:e.timeZone}),l.getMonth()!==r.getMonth()&&(n+=" "+l.toLocaleDateString(e.locale,{month:e.monthFormat,timeZone:e.timeZone})),l.getFullYear()!==r.getFullYear()&&(n+=" "+l.toLocaleDateString(e.locale,{year:e.yearFormat,timeZone:e.timeZone})),n+="-"+r.toLocaleDateString(e.locale,{day:e.dayFormat,timeZone:e.timeZone}),t=r}n+=" "+t.toLocaleDateString(e.locale,{month:e.monthFormat,timeZone:e.timeZone})+" "+t.toLocaleDateString(e.locale,{year:e.yearFormat,timeZone:e.timeZone})}e.$.currentDate.innerHTML=n}_refreshViewSelector(){const e=this,t=e.views,n=e.viewSelectorType,i=e.$.viewSelectorContainer,l=e.$.viewItemsContainer,r=e.$.viewItemsButton,a=e.$.tooltip,o=a.contains(l);for(i.classList.add("smart-visibility-hidden"),r.classList.add("smart-visibility-hidden"),i.classList.remove("no-overflowing"),l.remove();t.length<l.children.length;)l.firstElementChild.remove();for(;t.length>l.children.length;){const e=document.createElement("div");e.classList.add("smart-scheduler-item"),l.appendChild(e)}const s=l.children;for(let n=0;n<s.length;n++){const i=s[n],l=t[n];let r;if("string"==typeof t[n])i.innerHTML="<div>"+e.localize(r=t[n])+"</div>";else{const t=l.label;r=l.value,i.innerHTML="<div>"+("string"!=typeof t&&isNaN(t)?e.localize(r):t)+"</div>"}i.$={value:r}}if(i.appendChild(l),e._viewButtons)for(let t in e._viewButtons)e._viewButtons[t].remove();const d=i.offsetWidth-l.offsetWidth<0;if("tabs"===n){let t,n;return o&&a.close(),d&&(e._viewButtons||(t=document.createElement("smart-repeat-button"),n=document.createElement("smart-repeat-button"),t.classList.add("smart-scheduler-nav"),n.classList.add("smart-scheduler-nav"),t.setAttribute("prev",""),n.setAttribute("next",""),e._viewButtons={prev:t,next:n}),t=e._viewButtons.prev,n=e._viewButtons.next,i.classList.add("no-overflowing"),i.insertBefore(t,l),i.appendChild(n)),i.classList.remove("smart-visibility-hidden"),void e._handleViewSelection()}delete e._viewButtons,"menu"===n||d?(o?(a.clear(),a.appendChild(l)):l.remove(),r.classList.remove("smart-visibility-hidden")):o&&a.close(),i.classList.remove("smart-visibility-hidden"),e._handleViewSelection()}_createEvents(e){const t=this;let n=void 0!==e;if(n||(e=t.dataSource,t._clearEvents()),!Array.isArray(e)||!e.length)return;let i=[];for(let n=0;n<e.length;n++){const l=e[n];let r,a;const o=!!l.allDay;if(r=t._dateValidator(void 0,l.dateStart),a=t._dateValidator(void 0,l.dateEnd),!r||!r.getTime())continue;if(!a||!a.getTime()){if(!o)continue;a=new Date(r),a.setHours(23,59,59,999)}const s=Object.assign({},l,{dateStart:r,dateEnd:a,allDay:o,label:l.label||""});s.dateEnd=new Date(Math.max(s.dateStart.getTime(),s.dateEnd.getTime()));const d=s.repeat;if(d){const e=["hourly","daily","weekly","monthly","yearly"];for(let n in d)if("repeatFreq"===n&&e.indexOf(d[n])<0)d[n]=e[0];else if("repeatInterval"===n)d[n]=isNaN(d[n])?1:d[n];else if("exceptions"===n){let e=d[n];Array.isArray(e)||(e=[e]);for(let n=0;n<e.length;n++){let i=e[n];void 0===i.date?i={date:t._parseDate(i)}:i.date||(i.date=new Date(i.dateStart)),e[n]=i}}}t._containsEvent(s)||i.push(s)}if(n)return i;t._events=i}_clearEvents(){const e=this;e._events=[],e._eventList&&e._eventList.removeAll(),e.$.timelineEventsContainer.innerHTML="",e.$.allDayEventsContainer.innerHTML="",delete e._eventsBetween,e.rendered&&(e.viewType.indexOf("agenda")>-1?e._createTimeline():e._refreshTimelineContentCells())}_refreshEvents(){const e=this,t=e._events,n=e.$.timelineEventsContainer,i=e.$.allDayEventsContainer,l=e._timelineCells;if(!t||!l.horizontal||!l.vertical)return n.innerHTML="",i.innerHTML="",void delete e._eventsBetween;const r=l.groups,a=e._getViewEvents();let o=[],s=e._eventsBetween.eventCellDetails;if(s){const t=s.eventGroups,n=s.cellRanges;for(let i=0;i<t.length;i++)o=o.concat(e._createTimelineEvents(t[i],n[i]).usedEventCells)}else{const n=e.$.timeline.querySelectorAll(".smart-scheduler-event[collector]");for(let e=0;e<n.length;e++)n[e].$&&(n[e].$.events=n[e].$.events.reduce((e,n)=>(t.indexOf(n)>-1&&e.push(n),e),[]));s={eventGroups:[],cellRanges:[],allDayEvents:[]};let i=[];if(r&&r.length){const t=r[r.length-1].cells;for(let n=0;n<t.length;n++){const l=a.filter(i=>e._isEventPartOfGroup(i,t[n])),r=e._getTimelineEventCells(l,i),d=e._createTimelineEvents(l,r);s.eventGroups.push(l),s.cellRanges.push(r),o=o.concat(d.usedEventCells)}}else{const t=e._getTimelineEventCells(a,i),n=e._createTimelineEvents(a,t);s.eventGroups.push(a),s.cellRanges.push(t),o=o.concat(n.usedEventCells)}}if(e._eventsBetween.eventCellDetails=s,e.hasAttribute("resized"))return;const d=Array.from(n.children).concat(Array.from(i.children)),c=e._eventList;for(let e=0;e<d.length;e++){const t=d[e];o.indexOf(t)<0&&(t.remove(),c&&c._target===t&&(c.innerHTML="",delete c._target))}}_getViewEvents(){const e=this.viewType.toLowerCase(),t=this.dateCurrent,n=this.firstDayOfWeek;let i=new Date(t),l=new Date(t);if("agenda"===e)i.setHours(0,0,0,0),l.setDate(l.getDate()+6),l.setHours(23,59,59,999);else if(e.indexOf("month")>-1){i.setDate(1),i.setDate(i.getDate()-(i.getDay()-n+7)%7),i.setHours(0,0,0,0),l=new Date(i);for(let e=0;e<5;e++)l.setDate(l.getDate()+7);l.setDate(l.getDate()+6)}else e.indexOf("week")>-1?(i.setDate(i.getDate()-i.getDay()+n),l.setDate(i.getDate()+6),i.setHours(0,0,0,0),l.setHours(23,59,59,999)):e.indexOf("day")>-1&&(i.setHours(0,0,0,0),l.setHours(23,59,59,999));return this._getEventsBetween(i,l)}_refreshTimelineEvents(){delete this._eventsBetween,"agenda"===this.viewType?this._createTimeline():this._refreshEvents()}_getTimelineEventCells(e,t){const n=this,i=["day","week"].indexOf(n.viewType)>-1,l=n.hideAllDay;let r=[];for(let a=0;a<e.length;a++){const o=e[a];let s,d=[];if(i){const e=o.dateStart,t=o.dateEnd;(o.allDay||e.getFullYear()!==t.getFullYear()||e.getMonth()!==t.getMonth()||e.getDate()!==t.getDate())&&(s=!0)}o.hidden||s&&l?r.push(d):(d=n._getEventTimelineCells(o,t,s),r.push(n._getEventTimelineCellRanges(d,s)))}return r}_createTimelineEvents(e,t){const n=this,i=n.viewType,l=n.eventRenderMode,r="classic"===l?"month"===i?n._monthViewNumberSize:0:n._eventCollectorSize,a=["day","week"].indexOf(i)>-1,o=n._getCellSize(),s=o[a?"width":"height"]-r,d=n.view,c=n.views.find(e=>e.value&&e.value===d)||{},u=c&&c.groupOrientation?c.groupOrientation:n.groupOrientation,h=Math.min(s,n._eventSize);let m={viewType:i,groupOrientation:u,isMobile:n.$.timeline.hasAttribute("mobile"),isDayOrWeekView:a,eventRenderMode:l,cellSize:o,eventSize:h,collectorSize:r,spaceAvailable:s,usedEventCells:[],eventIndexes:[]},g=[];if(a){let[i,l,a]=[[],[],[]];for(let n=0;n<e.length;n++){const r=e[n],o=r.dateStart,s=r.dateEnd;r.allDay||o.getFullYear()!==s.getFullYear()||o.getMonth()!==s.getMonth()||o.getDate()!==s.getDate()?(g.push(r),i.push(t[n])):(l.push(r),a.push(t[n]))}m.events=l,m.eventCells=a,n._setHorizontalTimelineEvents(m),g.length&&(m.events=g,m.eventCells=i,m.eventSize=h,m.eventIndexes=[],m.isAllDayEvent=!0,m.cellSize={height:n._allDayCellSize,width:o.width},m.spaceAvailable=n._allDayCellSize-r,n._setVerticalTimelineEvents(m))}else m.events=e,m.eventCells=t,n._setVerticalTimelineEvents(m);return{usedEventCells:m.usedEventCells,allDayEvents:g,allDayEventIndexes:m.eventIndexes}}_setHorizontalTimelineEvents(e){const t=this,n=e.events,i=e.eventCells,l=e.eventRenderMode;if("modern"===l&&e.isMobile)return t._setAgendaOrMobileEvents(e);const r=e.eventIndexes,a=e.spaceAvailable,o="classic"===l?1:t._eventSize,[s,d]=[t.scrollTop,t.scrollLeft],[c,u]=[s+t._scrollViewSize.height,d+t._scrollViewSize.width],h=t._getEventsCollisionIndexes(e),m=h.eventOverlaps;let g=h.eventsInCollision;"modern"===l&&(g=Math.min(Math.floor(a/o),g));for(let h=0;h<n.length;h++){const v=i[h],f=n[h];e.eventObj=f,e.cellEventsCount=g;for(let i=0;i<v.length;i++){const p=v[i],w=p[0];if(!w)continue;const y=r[h],_=m.filter(e=>e.indexOf(f)>-1);let b=1;for(let e=y+1;e<g&&_.every(t=>t.map(e=>r[n.indexOf(e)]).indexOf(e)<0);e++)b++;if(e.cellRange=p,e.eventIndex=y,e.eventSize=a/g*b,"modern"===l&&(y+1)*o>a){t._addEventToCollector(e);continue}const C=p[p.length-1],[D,S]=[w.vertical,C.vertical],[T,E]=[w.horizontal,C.horizontal];S.top+S.height>=s&&D.top<=c&&E.left+E.width>=d&&T.left<=u&&t._setEventCell(e)}}return e.usedEventCells}_getEventsCollisionIndexes(e,t="horizontal"){const n=this,i=e.events,l=e.eventIndexes;let r=[];if("horizontal"===t){let t=1;for(let a=0;a<i.length;a++){const o=i[a];if(!e.eventCells[a].length)continue;e.eventObj=o,e.eventsInCollision=t;const s=n._getEventsInCollision(e);t=Math.max(t,s.length),r[a]=s,l[a]=s.indexOf(o)}return delete e.eventsInCollision,{eventOverlaps:r,eventsInCollision:t}}let a=[];for(let t=0;t<i.length;t++){const o=i[t];e.eventObj=o;const s=n._getEventsInCollision(e),d=r.filter(e=>e.indexOf(o)>-1);if(a[t]=s.length,d.length){d.sort((e,t)=>t.length-e.length);let e=Math.max(s.length,d[0].length);d.forEach(t=>t.forEach(t=>{const n=i.indexOf(t);a[n]=Math.max(a[n],e)}))}r[t]=s,l[t]=s.indexOf(o)}return{eventOverlaps:r,eventCollisionsCount:a}}_getEventsInCollision(e){const t=this,n=t._getEventCellDetails(e),i=n.eventCellStartTime,l=n.eventCellEndTime,r=n.hCellGroup,a=n.vCellGroup;let o=e.events,s=[],d=[];for(let e=0;e<o.length;e++){const n=o[e];if(r&&!t._isEventPartOfGroup(n,r)||a&&!t._isEventPartOfGroup(n,a))continue;const c=n.dateStart.getTime(),u=n.dateEnd.getTime();c>=i&&c<=l?s.push(n):u>i&&c<l&&d.push(n)}return!s.length&&d.length&&(s=d,d=[]),t._sortEventCellObjs(s,e.isDayOrWeekView),t._getOrderedEventCollision(e,s,d)}_sortEventCellObjs(e,t){t?e.sort((e,t)=>{const n=e instanceof HTMLElement?e.$.event:e,i=t instanceof HTMLElement?t.$.event:t,l=n.dateStart.getTime(),r=i.dateStart.getTime();return l===r?i.dateEnd.getTime()-n.dateEnd.getTime():l-r}):e.sort((e,t)=>{const n=e instanceof HTMLElement?e.$.event:e,i=t instanceof HTMLElement?t.$.event:t;n.dateStart.getTime(),i.dateStart.getTime()})}_getOrderedEventCollision(e,t,n){const i=e.events,l=e.eventIndexes,r=Math.max(e.eventsInCollision||1,t.length+n.length);let a=[];if(n.length){const e=n.map(e=>l[i.indexOf(e)]);for(let i=0;i<r;i++){const l=n[e.indexOf(i)];if(l)a.push(l);else{const e=t.find(e=>a.indexOf(e)<0);e&&a.push(e)}}n.forEach(e=>a.indexOf(e)<0?a.push(e):null)}else a=t;return a}_getEventCellDetails(e){const t=this,n=t.viewType;if("month"===n)return t._getMonthEventCellDetails(e);const i=e.eventObj,l=i.dateStart,r=i.dateEnd,a=t._getEventHorizontallCellObjs(i),o=t._getEventVerticalCellObjs(i),s=o.start||o.first,d=s.group;let c,u,h,m=a.start,g=0;if(m||(m=a.first),u=m.group,c=m.date,e.isAllDayEvent)c>l.getTime()&&(c=new Date(l),c.setHours(c.getHours(),0,0,0)),h=new Date(c),h.setHours(23,59,59,999),c=c.getTime(),h=h.getTime();else{let e=t._getCellsScaleCount();g=t._getEventScaleIndex(i,n.indexOf("timeline")>-1?m:s).start,c=t._getCellTime({horizontal:m,vertical:s,scaleIndex:g}),c>l.getTime()?(c=new Date(l),c.setHours(c.getHours(),0,0,0),c=c.getTime(),e=1):c<l.getTime()&&(c=new Date(c),c.setMinutes(l.getMinutes()),c=c.getTime()),h=c+60*("timelineMonth"===n?1440:60/e)*1e3-1,h>r.getTime()&&(h=new Date(h),h.setMinutes(r.getMinutes()),h=h.getTime())}return{eventCellStartTime:c,eventCellEndTime:h,hCellGroup:u,vCellGroup:d}}_getMonthEventCellDetails(e){const t=e.eventObj,n=t.dateStart,i=t.dateEnd,l=this._getEventVerticalCellObjs(t);let r,a,o,s,d,c=l.start||l.first;c=l.start,s=c.group;const u=new Date(c.date),h=new Date(c.date),m=Object.assign({},t);h.setDate(h.getDate()+6),h.setHours(23,59,59,999),u.setHours(0,0,0,0),m.dateStart=new Date(Math.max(n.getTime(),u.getTime())),m.dateEnd=new Date(Math.min(i.getTime(),h.getTime()));const g=this._getEventHorizontallCellObjs(m);return r=g.start,r||(r=g.first),o=r.group,a=r.date,a=this._getCellTime({horizontal:r,vertical:c,scaleIndex:0}),a>n.getTime()&&(a=new Date(n),a=a.getTime()),d=a+864e5-1,d>i.getTime()&&(d=new Date(d),d.setMinutes(i.getMinutes()),d=d.getTime()),{eventCellStartTime:a,eventCellEndTime:d,hCellGroup:o,vCellGroup:s}}_getEventScaleIndex(e,t){const n=this,i=n._getCellsScaleCount(),l=60/i,r=e.dateStart,a=e.dateEnd;let o,s,d,c,u=0,h=l;if(t){const e=t.date;let l=new Date(e),u=new Date(e);n.viewType.indexOf("timeline")<0&&(l=new Date(r),u=new Date(a),l.setHours(e.getHours(),e.getMinutes(),0,0),u.setHours(e.getHours(),e.getMinutes(),0,0)),l=l.getTime(),u=l+36e5,r.getTime()<=l&&(d=!0,o=0),a.getTime()>=u&&(c=!0,s=i-1)}if(void 0===o||void 0===s){const e=r.getMinutes(),t=a.getMinutes();for(let n=0;n<i;n++)!d&&u<=e&&h>=e&&(o=n),!c&&u<t&&h>=t&&(s=n),u+=l,h+=l}return{start:o||0,end:s||0}}_getEventVisibleDateRange(e){const t=this,n=e.dateStart,i=e.dateEnd;if(t.viewType.toLowerCase().indexOf("day")>-1)return{dateStart:n,dateEnd:i};const l=t.view,r=t.views.find(e=>e.value&&e.value===l)||{};let a=new Date(n),o=new Date(i),s=[];if(0===o.getHours()&&0===o.getMinutes()&&0===o.getSeconds()&&(o.setDate(o.getDate()-1),o.setHours(i.getHours(),i.getMinutes(),i.getSeconds(),0)),(t.hideNonworkingWeekdays||r.hideNonworkingWeekdays)&&(t.nonworkingDays||r.nonworkingDays).forEach(e=>s.push(e)),(t.hideWeekend||r.hideWeekend)&&[0,6].forEach(e=>s.push(e)),![0,1,2,3,4,5,6].every(e=>s.indexOf(e)>-1)){for(;s.indexOf(a.getDay())>-1;)a.setDate(a.getDate()+1);for(;s.indexOf(o.getDay())>-1;)o.setDate(o.getDate()-1);return a.getTime()<o.getTime()?{dateStart:a,dateEnd:o}:void 0}}_getEventHorizontallCellObjs(e){const t=this.hourStart,n=this.hourEnd,i=this._getEventVisibleDateRange(e);if(!i)return;const l=i.dateStart,r=i.dateEnd,a=l.getHours(),o=r.getHours(),s=r.getTime()>l.getTime()&&r.getMinutes()+r.getSeconds()+r.getMilliseconds()===0,d=this.viewType;return this._getEventCellObjs(e,(function(e,i){let c;arguments.length?(c=!0,i||(i=e)):(e=l,i=r);let u=new Date(e),h=new Date(i);switch(d){case"agenda":u=l,h=r;break;case"day":case"week":case"timelineMonth":c?(u.setHours(0,0,0,0),h.setHours(23,59,59,999)):(h=new Date(r),h.setHours(h.getHours(),h.getMinutes(),0,0),s&&(h=new Date(h.getTime()-1),h.setHours(h.getHours(),59,59,999)));break;case"timelineDay":case"timelineWeek":if(c){const l=e.getHours(),r=i.getHours();u.setHours(l===t&&a<t?a:l,0,0,0),h.setHours(r===n&&o>n?o:r,59,59,999)}else s&&(h=new Date(h.getTime()-1),h.setHours(h.getHours(),59,59,999)),h.setHours(Math.min(h.getHours(),n),h.getMinutes(),0,0);break;case"month":return!c&&s&&(h=new Date(r.getTime()-1),h.setHours(h.getHours(),59,59,999)),{start:u.getDay(),end:h.getDay()}}return u=u.getTime(),h=h.getTime(),{start:u,end:h}}),"horizontal")}_getEventVerticalCellObjs(e){const t=this.hourStart,n=this.hourEnd,i=this._getEventVisibleDateRange(e);if(!i)return;const l=i.dateStart,r=i.dateEnd,a=l.getHours(),o=r.getHours(),s=r.getTime()>l.getTime()&&r.getMinutes()+r.getSeconds()+r.getMilliseconds()===0,d=this.viewType;return this._getEventCellObjs(e,(function(e,i){let c;arguments.length?(c=!0,i||(i=e)):(e=l,i=r);let u=new Date(e),h=new Date(i);switch(d){case"day":case"week":if(u=new Date(l),h=new Date(r),c){const l=e.getHours(),r=i.getHours();u.setHours(l===t&&a<t?a:l,0,0,0),h.setHours(r===n&&o>n?o:r,59,59,999)}else u.setHours(u.getHours(),u.getMinutes(),0,0),h.setHours(h.getHours(),h.getMinutes(),0,0),s&&(h=new Date(h.getTime()-1),h.setHours(h.getHours(),59,59,999));break;case"agenda":c&&(u.setHours(0,0,0,0),h.setHours(23,59,59,999));break;case"month":c?(u.setHours(0,0,0,0),h=new Date(e),h.setDate(h.getDate()+6),h.setHours(23,59,59,999)):s&&(h=new Date(h.getTime()-1),h.setHours(h.getHours(),59,59,999));break;case"timelineDay":case"timelineWeek":case"timelineMonth":return{start:0,end:0}}return u=u.getTime(),h=h.getTime(),{start:u,end:h}}),"vertical")}_getEventCellObjs(e,t,n="horizontal"){const i=this,l=i._timelineCells;if(!l||!l[n])return;const r=l[n],a=t(),o=a.start,s=a.end;let d,c,u,h,m,g;for(let n=0;n<r.length;n++){const l=r[n],a=l.date,v=l.group;if(v&&!i._isEventPartOfGroup(e,v))continue;const f=t(a,a),p=f.start,w=f.end;!d&&o>=p&&o<=w&&(d=l),s>=p&&s<=w&&(c=l),u||(u=l,m=p),h=l,g=p}return!d&&o<=m&&s>m&&(d=u),!c&&d&&(c=s>=m&&s<=g?d:h),{start:d,end:c,first:u,last:h}}_setVerticalTimelineEvents(e){const t=this,n=e.events,i=e.eventCells,l=e.eventRenderMode;if("agenda"===e.viewType||"modern"===l&&e.isMobile)return t._setAgendaOrMobileEvents(e);const r=e.isAllDayEvent,a=e.spaceAvailable,o=e.eventSize,s=Math.floor(a/o),d=e.eventIndexes,[c,u]=[t.scrollTop,t.scrollLeft],[h,m]=[c+t._scrollViewSize.height,u+t._scrollViewSize.width];let g,v;if("classic"===l){const n=t._getEventsCollisionIndexes(e,"vertical");g=n.eventOverlaps,v=n.eventCollisionsCount}for(let f=0;f<n.length;f++){const p=i[f],w=n[f];e.eventObj=w;for(let i=0;i<p.length;i++){const y=p[i],_=y[0];if(!_)continue;e.cellRange=y;let b=d[f];if(void 0===b){const n=t._getEventsInCollision(e);e.cellEventsCount=n.length,d[f]=n.indexOf(w)}if(e.eventIndex=b=d[f],"modern"===l&&(b+1)*o>a){t._addEventToCollector(e);continue}if("classic"===l){const t=g.filter(e=>e.indexOf(w)>-1),i=g[f].reduce((e,t)=>Math.max(e,v[n.indexOf(t)]),1);let l=1;for(let e=b+1;e<i&&t.every(t=>t.map(e=>d[n.indexOf(e)]).indexOf(e)<0);e++)l++;e.isMaxSizeReached=i>s,e.cellEventsCount=i,e.eventSize=Math.min(o,a/i*l)}const C=y[y.length-1],[D,S]=[_.vertical,C.vertical],[T,E]=[_.horizontal,C.horizontal];(r||S.top+S.height>=c&&D.top<=h&&E.left+E.width>=u&&T.left<=m)&&t._setEventCell(e)}}}_setAgendaOrMobileEvents(e){const t=this,n=e.events,i=e.eventCells,l="agenda"===e.viewType;for(let r=0;r<n.length;r++){const a=i[r],o=n[r];e.eventObj=o,a.forEach(n=>{n[0]&&(e.cellRange=n,l?t._setEventCell(e):t._addEventToCollector(e))})}return e.usedEventCells}_addEventToCollector(e){const t=this,n=e.viewType.indexOf("timeline")>-1,i=e.eventObj,l=e.cellRange,r=e.usedEventCells,a=t.$.allDayEventsContainer,o=e.isAllDayEvent,s=e.isDayOrWeekView,d=o?a:t.$.timelineEventsContainer,c=Array.from(d.children),u=t._getCellsScaleCount(),h=t._setEventCell(e,!0),m=l.length,g=e.groupOrientation,v=t.hasAttribute("tabindex")?t.tabIndex:void 0;let f=document.createDocumentFragment(),p={tabIndex:v};e:for(let a=0;a<m;a++){const d=l[a],v=d.scaleIndex,w=d[g].group;let y;y=o?1:1===m?t._getEventScaleIndex(i,n?d.horizontal:d.vertical).end+1:a===m-1?v+1:u;for(let n=0===a&&v||0;n<y;n++){d.scaleIndex=n;const l=t._getCellTime(d);let a=c.find(e=>!!e.hasAttribute("collector")&&(e.$.cellTime===l&&(!w||t._isEventPartOfGroup(e.$.group,w))));if(a){const e=a.$.events;e.map(e=>e.$.event).indexOf(i)<0&&(e.push(h),t._sortEventCellObjs(e,s))}else a=document.createElement("div"),a.classList.add("smart-scheduler-event"),a.setAttribute("collector",""),a.$={group:w,cellTime:l,collector:!0,events:[h]},f.appendChild(a);if(p.eventCollector=a,p.cellObj=d,t._setEventCollectorStyles(e,p),t._setEventCellContent(a,e),r.indexOf(a)<0&&r.push(a),s&&!o)break e}d.scaleIndex=v}f.children.length&&d.appendChild(f)}_setEventCollectorStyles(e,t){const n=this,i=e.cellSize,l=e.eventRenderMode,r=t.eventCollector,a=t.cellObj,o=t.tabIndex,s=e.isMobile,d=e.isAllDayEvent,c=e.isDayOrWeekView;let u=e.collectorSize;const h=n._getCellOffset(a);"modern"===l&&s?(u=Math.min(i.width,i.height),r.style.width=r.style.height=u+"px",r.style.left=h.left+(i.width-u)/2+"px",r.style.top=h.top+(i.height-u)/2+"px"):(r.style.top=h.top+"px",r.style.height=n._eventCollectorSize+"px",c&&!d?(r.style.left=h.left+i.width-u+"px",r.style.width=u+"px"):(r.style.left=h.left+"px",r.style.width=Math.max(0,i.width)+"px")),void 0!==o?r.tabIndex=o:r.removeAttribute("tabindex")}_removeEventFromCollector(e){const t=this,n=e.eventObj,i=e.cellRange,l=e.isAllDayEvent?t.$.allDayEventsContainer:t.$.timelineEventsContainer,r=Array.from(l.children);let a;for(let l=0;l<i.length;l++){const o=i[l],s=t._getCellTime(o),d=r.find(e=>e.hasAttribute("collector")&&e.$.cellTime===s);if(d){const i=d.$.events,l=i.map(e=>e.$.event).indexOf(n);l>-1&&(a=i.splice(l,1)[0]),i.length?t._setEventCellContent(d,e):d.remove()}}return a}_setEventCell(e,t){const n=this,i=e.viewType,l=e.eventObj,r=e.usedEventCells,a=l.$?l.$.event:void 0,o=l.dateStart,s=l.dateEnd,d=l.status,c=n._getCellTime(e.cellRange[0]),u=e.isAllDayEvent?n.$.allDayEventsContainer:n.$.timelineEventsContainer,h=n._dragDetails,m=n.tabIndex;let g,v,f=Array.from(u.children).find(e=>e.$.event===l&&e.$.cellTime===c);if(!t){const t=n._removeEventFromCollector(e);!f&&t&&(f=t)}if(!f||!n.hasAttribute("resized")||f!==h.schedulerEvent){if(f||(f=document.createElement("div"),f.classList.add("smart-scheduler-event")),n._setEventCellStyles(e,{eventCell:f}),"agenda"===i?(g=new Date(c),g.setHours(o.getHours(),o.getMinutes())):g=new Date(o),f.$||(f.$={}),v=f.$,v.cellTime=c,v.dateStart=g,v.dateEnd=new Date(g.getTime()+s.getTime()-o.getTime()),v.event=l,n.resources.forEach(e=>{void 0!==l[e.value]&&f.setAttribute(e.value,l[e.value])}),d&&n.statuses.some(e=>e.value===d)?f.setAttribute("status",d):f.removeAttribute("status"),a){const e=a.repeat.exceptions;f.setAttribute("repeating",""),e&&e.indexOf(l)>-1?f.setAttribute("exception",""):f.removeAttribute("exception")}else f.removeAttribute("repeating"),f.removeAttribute("exception");if(l.allDay?f.setAttribute("all-day",""):f.removeAttribute("all-day"),n._setEventCellContent(f,e),t)return f;n.hasAttribute("tabindex")?f.tabIndex=m:f.removeAttribute("tabindex"),f.setAttribute("title",l.label),r.indexOf(f)<0&&r.push(f),u.contains(f)||u.appendChild(f)}}_setEventCellStyles(e,t){const n=this,i=e.viewType,l=e.eventObj,r=e.eventIndex,a=t.eventCell,o=e.collectorSize,s=e.cellRange,d=e.cellSize,c=s[0],u=s[s.length-1],h=n._getCellOffset(c),m=e.isDayOrWeekView,g=e.isAllDayEvent,v=i.indexOf("timeline")>-1,f=["timelineDay","timelineWeek"].indexOf(i)>-1;let p=l.backgroundColor,w=l.color;if(!p||!w){const e=n.resources.find(e=>void 0!==l[e.value]);if(e&&e.dataSource){const t=e.dataSource.find(t=>t.id===l[e.value]);t&&(p=t.backgroundColor,w=t.color)}}if(a.style.setProperty("--smart-scheduler-event-background",n._getRGBA(p)),a.style.setProperty("--smart-scheduler-event-focus",n._getRGBA(p,.9)),a.style.setProperty("--smart-scheduler-event-hover",n._getRGBA(p,.8)),a.style.setProperty("--smart-scheduler-event-color",n._getRGBA(w)),a.style.setProperty("--smart-scheduler-event-color-hover",n._getRGBA(w)),a.style.setProperty("--smart-scheduler-event-color-focus",n._getRGBA(w)),"agenda"===i)a.style.top=h.top+"px",a.style.left=h.left+"px",a.style.width=d.width+"px",a.style.height=d.height+"px";else{const t=e.cellEventsCount,i=u.scaleIndex;let s,p=0,w=0,y=e.eventSize;(f||m)&&(p=n._getEventCellOffset(l,c)),c===u&&(u.scaleIndex=n._getEventScaleIndex(l,v?u.horizontal:u.vertical).end),s=n._getCellOffset(u),m&&!g?(p=parseFloat((d.height*p).toFixed(2)),w=parseFloat((d.height*n._getEventCellOffset(l,u,!0)).toFixed(2)),a.style.height=w+s.top-h.top-p+"px",a.style.width=y+"px",a.style.top=h.top+p+"px",a.style.left=h.left+r*((d.width-o)/t)+"px"):(f?(p=parseFloat((d.width*p).toFixed(2)),w=parseFloat((d.width*n._getEventCellOffset(l,u,!0)).toFixed(2))):(w=d.width,p=0),a.style.height=y+"px",a.style.width=w+s.left-h.left-p+"px",a.style.left=h.left+p+"px","classic"===n.eventRenderMode&&e.isMaxSizeReached?a.style.top=h.top+o+r*((d.height-o)/t)+"px":a.style.top=h.top+o+r*y+"px"),u.scaleIndex=i}}_getEventCellOffset(e,t,n){if(void 0===t.scaleIndex)return 0;const i=["day","week"].indexOf(this.viewType)>-1?"vertical":"horizontal",l=60/this._getCellsScaleCount()*60*1e3;let r=n?e.dateEnd:e.dateStart,a=t[i].date;return a=new Date(a.getTime()+l*t.scaleIndex),"vertical"===i&&(a=new Date(r.getFullYear(),r.getMonth(),r.getDate(),a.getHours(),a.getMinutes(),0,0)),a=a.getTime(),r=r.getTime(),Math.max(0,Math.min(1,a>r?0:parseFloat(((r-a)/l).toFixed(2))))}_getRGBA(e,t){if(!e)return"";const n=/^#(.)(.)(.)$/gi.exec(e);let i,l,r;if(n)i=parseInt(n[1]+n[1],16),l=parseInt(n[2]+n[2],16),r=parseInt(n[3]+n[3],16);else{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(e);i=parseInt(t[1],16),l=parseInt(t[2],16),r=parseInt(t[3],16)}return`rgba(${i},${l},${r},${t||1})`}_getCellRanges(e,t="horizontal"){if(!e)return[];const n=this._timelineCells[t],i=e.start,l=e.end,r=e.first,a=e.last;if(!i&&!l||!r&&!a)return[];const o=e.start||r,s=e.end||a,d=n.indexOf(o),c=n.indexOf(s),u=n.indexOf(r),h=n.indexOf(a);let m=[];return m=d>c?[{fromIndex:d,toIndex:h},{fromIndex:u,toIndex:c}]:[{fromIndex:d,toIndex:c}],m}_getEventTimelineCells(e,t,n){const i=this,l=i.viewType,r="agenda"===l,a="month"===l,o=new Date(e.dateStart),s=new Date(e.dateEnd),d=i._timelineCells.horizontal,c=i._timelineCells.vertical;let u=[];if("month"===l)return i._getEventTimelineCellsMonth(e);if(n){const t={height:i._allDayCellSize,top:0,date:new Date(i.dateCurrent)};return t.date.setHours(0,0,0,0),i._getCellRanges(i._getEventHorizontallCellObjs(e)).forEach(e=>{const n=e.fromIndex,i=e.toIndex;for(let e=n;e<=i;e++)u.push({allDay:!0,horizontal:d[e],vertical:t})}),u}const h=Object.assign({},e),m=l.indexOf("timeline")>-1;let g,v,f=new Date(o);return i._getCellRanges(i._getEventHorizontallCellObjs(e)).forEach(n=>{const l=n.fromIndex,p=n.toIndex;for(let n=l;n<=p;n++){const w=d[n],y=new Date(w.date),_=new Date(w.date),b=w.group;if(b&&!i._isEventPartOfGroup(e,b))continue;let C;y.setHours(o.getHours(),o.getMinutes()),_.setHours(s.getHours(),s.getMinutes()),a&&f.getTime()>=y.getTime()?(h.dateStart=new Date(f),h.dateEnd=new Date(f),f.setDate(f.getDate()+1),f.setHours(0,0,0,0)):r||(h.dateStart=y,h.dateEnd=_),i._getCellRanges(i._getEventVerticalCellObjs(h),"vertical").forEach(a=>{const o=a.fromIndex,s=a.toIndex;for(let a=o;a<=s;a++){const d=c[a],f=w.group;if(f&&!i._isEventPartOfGroup(h,f))continue;if(r&&(C&&C.date.getTime()===d.date.getTime()||t.some(e=>e.horizontal===w&&e.vertical===d)))continue;const y={horizontal:w,vertical:d};n===l&&a===o?(void 0===g&&(g=i._getEventScaleIndex(e,m?w:d).start),y.scaleIndex=g):n===p&&a===s&&(void 0===v&&(v=i._getEventScaleIndex(e,m?w:d).end),y.scaleIndex=v),C=d,u.push(y),t.push(y)}})}}),u}_getEventTimelineCellsMonth(e){const t=this,n=new Date(e.dateStart),i=new Date(e.dateEnd),l=t._timelineCells.horizontal,r=t._timelineCells.vertical,a=Object.assign({},e);let o=[];return t._getCellRanges(t._getEventVerticalCellObjs(e),"vertical").forEach(s=>{const d=s.fromIndex,c=s.toIndex;for(let s=d;s<=c;s++){const d=r[s],c=new Date(d.date),u=new Date(d.date),h=d.group;h&&!t._isEventPartOfGroup(e,h)||(u.setDate(u.getDate()+6),u.setHours(23,59,59,999),c.setHours(0,0,0,0),a.dateStart=new Date(Math.max(n.getTime(),c.getTime())),a.dateEnd=new Date(Math.min(i.getTime(),u.getTime())),t._getCellRanges(t._getEventHorizontallCellObjs(a)).forEach(n=>{const i=n.fromIndex,r=n.toIndex;for(let n=i;n<=r;n++){const a=l[n],c=d.group;if(c&&!t._isEventPartOfGroup(e,c))continue;const u={horizontal:a,vertical:d};s!==i&&s!==r||(u.scaleIndex=0),o.push(u)}}))}}),o}_getEventTimelineCellRanges(e,t){const n=this,i=n.viewType;if(!e.length)return[];if("agenda"===i)return e.map(e=>[e]);{let l,r=[],a=[];const o=["day","week"].indexOf(i)>-1&&!t;for(let t=0;t<e.length;t++){const i=e[t];if(!l){r.push(l=i);continue}const s=i.horizontal,d=i.vertical,c=l.horizontal,u=l.vertical,h=n._getCellOffset(i,void 0===d.scaleIndex),m=n._getCellOffset(l,void 0===d.scaleIndex);!o&&(d!==u||m.right!==h.left)||o&&(s!==c||m.bottom!==h.top)?(a.push(r),r=[i]):r.push(i),l=i}return r.length&&a.push(r),a}}_getCellSize(e){const t=this,n=t.viewType;let i,l;if(e){let t=e;if(e instanceof HTMLElement&&(t=e.$?e.$.cellObj:void 0),!t)return{width:0,height:0};i=t.vertical,l=t.horizontal}else{const e=t._timelineCells,n=e.vertical,r=e.horizontal;if(!n.length||!r.length)return{width:0,height:0};i=n[0],l=r[0]}const r=t._getCellsScaleCount();let a,o;switch(n){case"agenda":case"month":case"timelineMonth":a=l.width,o=i.height;break;case"day":case"week":a=l.width,o=i.height/r;break;case"timelineDay":case"timelineWeek":a=l.width/r,o=i.height}return{width:a,height:o}}_getCellOffset(e,t){const n=this.viewType;let i,l,r=e;if(!e)return{left:0,top:0};if(e instanceof HTMLElement&&(r=e.$?e.$.cellObj:void 0),!r)return{left:0,top:0};i=r.vertical,l=r.horizontal;const a=this._getCellsScaleCount(),o=t||r.allDay?0:r.scaleIndex||0;let s,d;switch(n){case"agenda":case"month":case"timelineMonth":s=l.left,d=i.top;break;case"day":case"week":s=l.left,d=parseFloat((i.top+i.height/a*o).toFixed(2));break;case"timelineDay":case"timelineWeek":s=parseFloat((l.left+l.width/a*o).toFixed(2)),d=i.top}return{left:s,right:parseFloat((s+l.width).toFixed(2)),top:d,bottom:parseFloat((d+i.height).toFixed(2))}}_getCellDateRange(e){const t=this;let n=e;if(e instanceof HTMLElement&&(n=e&&e.$?e.$.cellObj:void 0),!n)return;const i=t.viewType;let l=new Date(n.time?n.time:t._getCellTime(n)),r=new Date(l);switch(i){case"agenda":case"month":case"timelineMonth":r.setHours(23,59,59,999);break;case"week":case"day":case"timelineWeek":case"timelineDay":n.allDay?r.setHours(23,59,59,999):r=new Date(r.getTime()+60/t._getCellsScaleCount()*60*1e3)}return{dateStart:l,dateEnd:r}}_setEventCellContent(e,t){const n=this,i=t.eventObj;if(!e||!i)return;const l=t.isDayOrWeekView,r=t.isAllDayEvent;let a=e.querySelector(".smart-scheduler-event-content");if(e.$&&e.$.events){a||(e.innerHTML='<div class="smart-scheduler-event-content"></div>',a=e.firstElementChild);const t=n.eventRenderMode,i=n.$.timeline.hasAttribute("mobile"),o=e.$.events.length+(i||"modern"===t&&l&&!r?"":" "+n.localize("collector"));return void(a.innerHTML=`<div>${o}</div>`)}a||(e.innerHTML='<div class="smart-scheduler-event-content"></div><div class="smart-scheduler-event-button"></div>',a=e.firstElementChild);const o=e.querySelector(".smart-scheduler-event-button");if(o&&(o.tabIndex=t.tabIndex),n.eventTemplate)n._applyTemplate("eventTemplate",a,i);else{const e=void 0!==t.isMonthView?t.isMonthView:["timelineMonth","month"].indexOf(n.viewType)>-1;let l=a.querySelector(".smart-scheduler-event-label"),r=a.querySelector(".smart-scheduler-event-time"),o=i.label;const s=n.timeZone,d=n.locale,c=i.dateStart,u=i.dateEnd;let h;if(t.isAllDayEvent||e){const e="short",t=n.dayFormat;h=c.getFullYear()===u.getFullYear()&&c.getMonth()===u.getMonth()&&c.getDate()===u.getDate()?new Date(c).toLocaleDateString(d,{day:t,month:e,timeZone:s}):new Date(c).toLocaleDateString(d,{day:t,month:e,timeZone:s})+" - "+new Date(u).toLocaleDateString(d,{day:t,month:e,timeZone:s})}else{const e=n.minuteFormat,t=n.hourFormat;h=new Date(c).toLocaleTimeString(d,{hour:t,minute:e,timeZone:s})+" - "+new Date(u).toLocaleTimeString(d,{hour:t,minute:e,timeZone:s})}if(!r)return void(a.innerHTML=`\n                        <div><label class="smart-scheduler-event-label">${i.label}</label></div>\n                        <div><label class="smart-scheduler-event-time">${h}</label></div>`);l.textContent=o,r.textContent=h}}_createTimeline(){const e=this,t=e.resizeTrigger,n=e.scrollTop,i=e.scrollLeft;let l,r;t&&(l=t.offsetWidth,r=t.offsetHeight,t.style.display="none"),delete e._selectedCellObj,delete e._eventsBetween,e._createTimelineHeader(),e._refreshTimelineContentCells(),e.scrollTop=n,e.scrollLeft=i,t&&(t.style.display=null,l===t.offsetWidth&&r===t.offsetHeight||(e._noResizeHandler=!0)),e._refreshEvents()}_createTimelineHeader(){const e=this,t=e.$.timelineContent;if(t.style.width=t.style.height=null,Smart.Utilities.Core.Browser.Chrome){const t=e.$.timelineHeaderVertical;t.style.display="none",t.offsetHeight,t.style.display=null}e._validateEventDateRange(),e._createTimelineCellsObj(),e._createTimelineHeaderCells("horizontal"),e._createTimelineHeaderCells("vertical"),e._refreshTimelineHeaderCells(),e._refreshTimelineAllDayCells(),e._refresh()}_validateEventDateRange(e){if(["month","agenda"].indexOf(this.viewType.toLowerCase())>-1)return;const t=e?[e]:this._events;for(let e=0;e<t.length;e++){const n=t[e],i=n.dateStart,l=n.dateEnd,r=new Date(i.getFullYear(),i.getMonth(),i.getDate()+1,0,0,0,0);l.getTime()>r.getTime()?(n.allDay=!0,n.dateStart=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0)):n.allDay&&i.getFullYear()===l.getFullYear()&&i.getMonth()===l.getMonth()&&i.getDate()===l.getDate()&&(n.dateStart.setHours(0,0,0,0),n.dateEnd=r,n.dateEnd.setHours(0,0,0,0))}}_handleTimelineGroupHeader(e){const t=this,n=t._timelineCells.groups;let i=t.$.groupsContainer;if(!n||!n.length||"agenda"===t.viewType&&!Object.keys(e.vertical).length)return void(i&&i.remove());i||(i=document.createElement("div"),i.classList.add("smart-scheduler-groups-container"),i.innerHTML='\n                        <div class="smart-scheduler-view-groups-label-container" role="row"></div>\n                        <div class="smart-scheduler-view-groups-content" role="row">\n                            <div class="smart-scheduler-view-header-groups-container"></div>\n                        </div>',t.$.groupsContainer=i);const l=t.view,r=t.views.find(e=>e.value&&e.value===l)||{},a="vertical"!==(r&&r.groupOrientation?r.groupOrientation:t.groupOrientation)?t.$.timelineHeaderHorizontal:t.$.timelineHeaderVertical;a.contains(i)||a.insertBefore(i,a.firstElementChild)}_handleTimeZoneHeader(e){const t=this;e||(e="horizontal",t._handleTimeZoneHeader("vertical"));const n=t.viewType.toLowerCase(),i=n.indexOf("timeline")>-1,l=("vertical"===e?t.$.timelineHeaderVerticalContent:t.$.timelineHeaderHorizontalContent).querySelector(".smart-scheduler-view-time"),r=l.children,a=t.$.timelineViewCellsLabelContainer,o=!i&&"agenda"!==n&&"vertical"===e||"horizontal"===e&&i;let s=t.timeZones.slice(0);const d=t.$.viewDetailsLabel,c=t.$.timelineTimeZoneLabelContainer;if(c.remove(),d&&d.remove(),t._recycleContainerCells({fragment:l,cellsNeeded:1+(o&&n.indexOf("month")<0?s.length:0),className:"smart-scheduler-cells"}),s.push(t.timeZone),(i&&o||!i)&&t._recycleContainerCells({fragment:a,cellsNeeded:!i&&n.indexOf("month")<0&&"agenda"!==n?s.length:0,className:"smart-scheduler-time-zone"}),o){const e=c.parentElement;t._recycleContainerCells({fragment:c,cellsNeeded:1===r.length?0:r.length,className:"smart-scheduler-time-zone"}),r.length&&e&&e.appendChild(c)}}_createTimelineHeaderCells(e="vertical"){const t=this,n=t.viewType.toLowerCase(),i=n.indexOf("timeline")>-1,l="vertical"===e?t.$.timelineHeaderVerticalContent:t.$.timelineHeaderHorizontalContent,r=l.querySelector(".smart-scheduler-view-time"),a=l.querySelector(".smart-scheduler-view-details"),o=r.children,s=!i&&"agenda"!==n&&"vertical"===e||"horizontal"===e&&i;let d=t.timeZones.slice(0);const c=t._getTimelineVisibleCellsCount(e),u=t.timeZone,h=o.length;d.push(t.timeZone);for(let e=0;e<h;e++){const n=o[e],i=d[e];n.timeZone=1===h?u:i.id||i,t._recycleContainerCells({fragment:n,cellsNeeded:c})}if(a&&t._recycleContainerCells({fragment:a,cellsNeeded:t._getTimelineVisibleCellsCount({orientation:e,type:"details"})}),t._createTimelineHeaderGroupCells(e),s){const e=t.$.timelineTimeZoneLabelContainer,l=t.$.timelineViewCellsLabelContainer;e.remove();const r=t.$.timelineAllDayLabelContainer;let o=t.$.viewDetailsLabel;if(i&&n.indexOf("week")>-1&&a?(o||(o=document.createElement("div"),o.classList.add("smart-scheduler-view-details-label"),t.$.viewDetailsLabel=o),o.parentElement||l.appendChild(o)):o&&o.parentElement&&o.remove(),!e.children.length)return;!i&&r.offsetHeight?r.appendChild(e):l.offsetHeight&&l.appendChild(e)}}_createTimelineHeaderGroupCells(e){const t=this,n=t.view,i=t.viewType,l=i.indexOf("timeline")>-1,r=t.views.find(e=>e.value&&e.value===n)||{},a=t._timelineCells,o=a.groups,s=r&&r.groupOrientation?r.groupOrientation:t.groupOrientation;let d=t.$.groupsContainer;if("vertical"===e&&"vertical"!==s||("horizontal"===e&&"day"!==i||!e)&&"vertical"===s)return;if(d&&d.remove(),!o||!o.length||"agenda"===i&&!a.vertical.length)return;const c=t._timelineCells.groups,u=d.querySelector(".smart-scheduler-view-header-groups-container"),h=u.children;t._recycleContainerCells({fragment:u,cellsNeeded:c.length,className:"smart-scheduler-cell-container"});for(let n=0;n<h.length;n++)t._recycleContainerCells({fragment:h[n],cellsNeeded:t._getTimelineVisibleCellsCount({orientation:e,type:"groups",resource:c[n].resource})});let m="vertical"===e||i.toLowerCase().indexOf("month")>-1?0:t.timeZones.length+("month"===i?0:1);if(l&&(m=m>1?1:0),"agenda"===i&&(m="vertical"!==s&&t._timelineCells.vertical.length?1:0),t._recycleContainerCells({fragment:d.querySelector(".smart-scheduler-view-groups-label-container"),cellsNeeded:m,className:"smart-scheduler-time-zone"}),!d.parentElement&&e===s){const n="horizontal"===e?t.$.timelineHeaderHorizontal:t.$.timelineHeaderVertical;n.insertBefore(d,n.firstElementChild)}}_recycleContainerCells(e){const t=this,n=e.fragment;if(!n)return;const i=n.children,l=n.children.length,r=e.cellsNeeded,a=e.className,o=e.isBackwards?"lastElementChild":"firstElementChild";if(l>r)for(;i.length&&i.length!==r;)n.removeChild(n[o]);else l<r&&n.appendChild(t._createCells(r-l,a))}_createTimelineCellsObj(){const e=this,t=e.viewType,n=t.indexOf("timeline")>-1,i=e._getCellsCount(),l=e._getCellsScaleCount(),r=window.getComputedStyle(e);e.timeZones.length>0&&n&&"timelineMonth"!==t?e.$.timeline.setAttribute("show-vertical-header",""):e.$.timeline.removeAttribute("show-vertical-header");let a=Math.max(parseFloat(r.getPropertyValue("--smart-scheduler-timeline-cell-height"))||0,parseFloat(r.getPropertyValue("--smart-scheduler-timeline-cell-min-height")||0)),o=Math.max(parseFloat(r.getPropertyValue("--smart-scheduler-timeline-cell-width"))||0,parseFloat(r.getPropertyValue("--smart-scheduler-timeline-cell-min-width")||0));e._eventSize=parseFloat(r.getPropertyValue("--smart-scheduler-event-size"))||0,e._allDayCellSize=parseFloat(r.getPropertyValue("--smart-scheduler-timeline-header-all-day-cells-size"))||e.$.timelineViewAllDay.offsetHeight,e._eventCollectorSize=parseFloat(r.getPropertyValue("--smart-scheduler-event-collector-size"))||0,e._monthViewNumberSize="month"!==t?0:parseFloat(r.getPropertyValue("--smart-scheduler-month-view-number-size"))||0,t.indexOf("timeline")>-1?o*=l:a*=l,e._timelineCells={},e._scrollViewSize={},e.groups.length&&(e._timelineCells.groups=e._getTimelineCellsObjGroups()),e._handleTimelineGroupHeader(i),e._handleTimeZoneHeader(),e._refresh(),e._handleTimelineContentSize(i,a,"height");let s=e.$.timelineContainer.offsetHeight;e._handleTimelineContentSize(i,o,"width"),s!==(s=e.$.timelineContainer.offsetHeight)&&e._handleTimelineContentSize(i,a,"height"),e._scrollViewSize.height=s,e._scrollViewSize.width=e.$.timelineContainer.offsetWidth,e._timelineCells.horizontal=e._getTimelineCellsObjHorizontal(i.horizontal,o),e._timelineCells.vertical=e._getTimelineCellsObjVertical(i.vertical,a),"timelineWeek"===t&&(e._timelineCells.details=e._getTimelineCellsObjDetails())}_getResourceGroups(){const e=this.groups,t=this.resources;let n,i=[],l=[];if(!e.length||!t.length)return l;for(let l=0;l<e.length;l++){const r=t.find(t=>t.value===e[l]);if(!r||!r.dataSource.length)continue;let a={};const o=r.dataSource;for(let e=0;e<o.length;e++){const t=o[e];a[t.id]={id:t.id,label:t.label,color:t.color}}if(Object.keys(a).length){const e=Object.values(a),t=n?n.cells.length:1;let l=[];for(let i=0;i<t;i++)for(let t=0;t<e.length;t++){const a={resource:r.value,label:e[t].label,group:n?Object.assign({},n.cells[i].group):{},groupSeparator:!0};a.group[r.value]=e[t].id,l.push(a)}i.push(n={resource:r.value,groups:e,cells:l})}}return i}_getTimelineCellsObjGroups(){const e=this,t=e._getResourceGroups();let n=[];if(!t.length)return n;for(let e=t.length-1;e>-1;e--){const i=t[e];if(n.length){const e=n.slice(0);n=[],i.groups.forEach(t=>{e.forEach(e=>{const l=Object.assign({},e);l.group=Object.assign({},l.group),l.group[i.resource]=t.id,n.push(l)})})}else i.groups.forEach(e=>{const t={label:e.label,color:e.color,group:{},resource:i.resource,groupSeparator:!0};t.group[i.resource]=e.id,n.push(t)})}if(n.length){const t=e.view,n=e.views.find(e=>e.value&&e.value===t)||{},i=n&&n.groupOrientation?n.groupOrientation:e.groupOrientation;e.$.timeline.setAttribute("show-group-header",i)}else e.$.timeline.removeAttribute("show-group-header");return t[t.length-1].cells=n,t}_getTimelineCellsObjHorizontal(e,t){const n=this,i=n.view,l=n.viewType,r=i.indexOf("timeline")>-1,a=n.views.find(e=>e.value&&e.value===i)||{},o=new Date(n.dateCurrent);r?o.setHours(n.hourStart,0,0,0):o.setHours(0,0,0,0);const s=n.firstDayOfWeek;let d,c;switch(l){case"week":case"timelineWeek":o.setDate(o.getDate()-o.getDay()+s),c=n.hideWeekend||a.hideWeekend,d=n.hideNonworkingWeekdays||a.hideNonworkingWeekdays;break;case"month":case"timelineMonth":o.setDate(1),r||o.setDate(o.getDate()-o.getDay()+s),o.setHours(0,0,0,0),c=n.hideWeekend||a.hideWeekend,d=n.hideNonworkingWeekdays||a.hideNonworkingWeekdays}return n._getCellsObject({orientation:"horizontal",cells:[],cellSize:t,cellCount:e,date:o,hideWeekend:c,hideNonworkingWeekdays:d,hourStart:n.hourStart,hourEnd:n.hourEnd,viewSize:n.$.timelineContent.offsetWidth,offset:0})}_getCellsObject(e){const t=this,n=t.view,i=t.viewType,l=t.views.find(e=>e.value&&e.value===n)||{},r=t._timelineCells.groups,a=l&&l.groupOrientation?l.groupOrientation:t.groupOrientation,o=e.cellCount,s=e.viewSize,d=e.orientation,c=e.cells;let u,h=e.cellSize,[m,g]="horizontal"===d?["width","left"]:["height","top"];if(r&&r.length&&(u=r[r.length-1].cells),!u||!u.length||"horizontal"===d&&"vertical"===a||"vertical"===d&&"vertical"!==a)o*h<s&&(h=s/o),e.cellSize=parseFloat(h.toFixed(2)),"agenda"===i&&u&&u.length&&(e.groups=u),t._createCellObjects(e);else{const n=u.length;if(1===o){let e=s/n;e>=h&&(h=e)}else{const e=o*n;e*h<s&&(h=s/e)}if(e.cellSize=parseFloat(h.toFixed(2)),t.groupByDate&&d===a)e.groupHeader=r[r.length-1],t._createCellObjects(e);else{for(let n=0;n<u.length;n++){const i=u[n];i[g]=e.offset,e.size=0,e.group=i.group,t._createCellObjects(e),i[m]=e.size||0,t._refreshGroupHeaderCells(d,i)}c.length||t._createCellObjects(e)}}return c}_refreshGroupHeaderCells(e="horizontal",t){const n=t.group,i=this._timelineCells.groups;if(!i)return;let l=t.date,r=l?"cellsByDate":"cells";const[a,o]="horizontal"===e?["width","left"]:["height","top"];i.forEach(e=>{if(e.resource!==t.resource){const i=e[r];for(let e=0;e<i.length;e++){const r=i[e],s=r.group;l&&l.getTime()!==r.date.getTime()||Object.keys(s).every(e=>s[e]===n[e])&&(r[a]=(void 0===r[a]?0:r[a])+t[a],void 0===r[o]&&(r[o]=t[o]))}}})}_createCellObjects(e){const t=this;"horizontal"===e.orientation?t._createCellsObjectHorizontal(e):t._createCellsObjectVertical(e)}_createCellsObjectHorizontal(e){if(!e)return[];const t=this,n=t.viewType,i=n.indexOf("timeline")>-1,l=e.cells,r=new Date(e.date),a=e.cellSize,o=e.cellCount,s=e.hideWeekend,d=e.hideNonworkingWeekdays,c=t.nonworkingDays,u=t.nonworkingHours,h=e.hourStart,m=e.hourEnd,g=e.group,v=e.groupHeader,f=["timelineDay","timelineWeek"].indexOf(n)>-1;let p,w=e.offset,y=0;f?r.setHours(h):r.setHours(0,0,0,0);for(let _=0;_<o;_++){if(p={width:a},d){let e=0;const t=r.getHours();for(;e<7&&c.indexOf(r.getDay())>-1;)r.setDate(r.getDate()+1),e++;r.setHours(t)}if(s&&[0,6].indexOf(r.getDay())>-1){const e=r.getHours();r.setDate(r.getDate()+1),r.setHours(e)}if("agenda"===n?p.noLabel=!0:p.weekend=0===r.getDay()||6===r.getDay(),p.nonworking=c.indexOf(r.getDay())>-1,f&&(p.nonworking=p.nonworking||u.indexOf(r.getHours())>-1),v?(e.offset=w,e.date=r,t._createCellsObjByDate(p,e),w=e.offset):(g&&(p.group=g),p.left=w,p.date=new Date(r),l.push(p),w=parseFloat((w+a).toFixed(2))),i&&"timelineMonth"!==n){const e=r.getHours();"timelineWeek"===n&&e===m?(r.setDate(r.getDate()+1),r.setHours(h)):(r.setHours(r.getHours()+1),e===r.getHours()&&r.setHours(r.getHours()+2))}else r.setDate(r.getDate()+1),r.setHours(0,0,0,0);y+=a}p&&g&&(p.groupSeparator=!0),e.offset=w,e.size=y}_getTimelineCellsObjVertical(e,t){return this._getCellsObject({orientation:"vertical",cells:[],date:new Date(this.dateCurrent),cellSize:t,cellCount:e,viewSize:this._scrollViewSize.height,offset:0})}_isEventPartOfGroup(e,t){if(e)return t=t.group||t,Object.keys(t).every(n=>e[n]&&e[n]===t[n])}_createCellsObjByDate(e,t){const n=this,i=t.groupHeader;if(!i)return;const[l,r]="horizontal"===t.orientation?["width","left"]:["height","top"],a=i.cells,o=t.date,s=e[l],d=t.cells,c=t.agendaItem;let u=t.offset;n._createGroupCellsByDate(t,c);const h=i.cellsByDate,m=a.length,g=m%2==0?"center":"offset";for(let i=0;i<m;i++){const v=a[i],f=v.group;if(c&&!n._isEventPartOfGroup(c,f))continue;const p=Object.assign({},e),w=h.find(e=>e.date.getTime()===o.getTime()&&Object.keys(f).every(t=>f[t]===e.group[t]));w&&(w[r]=void 0===w[r]?u:w[r],w[l]=p[l]+(c&&w[l]||0),p[r]=u,p.date=new Date(o),p.group=v.group,c||(i===m-1&&(p.groupSeparator=!0),i===Math.round(m/2)&&(p.showLabel=g)),n._refreshGroupHeaderCells(t.orientation,w),d.push(p),u=parseFloat((u+s).toFixed(2)))}t.offset=u}_createGroupCellsByDate(e,t){const n=this,i=e.date,l=n._timelineCells.groups;if(i)for(let r=0;r<l.length;r++){const a=l[r];let o=a.cellsByDate;o||(o=a.cellsByDate=[]);const s=a.cells;for(let l=0;l<s.length;l++){let r;if(t){if(!n._isEventPartOfGroup(t,s[l]))continue;r=o.find(e=>e.date.getTime()===i.getTime()&&e.group[e.resource]===t[e.resource])}r=r||Object.assign({},s[l]),r.date||(r.date=new Date(i)),r.separator=!!e.separator,r.groupSeparator=t?!r.separator:l===s.length-1,o.includes(r)||o.push(r)}}}_createCellsObjectVertical(e){const t=this;if(!e)return;const n=t.firstDayOfWeek,i=t.viewType,l=i.indexOf("timeline")>-1,r=e.cells,a=new Date(e.date),o=e.cellCount,s=e.viewSize,d=t.nonworkingHours,c=e.group,u=e.groups,h=e.groupHeader;let m,g=e.offset,v=0,f=e.cellSize;if("agenda"===i){const n=Object.keys(o).sort((e,t)=>parseInt(e)-parseInt(t));for(let i of n){let n=o[i],l=f;if(c)n=n.filter(e=>t._isEventPartOfGroup(e,c));else if(u)n=t._getAgendaGroupEvents(n);else if(h){const e=h.cells;let i=n.slice(0);n=[];for(let l=0;l<e.length;l++)n.push(...i.filter(n=>t._isEventPartOfGroup(n,e[l])))}const a=n.length,d=new Date(parseInt(i));a*l<s&&(l=s/a),l=parseFloat(f.toFixed(2));for(let i=0;i<a;i++){const o=d;m={height:l,separator:i===a-1,weekend:0===o.getDay()||6===o.getDay(),nonworking:t.nonworkingDays.indexOf(o.getDay())>-1},i>0&&(m.noLabel=!0),h?(e.offset=g,e.date=o,e.agendaItem=n[i],e.separator=m.separator,t._createCellsObjByDate(m,e),g=e.offset):(c&&(m.group=c),m.top=g,m.date=o,r.push(m),g=parseFloat((g+l).toFixed(2))),v+=l}}t.$.timeline.classList[r.length?"remove":"add"]("no-agenda")}else if(l)for(let n=0;n<o;n++)a.setHours(0,0,0,0),m={height:f,weekend:0===a.getDay()||6===a.getDay()},h?(e.offset=g,e.date=a,t._createCellsObjByDate(m,e),g=e.offset):(c&&(m.group=c),m.top=g,m.date=new Date(a),r.push(m),g=parseFloat((g+f).toFixed(2))),v+=f;else{"month"===i?(a.setDate(1),a.setDate(a.getDate()-(a.getDay()-n+7)%7),a.setHours(0,0,0,0)):a.setHours(t.hourStart,0,0,0);for(let n=0;n<o;n++)m={height:f},h?(e.offset=g,e.date=a,t._createCellsObjByDate(m,e),g=e.offset):(c&&(m.group=c),m.top=g,m.date=new Date(a),r.push(m),g=parseFloat((g+f).toFixed(2))),v+=f,"month"===i?a.setDate(a.getDate()+7):(m.nonworking=d.indexOf(a.getHours())>-1,a.setHours(a.getHours()+1))}m&&c&&(m.groupSeparator=!0),e.offset=g,e.size=v}_getTimelineCellsObjDetails(){if("timelineWeek"===!this.viewType)return[];function e(e){let t="";if(!n&&e)for(const n in e)t+=n+e[n];return t}const t=this.hourStart,n=this.groupByDate,i=this._timelineCells.horizontal;let l,r={};for(let n=0;n<i.length;n++){const a=i[n],o=a.date,s=o.getDate()+e(a.group);if(l=r[s],l||(l=r[s]={width:0,left:a.left}),l.width+=a.width,a.groupSeparator&&(l.groupSeparator=a.groupSeparator),!l.date){const e=new Date(o);e.setHours(t,0,0,0),l.date=e}}return r=Object.values(r).sort((e,t)=>e.left-t.left),r}_getAgendaGroupEvents(e){const t=this,n=t._timelineCells.groups;let i;n&&n.length&&(i=n[n.length-1].cells);const l={};let r=0;for(let n=0;n<i.length;n++)l[n]=e.filter(e=>t._isEventPartOfGroup(e,i[n])),l[n].length>l[r].length&&(r=n);return l[r]}_handleTimelineContentSize(e,t,n){const i=this,l=i.view,r=i.viewType,a=i._timelineCells.groups,o=i.views.find(e=>e.value&&e.value===l)||{},s=o&&o.groupOrientation?o.groupOrientation:i.groupOrientation,d="agenda"===r&&Object.keys(e.vertical).length?i.$.timelineHeaderVertical.offsetWidth:Math.max(i.$.timelineViewCellsLabelContainer.offsetWidth,i.$.timelineViewAllDaylabel.offsetWidth),c="width"===n?Math.max(0,i.$.timeline.offsetWidth-d):i.$.timelineContainer.offsetHeight;let u=0,h=[],m=e["width"===n?"horizontal":"vertical"];if(a&&a.length&&(h=a[a.length-1].cells),"agenda"===r&&"height"===n)for(let e in m){let n=m[e];h.length&&(n="horizontal"===s?i._getAgendaGroupEvents(n):n.filter(e=>h.some(t=>i._isEventPartOfGroup(e,t)))),u+=n.length*t}else{let e=1;i.groups.length&&("vertical"!==s&&"width"===n||"vertical"===s&&"height"===n)&&(e=Math.max(h.length,1)),1===m?c<t?u=t*e:(u=c/e,u<t&&(u=t*e)):(m*=e,m*t<c&&(t=c/m),u=m*(t=parseFloat(t.toFixed(2))))}u=Math.max(u,c,t),i.$.timelineContent.style[n]=u===c?"":u+"px",i._refresh()}_createCells(e,t="smart-scheduler-cell"){let n,i=document.createDocumentFragment();Array.isArray(t)||(t=[t]);for(let l=0;l<e;l++)n=document.createElement("div"),t.forEach(e=>n.classList.add(e)),n.setAttribute("role","columnheader"),i.appendChild(n);return i}_refreshTimelineContentCells(){const e=this._timelineCells;if(!e||!e.vertical||!e.horizontal)return;const t=this.$.timelineContainer,n=this.$.timelineCellsContainer,i=this.$.timelineContent,l=this.view,r=this.viewType,a=this.views.find(e=>e.value&&e.value===l)||{},o=a&&a.groupOrientation?a.groupOrientation:this.groupOrientation,s=this._getVisibleCellObj();if(!s)return;const d={viewType:r,isTimelineView:r.indexOf("timeline")>-1,visibleCellObjs:s,groupOrientation:o,locale:this.locale,timeZone:this.timeZone,isRightToLeft:this.rightToLeft,dateCurrent:this.dateCurrent};n.remove(),this._recycleContainerCells({fragment:n,cellsNeeded:s[this.viewType.indexOf("timeline")>-1?"horizontal":"vertical"].length,className:"smart-scheduler-cell-container"}),this._refreshContainerCells(n,d),i.insertBefore(n,i.firstElementChild),t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,this._setCurrentTimeIndicators()}_getVisibleCellObj(){const e=this._timelineCells;if(!e||!e.vertical||!e.horizontal)return;const t=e.vertical,n=e.horizontal,[i,l]=[this.scrollTop,this.scrollLeft],[r,a]=[i+this._scrollViewSize.height,l+this._scrollViewSize.width];let[o,s]=[[],[]];for(let e=0;e<t.length;e++){const n=t[e];n.top+n.height>=i&&n.top<=r&&o.push(n)}for(let e=0;e<n.length;e++){const t=n[e];t.left+t.width>=l&&t.left<=a&&s.push(t)}return{vertical:o,horizontal:s}}_refreshContainerCells(e,t){const n=this,i=t.viewType,l=t.groupOrientation,r=t.isTimelineView,a=t.visibleCellObjs,o=e.children,s=e===n.$.timelineCellsContainer,d=t.locale,c=t.timeZone,u=t.rightToLeft,h=t.dateCurrent;let m,g,v,f,p,w,y;if(s)r?(v=a.horizontal,[p,w,y]=["horizontal","left","width"]):(v=a.vertical,[p,w,y]=["vertical","top","height"]),m=a.vertical,f=n._getCellsScaleCount();else if(r?(m=a.horizontal,v=a.vertical,[p,w,y]=["vertical","top","height"]):(m=a.vertical,v=a.horizontal,[p,w,y]=["horizontal","left","width"]),n._selectedCellObj){const e=n._selectedCellObj.from;if(!e.allDay){const t=n._selectedCellObj.to;g={lastTime:e.time,fromTime:Math.min(e.time,t.time),toTime:Math.max(e.time,t.time),group:e[l]?e[l].group:void 0}}}for(let a=0;a<o.length;a++){const _=o[a],b=v[a];let C;if(b.nonworking?_.setAttribute("nonworking",""):_.removeAttribute("nonworking"),b.weekend?_.setAttribute("weekend",""):_.removeAttribute("weekend"),b.separator?_.setAttribute("separator",""):_.removeAttribute("separator"),C=b.groupSeparator,s)r||"vertical"!==l||(C=m[a].groupSeparator),C&&(r&&"vertical"!==l||!r&&"vertical"===l)?_.setAttribute("group-separator",""):_.removeAttribute("group-separator"),_.$={cellObj:b},n._refreshScaleCells(_,t,f);else{_.$||(_.$={cellObj:{}});const t=_.$.cellObj;t.scaleIndex=e._scaleIndex,r?(t.horizontal=e.$.cellObj,t.vertical=b):(t.horizontal=b,t.vertical=e.$.cellObj);const a=t[l]?t[l].group:void 0;if(a)for(const e in a)_.setAttribute(e,a[e]||"");C&&(!r&&"vertical"!==l||r&&"vertical"===l)?_.setAttribute("group-separator",""):_.removeAttribute("group-separator");const o=new Date(t.time=n._getCellTime(t));n._setCellContent(_,o),"month"===i?(o.getMonth()!==h.getMonth()?_.setAttribute("other-month",""):_.removeAttribute("other-month"),_.setAttribute("date",o.toLocaleString(d,{timeZone:c}))):(_.removeAttribute("other-month"),_.setAttribute("date",o.toLocaleString(d,{timeZone:c}))),_.removeAttribute("selected"),g&&a===g.group&&t.time>=g.fromTime&&t.time<=g.toTime&&_.setAttribute("selected",t.time===g.lastTime?"start":"")}_.style.top=_.style.left=_.style.width=_.style.height="",_.style[y]=b[y]+"px","horizontal"===p?_.style[u?"right":"left"]=b.left+"px":_.style[w]=b[w]+"px"}}_refreshScaleCells(e,t,n){const i=this,l=t.visibleCellObjs,r=t.isTimelineView,a=e.children;i._recycleContainerCells({fragment:e,cellsNeeded:n,className:["smart-scheduler-cell","scale"]});const o=r?"width":"height",s=a.length,d=e.$.cellObj,c=l[r?"vertical":"horizontal"].length;for(let l=0;l<s;l++){const r=a[l];r.$=e.$,r._scaleIndex=l,d.nonworking?r.setAttribute("nonworking",""):r.removeAttribute("nonworking"),r.style.width=r.style.height=null,r.style[o]=100/n+"%",i._recycleContainerCells({fragment:r,cellsNeeded:c}),i._refreshContainerCells(r,t),delete r._scaleIndex}}_refreshTimelineAllDayCells(){const e=this,t=e.viewType.toLowerCase(),n=e.$.timelineViewAllDayContent,i=e.$.timelineViewAllDayCellsContainer;if(t.indexOf("timeline")>-1||t.indexOf("month")>-1)return void(i.innerHTML="");i.remove();const l=i.children,r=e.locale,a=e.timeZone,o={height:e._allDayCellSize,top:0},s=e.$.timelineHeaderHorizontalContent.querySelector(".smart-scheduler-cells").children;e._recycleContainerCells({fragment:i,cellsNeeded:"agenda"===t?0:s.length});for(let t=0;t<l.length;t++){const n=l[t],i=s[t],d=i.$.cellObj;n.$||(n.$={cellObj:{}});const c=n.$.cellObj;c.horizontal=d,c.vertical=o,c.allDay=!0,n.setAttribute("all-day","");const u=c.horizontal.group;if(u)for(const e in u)n.setAttribute(e,u[e]||"");const h=new Date(c.time=e._getCellTime(c));e._setCellContent(n,h),n.setAttribute("date",h.toLocaleString(r,{timeZone:a})),d.groupSeparator?n.setAttribute("group-separator",""):n.removeAttribute("group-separator"),d.weekend?n.setAttribute("weekend",""):n.removeAttribute("weekend"),d.nonworking?n.setAttribute("nonworking",""):n.removeAttribute("nonworking"),n.style.left=i.style.left,n.style.width=i.style.width}n.insertBefore(i,n.firstElementChild),n.scrollLeft=e.scrollLeft}_getCellsScaleCount(){const e=this.viewType;if(["timelineMonth","month","agenda"].indexOf(e)>-1)return 1;switch(this.timelineDayScale){case"hour":return 1;case"halfHour":return 2;case"quarterHour":return 4;case"tenMinutes":return 6;case"fiveMinutes":return 12;default:return 1}}_getTimelineVisibleCellsCount(e="horizontal"){const t=this,n=e.orientation||e,i=e.type,l=e.resource;let r=t._timelineCells[n];if(i)if(l){r=t._timelineCells.groups.find(e=>e.resource===l)[t.groupByDate?"cellsByDate":"cells"]}else r=t._timelineCells[i];if(!r)return 0;const a=t._getFirstCellObjInView({orientation:n,type:i,resource:l});if(!a)return 0;const[o,s,d]="horizontal"===n?["left","width",t.scrollLeft]:["top","height",t.scrollTop];let c;if("vertical"===n?c=t._scrollViewSize.height:(c=t.$.timelineHeaderHorizontalContent.offsetWidth||t.$.timelineViewAllDayContent.offsetWidth,"agenda"===t.viewType&&t._timelineCells.vertical.length&&(c-=t.$.timelineHeaderVertical.offsetWidth)),i){let e=0;if("details"===i&&("timelineWeek"!==t.viewType||"vertical"===n))return e;for(let t=r.indexOf(a);t<r.length;t++){const n=r[t];n[o]+n[s]>=d&&n[o]<c+d&&e++}return e}const u=1-(a[o]+a[s]-d)/r[0][s];return Math.min(r.length,Math.ceil(parseFloat((c/a[s]+u).toFixed(2))))}_getFirstCellObjInView(e="horizontal"){const t=this,n=e.orientation||e,i=e.type,l=e.resource,r=t._timelineCells;if(!r)return;let a,o,s;const[d,c,u]="horizontal"===n?["scrollLeft","left","width"]:["scrollTop","top","height"],h=Math.abs(t[d]);if(s=r[n],i)if(l){s=t._timelineCells.groups.find(e=>e.resource===l)[t.groupByDate?"cellsByDate":"cells"]}else s=t._timelineCells[i];for(let e=0;e<s.length;e++){const t=s[e];if(t[c]+t[u]>=h){a=t;break}o=t}return!a&&o&&(a=h>o[c]?o:s[0]),a}_getCellsCount(e){const t=this,n=t.dateCurrent,i=new Date(t.dateCurrent);e||(e=t.view);const l=t.viewType,r=t.views.find(t=>t.value&&t.value===e)||{},a=t.nonworkingDays;let[o,s,d,c]=[0,0,0,0,0];const u=t.hideNonworkingWeekdays||r.hideNonworkingWeekdays,h=t.hideWeekend||r.hideWeekend;switch(h&&(c=2,u&&(c-=(a.includes(0)?1:0)+(a.includes(6)?1:0))),l){case"agenda":s=t._getAgendaEvents(i,r),o=1;break;case"day":s=t._getDayHours(i),o=1;break;case"month":case"week":s="month"===l?6:t.hourEnd-t.hourStart+1,o=7-(u?a.length:0)-c;break;case"timelineDay":o=t._getDayHours(i),s=1;break;case"timelineWeek":{const e=t.firstDayOfWeek;let n=new Date(i);s=1,n.setDate(n.getDate()-n.getDay()+e);for(let e=0;e<7;e++)(!h||h&&[0,6].indexOf(n.getDay())<0)&&(!u||u&&a.indexOf(n.getDay())<0)&&(o+=t._getDayHours(n),d++),n.setDate(n.getDate()+1);break}case"timelineMonth":{const e=new Date(n);e.setDate(1),e.setMonth(e.getMonth()+1),e.setDate(0),o=e.getDate(),s=1;break}}return{horizontal:o,vertical:s,detail:d}}_getAgendaEvents(e,t){const n=this;if(!t){const e=n.view;t=n.views.find(t=>t.value&&t.value===e)||{}}e||(e=new Date(n.currentDate));const i=n.hideNonworkingWeekdays||t.hideNonworkingWeekdays,l=n.hideWeekend||t.hideWeekend,r=n.nonworkingDays,a=new Date(e),o=n.hourStart,s=n.hourEnd;a.setHours(0,0,0,0);const d=new Date(a);d.setDate(a.getDate()+6),d.setHours(23,59,59,999);const[c,u]=[a.getTime(),d.getTime()],h=n._getEventsBetween(c,u);let m={};if(!h||!h.length)return m;for(let e=0;e<h.length;e++){const t=h[e],n=t.dateStart,d=t.dateEnd,g=n.getTime(),v=d.getTime();if(!(g>=u||v<=c||t.hidden))for(let e=0;e<7;e++){const n=new Date(a);if(n.setDate(n.getDate()+e),i&&r.indexOf(n.getDay())>-1||l&&[0,6].indexOf(n.getDay())>-1)continue;n.setHours(o,0,0,0);const d=new Date(n);d.setHours(s,59,59,999);const c=n.getTime(),u=d.getTime();if(c<=v&&u>=g){let e=m[c];e||(m[c]=e=[]),e.push(t)}}}for(let e in m)m[e].sort((e,t)=>e.dateStart.getTime()-t.dateStart.getTime());return m}_getEventsBetween(e,t){const n=this;if(!e||!t)return[];e instanceof Date&&(e=e.getTime()),t instanceof Date&&(t=t.getTime());let i=n._eventsBetween;if(n._eventsBetween){if(i.timeStart===e&&i.timeEnd===t)return i.events}else i=n._eventsBetween={timeStart:e,timeEnd:t,events:[]};let l=[];const r=n._events,a=n._rRule,o={isMonthView:n.viewType.toLowerCase().indexOf("month")>-1,hourStart:n.hourStart,hourEnd:n.hourEnd,dateStart:new Date(e),dateEnd:new Date(t),rRule:a,targetEvents:l};for(let i=0;i<r.length;i++){const s=r[i],d=s.repeat,c=s.dateStart,u=s.dateEnd,h=c.getTime(),m=u.getTime();if(d&&a){const e=n._getEventRepeatOptions(s);if(e){o.event=s,o.repeatObj=d,o.options=e,o.eventTimeStart=h,o.eventTimeEnd=m,n._getRepeatingEvents(o);continue}}else if(h>t||m<e)continue;l.push(s)}return l.sort((e,t)=>e.dateStart.getTime()-t.dateStart.getTime()),i.timeStart=e,i.timeEnd=t,i.events=l}_getRepeatingEvents(e){const t=this,n=e.isMonthView,i=e.hourStart,l=e.hourEnd,r=e.rRule,a=e.dateStart,o=e.dateEnd,s=a.getTime(),d=e.event,c=e.options,u=e.repeatObj,h=e.eventTimeStart,m=e.eventTimeEnd,g=u.exceptions,v=e.targetEvents;let f=new r(c).between(new Date(Date.UTC(...t._getUTCDateArgs(a))),new Date(Date.UTC(...t._getUTCDateArgs(o))),!0);if(!f.length){const e=new r(c).before(new Date(Date.UTC(...t._getUTCDateArgs(a))));e&&e.getTime()+m-h>=s&&f.push(e)}for(let e=0;e<f.length;e++){const r=f[e];let a,o=new Date(r),s=new Date(r.getTime()+m-h);if(g&&(a=g.find(e=>e.date.getTime()===r.getTime())),a?(o=a.dateStart,s=a.dateEnd):(o=new Date(r),s=new Date(r.getTime()+m-h)),n||!(o.getHours()<i&&s.getHours()<i||o.getHours()>l&&s.getHours()>l)){if(!a&&(a=t._cloneObject(d),a.dateStart=o,a.dateEnd=s,a.$={event:d},g)){const e=a.dateStart.getTime(),t=a.dateEnd.getTime();for(let n=0;n<g.length;n++){const i=g[n],l=i.date.getTime();l>e&&l<=t&&v.push(i)}}v.push(a)}}}_getEventRepeatOptions(e){const t=this,n=t._rRule;if(!e||!e.repeat||!n)return;const i=e.repeat,l=i.repeatFreq,r=l?n[l.toUpperCase()]:void 0;if(void 0===r)return;const a=i.repeatOn,o=i.repeatEnd;let s={freq:r,wkst:t.firstDayOfWeek,interval:i.repeatInterval||1};const d=t._getRepeatOnCondition(l,a);switch(l){case"weekly":s.byweekday=d;break;case"monthly":s.bymonthday=d;break;case"yearly":s.bymonth=d.index+1,s.bymonthday=d.value}return o instanceof Date?s.until=new Date(Date.UTC(...t._getUTCDateArgs(o))):"number"!=typeof o||isNaN(o)||(s.count=o),s.dtstart=new Date(Date.UTC(...t._getUTCDateArgs(e.dateStart))),s}_getUTCDateArgs(e){if(!isNaN(new Date(e).getTime()))return[e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes()]}_getRepeatOnCondition(e,t){if(!e||!t)return[];let n;if("weekly"===e){let e=[];Array.isArray(t)||(t=[t]);for(let i=0;i<t.length;i++)n=t[i],"string"==typeof n&&(n=isNaN(parseInt(n))?new Date(n):parseInt(n)),n instanceof Date&&!isNaN(n.getTime())?e.push(n.getDay()):e.push(Math.max(0,Math.min(6,parseInt(t[i])||0)));return e}if("monthly"===e)return Array.isArray(t)&&(t=t[0]),n=t,"string"==typeof n&&(n=isNaN(parseInt(n))?new Date(n):parseInt(n)),n=n instanceof Date&&!isNaN(n.getTime())?n.getDate():Math.max(0,Math.min(31,parseInt(t)||0)),n;if("yearly"===e){let e,i;if(Array.isArray(t)&&(t=t[0]),n=t,"string"==typeof n&&(n=isNaN(parseInt(n))?new Date(n):parseInt(n)),n instanceof Date&&!isNaN(n.getTime()))e=n.getMonth(),i=n.getDate();else{let n=t,l=t;"object"==typeof t&&(n=t.month,l=t.date),e=Math.max(0,Math.min(11,parseInt(n)||0)),i=Math.max(0,Math.min(31,parseInt(l)||0))}return{index:e,value:i}}}_getDayHours(e){const t=new Date(e||this.dateCurrent),n=t.getDate(),i=this.hourStart,l=this.hourEnd;let r=0;for(t.setHours(i,0,0,0);n===t.getDate()&&t.getHours()<=l;){r++;const e=t.getHours();t.setHours(t.getHours()+1,0,0,0),e===t.getHours()&&t.setHours(t.getHours()+2,0,0,0)}return r}_getDateString(e,t="horizontal",n){const i=this,l=i.viewType,r=l.indexOf("timeline")>-1,a=e.timeZone||i.timeZone;let o;if(e=e.date||e,r){if("vertical"===t)return"";o="timelineMonth"===l||"timelineWeek"===l&&n?e.toLocaleDateString(i.locale,{day:i.dayFormat,weekday:i.weekdayFormat,timeZone:a}):e.toLocaleTimeString(i.locale,{hour:i.hourFormat,minute:i.minuteFormat,timeZone:a})}else if("horizontal"===t){if("day"===l)return"";"week"===l?o=e.toLocaleDateString(i.locale,{day:i.dayFormat,weekday:i.weekdayFormat,timeZone:a}):"month"===l&&(o=e.toLocaleDateString(i.locale,{weekday:i.weekdayFormat,timeZone:a}))}else{if("month"===l)return"";o="agenda"===l?e.toLocaleDateString(i.locale,{day:i.dayFormat,weekday:i.weekdayFormat,timeZone:a}):e.toLocaleTimeString(i.locale,{hour:i.hourFormat,minute:i.minuteFormat,timeZone:a})}return i.timelineHeaderFormatFunction?i.timelineHeaderFormatFunction(e,t,n,o):o}_setGroupContent(e){const t=this,n=e.$.cellObj;if(t.groupTemplate)t._applyTemplate("groupTemplate",e,n);else{const i=t.resources.find(e=>e.value===n.resource);if(!i)return void(e.innerHTML="");let l;n.group&&(l=n.label);let r=l||i.label;t.timelineHeaderGroupFormatFunction&&(r=t.timelineHeaderGroupFormatFunction(l,i,r)),e.innerHTML=`<div>${r}</div>`}}_applyTemplate(e,t,n){const i=this;let l,r=i[e];if("groupTemplate"===e){if(l=i.resources.find(e=>e.value===n.resource),l){const e=n.group[n.resource];n=l.dataSource.find(t=>t.id===e)}n||(n=l)}i._templates||(i._templates={});const a=i._templates;if(t.innerHTML="","function"==typeof r)return r.call(i,t,n),void delete a[e];if("string"==typeof r&&(r=document.getElementById(r)),!("content"in document.createElement("template")))return i.error(i.localize("htmlTemplateNotSuported",{elementType:i.nodeName.toLowerCase()})),void delete a[e];if(null===r||!("content"in r))return i.error(i.localize("invalidTemplate",{elementType:i.nodeName.toLowerCase(),property:"groupTemplate"})),void delete a[e];a[e]||(a[e]={});const o=a[e];let s=o.clone;if(s||(s=o.clone=document.importNode(r.content,!0)),"cellTemplate"===e)n=n.toLocaleDateString(i.locale,{day:i.dayFormat});else if("eventTemplate"===e)return t.innerHTML="",void t.appendChild(s);const d=s.childNodes;for(let e=0;e<d.length;e++){let i=d[e].outerHTML;if(i){let e=o.bindings;if(!e){const t=/{{\s*\w*\s*}}/gm;t.test(i)&&(e=o.bindings=i.match(t))}for(let t=0;t<e.length;t++){const l=e[t];i=i.replace(l,"object"==typeof n?n[l.replace(/{{|}}/gm,"").trim()]||"":n)}t.innerHTML+=i}}}_setCellContent(e,t){const n=this;t=new Date(t||n.dateCurrent),n.cellTemplate?n._applyTemplate("cellTemplate",e,t):"month"===n.viewType?1===t.getDate()?e.innerHTML=`<div>${t.toLocaleDateString(n.locale,{month:"short",day:n.dayFormat})}</div>`:e.innerHTML=`<div>${t.toLocaleDateString(n.locale,{day:n.dayFormat})}</div>`:e.innerHTML=""}_setCurrentTimeIndicators(){clearInterval(this._currentTimeIndicatorInterval),delete this._currentTimeIndicatorInterval,this._refreshIndicators(),(this.currentTimeIndicator||this.shadeUntilCurrentTime)&&(this._currentTimeIndicatorInterval=setInterval(this._refreshIndicators.bind(this),1e3*this.currentTimeIndicatorInterval))}_refreshIndicators(){const e=this.viewType,t=new Date,n=this.$.timelineCellsContainer,i=60/this._getCellsScaleCount(),l=e.toLowerCase().indexOf("month")>-1,r=n.querySelectorAll(".smart-scheduler-cell:not(.scale)");let a,o=[];for(let e=0;e<r.length;e++){const n=r[e],a=new Date(n.$.cellObj.time);if(n.$&&(t.getFullYear()===a.getFullYear()&&t.getMonth()===a.getMonth()&&t.getDate()===a.getDate())){if(!l&&a.getHours()!==t.getHours()||a.getMinutes()+i<t.getMinutes()||a.getMinutes()>t.getMinutes())continue;o.push(n)}}if(o.length){const e=o[0].$.cellObj,n=new Date(e.time),r=e.scaleIndex||0;let s,d;l?(d=60*t.getHours()+t.getMinutes(),s=1440):(d=t.getMinutes(),s=n.getMinutes()+i),a={cells:o,minutes:d,max:s,scaleIndex:r}}this._refreshCurrentTimeIndicator(a),this._refreshCurrentTimeShader(a)}_refreshCurrentTimeIndicatorHeader(){const e=this.currentTimeIndicator,t=this.timeZone,n=new Date,i=n.getFullYear(),l=n.getMonth(),r=n.getDate(),a=n.getHours(),o=this.viewType.toLowerCase(),s=e=>{let t=new Date(e);for(let e=0;e<6;e++){if(t.getFullYear()===i&&t.getMonth()===l&&t.getDate()===r)return!0;t.setDate(t.getDate()+7)}},d=o.indexOf("agenda")>-1,c=o.indexOf("timeline")>-1,u=o.indexOf("month")>-1;function h(n,o){let h;const m=!d&&!u&&(o&&!c||!o&&c);for(let e=0;e<n.length;e++){const i=n[e];if(i.timeZone===t){h=i.children;break}}if(h)for(let t=0;t<h.length;t++){const n=h[t];if(!n.$)return;const o=n.$.cellObj.date;if(e){if(u&&!c){s(o)?n.setAttribute("current",""):n.removeAttribute("current");continue}if(o.getDate()===r&&(!m||o.getFullYear()===i&&o.getMonth()===l&&o.getHours()===a)){n.setAttribute("current","");continue}}n.removeAttribute("current")}}h(this.$.timelineHeaderHorizontalContent.querySelectorAll(".smart-scheduler-cells")),h(this.$.timelineHeaderVerticalContent.querySelectorAll(".smart-scheduler-cells"),!0)}_refreshCurrentTimeIndicator(e){const t=this,n=t.viewType,i=t.$.timelineIndicatorsContainer;let l=i.querySelector(".smart-scheduler-current-time");if(t._refreshCurrentTimeIndicatorHeader(),!t.currentTimeIndicator||"agenda"===n||!e)return l&&l.remove(),void(i.firstElementChild||(clearInterval(t._currentTimeIndicatorInterval),delete t._currentTimeIndicatorInterval));const[r,a,o,s]=[e.cells,e.minutes,e.max,e.scaleIndex],d=r.length,c=t._getCellsScaleCount();l||(l=document.createElement("div"),l.classList.add("smart-scheduler-current-time"));const u=l.children;t._recycleContainerCells({fragment:l,cellsNeeded:d,className:"smart-scheduler-current-time-indicator"});for(let e=0;e<u.length;e++){const t=r[e],i=u[e],l=t.closest(".smart-scheduler-cell-container");let d;n.toLowerCase().indexOf("timeline")>-1?(d=parseFloat(l.style.width)/c*(s+1),i.style.width=t.style.width,i.style.height=t.style.height,i.style.left=parseFloat(l.style.left)+d*(a/o)+"px",i.style.top=t.style.top):(d=parseFloat(l.style.height)/c*(s+1),i.style.width=t.style.width,i.style.height=t.style.height,i.style.left=t.style.left,i.style.top=parseFloat(l.style.top)+d*(a/o)+"px")}l.parentElement||i.appendChild(l)}_refreshCurrentTimeShader(e){const t=this,n=t.$.timelineIndicatorsContainer;let i=n.querySelector(".smart-scheduler-shader");if(!t.shadeUntilCurrentTime||"agenda"===t.viewType)return i&&i.remove(),void(t.currentTimeIndicator||(clearInterval(t._currentTimeIndicatorInterval),delete t._currentTimeIndicatorInterval));i||(i=document.createElement("div"),i.classList.add("smart-scheduler-shader"));const l=i.children;if(e)t._shadeUntilToday(i,e);else{const e=t._getCellShadeRangesByDate(),r=e.length;if(t._recycleContainerCells({fragment:i,cellsNeeded:r,className:"smart-scheduler-shade"}),!r&&(i.remove(),!n.firstElementChild))return clearInterval(t._currentTimeIndicatorInterval),void delete t._currentTimeIndicatorInterval;for(let n=0;n<r;n++){const i=e[n],r=i.hFrom,a=i.hTo,o=t._getFirstShadeCell(i.vFrom.$.cellObj,!0),s=t._getFirstShadeCell(i.vTo.$.cellObj,!0,!0),d=l[n];t._recycleContainerCells({fragment:d,cellsNeeded:1,className:"smart-scheduler-shade-section"});const c=d.children[0];c.style.width=parseFloat(a.style.left)+parseFloat(a.style.width)-parseFloat(r.style.left)+"px",c.style.height=parseFloat(s.style.top)+parseFloat(s.style.height)-parseFloat(o.style.top)+"px",c.style.left=r.style.left,c.style.top=o.style.top}}i.parentElement||n.insertBefore(i,n.firstElementChild)}_shadeUntilToday(e,t){const n=this;if(!t)return void(e.innerHTML="");const i=e.children,l=n.viewType,r=l.indexOf("month")>-1,a=n._getCellsScaleCount(),[o,s,d,c]=[t.cells,t.minutes,t.max,t.scaleIndex],u=o?o.length:1;n._recycleContainerCells({fragment:e,cellsNeeded:u,className:"smart-scheduler-shade"});for(let e=0;e<u;e++){const t=o[e],u=i[e],h=t.closest(".smart-scheduler-cell-container"),m=t.$.cellObj.horizontal,g=t.$.cellObj.vertical;let v;if(l.toLowerCase().indexOf("timeline")>-1){n._recycleContainerCells({fragment:u,cellsNeeded:1,className:"smart-scheduler-shade-section"});const e=u.children[0],i=n._getFirstShadeCell(m);v=parseFloat(h.style.width)/a*(c+1),e.style.width=parseFloat(h.style.left)-parseFloat(i.style.left)+v*(s/d)+"px",e.style.height=t.style.height,e.style.left=i.style.left,e.style.top=t.style.top}else{n._recycleContainerCells({fragment:u,cellsNeeded:r?3:2,className:"smart-scheduler-shade-section"});const e=u.children[0],i=u.children[1],l=n._getFirstShadeCell(m),o=n._getFirstShadeCell(g,!0),f=n._getFirstShadeCell(g,!0,!0);if(v=parseFloat(h.style.height)/a*(c+1),e.style.top=o.style.top,e.style.left=l.style.left,r){e.style.width=parseFloat(t.style.left)-parseFloat(l.style.left)+"px",e.style.height=parseFloat(h.style.top)-parseFloat(o.style.top)+parseFloat(h.style.height)+"px";const r=n._getFirstShadeCell(m,void 0,!0),a=u.children[2];i.style.width=parseFloat(r.style.left)+parseFloat(r.style.width)-parseFloat(l.style.left)-parseFloat(e.style.width)+"px",i.style.height=parseFloat(h.style.top)-parseFloat(o.style.top)+"px",i.style.top=o.style.top,i.style.left=parseFloat(l.style.left)+parseFloat(e.style.width)+"px",a.style.top=parseFloat(i.style.top)+parseFloat(i.style.height)+"px",a.style.left=i.style.left,a.style.width=t.style.width,a.style.height=v*(s/d)+"px"}else e.style.width=parseFloat(t.style.left)+parseFloat(t.style.width)-parseFloat(l.style.left)+"px",e.style.height=parseFloat(h.style.top)-parseFloat(o.style.top)+v*(s/d)+"px",i.style.top=parseFloat(e.style.top)+parseFloat(e.style.height)+"px",i.style.left=l.style.left,i.style.width=parseFloat(t.style.left)-parseFloat(l.style.left)+"px",i.style.height=parseFloat(f.style.top)+parseFloat(f.style.height)-parseFloat(i.style.top)+"px"}}}_getFirstShadeCell(e,t,n){const i=(t?this.$.timelineHeaderVerticalContent:this.$.timelineHeaderHorizontalContent).querySelectorAll(".smart-scheduler-view-time .smart-scheduler-cell"),l=e.group;if(!l)return n?i[i.length-1]:i[0];let r;for(let e=0;e<i.length;e++){const t=i[e],a=t.$.cellObj.group;if(a&&Object.keys(a).every(e=>a[e]===l[e])&&(r=t,!n))return r}return r}_getCellShadeRangesByDate(){const e=this.viewType.indexOf("timeline")>-1,t=new Date,n=t.getFullYear(),i=t.getMonth(),l=t.getDate(),r=t.getHours(),a=this.$.timelineHeaderHorizontalContent.querySelectorAll(".smart-scheduler-view-time .smart-scheduler-cell"),o=this.$.timelineHeaderVerticalContent.querySelectorAll(".smart-scheduler-cell"),s=e=>{let n,i;for(let l=0;l<o.length;l++){if(i=o[l],!i.$)continue;const r=new Date(i.$.cellObj.date);r.setDate(e.getDate());const a=r.getTime()||0;if(!n&&a<=t.getTime()&&(n=i),n&&a>t.getTime())break}return n&&i?{from:n,to:i}:void 0},d=e=>e.getFullYear()===n&&e.getMonth()===i&&e.getDate()===l;let c,u,h,m=[];for(let n=0;n<a.length;n++){const i=a[n],l=i.$.cellObj.date;!c&&l.getTime()<=t.getTime()&&(c=i),!d(l)||e&&l.getHours()!==r||(h=s(l),u=h?i:u,u&&(h=s(u.$.cellObj.date),h&&m.push({hFrom:c,hTo:u,vFrom:h.from,vTo:h.to})),c=void 0),u=i}if(c&&!m.length){u=a[a.length-1],(u.$?u.$.cellObj.date.getTime():0)>t.getTime()&&(u=c),h=u.$?s(u.$.cellObj.date):void 0,h&&m.push({hFrom:c,hTo:u,vFrom:h.from,vTo:h.to})}return m}_refreshTimelineHeaderCells(e,t){const n=this;e||(e="horizontal",n._refreshTimelineHeaderCells("vertical",t)),"horizontal"===e&&n.$.timelineViewAllDay.offsetHeight&&(n.$.timelineViewAllDaylabel.innerHTML=`<div>${n.localize("allDay")}</div>`);const[i,l,r,a]="horizontal"===e?["scrollLeft","left","width",n.$.timelineHeaderHorizontalContent]:["scrollTop","top","height",n.$.timelineHeaderVerticalContent],o=n.$.timelineTimeZoneLabelContainer,s=n.timeZones,d=a.querySelector(".smart-scheduler-view-time"),c=n.viewType,u=c.indexOf("timeline")>-1,h=d.children,m=n[i],g=n._timelineCells[e];let v,f;for(let e=0;e<g.length;e++){const t=g[e];if(m<=t[l]+t[r]){v=e;break}}(o.parentElement&&!u&&"agenda"!==c&&"vertical"===e||u&&"horizontal"===e)&&(f=o.children);for(let i=0;i<h.length;i++){const a=h[i],o=a.children;let d=v;if(f){const e=s.find(e=>e.id===a.timeZone);e&&(f[i].innerHTML=e?`<div>${e.label}</div>`:"")}for(let i=0;i<o.length;i++){const s=o[i],c=g[d];if(!c)break;d++,s.$={cellObj:c},s.innerHTML=`<div>${c.noLabel?"":n._getDateString({date:new Date(c.date),timeZone:a.timeZone},e)}</div>`,t||(s.style[r]=c[r]+"px","horizontal"===e?s.style[n.rightToLeft?"right":"left"]=c[l]+"px":s.style[l]=c[l]+"px",c.weekend?s.setAttribute("weekend",""):s.removeAttribute("weekend"),c.nonworking?s.setAttribute("nonworking",""):s.removeAttribute("nonworking"),c.separator?s.setAttribute("separator",""):s.removeAttribute("separator"),c.groupSeparator?s.setAttribute("group-separator",""):s.removeAttribute("group-separator"),c.showLabel?s.setAttribute("show-label",c.showLabel):s.removeAttribute("show-label"))}}n._refreshHeaderDetailCells(e,t),n._refreshHeaderGroupCells(e,t),a[i]=n[i]}_refreshHeaderGroupCells(e,t){const n=this,i=n._timelineCells.groups,l=n.$.groupsContainer,r=n.groupByDate;let a,o,s,d,c;if(!l)return;if(c=l.querySelector(".smart-scheduler-view-header-groups-container"),d="horizontal"===e?n.$.timelineHeaderHorizontal:n.$.timelineHeaderVertical,!i||!c||!d.contains(c))return;[a,o,s]="vertical"===e?["top","height","scrollTop"]:["left","width","scrollLeft"];let u=c.children,h=document.createDocumentFragment();for(;u.length;)h.appendChild(c.firstElementChild);u=h.children;for(let l=0;l<u.length;l++){const s=u[l],d=i[l];n._refreshAdditionalHeaderCells({orientation:e,fragment:s,type:"groups",offset:a,size:o,cellsObj:d[r?"cellsByDate":"cells"],resource:d.resource,refreshContentOnly:t})}c.appendChild(h),n.$.groupsContainer.querySelector(".smart-scheduler-view-groups-content")[s]=n[s]}_refreshHeaderDetailCells(e,t){const n=this._timelineCells.details;let i,l,r,a;if(!n||"horizontal"!==e||"timelineWeek"!==this.viewType)return;if(r=this.$.timelineHeaderHorizontalContent,a=r.querySelector(".smart-scheduler-view-details"),!a)return;[i,l]=["left","width"];let o=a.children,s=document.createDocumentFragment();for(;o.length;)s.appendChild(a.firstElementChild);this._refreshAdditionalHeaderCells({orientation:e,fragment:s,type:"details",offset:i,size:l,cellsObj:n,refreshContentOnly:t}),a.appendChild(s)}_refreshAdditionalHeaderCells(e){const t=this,n="agenda"===t.viewType,i=e.orientation,l=e.fragment,[r,a,o,s,d]=[e.type,e.offset,e.size,e.cellsObj,e.resource],c=e.refreshContentOnly,u=t._getFirstCellObjInView({orientation:i,type:r,resource:d});if(!u)return;t._recycleContainerCells({fragment:l,cellsNeeded:t._getTimelineVisibleCellsCount({orientation:i,type:r,resource:d})});const h=Array.from(l.children),m=s.indexOf(u),g="top"===a?a:t.rightToLeft?"right":"left";for(let e=0;e<h.length;e++){const l=h[e],d=s[m+e];if(l.$={cellObj:d},"groups"===r){if(!d[o]&&n){l.remove();continue}t._setGroupContent(l)}else{const e=d.date;l.innerHTML=`<div>${d.noLabel?"":t._getDateString({date:new Date(e)},i,!0)}</div>`}if(!c){if(d.groupSeparator?l.setAttribute("group-separator",""):l.removeAttribute("group-separator"),d.separator?l.setAttribute("separator",""):l.removeAttribute("separator"),d.group){const e=d.group;for(const t in e)l.setAttribute(t,e[t]||"")}l.style.top=l.style.left=l.style.width=l.style.height=null,l.style[o]=d[o]+"px",l.style[g]=d[a]+"px"}}}_createWindow(e){const t=this,n=e?e+"SchedulerWindow":"schedulerWindow";if(t.$[n])return t.$[n];const i=document.createElement("smart-window");return i.classList.add("smart-scheduler-window"),e&&i.classList.add(e),i.setAttribute("smart-id",n),t.$[n]=i,t["$"+n]=Smart.Utilities.Extend(i),i.rightToLeft=t.rightToLeft,i.theme=t.theme,i.animation=t.animation,i.disableSnap=!0,i.headerButtons=["close"],i}_openWindow(e,t){const n=this;if(!e&&!(e=n._createEventFromSelection()))return;if([n.$.schedulerWindow,n.$.confirmSchedulerWindow].some(e=>e&&e.opened)||n.disableWindowEditor)return;const i=t?"confirm":"";function l(){function t(){n._positionWindow(),r.opened?(r.bringToFront(),r._handleActiveState(),r._onOpenCallback&&r._onOpenCallback()):r.open()}if(n.windowCustomizationFunction?n.windowCustomizationFunction(r,i,n._cloneObject(e)):(n._setPopupWindowTemplate("header",i),n._setPopupWindowTemplate("footer",i),n._setPopupWindowTemplate("content",i)),!r.opened){const e=n["$"+(i?i+"SchedulerWindow":"schedulerWindow")];e.unlisten("transitionend"),e.unlisten("open"),e.unlisten("close"),e.unlisten("closing"),e.unlisten("click"),e.unlisten("change"),i||(r._onOpenCallback=()=>{((r.shadowRoot||r).querySelector(".smart-input")||r).focus({preventScroll:!0})}),r.hasAnimation&&e.listen("transitionend",n._windowTransitionendHandler.bind(n)),e.listen("open",n._windowOpenHandler.bind(n)),e.listen("close",n._windowCloseHandler.bind(n)),e.listen("closing",n._windowClosingHandler.bind(n)),e.listen("click",n._windowClickHandler.bind(n)),e.listen("change",n._windowChangeHandler.bind(n))}r.shadowRoot?(r.importStyle(Smart.Utilities.Core.getScriptLocation()+Smart.StyleBaseUrl.replace("/scoped/","/smart.textbox.css")),n._onShadowDomLoaded(r,"smart.window.css",t)):t(),n.setAttribute("aria-owns",r.id.trim())}if(!e)return;const r=n._createWindow(i);n.$.fireEvent("opening",{target:r,type:i,event:n._cloneObject(e)}).defaultPrevented||(r._target={event:e,originalTarget:t},r.parentElement||n.getShadowRootOrBody().appendChild(r),r.isCompleted?l():r.whenReady(()=>l()))}_positionWindow(){const e=this,t=e.getShadowRootOrBody(),n=[e.$.schedulerWindow,e.$.confirmSchedulerWindow];for(let i=0;i<n.length;i++){const l=n[i];if(!l||!t.contains(l))continue;const r=e.getBoundingClientRect();if(l.opened||(l.style.left=l.style.top=""),l.querySelector(".smart-scheduler-window-repeat")){const e=l.offsetWidth;!l.hasAttribute("horizontal")&&2*e<=r.width?l.setAttribute("horizontal",""):l.hasAttribute("horizontal")&&e>r.width&&l.removeAttribute("horizontal")}else l.removeAttribute("horizontal");l.style.left=Math.max(r.left+window.pageXOffset,r.left+window.pageXOffset+r.width/2-l.offsetWidth/2)+"px",l.style.top=Math.max(r.top+window.pageYOffset,r.top+window.pageYOffset+r.height/2-l.offsetHeight/2)+"px"}}_windowTransitionendHandler(e){const t=this,n=e.target;if(!n.classList.contains("smart-scheduler-window"))return;let i,l;n.classList.contains("confirm")?(i=t.$.confirmSchedulerWindow,l=t.$confirmSchedulerWindow):(i=t.$.schedulerWindow,l=t.$schedulerWindow),i.opened||"visibility"!==e.propertyName||(l.unlisten("transitionend"),i.remove())}_windowOpenHandler(e){const t=this,n=e.target;if(!n.classList.contains("smart-scheduler-window"))return;const i=n.classList.contains("confirm")?t.$confirmSchedulerWindow:t.$schedulerWindow,l=n._target.event;i&&(t._handleModal(!0),n===t.$.schedulerWindow?t.$.fireEvent(e.type,{target:e.target,editors:t._windowEditors,event:t._cloneObject(l)}):t.$.fireEvent(e.type,{target:e.target,event:t._cloneObject(l)}),i.unlisten("open"))}_windowClosingHandler(e){const t=this,n=e.target;if(!n.classList.contains("smart-scheduler-window"))return;const i=n.classList.contains("confirm")?t.$confirmSchedulerWindow:t.$schedulerWindow;if(i){const l={target:e.target,event:t._cloneObject(e.target._target.event)};if(n===t.$.schedulerWindow&&(l.editors=t._windowEditors),t.$.fireEvent(e.type,l).defaultPrevented)return void e.preventDefault();i.unlisten(e.type)}}_windowCloseHandler(e){const t=this,n=e.target;if(!n.classList.contains("smart-scheduler-window"))return;const i=n.classList.contains("confirm")?t.$confirmSchedulerWindow:t.$schedulerWindow;if(i){const l=e.target._target.event;t._handleModal(),n===t.$.schedulerWindow?t.$.fireEvent(e.type,{target:e.target,editors:t._windowEditors,event:t._cloneObject(l)}):t.$.fireEvent(e.type,{target:e.target,event:t._cloneObject(l)}),i.unlisten("close"),i.unlisten("click"),t.hasAttribute("aria-owns")&&t.removeAttribute("aria-owns");const r=t._getEventCell(n._target.originalTarget||l);(r||t.$.timeline).focus({preventScroll:!0})}}_getEventCell(e){if(e instanceof HTMLElement&&(e=e.$.event),!e)return;const t=this.$.timelineEventsContainer.children;for(let n=0;n<t.length;n++){const i=t[n],l=i.$?i.$.event:void 0;if(!l)continue;const r=l.$?l.$.event:void 0;if(l===e||r&&(r===e||e.$&&r===e.$.event))return i}}_windowChangeHandler(e){const t=this,n=e.target,i=n.closest(".smart-scheduler-window.confirm")?t.$.confirmSchedulerWindow:t.$.schedulerWindow;if(e.stopPropagation(),i!==t.$.schedulerWindow)return;const l=n.closest(".smart-scheduler-window-editor"),r=l?l.getAttribute("type"):void 0;if(r)if(r.indexOf("repeatEnd")>-1){const e=n.closest(".smart-scheduler-window-editor[multiple]");if(e){const t=e.children;for(let e=0;e<t.length;e++){const i=t[e],l=i.querySelector("[event-editor]");l&&(l.disabled=!i.contains(n))}}}else if(t._windowEditors&&n.hasAttribute("event-editor"))if("allDay"!==r)if("repeat"!==r){if("repeatFreq"===r)return t._setPopupWindowEditor(t._windowEditors.repeatOn),void t._setPopupWindowEditor(t._windowEditors.repeatInterval);"dateStart"!==r&&"dateEnd"!==r?"resources"!==r||t._setResourceDataEditor(t._windowEditors.resourceData):t._handleEditorDateValidation(n)}else{i._target.event&&(t._createWindowEditor("repeat"),t._positionWindow())}else t._handleEditorAllDay(n,i)}_handleEditorDateValidation(e){const t=this,n=t._windowEditors.dateStart,i=t._windowEditors.dateEnd,l=t._windowEditors.allDay;if(!n||!i)return;const r=n.querySelector("[event-editor]"),a=i.querySelector("[event-editor]"),o={dateStart:r.value.toDate(),dateEnd:a.value.toDate(),allDay:!!l&&l.checked};e===r?(o.type="end",a.value=t._getValidDate(o)):e===a&&(o.type="start",r.value=t._getValidDate(o))}_handleEditorAllDay(e){const t=this,n=t._windowEditors.dateStart,i=t._windowEditors.dateEnd;if(!n||!i)return;const l=n.querySelector("[event-editor]"),r=i.querySelector("[event-editor]"),a=l.value.toDate(),o=e.checked;let s=r.value.toDate();if(o){const e={dateStart:a,dateEnd:s,allDay:o,type:"start"};l.formatString="yyyy-MMM-dd",r.formatString="yyyy-MMM-dd",a.setHours(t.hourStart,0,0,0),s.setHours(t.hourEnd,0,0,0),l.value=t._getValidDate(e),e.type="end",r.value=t._getValidDate(e)}else{const e=t.hourStart;s=new Date(a),a.setHours(e,0,0,0),s.setHours(e,60/t._getCellsScaleCount(),0,0),l.value=a,r.value=s,l.formatString="yyyy-MMM-dd HH:mm",r.formatString="yyyy-MMM-dd HH:mm"}}_windowClickHandler(e){const t=this;let n=(e.originalEvent||e).target;n.shadowRoot&&(n=(e.originalEvent||e).composedPath()[0]);const i=n.closest(".smart-scheduler-window.confirm")?t.$.confirmSchedulerWindow:t.$.schedulerWindow,l=n.closest(".smart-scheduler-window-button"),r=t._windowEditors,a=i._target.event;i&&l&&(l.classList.contains("ok")&&r?t._updateEventViaWindow(a,r):l.classList.contains("delete")&&t._deleteEventViaWindow(a),i.close(),delete i._target,l.classList.contains("edit-event")?(a.date||(a.date=new Date(a.dateStart)),delete a.repeat,t._openWindow(a)):l.classList.contains("edit-series")&&a.$&&t._openWindow(a.$.event))}_deleteEventViaWindow(e){const t=this,n=t._events.indexOf(e),i=e.$?e.$.event:void 0;if(i){const t=i.repeat?i.repeat.exceptions:void 0,n=t?t.indexOf(e):void 0;n>-1&&t.splice(n,1)}else n>-1&&(t._events.splice(n,1),t.$.fireEvent("itemRemove",{item:t._cloneObject(e)}));t._refreshTimelineEvents()}_updateEventViaWindow(e,t){const n=this,i=n._events.indexOf(e),l=e.$?e.$.event:void 0;if(n._updateEventSettings(e,t),i<0)if(l){if(l.repeat){const t=l.repeat;t.exceptions||(t.exceptions=[]);const n=t.exceptions;delete t.repeat,n.indexOf(e)<0&&t.exceptions.push(e)}}else n._events.push(e),n.$.fireEvent("itemInsert",{item:n._cloneObject(e)});else n.$.fireEvent("itemUpdate",{item:n._cloneObject(e)});n._refreshTimelineEvents()}_updateEventSettings(e,t){const n=this,i=Object.keys(t);for(let l=0;l<i.length;l++){const r=i[l],a=t[r].querySelectorAll("[event-editor]"),o=a[0];if(o)switch(r){case"allDay":e[r]=o.checked;break;case"dateEnd":case"dateStart":e[r]=o.value.toDate(),e.dateEnd=n._getValidDate({dateStart:e.dateStart,dateEnd:e.dateEnd,type:"end"});break;case"description":case"label":e[r]=o.value;break;case"exceptions":e.repeat&&o.checked&&delete e.repeat.exceptions;break;case"hidden":e.$&&e.$.event&&(e[r]=o.checked);break;case"backgroundColor":e[r]=o.value,e[r]||delete e[r];break;case"resources":n._updateEventResources(e,t,o);break;case"resoruceData":break;case"status":{const t=n.statuses[o.selectedIndex];t&&t.value?e[r]=t.value:delete e[r];break}default:n._updateEventRepeating(e,t,r,a)}}}_updateEventResources(e,t,n){const i=this.resources;if(!n.value)return void i.forEach(t=>delete e[t.value]);const l=t.resourceData.querySelectorAll(".smart-scheduler-window-editor[resource-type]");let r,a=[];for(let t=0;t<l.length;t++){const n=l[t],o=n.querySelector("[event-editor]"),s=n.getAttribute("resource-type");if(!o||o.value&&o.selectedIndex<0){a.push(s);continue}const d=i.find(e=>e.value===s);if(d){const t=d.dataSource[o.selectedIndex];r=!0,t?(e[s]=t.id,a.push(s)):delete e[s]}}r&&i.forEach(t=>{a.indexOf(t.value)<0&&delete e[t.value]})}_updateEventRepeating(e,t,n,i){const l=i[0];if("repeat"===n)l.checked?e.repeat=e.repeat||{}:delete e.repeat;else{if(n.toLowerCase().indexOf("repeat")<0||!e.repeat)return;"object"!=typeof e.repeat&&(e.repeat={});const r=e.repeat;switch(n){case"repeatEnd":case"repeatEndAfter":case"repeatEndOn":{const e=t[n].querySelector(".smart-radio-button");if(e&&e.checked){const e=l.value;r.repeatEnd="repeatEndOn"===n?e.toDate():parseInt(e)}break}case"repeatFreq":r[n]=l.value.toLowerCase();break;case"repeatInterval":r[n]=parseInt(l.value);break;case"repeatOn":switch(r.repeatFreq){case"weekly":r[n]=l.selectedValues;break;case"monthly":r[n]=l.value;break;case"yearly":{const e=i[1]?parseInt(i[1].value):0;r[n]={month:l.selectedIndex,date:e};break}}}}}_getValidDate(e){const[t,n,i,l]=[e.dateStart,e.dateEnd,e.type,e.allDay||"start"];let r=new Date(t),a=new Date(n);if(isNaN(r)||isNaN(a)||n.getTime()>t.getTime())return"start"===i?t:n;for("start"===i?r=new Date(a):a=new Date(r);r.getTime()>=a.getTime();){const e=r.getTime();"start"===i?(r.setHours(r.getHours()-1),r.getTime()===e&&r.setHours(r.getHours()-2)):(a.setHours(a.getHours()+1),a.getTime()===e&&a.setHours(a.getHours()+2))}return l&&r.getFullYear()===a.getFullYear()&&r.getMonth()===a.getMonth()&&r.getDate()===a.getDate()&&("start"===i?(r.setHours(0,0,0,0),r.setDate(a.getDate()-1)):(a.setHours(0,0,0,0),a.setDate(a.getDate()+1))),"start"===i?r:a}_handleModal(e){const t=this;let n=(t.shadowRoot||t).querySelector(".smart-scheduler-window-modal");e?(n||(n=document.createElement("div"),n.classList.add("smart-scheduler-window-modal")),n.parentElement||(t.$.container.appendChild(n),t.setAttribute("modal",""))):n&&n.parentElement&&(n.parentElement.removeChild(n),t.removeAttribute("modal"))}_onShadowDomLoaded(e,t,n){requestAnimationFrame((function i(){const l=(e.shadowRoot||e.getRootNode()).querySelectorAll("link");for(let e=0;e<l.length;e++)if(-1!==l[e].href.indexOf(t))return void n();requestAnimationFrame(i)}))}_setPopupWindowTemplate(e,t){const n=this,i=n.$[t?t+"SchedulerWindow":"schedulerWindow"];if(!i)return;if("content"===e)return void n._setWindowContent(t);if(i[e+"Template"]||(i[e+"Template"]=n._createWindowTemplate(e,t)),t)return void n._setWindowTypeSection(e,t);const l=i._target.event,r=l.$&&l.$.event,a=n._events.indexOf(l)<0&&!r;let o;if(r&&r.repeat.exceptions&&(o=r.repeat.exceptions.indexOf(l)>-1),"header"===e){const e=(i.shadowRoot||i).querySelector(".smart-scheduler-window-label");l&&e&&(e.innerHTML=a?n.localize("newEvent"):r&&!o?n.localize("eventException"):l.label)}else if("footer"===e){const e=(i.shadowRoot||i).querySelectorAll(".smart-scheduler-window-button");for(let t=0;t<e.length;t++){const i=e[t];i.innerHTML='<span class="smart-icon"></span>',i.theme=n.theme,i.rightToLeft=n.rightToLeft,i.animation=n.animation,i.classList.contains("ok")?(i.innerHTML+=n.localize("ok"),i.setAttribute("aria-label","ok")):i.classList.contains("cancel")?(i.innerHTML+=n.localize("cancel"),i.setAttribute("aria-label","cancel")):i.classList.contains("delete")&&(i.innerHTML+=n.localize("delete"),i.setAttribute("aria-label","delete"),i.classList[a||r&&!o?"add":"remove"]("smart-hidden"));const l=i.querySelector(".smart-ripple");l&&l.parentElement.removeChild(l)}}}_setWindowTypeSection(e,t){const n=this,i=n.$[t?t+"SchedulerWindow":"schedulerWindow"];if(t&&i)if("confirm"!==t);else if("header"===e){const e=(i.shadowRoot||i).querySelector(".smart-scheduler-window-label");e&&(e.innerHTML=n.localize("repeatConfirmLabel"))}else if("footer"===e){const e=(i.shadowRoot||i).querySelectorAll(".smart-scheduler-window-button");for(let t=0;t<e.length;t++){const i=e[t];i.theme=n.theme,i.rightToLeft=n.rightToLeft,i.animation=n.animation,i.classList.contains("edit-event")?(i.innerHTML=n.localize("editEvent"),i.setAttribute("aria-label","edit-event")):i.classList.contains("edit-series")&&(i.innerHTML=n.localize("editSeries"),i.setAttribute("aria-label","edit-series"));const l=i.querySelector(".smart-ripple");l&&l.parentElement.removeChild(l)}}}_setWindowContent(e){const t=this,n=t.$[e?e+"SchedulerWindow":"schedulerWindow"];if(e){let i=n.querySelector(".smart-scheduler-confirm-label");if(!n.content||n.content.innerHTML&&!i)return;return i||(i=document.createElement("label"),i.classList.add("smart-scheduler-confirm-label"),n.appendChild(i)),void("confirm"===e&&i&&(i.innerHTML=t.localize("repeatConfirm")))}const i=n._target.event,l=[].slice.call(n.getElementsByClassName("smart-scheduler-window-editor"));!n.content||n.content.innerHTML&&!l.length||i&&(t._createWindowEditor(),t._createWindowEditor("repeat"))}_createWindowEditor(e="main"){const t=this,n=t.$.schedulerWindow,i=n._target.event,l=t._windowEditors;let r=n.querySelector(`.smart-scheduler-window-${e}`),a=i.repeat,o=i.$&&i.$.event;if(l&&l.repeat){const e=l.repeat.querySelector("[event-editor]");e&&(a=e.checked)}if("repeat"===e&&(!a||o))return void(r&&r.remove());if(!r){if(l){const t="main"===e?l.label:l.repeatFreq;t&&(r=t.closest(`.smart-scheduler-window-${e}`))}r||(r=document.createElement("div"),r.classList.add(`smart-scheduler-window-${e}`),r.innerHTML=t._getWindowEditorTemplate(e))}r.parentElement||n.appendChild(r);const s=r.querySelectorAll(".smart-scheduler-window-editor[type]");for(let e=0;e<s.length;e++)t._setPopupWindowEditor(s[e])}_getWindowEditorTemplate(e){return e&&"main"!==e?"repeat"===e?'\n                <div class="smart-scheduler-window-editor" type="repeatFreq">\n                    <label></label>\n                    <smart-input readonly event-editor drop-down-button-position="right"></smart-input>\n                </div>\n                <div class="smart-scheduler-window-editor" type="repeatInterval">\n                    <label></label>\n                    <smart-number-input min="1" event-editor></smart-number-input>\n                </div>\n                <div class="smart-scheduler-window-editor" type="repeatOn" multiple>\n                    <label></label>\n                </div>\n                <div class="smart-scheduler-window-editor" multiple>\n                    <div class="smart-scheduler-window-editor" type="repeatEnd">\n                        <label></label>\n                        <smart-radio-button group-name="repeat"></smart-radio-button>\n                    </div>\n                    <div class="smart-scheduler-window-editor" type="repeatEndOn">\n                        <smart-radio-button group-name="repeat"></smart-radio-button>\n                        <smart-date-time-picker calendar-button drop-down-append-to="body" event-editor\n                        enable-mouse-wheel-action drop-down-display-mode="auto"></smart-date-time-picker>\n                    </div>\n                    <div class="smart-scheduler-window-editor" type="repeatEndAfter">\n                        <smart-radio-button group-name="repeat"></smart-radio-button>\n                        <smart-number-input min="1" event-editor></smart-number-input>\n                        <label></label>\n                    </div>\n                </div>\n                <div class="smart-scheduler-window-editor smart-hidden" type="exceptions">\n                    <label></label>\n                    <smart-check-box event-editor></smart-check-box>\n                </div>':void 0:'\n            <div class="smart-scheduler-window-editor" type="label">\n                <label></label>\n                <smart-input event-editor></smart-input>\n            </div>\n            <div class="smart-scheduler-window-editor" multiple>\n                <div class="smart-scheduler-window-editor" type="dateStart">\n                    <label></label>\n                    <smart-date-time-picker calendar-button drop-down-append-to="body" event-editor\n                    enable-mouse-wheel-action drop-down-display-mode="auto"></smart-date-time-picker>\n                </div>\n                <div class="smart-scheduler-window-editor" type="dateEnd">\n                    <label></label>\n                    <smart-date-time-picker calendar-button drop-down-append-to="body" event-editor\n                        enable-mouse-wheel-action drop-down-display-mode="auto"></smart-date-time-picker>\n                </div>\n            </div>\n            <div class="smart-scheduler-window-editor" type="description">\n                <label></label>\n                <smart-text-area event-editor></smart-text-area>\n            </div>\n            <div class="smart-scheduler-window-editor" multiple>\n                <div class="smart-scheduler-window-editor" type="allDay">\n                    <label></label>\n                    <smart-switch-button event-editor></smart-switch-button>\n                </div>\n                <div class="smart-scheduler-window-editor" type="hidden">\n                    <label></label>\n                    <smart-switch-button event-editor></smart-switch-button>\n                </div>\n                <div class="smart-scheduler-window-editor" type="repeat">\n                    <label></label>\n                    <smart-switch-button event-editor></smart-switch-button>\n                </div>\n            </div>\n            <div class="smart-scheduler-window-editor" multiple>\n                <div class="smart-scheduler-window-editor" type="backgroundColor">\n                    <label></label>\n                    <smart-color-input event-editor></smart-color-input>\n                </div>\n                <div class="smart-scheduler-window-editor" type="status">\n                    <label></label>\n                    <smart-input event-editor></smart-input>\n                </div>\n            </div>\n            <div class="smart-scheduler-window-editor smart-hidden" type="resources">\n                <label></label>\n                <smart-check-input event-editor disabled></smart-check-input>\n            </div>\n            <div class="smart-scheduler-window-editor smart-hidden" multiple type="resourceData"></div>\n            </div>'}_setPopupWindowEditor(e){const t=this,n=e.getAttribute("type"),i=e.querySelector("label"),l=t.$.schedulerWindow._target.event,r=l.$&&l.$.event;let a=e.querySelector("[event-editor]");if(!l)return;t._windowEditors||(t._windowEditors={});const o=t._windowEditors;if(o[n]||(o[n]=e),i&&(i.innerHTML=t.localize(n)),"label"===n||"description"===n)a.value=void 0!==l[n]?l[n]+"":"";else if(n.indexOf("date")>-1){const e=!!l.allDay;a.formatString=e?"yyyy-MMM-dd":"yyyy-MMM-dd HH:mm",a.value=new Date(l[n])}else if("allDay"===n||"repeat"===n)a.checked=!!l[n],e.classList["repeat"===n&&r?"add":"remove"]("smart-hidden");else if("repeatFreq"===n){const e=["hourly","daily","weekly","monthly","yearly"],n=l.repeat?(l.repeat.repeatFreq+"").toLowerCase():e[0];a.dataSource=[{label:t.localize(e[0]),value:e[0]},{label:t.localize(e[1]),value:e[1]},{label:t.localize(e[2]),value:e[2]},{label:t.localize(e[3]),value:e[3]},{label:t.localize(e[4]),value:e[4]}],a.value=t.localize(e.indexOf(n)>-1?n:e[0])}else if("repeatInterval"===n){const e=parseInt(l.repeat?l.repeat.repeatInterval:void 0);if(a.value=isNaN(e)?1:e,i&&o.repeatFreq){const e=o.repeatFreq.querySelector("[event-editor]");if(e){const n={hourly:"hours",daily:"days",weekly:"weeks",monthly:"months",yearly:"years"};i.innerHTML+=` (${t.localize(n[e.value.toLowerCase()])||""})`}}}else if("repeatOn"===n)t._setRepeatOnEditor(e,a);else if(n.indexOf("repeatEnd")>-1){let i=l.repeat?l.repeat.repeatEnd:void 0,r=i;switch(n){case"repeatEnd":r=!r;break;case"repeatEndOn":r=r instanceof Date;break;case"repeatEndAfter":r="number"==typeof r&&!isNaN(r)}const o=e.querySelector(".smart-radio-button");o&&(o.innerHTML=t.localize(n+"Option"),o.checked=r,t._setEditorCommonProperties(o)),a&&(a instanceof Smart.DateTimePicker?(i=new Date(i),a.formatString="yyyy-MMM-dd",a.value=r&&!isNaN(i.getTime())?i:new Date):(i=parseInt(i),a.value=r&&!isNaN(i)?i:1),a.disabled=o&&!o.checked)}else if("exceptions"===n){const n=!r&&l.repeat&&l.repeat.exceptions&&l.repeat.exceptions.length;a.checked=!1,a.innerHTML=t.localize("resetExceptions"),e.classList[n?"remove":"add"]("smart-hidden")}else if("hidden"===n)a.checked=!!l[n],e.classList[r?"remove":"add"]("smart-hidden");else if("backgroundColor"===n){a.dataSource||(a.dataSource=l.colorScheme||t.colorScheme);const e=a.$.scrollView;e&&e.classList.add("smart-scheduler-color-input"),a.valueDisplayMode="colorBox",a.value=l.backgroundColor||""}else"status"===n?t._setStatusEditor(e,a):"resources"===n?t._setResourceEditor(e,a):"resourceData"===n&&t._setResourceDataEditor(e);t._setEditorCommonProperties(a)}_setEditorCommonProperties(e){const t=this;e&&(e.locale=t.locale,e.rightToLeft=t.rightToLeft,e.animation=t.animation,e.theme=t.theme)}_setStatusEditor(e,t){const n=this.statuses,i=this.$.schedulerWindow._target.event;if(!i||!n.length)return void e.classList.add("smart-hidden");const l=i.status,r=n.find(e=>e.value===l);e.classList.remove("smart-hidden"),t.dataSource=this.statuses,t.value=r?this.localize(r.label)||r.label:"",t.readonly=!0,t.placeholder=this.localize("selectPlaceholder"),t.dropDownButtonPosition="right",this._setEditorCommonProperties(t)}_setResourceEditor(e,t){const n=this.resources,i=this.$.schedulerWindow._target.event;let l=[],r=[];i&&n.length?(e.classList.remove("smart-hidden"),l=n.map(e=>(e&&i[e.value]&&r.push(e.label),{label:e.label,value:e.value})),t.readonly=!0,t.placeholder=this.localize("selectPlaceholder"),t.dropDownButtonPosition="right",t.disabled=!n.length,t.dataSource=l,t.value=r.toString(),this._setEditorCommonProperties(t),t.wait&&(t.wait=!1)):e.classList.add("smart-hidden")}_setResourceDataEditor(e){const t=this,n=t.resources,i=t.$.schedulerWindow._target.event;let l,r,a=Array.from(e.querySelectorAll(".smart-scheduler-window-editor")),o=[];if(i&&n.length){t._windowEditors.resources&&(r=t._windowEditors.resources.querySelector("[event-editor]"),r&&r.value&&(l=r.selectedValues));for(let r=0;r<n.length;r++){const s=n[r],d=s.label,c=s.value,u=s.dataSource;if(!u||!l)continue;const h=l.length;if(h&&l.indexOf(c)>-1||!h&&i[c]){const n=u.find(e=>s&&e.id===i[c]);let l,r,h=a.find(e=>e.getAttribute("resource-type")===c);h?(l=h.querySelector("label"),r=h.querySelector("[event-editor]")):(h=document.createElement("div"),l=document.createElement("label"),r=document.createElement("smart-input"),r.setAttribute("event-editor",""),h.appendChild(l),h.appendChild(r),h.classList.add("smart-scheduler-window-editor"),h.setAttribute("resource-type",c),e.appendChild(h)),o.push(h),t._setEditorCommonProperties(r),l.innerHTML=t.localize(d)||d,r.dataSource=s.dataSource.map(e=>Object.create({label:e.label,value:e.value})),r.value=n?n.label:"",r.dropDownButtonPosition="right",r.readonly=!0,r.placeholder=t.localize("selectPlaceholder")}}for(let e=0;e<a.length;e++)o.indexOf(a[e])<0&&a[e].remove();e.classList.remove("smart-hidden")}else e.classList.add("smart-hidden")}_setRepeatOnEditor(e){const t=this,n=t.$.schedulerWindow._target.event,i=t._windowEditors,l=i.repeatOn,r=i.repeatFreq.querySelector("[event-editor]").value.toLowerCase();let a,o=n.repeat?n.repeat.repeatOn:void 0;if(!n||!r||["weekly","monthly","yearly"].indexOf(r)<0)return void e.classList.add("smart-hidden");l.$||(l.$={});const s=l.$;for(let e in s)e!==r&&s[e]&&s[e].remove();void 0===o&&(o=new Date(n.dateStart));let d=s[r];switch(r){case"weekly":d||(d=document.createElement("smart-button-group"),d.dataSource=t._getWeekDays(),d.selectionMode="zeroOrMany",d.setAttribute("event-editor",""),s[r]=d),d.selectedValues=t._getRepeatOnCondition(r,o).map(e=>e.toString());break;case"monthly":d||(d=document.createElement("smart-number-input"),d.min=1,d.max=31,d.setAttribute("event-editor",""),s[r]=d),d.value=t._getRepeatOnCondition(r,o).toString();break;case"yearly":{let e,n;if(!d){d=document.createElement("div");const e=document.createElement("smart-input"),n=document.createElement("smart-number-input");e.dataSource=t._getMonthNames(),e.dropDownButtonPosition="right",e.readonly=!0,n.min=1,n.max=31,e.setAttribute("event-editor",""),n.setAttribute("event-editor",""),t._setEditorCommonProperties(e),t._setEditorCommonProperties(n),d.appendChild(e),d.appendChild(n),d.classList.add("smart-scheduler-window-editor"),s[r]=d}e||(e=d.querySelector("smart-input")),n||(n=d.querySelector("smart-number-input")),a=t._getRepeatOnCondition(r,o),e.selectedIndex=a.index,n.value=a.value.toString();break}}d=s[r],e.contains(d)||e.appendChild(d),e.classList.remove("smart-hidden")}_getMonthNames(){const e=[],t=this.monthFormat,n=this.locale,i=new Date;i.setMonth(0);for(let l=0;l<12;l++)e.push({label:i.toLocaleDateString(n,{month:t}),value:i.getMonth()}),i.setMonth(i.getMonth()+1);return e}_getWeekDays(){const e=[],t=this.weekdayFormat,n=this.locale,i=new Date;i.setDate(i.getDate()-i.getDay()+this.firstDayOfWeek);for(let l=0;l<7;l++)e.push({label:i.toLocaleDateString(n,{weekday:t}),value:i.getDay()}),i.setDate(i.getDate()+1);return e}_createWindowTemplate(e,t){const n=this,i=document.createElement("template");return"footer"===e?t?"confirm"===t&&(i.innerHTML=`\n                    <smart-button class="smart-scheduler-window-button edit-event"\n                        animation="${n.animation}" theme="${n.theme}" ${n.rightToLeft?"right-to-left":""}>\n                    </smart-button>\n                    <smart-button class="smart-scheduler-window-button edit-series"\n                        animation="${n.animation}" theme="${n.theme}" ${n.rightToLeft?"right-to-left":""}>\n                    </smart-button>`):i.innerHTML=`<smart-button class="smart-scheduler-window-button ok primary"\n                        animation="${n.animation}" theme="${n.theme}" ${n.rightToLeft?"right-to-left":""}>\n                    </smart-button>\n                    <smart-button class="smart-scheduler-window-button cancel"\n                        animation="${n.animation}" theme="${n.theme}" ${n.rightToLeft?"right-to-left":""}>\n                    </smart-button>\n                    <smart-button class="smart-scheduler-window-button delete secondary"\n                        animation="${n.animation}" theme="${n.theme}" ${n.rightToLeft?"right-to-left":""}>\n                    </smart-button>`:"header"===e&&(i.innerHTML='<span class="smart-scheduler-window-label"></span>'),i}_currentTimeIndicatorIntervalValidator(e,t){return Math.max(1,t)}_hourValidator(e,t){return Math.max(0,Math.min(23,t))}_dateValidator(e,t){return t=this._parseDate(t),this._minMaxDateValidator(isNaN(t)?e:t)}_parseDate(e){let t;if(e instanceof Date)return e;if(Smart.Utilities.DateTime&&e instanceof Smart.Utilities.DateTime)return e.toDate();if("string"==typeof e){const n=/\d+:\d+:\d+/;if("new Date()"===e.trim()||"new Smart.Utilities.DateTime()"===e.trim())return new Date;if(isNaN(Date.parse(e))){const i=/(\d+[,-.\/]{1}\s*\d+[,-.\/]{1}\s*\d+)/;if(i.test(e)){const l=i.exec(e)[0].replace(/[,-.\/]/g,",").split(",");if(3===l.length){const[i,r]=parseInt(l[0])<parseInt(l[2])?[l[0],l[2]]:[l[2],l[0]];if(t=new Date(parseInt(r),parseInt(l[1])-1,parseInt(i)),n.test(e)){const i=n.exec(e)[0].split(":");t.setHours(i[0]||0,i[1]||0,i[2]||0)}e=t}}}else t=new Date(Date.parse(e)),n.test(e)||t.setHours(0,0,0,0),e=t}return new Date(e)}_firstDayOfWeekValidator(e,t){return Math.min(6,Math.max(0,t))}_minMaxDateValidator(e){if(!e||isNaN(e.getTime()))return e;const t=new Date(this.min),n=new Date(this.max);return t&&(e=new Date(Math.max(t.getTime(),e.getTime()))),n&&(e=new Date(Math.min(n.getTime(),e.getTime()))),e}_nonworkingDayValidator(e,t){return this._nonworkingDateTimeValidator(e,t)}_nonworkingTimeValidator(e,t){return this._nonworkingDateTimeValidator(e,t,!0)}_nonworkingDateTimeValidator(e,t,n){let i=[];const[l,r]=[0,n?23:6];for(let e=0;e<t.length;e++){const a=t[e];if("number"!=typeof a||isNaN(a))if(Array.isArray(a)){let e=Math.max(l,Math.min(r,parseInt(a[0]))),t=Math.max(l,Math.min(r,parseInt(a[1])));if(!isNaN(e)&&!isNaN(t)){for(;e!==t;)i.push(e),e=e===r?l:++e;i.push(e)}}else{const e=this._dateValidator(a,a);e instanceof Date&&i.push(n?e.getHours():e.getDay())}else i.push(Math.max(l,Math.min(r,parseInt(a))))}return i}_setViewType(e){const t=this.views.find(t=>t.value&&t.value===e);e=t?t.type:e,this.set("viewType",this.properties.viewType.allowedValues.indexOf(e)>-1?e:"day")}_timeZoneValidator(e,t){const n=this;try{return Intl.DateTimeFormat(n.locale,{timeZone:t}),t}catch(t){return n.error(n.localize("invalidTimeZone",{elementType:n.nodeName.toLowerCase()})),e}}_timeZonesValidator(e,t){const n=this;let i=[];for(let e=0;e<t.length;e++){const l=t[e],r=l.id||l;null!==n._timeZoneValidator(null,r)&&i.push({id:r,label:l.label||r})}return i}_viewValidator(e,t){return this._isViewUpdated=!0,this._setViewType(t),delete this._isViewUpdated,t}_viewTypeValidator(e,t){return this._isViewUpdated?t:e}_viewsValidator(e,t){const n=this,i=n.properties.viewType.allowedValues;let l=[];for(let e=0;e<t.length;e++){const r=t[e];"string"==typeof r&&i.includes(r)?l.push(r):"object"==typeof r&&i.includes(r.type)&&(r.value=r.value||r.type,r.label=r.label||n.localize(r.type),l.push(r))}return l}})}});