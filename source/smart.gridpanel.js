
/* Smart HTML Elements v3.2.0 (2019-June) 
Copyright (c) 2011-2019 jQWidgets. 
License: https://htmlelements.com/license/ */

Smart("smart-grid-panel",class extends Smart.BaseElement{static get properties(){return{closeButtonPosition:{value:"left",allowedValues:["left","right"],type:"string"},dataSource:{value:[],type:"array",reflectToAttribute:!1},messages:{value:{en:{apply:"Apply",booleanFirst:"\u2610",booleanLast:"\u2611",cancel:"Cancel",dateFirst:"1",dateLast:"9",from:"from",numberFirst:"1",numberLast:"9",stringFirst:"A",stringLast:"Z",thenBy:"then by"}},type:"object",extend:!0}}}static get listeners(){return{change:"_changeHandler",click:"_clickHandler",keydown:"_keydownHandler","sortable.dragEnd":"_sortableDragEndHandler"}}template(){return`<div id="container">
                    <smart-sortable id="sortable" animation="[[animation]]" disabled="[[readonly]]" drag-mode="handle" handle-position="right" handle-visibility="visible"></smart-sortable>
                    <div id="footer" class="smart-grid-panel-container-footer">
                        <smart-input id="inputNotSorted" animation="[[animation]]" readonly></smart-input>
                        <div id="buttonsContainer" class="smart-grid-panel-buttons-container smart-unselectable">
                            <span class="smart-grid-panel-cancel-button"></span>
                            <span class="smart-grid-panel-apply-button"></span>
                        </div>
                    </div>
                </div>`}ready(){super.ready();const a=this;"right"===a.closeButtonPosition&&(a.$.sortable.handlePosition="left"),a._localize(),a._createSources(),a._setFocusable()}propertyChangedHandler(a,b,c){super.propertyChangedHandler(a,b,c);const d=this;switch(a){case"animation":const b=Array.from(d.$.sortable.getElementsByTagName("smart-input"));b.forEach(a=>a.animation=c);break;case"disabled":case"unfocusable":d._setFocusable();break;case"closeButtonPosition":d.$.sortable.handlePosition="right"===d.closeButtonPosition?"left":"right";break;case"dataSource":d.$.sortable.$.container.innerHTML="",d._createSources();break;case"locale":case"messages":const e=d.$.sortable._items;d._localize(),e.length&&(e[0].children[1].innerHTML=d.localize("firstBy"),e.forEach(function(a,b){0!==b&&(a.children[1].innerHTML=d.localize("thenBy"));const c=d._HTMLToSourceMap.get(a),e=d._ascDescTemplates[c.dataType]||d._ascDescTemplates.string;a.children[3].innerHTML=d.localize("from"),a.children[4].firstElementChild.innerHTML=e[0],a.children[4].children[1].innerHTML=e[1]}));break;case"maxLevel":if(c!==void 0&&null!==c)for(;0<d.$.sortable._items.length&&d.$.sortable._items.length>c;)d._interactionHandler(d.$.sortable._items[d.$.sortable._items.length-1].firstElementChild);d._disableItemAddition();}}_changeHandler(a){const b=this,c=a.target;if(b.$.inputNotSorted.contains(c)){const a=b.$.inputNotSorted.value,c=b._labelToSourceMap.get(a);return b._createSortItem(c,b.$.sortable._items.length),b.$.sortable.updateItems(),b._visibleLabels.push(a),b._updateHiddenSource(),b._disableItemAddition(),void(b.$.inputNotSorted.value="")}const d=c.closest("smart-input");if(d){const a=d.parentElement.parentElement,c=a.children[4].firstElementChild,e=a.children[4].children[1],f=d.value,g=b._HTMLToSourceMap.get(a).label,h=b._labelToSourceMap.get(f),i=b._ascDescTemplates[h.dataType]||b._ascDescTemplates.string;b._HTMLToSourceMap.set(a,h),b._visibleLabels.splice(b._visibleLabels.indexOf(g),1,f),b._updateHiddenSource(),c.innerHTML=i[0],e.innerHTML=i[1],h.sortDirection&&-1===h.sortDirection.indexOf("asc")?(e.classList.add("selected"),c.classList.remove("selected")):(c.classList.add("selected"),e.classList.remove("selected"))}}_updateHiddenSource(){const a=this;a._hiddenSource=a.dataSource.map(a=>({label:a.label,value:a.dataField,icon:a.icon})).filter(b=>-1===a._visibleLabels.indexOf(b.label)),a.$.inputNotSorted.dataSource=a._hiddenSource,a.$.sortable._items.forEach(b=>b.getElementsByTagName("smart-input")[0].dataSource=a._hiddenSource),a._disableItemAddition()}_clickHandler(a){const b=this;b._interactionHandler(a.target,a)}_interactionHandler(a,b){const c=this;if(c.disabled||c.readonly)return!0;const d=a.closest(".smart-grid-panel-item");if(d){if(a===d.firstElementChild){const a=c._HTMLToSourceMap.get(d),b=a.label;c.$.sortable.$.container.removeChild(d),c.$.sortable.updateItems(),c._visibleLabels.splice(c._visibleLabels.indexOf(b),1),c._updateHiddenSource(),c._disableItemAddition(),c.$.sortable._items.length&&(c.$.sortable._items[0].children[1].innerHTML=c.localize("firstBy"))}else if(d.children[4].contains(a)){const e=d.children[4].firstElementChild,f=d.children[4].children[1];"click"===b.type?!a.classList.contains("selected")&&(a===e?(f.classList.remove("selected"),e.classList.add("selected"),c._HTMLToSourceMap.get(d).sortDirection="ascending"):a===f&&(e.classList.remove("selected"),f.classList.add("selected"),c._HTMLToSourceMap.get(d).sortDirection="descending")):(e.classList.toggle("selected"),f.classList.toggle("selected"),c._HTMLToSourceMap.get(d).sortDirection=e.classList.contains("selected")?"ascending":"descending")}return!0}if(a===c.$.buttonsContainer.firstElementChild)return c.$.fireEvent("cancel"),!0;if(a===c.$.buttonsContainer.children[1]){const a=[];return c.$.sortable._items.forEach(b=>{const d=c._HTMLToSourceMap.get(b);a.push({dataField:d.dataField,sortDirection:d.sortDirection})}),c.$.fireEvent("apply",{value:a}),!0}}_keydownHandler(a){const b=this,c=document.activeElement,d=a.key;(" "===d||"Enter"===d)&&(a.preventDefault(),b._interactionHandler(c,a))}_sortableDragEndHandler(a){const b=this,c=a.detail.oldIndex,d=a.detail.newIndex,e=Math.max(c,d),f=b.$.sortable._items;0===(c&&d)&&(f[0].children[1].innerHTML=b.localize("firstBy"),f[1].children[1].innerHTML=b.localize("thenBy"),1<e&&(f[e].children[1].innerHTML=b.localize("thenBy")))}_localize(){const a=this;a.$.inputNotSorted.placeholder=a.localize("pickAnother"),a.$.buttonsContainer.firstElementChild.innerHTML=a.localize("cancel"),a.$.buttonsContainer.children[1].innerHTML=a.localize("apply"),a._ascDescTemplates={boolean:[a.localize("booleanFirst")+" \u2192 "+a.localize("booleanLast"),a.localize("booleanLast")+" \u2192 "+a.localize("booleanFirst")],date:[a.localize("dateFirst")+" \u2192 "+a.localize("dateLast"),a.localize("dateLast")+" \u2192 "+a.localize("dateFirst")],number:[a.localize("numberFirst")+" \u2192 "+a.localize("numberLast"),a.localize("numberLast")+" \u2192 "+a.localize("numberFirst")],string:[a.localize("stringFirst")+" \u2192 "+a.localize("stringLast"),a.localize("stringLast")+" \u2192 "+a.localize("stringFirst")]}}_createSources(){const a=this,c=(a instanceof Smart.SortPanel?"sort":"group")+"Index",b=[],d=[];if(a._HTMLToSourceMap=new Map,a._labelToSourceMap=new Map,a.dataSource.forEach(d=>{a._labelToSourceMap.set(d.label,d),-1!==d[c]&&void 0!==d[c]&&b.push(d)}),b.sort((d,a)=>d[c]-a[c]),void 0!==a.maxLevel&&null!==a.maxLevel)for(;0<b.length&&b.length>a.maxLevel;)b.pop();b.forEach(a=>d.push(a.label)),a._visibleLabels=d,a._updateHiddenSource(),b.forEach((b,c)=>{a._createSortItem(b,c)}),a.$.sortable.updateItems(),a._disableItemAddition()}_createSortItem(a,b){const c=this,d=c.disabled||c.unfocusable?-1:0,e=document.createElement("div"),f=c._ascDescTemplates[a.dataType]||c._ascDescTemplates.string;e.className="smart-grid-panel-item",e.innerHTML=`<div class="smart-grid-panel-item-close-button" tabindex="${d}"></div>
<div class="smart-grid-panel-label-by smart-unselectable">${c.localize(0<b?"thenBy":"firstBy")}</div>
<div class="smart-grid-panel-field-container"><smart-input class="smart-grid-panel-field-selection" value="${a.label}" animation="${c.animation}" readonly></smart-input></div>
<div class="smart-grid-panel-from smart-unselectable">${c.localize("from")}</div >
<div class="smart-grid-panel-direction smart-unselectable" tabindex="${d}">
    <div class="smart-grid-panel-asc">${f[0]}</div >
    <div class="smart-grid-panel-desc">${f[1]}</div>
</div>
`,e.getElementsByTagName("smart-input")[0].dataSource=c._hiddenSource,c.$.sortable.$.container.appendChild(e),e.getElementsByTagName("input")[0].tabIndex=d,a.sortDirection&&-1===a.sortDirection.indexOf("asc")?e.children[4].children[1].classList.add("selected"):e.children[4].firstElementChild.classList.add("selected"),c._HTMLToSourceMap.set(e,a)}_disableItemAddition(){const a=this,b=a.maxLevel;a.$.inputNotSorted.disabled=0===a._hiddenSource.length||b!==void 0&&null!==b&&Math.max(0,b)===a.$.sortable._items.length}_setFocusable(){const a=this,b=a.disabled||a.unfocusable?-1:0,c=Array.from(a.getElementsByClassName("smart-grid-panel-item-close-button")),d=Array.from(a.getElementsByClassName("smart-grid-panel-direction")),e=Array.from(a.getElementsByTagName("input")),f=c.concat(d).concat(e);a.$.buttonsContainer.firstElementChild.tabIndex=b,a.$.buttonsContainer.children[1].tabIndex=b,f.forEach(a=>a.tabIndex=b)}}),Smart("smart-sort-panel",class extends Smart.GridPanel{static get properties(){return{messages:{value:{en:{firstBy:"Sort by",pickAnother:"Pick another field to sort by"}},type:"object",extend:!0}}}}),Smart("smart-group-panel",class extends Smart.GridPanel{static get properties(){return{maxLevel:{value:8,type:"number?"},messages:{value:{en:{collapseAll:"Collapse all",expandAll:"Expand all",firstBy:"Group by",pickAnother:"Pick another field to group by"}},type:"object",extend:!0}}}template(){return`<div id="container">
                    <smart-sortable id="sortable" animation="[[animation]]" disabled="[[readonly]]" drag-mode="handle" handle-position="right" handle-visibility="visible"></smart-sortable>
                    <div id="expandCollapseContainer" class="smart-grid-panel-buttons-container smart-grid-panel-expand-collapse smart-unselectable">
                        <span class="smart-group-panel-collapse-button"></span>
                        <span class="smart-group-panel-expand-button"></span>
                    </div>
                    <div id="footer" class="smart-grid-panel-container-footer">
                        <smart-input id="inputNotSorted" animation="[[animation]]" readonly></smart-input>
                        <div id="buttonsContainer" class="smart-grid-panel-buttons-container smart-unselectable">
                            <span class="smart-grid-panel-cancel-button"></span>
                            <span class="smart-grid-panel-apply-button"></span>
                        </div>
                    </div>
                </div>`}_interactionHandler(a,b){const c=this,d=super._interactionHandler(a,b);d||(a===c.$.expandCollapseContainer.firstElementChild?c.$.fireEvent("collapseAll"):a===c.$.expandCollapseContainer.children[1]&&c.$.fireEvent("expandAll"))}_localize(){super._localize();const a=this;a.$.expandCollapseContainer.firstElementChild.innerHTML=a.localize("collapseAll"),a.$.expandCollapseContainer.children[1].innerHTML=a.localize("expandAll")}_setFocusable(){super._setFocusable();const a=this,b=a.disabled||a.unfocusable?-1:0;a.$.expandCollapseContainer.firstElementChild.tabIndex=b,a.$.expandCollapseContainer.children[1].tabIndex=b}});