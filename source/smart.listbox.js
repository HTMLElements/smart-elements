
/* Smart HTML Elements v3.2.0 (2019-June) 
Copyright (c) 2011-2019 jQWidgets. 
License: https://htmlelements.com/license/ */

Smart("smart-list-item",class extends Smart.ContentElement{static get properties(){return{alternationIndex:{value:-1,type:"int"},displayMode:{allowedValues:["plain","checkBox","radioButton"],value:"plain",type:"string"},grouped:{value:!1,type:"boolean"},selected:{value:!1,type:"boolean"},value:{value:"",type:"string"},label:{value:"",type:"string"},details:{value:"",type:"string"},group:{value:"",type:"string"},hidden:{value:!1,type:"boolean"},readonly:{value:!1,type:"boolean"}}}get hasStyleObserver(){return!1}get enableShadowDOM(){return!1}get _focused(){const e=this;return void 0===e.__focused&&(e.__focused=!1),e.__focused}set _focused(e){const t=this;t.__focused=e,e?t.setAttribute("focus",""):t.removeAttribute("focus")}template(){return`<div id="container">
                   <span id='itemInput' class ='smart-input smart-hidden'></span>
                    <span class ="smart-overlay" id="overlay"></span>
                    <div id="itemContainer" class ="smart-content smart-list-item-container"><span class="smart-content-label" inner-h-t-m-l=\'[[innerHTML]]\'><content></content></span><span inner-h-t-m-l=\'[[details]]\' id="details" class="smart-content-details"></span></div>
                </div>`}appendChild(e){const t=this;if(!t.isCompleted||e.classList.contains("smart-ripple")){const e=Array.prototype.slice.call(arguments,2);return HTMLElement.prototype.appendChild.apply(t,e.concat(Array.prototype.slice.call(arguments)))}t.$.itemContainer.innerHTML="",e instanceof HTMLElement&&t.$.itemContainer.appendChild(e)}insertBefore(e,t){const i=this;if(!i.isCompleted){const e=Array.prototype.slice.call(arguments,2);return HTMLElement.prototype.insertBefore.apply(i,e.concat(Array.prototype.slice.call(arguments)))}t.parentNode.insertBefore(e,t)}removeChild(e){const t=this;if(!t.isCompleted||e.classList.contains("smart-ripple")){const e=Array.prototype.slice.call(arguments,2);return HTMLElement.prototype.removeChild.apply(t,e.concat(Array.prototype.slice.call(arguments)))}e instanceof HTMLElement&&t.$.itemContainer.removeChild(e)}attached(){const e=this;super.attached(),e.ownerListBox=e.getListBox()}static get listeners(){return{mouseenter:"_itemOnMouseEnter",mouseleave:"_itemOnMouseLeave"}}ready(){super.ready();const e=this;""===e.label?""!==e.innerHTML&&(e.label=e.innerHTML):e.innerHTML=e.label,e._setDisplayMode(e.displayMode),e.$.container.noRipple=!0}propertyChangedHandler(e,t,i){const l=this;if(super.propertyChangedHandler(e,t,i),"hidden"===e&&(i?l.$.addClass("smart-hidden"):l.$.removeClass("smart-hidden")),"displayMode"===e&&l._setDisplayMode(i),"label"===e){const e=l.context;l.context=document,l.innerHTML=i;const t=l.getListBox();t.onItemUpdated(l),l.context=e}if("details"===e){const e=l.context;l.context=document,l.$.details.innerHTML=i;const t=l.getListBox();t.onItemUpdated(l),l.context=e}if("innerHTML"===e){const e=l.getListBox();e.onItemUpdated(l)}}getListBox(){const e=this;let t=e.parentNode;for(;!1==t instanceof Smart.ListBox&&null!==t;)t=t.parentNode;return!t&&Smart.EnableShadowDOM?e.getRootNode().host:t}_itemOnMouseEnter(){const e=this;!e.disabled&&e.ownerListBox&&(Smart.ListBox.DragDrop.Dragging&&e.ownerListBox.allowDrop&&(Smart.ListBox.DragDrop.DropDetails={item:e,position:"bottom"}),e.ownerListBox.$.verticalScrollBar.thumbCapture||e.ownerListBox.$.horizontalScrollBar.thumbCapture||e.setAttribute("hover",""))}_itemOnMouseMove(e){const t=this;if(t.ownerListBox&&Smart.ListBox.DragDrop.Dragging&&t.ownerListBox.allowDrop&&!Smart.Utilities.Core.isMobile){const l=[].slice.call(t.ownerListBox.getElementsByClassName("smart-list-item-bottom-line-feedback"));for(let e=0;e<l.length;e++)l[e].$.removeClass("smart-list-item-line-feedback"),l[e].$.removeClass("smart-list-item-bottom-line-feedback");if(Smart.ListBox.DragDrop.DropDetails={item:t,position:"top"},!t.ownerListBox._areCSSVarsSupported){if(t.ownerListBox._indexOf(t)===t.ownerListBox._items.length-1||t.parentNode.lastElementChild===t){const i=t.getBoundingClientRect();e.pageY-window.pageYOffset>i.top+i.height/2-1&&(Smart.ListBox.DragDrop.DropDetails={item:t,position:"bottom"})}return}if(t.$.removeClass("smart-list-item-line-feedback"),t.$.removeClass("smart-list-item-bottom-line-feedback"),t.ownerListBox.sorted&&t.ownerListBox.autoSort)return;const i=t.ownerListBox._items.filter(e=>!e.hidden);if(i.indexOf(t)===i.length-1||t.parentNode.lastElementChild===t){const i=t.getBoundingClientRect();e.pageY-window.pageYOffset>i.top+i.height/2-1?(t.$.addClass("smart-list-item-bottom-line-feedback"),Smart.ListBox.DragDrop.DropDetails={item:t,position:"bottom"}):!arguments[1]&&t.$.addClass("smart-list-item-line-feedback")}else arguments[1]||t.$.addClass("smart-list-item-line-feedback")}}_itemOnMouseLeave(){const e=this;e.ownerListBox&&(Smart.ListBox.DragDrop.Dragging&&(e.$.removeClass("smart-list-item-line-feedback"),e.$.removeClass("smart-list-item-bottom-line-feedback")),e.removeAttribute("hover"))}_setDisplayMode(e){const t=this,i=t.getListBox();if(i){const l="checkBox"===i.selectionMode||"radioButton"===i.selectionMode?i.selectionMode:"plain";t.displayMode=e=l}return"plain"===e?void t.$itemInput.addClass("smart-hidden"):void t.$itemInput.removeClass("smart-hidden")}}),Smart("smart-list-items-group",class extends Smart.ContentElement{static get properties(){return{label:{value:"",type:"string"}}}get enableShadowDOM(){return!1}template(){return`<div id="container">
                 <span id="itemsLabel" class ="smart-list-items-group-label">[[label]]</span>
                 <div id="listItemsGroupContainer" inner-h-t-m-l=\'[[innerHTML]]\' class ="smart-list-items-group-container">
                    <content></content>
                 </div>
               </div>`}appendChild(e){const t=this;if(!t.isCompleted){const e=Array.prototype.slice.call(arguments,2);return HTMLElement.prototype.appendChild.apply(t,e.concat(Array.prototype.slice.call(arguments)))}e instanceof HTMLElement&&t.$.listItemsGroupContainer.appendChild(e)}removeChild(e){const t=this;if(!t.isCompleted){const e=Array.prototype.slice.call(arguments,2);return HTMLElement.prototype.removeChild.apply(t,e.concat(Array.prototype.slice.call(arguments)))}e instanceof HTMLElement&&t.$.listItemsGroupContainer.removeChild(e)}getListBox(){const e=this;let t=e.parentNode;for(;!1==t instanceof Smart.ListBox&&null!==t;)t=t.parentNode;return t}attached(){const e=this;super.attached(),e.ownerListBox||(e.ownerListBox=e.getListBox())}}),Smart("smart-list-box",class extends Smart.ScrollViewer{static get properties(){return{allowDrag:{value:!1,type:"boolean"},allowDrop:{value:!1,type:"boolean"},alternationStart:{value:0,type:"int"},alternationEnd:{value:0,type:"int"},alternationCount:{value:0,type:"int"},autoSort:{value:!0,type:"boolean"},dataSource:{value:null,type:"any?",reflectToAttribute:!1},dragFeedbackFormatFunction:{value:null,type:"function?"},dragOffset:{value:[10,10],type:"array"},displayLoadingIndicator:{value:!1,type:"boolean"},displayMember:{value:"",type:"string"},shadowDomMode:{allowedValues:["light","shadow"],value:"shadow",type:"string"},dropAction:{value:"move",type:"string",allowedValues:["copy","move","none"]},editable:{value:!1,type:"boolean"},filterable:{value:!1,type:"boolean"},filterCallback:{value:null,type:"function?"},filterMode:{value:"containsIgnoreCase",allowedValues:["contains","containsIgnoreCase","doesNotContain","doesNotContainIgnoreCase","equals","equalsIgnoreCase","startsWith","startsWithIgnoreCase","endsWith","endsWithIgnoreCase","custom"],type:"string"},filterInputPlaceholder:{value:"",type:"string"},grouped:{value:!1,type:"boolean"},groupMember:{value:"",type:"string"},itemTemplate:{value:null,type:"any"},itemHeight:{value:null,type:"number?"},incrementalSearchDelay:{value:700,type:"number?"},incrementalSearchMode:{value:"startsWithIgnoreCase",allowedValues:["contains","containsIgnoreCase","doesNotContain","doesNotContainIgnoreCase","equals","equalsIgnoreCase","startsWith","startsWithIgnoreCase","endsWith","endsWithIgnoreCase"],type:"string"},loadingIndicatorPlaceholder:{value:"Loading...",type:"string"},loadingIndicatorPosition:{value:"center",allowedValues:["bottom","center","top"],type:"string"},messages:{extend:!0,value:{en:{overridingProperties:"{{elementType}}: Overriding properties {{property1}} and {{property2}} applied. The \"{{property1}}\" property is used by default.",invalidIndex:"{{elementType}}: \"{{method}}\" method accepts an index of type number or an Array of numbers.",indexOutOfBound:"{{elementType}}: Out of bound index/indexes in \"{{method}}\" method.",invalidItem:"{{elementType}}: \"{{method}}\" method accepts an object or an array of objects as it's second parameter.",invalidSettings:"{{elementType}}: \"{{method}}\" method accepts a string or an object as it's second parameter."}},type:"object"},name:{value:"",type:"string"},placeholder:{value:"No Items",type:"string"},selectedIndexes:{value:[],type:"array"},selectedValues:{value:[],type:"array"},selectionMode:{value:"oneOrManyExtended",allowedValues:["none","oneOrManyExtended","zeroOrMany","oneOrMany","zeroOrOne","one","checkBox","radioButton"],type:"string"},selectionChangeAction:{value:"release",allowedValues:["press","release"],type:"string"},sorted:{value:!1,type:"boolean"},sortDirection:{value:"asc",type:"string"},topVisibleIndex:{value:-1,type:"int"},type:{value:"list",type:"string",defaultReflectToAttribute:!0,readonly:!0},valueMember:{value:"",type:"string"},virtualized:{value:!1,type:"boolean"}}}static get requires(){return{"Smart.ScrollBar":"smart.scrollbar.js"}}static get styleUrls(){return["smart.listbox.css"]}static get listeners(){return{focus:"_focusHandler",blur:"_blurHandler","container.wheel":"_mouseWheelHandler","editInput.change":"_editInputEventHandler","editInput.blur":"_editInputEventHandler","editInput.keydown":"_editInputEventHandler","horizontalScrollBar.change":"_horizontalScrollbarHandler","itemsInnerContainer.down":"_downHandler","itemsInnerContainer.dblclick":"_dblclickEventHandler","itemsInnerContainer.move":"_itemsContainerMoveHandler","itemsContainer.mouseleave":"_mouseLeaveHandler","document.up":"_upHandler","document.move":"_moveHandler",keydown:"_keyDownHandler",keyup:"_keyUpHandler",resize:"_resizeHandler",selectstart:"_selectStartHandler",styleChanged:"_styleChangedHandler",swipeleft:"_swipeLeftHandler",swiperight:"_swipeRightHandler","verticalScrollBar.change":"_verticalScrollbarHandler"}}template(){return`<div id="container" class="smart-container">
                 <div class="smart-list-box-filter-input-container smart-hidden" id="filterInputContainer">
                     <input id="filterInput" disabled="[[disabled]]" placeholder='[[filterInputPlaceholder]]'>
                 </div>
                 <div id="itemsContainer" class="smart-list-items-container">
                      <div id="placeholder" class ="smart-placeholder">[[placeholder]]</div>
                      <div id="itemsInnerContainer" inner-h-t-m-l=\'[[innerHTML]]\' class ="smart-list-items-inner-container">
                          <content></content>
                      </div>
                      <input type="text" id="editInput" class= "smart-hidden"/>
                 </div>
                 <smart-scroll-bar wait id="verticalScrollBar" disabled="[[disabled]]" orientation="vertical"></smart-scroll-bar>
                 <smart-scroll-bar wait id="horizontalScrollBar" disabled="[[disabled]]" ></smart-scroll-bar>
                 <div id="loadingIndicatorContainer" class ="smart-loader-container">
                    <span id="loadingIndicator" class="smart-loader"></span>
                    <span id="loadingIndicatorPlaceHolder" class ="smart-loader-label smart-hidden">[[loadingIndicatorPlaceholder]]</span>
                 </div>
                <input id="hiddenInput" type="hidden" name="[[name]]">
                </div>`}_mouseLeaveHandler(){const e=this,t=[].slice.call(e.getElementsByClassName("smart-list-item-bottom-line-feedback"));for(let e=0;e<t.length;e++)t[e].$.removeClass("smart-list-item-line-feedback"),t[e].$.removeClass("smart-list-item-bottom-line-feedback")}_downHandler(e){const t=this;if(t.disabled||t.displayLoadingIndicator||t.readonly)return;let i=e.originalEvent.target,l=null;if(i instanceof Smart.ListItem&&!i.disabled&&!i.hidden&&!(i instanceof Smart.ListItemsGroup))l=i.dataItem;else for(;i.parentElement;){if(i instanceof Smart.ListItem&&!i.disabled&&!i.hidden&&!(i instanceof Smart.ListItemsGroup)){l=i.dataItem;break}i=i.parentElement}Smart.ListBox.DragDrop.StartTime=new Date,Smart.ListBox.DragDrop.StartPosition={left:e.pageX,top:e.pageY};l&&(e.stopPropagation(),t.hasRippleAnimation&&!l.readonly&&!l.disabled&&Smart.Utilities.Animation.Ripple.animate(i.$.overlay,e.pageX,e.pageY),!Smart.Utilities.Core.isMobile&&"press"===t.selectionChangeAction&&(t._focus(l),t.select(l)),!Smart.ListBox.DragDrop.Feedback&&t.allowDrag&&(Smart.ListBox.DragDrop.Feedback=document.createElement("span"),t.dragFeedbackFormatFunction?Smart.ListBox.DragDrop.Feedback.innerHTML=t.dragFeedbackFormatFunction(l):Smart.ListBox.DragDrop.Feedback.appendChild(l.offsetHeight?l.cloneNode(!0):t._createItem(l)),Smart.ListBox.DragDrop.Item=l,Smart.Utilities.Extend(Smart.ListBox.DragDrop.Feedback).addClass("smart-popup smart-list-item smart-list-item-feedback")))}_dblclickEventHandler(e){const t=this;if(t.editable){const i=e.target.closest("smart-list-item");return!(i instanceof Smart.ListItem)||i.disabled||i.readonly?void t.$editInput.addClass("smart-hidden"):void(t.$.editInput.owner=i,t.$.editInput.value=i.label,t.$.editInput.style.height=i.offsetHeight+"px",t.$.editInput.style.top=i.offsetTop+"px",t.$editInput.hasClass("smart-hidden")&&t.$editInput.removeClass("smart-hidden"),t.$.editInput.focus())}}_editInputEventHandler(e){const t=this;if("blur"===e.type||"keydown"===e.type&&"Escape"===e.key)return t.$editInput.hasClass("smart-hidden")?void 0:t.$editInput.addClass("smart-hidden"),void t.focus();if(!("keydown"===e.type||t.$editInput.hasClass("smart-hidden"))){const i=e.target;if(e.stopPropagation(),i.owner.label!==i.value&&(i.owner.label=i.value,t.itemTemplate&&t._applyTemplate(i.owner),t.dataSource)){const e=i.owner.dataIndex,l=t.dataSource[e];l&&(t.displayMember?l[t.displayMember]=i.value:l.label=i.value)}t.$editInput.addClass("smart-hidden"),t.$.fireEvent("itemLabelChange",{selected:i.owner.selected,disabled:i.owner.disabled,index:t._indexOf(i.owner),label:i.owner.label,value:i.owner.value})}}_pointerUpHandler(e){const t=this;let i=e.originalEvent,l=i.target;const o=i=>{const o=i.ownerListBox;o.disabled||o!==t||o.displayLoadingIndicator||"none"===o.selectionMode||i.grouped||i.readonly||(o._focus(i),o.select(i),e.preventDefault(),Smart.ListBox.DragDrop.StartPosition=null,t.$.fireEvent("itemClick",{selected:l.selected,disabled:l.disabled,index:t._indexOf(l),label:l.label,value:l.value}))};if(i.target instanceof Smart.ListItem&&!i.target.disabled&&!(i.target instanceof Smart.ListItemsGroup))return void o(l.dataItem);for(;l.parentElement;){if(l instanceof Smart.ListItem&&!l.disabled&&!(l instanceof Smart.ListItemsGroup)){o(l.dataItem);break}l=l.parentElement}if(this.enableShadowDOM&&"shadow"===this.shadowDomMode){const e=i.composedPath();for(let t=0;t<e.length;t++){const i=e[t];i instanceof Smart.ListItem&&!i.disabled&&o(i.dataItem)}}}_upHandler(e){var t=Math.abs;const i=this;if(!(i.disabled||i.readonly||!Smart.ListBox.DragDrop.StartPosition)){if(Smart.Utilities.Core.isMobile&&!Smart.ListBox.DragDrop.Dragging){const l=t(e.pageX-Smart.ListBox.DragDrop.StartPosition.left),o=t(e.pageY-Smart.ListBox.DragDrop.StartPosition.top);let s=0<=l&&3>=l&&0<=o&&3>=o;if(Smart.Utilities.Core.isMobile&&300<=new Date-Smart.ListBox.DragDrop.StartTime&&(s=!1,Smart.ListBox.DragDrop.StartTime=null),s){const t=e.originalEvent.target.closest("smart-list-box");t?t._pointerUpHandler(e):i._pointerUpHandler(e),Smart.ListBox.DragDrop.StartPosition=null}else{let t=e.originalEvent.target;if(e.target instanceof Smart.ListItem&&!t.readonly&&!e.target.disabled&&!(e.target instanceof Smart.ListItemsGroup))e.preventDefault(),e.stopPropagation();else for(;t.parentElement;){if(t instanceof Smart.ListItem&&!t.readonly&&!t.disabled&&!(t instanceof Smart.ListItemsGroup)){e.preventDefault(),e.stopPropagation();break}t=t.parentElement}}}else if(!Smart.Utilities.Core.isMobile&&!Smart.ListBox.DragDrop.Dragging&&"release"===i.selectionChangeAction){const t=e.originalEvent.target.closest("smart-list-box");t?t._pointerUpHandler(e):i._pointerUpHandler(e)}if(Smart.ListBox.DragDrop.Feedback){Smart.ListBox.DragDrop.Feedback.parentNode&&Smart.ListBox.DragDrop.Feedback.parentNode.removeChild(Smart.ListBox.DragDrop.Feedback),Smart.ListBox.DragDrop.Feedback=null;let t;if(Smart.Utilities.Core.isMobile&&Smart.ListBox.DragDrop.Dragging)for(let i=0;i<Smart.ListBox.DragDrop.ListBoxes.length;i++){const l=Smart.ListBox.DragDrop.ListBoxes[i],o=l.getBoundingClientRect();if(l.allowDrop&&!l.closest(".smart-visibility-hidden")&&o.left<=e.pageX&&e.pageX<=o.left+o.width&&o.top<=e.pageY&&e.pageY<=o.top+o.height){t=l;const s=l._items.filter(e=>!e.hidden);for(let t=0;t<s.length;t++){const i=s[t],n=i.getBoundingClientRect();if((s.indexOf(i)===s.length-1||i.parentNode.lastElementChild===i)&&e.pageY>=o.top+i.offsetTop-l.scrollTop+n.height/2&&e.pageY<=o.top-l.scrollTop+i.offsetTop+n.height){Smart.ListBox.DragDrop.DropDetails={item:i,position:"bottom"};break}if(e.pageY>=o.top+i.offsetTop-l.scrollTop&&e.pageY<=o.top+i.offsetTop+n.height-l.scrollTop){Smart.ListBox.DragDrop.DropDetails={item:i,position:"top"};break}}}}if(Smart.ListBox.DragDrop.Dragging){if(Smart.ListBox.DragDrop.DropDetails){let i=Smart.ListBox.DragDrop.DropDetails.item,l=Smart.ListBox.DragDrop.Item;const o=l.ownerListBox;if(t=!t&&e.originalEvent.target.closest?e.originalEvent.target.closest("smart-list-box"):t,document.body.classList.remove("smart-dragging"),i.$.removeClass("smart-list-item-line-feedback"),i.$.removeClass("smart-list-item-bottom-line-feedback"),t&&i.ownerListBox!==t&&0<t.items.length&&(i=t.items[t.items.length-1]),!(Smart.ListBox.DragDrop.Item!==i&&(t===i.ownerListBox||Smart.Utilities.Core.isMobile)))t&&0===t._items.length&&"none"!==t.dropAction&&("move"===t.dropAction?Smart.ListBox.DragDrop.Item.ownerListBox.removeChild(Smart.ListBox.DragDrop.Item):"copy"===t.dropAction&&(l=l.cloneNode(!0)),t.appendChild(l));else if("none"!==l.ownerListBox.dropAction){i.ownerListBox!==l.ownerListBox&&"move"===l.ownerListBox.dropAction&&Smart.ListBox.DragDrop.Item.ownerListBox.removeChild(Smart.ListBox.DragDrop.Item),"copy"===l.ownerListBox.dropAction&&(l=l.cloneNode(!0)),Smart.ListBox.DragDrop.Item.group=i.group;const e=i.ownerListBox;"checkBox"!==e.selectionMode&&"radioButton"!==e.selectionMode&&e.clearSelection(),"top"===Smart.ListBox.DragDrop.DropDetails.position?e.insertBefore(l,i):i.parentNode.lastElementChild===i?e.appendChild(l):e.appendChild(l,i),e.ensureVisible(l),"checkBox"===e.selectionMode||"radioButton"===e.selectionMode?(e._focus(l),e._refreshSelection()):(e.clearSelection(),e.select(l))}l.selected&&t!==o&&o._refreshSelection();const s=Smart.ListBox.DragDrop.Item,n=s.ownerListBox;s.displayMode="checkBox"===n.selectionMode||"radioButton"===n.selectionMode?n.selectionMode:"plain",n.$.fireEvent("dragEnd",{item:s,target:i,data:Smart.ListBox.DragDrop,previousContainer:o,container:t,originalEvent:e}),n._focus(s)}else{const t=Smart.ListBox.DragDrop.Item,i=t.ownerListBox;t.displayMode="checkBox"===i.selectionMode||"radioButton"===i.selectionMode?i.selectionMode:"plain",i.$.fireEvent("dragEnd",{item:t,target:null,data:Smart.ListBox.DragDrop,previousContainer:i,container:i,originalEvent:e}),i._focus(t)}e.preventDefault()}Smart.ListBox.DragDrop.Dragging=!1,Smart.ListBox.DragDrop.Item=null,Smart.ListBox.DragDrop.DropDetails=null}for(let e=0;e<Smart.ListBox.DragDrop.ListBoxes.length;e++){const t=Smart.ListBox.DragDrop.ListBoxes[e];t._dragInterval&&clearInterval(t._dragInterval)}}}_itemsContainerMoveHandler(e){const t=this;if(Smart.ListBox.DragDrop.Dragging)return t._applyItemFeedback(e),t._moveHandler(e),e.originalEvent.preventDefault(),e.originalEvent.stopPropagation(),!1}_applyItemFeedback(e){const t=this,i=e.originalEvent.target,l=i.closest?i.closest("smart-list-item"):i;return Smart.Utilities.Core.isMobile?void(Smart.ListBox.DragDrop.DropDetails={item:Smart.ListBox.DragDrop.Item,position:"bottom"}):0===t.items.length?void 0:l?void l._itemOnMouseMove(e):void t.items[t.items.length-1]._itemOnMouseMove(e,!0)}_moveHandler(e){var t=Math.abs;const i=this;if(Smart.ListBox.DragDrop.Feedback){const l=i.dragOffset;if(!Smart.ListBox.DragDrop.Dragging){const i=t(e.pageX-Smart.ListBox.DragDrop.StartPosition.left),o=t(e.pageY-Smart.ListBox.DragDrop.StartPosition.top),s=new Date-Smart.ListBox.DragDrop.StartTime;let n=5<=i&&15>=i||5<=o&&15>=o;if(Smart.Utilities.Core.isMobile&&(300>s||1e3<s)&&(n=!1),n){Smart.ListBox.DragDrop.Dragging=!0,Smart.ListBox.DragDrop.Feedback.style.left=l[0]+e.pageX+"px",Smart.ListBox.DragDrop.Feedback.style.top=l[1]+e.pageY+"px",document.body.appendChild(Smart.ListBox.DragDrop.Feedback),e.preventDefault(),e.stopPropagation(),e.originalEvent.preventDefault(),e.originalEvent.stopPropagation();const t=Smart.ListBox.DragDrop.Item,i=t.ownerListBox;i.$.fireEvent("dragStart",{item:t,data:Smart.ListBox.DragDrop,container:i,previousContainer:i,originalEvent:e.originalEvent}),document.body.classList.add("smart-dragging")}}else{Smart.ListBox.DragDrop.Feedback.style.left=l[0]+e.pageX+"px",Smart.ListBox.DragDrop.Feedback.style.top=l[1]+e.pageY+"px",i.$.fireEvent("dragging",{item:Smart.ListBox.DragDrop.Item,data:Smart.ListBox.DragDrop,originalEvent:e.originalEvent});for(let t=0;t<Smart.ListBox.DragDrop.ListBoxes.length;t++){const i=Smart.ListBox.DragDrop.ListBoxes[t];i._dragInterval&&clearInterval(i._dragInterval),i._dragInterval=setInterval(function(){const t=i.getBoundingClientRect();t.left<=e.clientX&&t.left+t.width>=e.clientX&&(e.clientY>=t.top&&e.clientY<=t.top+20?i.scrollTop-=2:e.clientY>=t.top+t.height-20&&e.clientY<=t.top+t.height&&(i.scrollTop+=2))},1)}return e.preventDefault(),e.stopPropagation(),e.originalEvent.preventDefault(),e.originalEvent.stopPropagation(),!1}}}_focusHandler(){const e=this;e._focused=!0,e.setAttribute("focus","")}_blurHandler(){const e=this;e._focused=!1,e.removeAttribute("focus")}appendChild(e){const t=this;if(!t.isCompleted){const e=Array.prototype.slice.call(arguments,2);return HTMLElement.prototype.appendChild.apply(t,e.concat(Array.prototype.slice.call(arguments)))}t.isVirtualized?(-1<t._items.indexOf(e)&&t._items.splice(t._items.indexOf(e),1),t._items.push(e)):(e.dataItem=e,t.enableShadowDOM&&"light"===t.shadowDomMode?t.appendChild(e):t.$.itemsInnerContainer.appendChild(e),-1<t._items.indexOf(e)&&t._items.splice(t._items.indexOf(e),1),t._items.push(e)),t._refreshItems(),t._refreshSelection()}insertBefore(e,t){const i=this;if(!i.isCompleted){const e=Array.prototype.slice.call(arguments,2);return HTMLElement.prototype.insertBefore.apply(i,e.concat(Array.prototype.slice.call(arguments)))}i.isVirtualized?(-1<i._items.indexOf(e)&&i._items.splice(i._items.indexOf(e),1),i._items.splice(i._indexOf(t),0,e)):(e.dataItem=e,t.parentNode.insertBefore(e,t),-1<i._items.indexOf(e)&&i._items.splice(i._items.indexOf(e),1),i._items.splice(i._indexOf(t),0,e)),i._refreshItems(),i._refreshSelection()}removeChild(e){const t=this;if(!t.isCompleted){const e=Array.prototype.slice.call(arguments,2);return HTMLElement.prototype.removeChild.apply(t,e.concat(Array.prototype.slice.call(arguments)))}if(t.isVirtualized)t._items.splice(t._indexOf(e),1);else if(e.parentNode){const i=t.selectedIndexes.slice(0),l=t.selectedValues.slice(0),o=i.indexOf(e.dataIndex);e.parentNode.removeChild(e),-1<o&&(i.splice(o,1),l.splice(o,1),t.selectedIndexes=i,t.selectedValues=l)}t._refreshItems()}propertyChangedHandler(e,t,l){super.propertyChangedHandler(e,t,l);const o=this;switch(e){case"innerHTML":o.clearSelection(),o._dataBind(),o.innerHTML=o.content=Smart.Utilities.Core.html(o.$.content);break;case"dataSource":case"valueMember":case"groupMember":case"displayMember":{o.clearSelection(),o._dataBind();break}case"disabled":case"unfocusable":o._setFocusable();break;case"displayLoadingIndicator":{o._setLoadingIndicatorVisibility();break}case"filterable":{o._refreshFilter(),o._refreshLayout();break}case"grouped":{if(l?o._group():o._ungroup(),!("radioButton"===o.selectionMode))o._refreshSelection();else if(0<o.selectedValues.length){const e=o.selectedValues;o.clearSelection(),o.select(e[0])}o._refreshLayout();break}case"itemTemplate":{if(null===l||""===l)return o._items.map(e=>e.innerHTML=e.label),delete o._bindingDetails,void o._refreshLayout();const e=o.querySelectorAll("smart-list-item"),t=function(){o._handleItemTemplate(l)&&(o._items.map(e=>o._applyTemplate(e)),o._refreshLayout()),o.ownerElement&&o.ownerElement._setDropDownSize&&o.ownerElement._setDropDownSize(),o.$.fireEvent("bindingComplete")};0===e.length?t():o._ensureItemsReady(e,t);break}case"selectedIndexes":case"selectedValues":{let s=o.selectedIndexes.slice(0),i=o.selectedValues.slice(0);if(!o._items||0===o._items.length)return o.selectedIndexes=[],o.selectedValues=[],void(o.$.hiddenInput.value=o.selectedValues.toString());if(o._propertyChanging=!0,"selectedIndexes"===e){s=t.slice(0),o.clearSelection();for(let e=0;e<l.length;e++){const t=l[e],i=o._items[t];i&&("oneOrManyExtended"===o.selectionMode||"oneOrMany"===o.selectionMode?(0<o.selectedIndexes.length&&0==e&&o.clearSelection(),o._select(i)):o.select(i))}}else{i=t.slice(0),o.selectedValues=[],o.clearSelection();for(let e=0;e<l.length;e++){const t=l[e],i=o.getItem(t);i&&("oneOrManyExtended"===o.selectionMode?o._select(i):o.select(i))}}if(0<o.selectedIndexes.length&&o._focus(o._items[o.selectedIndexes[0]]),o._propertyChanging=!1,JSON.stringify(i)!==JSON.stringify(o.selectedValues.slice(0))){let e=[],t=[];for(let e=0;e<s.length;e++)0>o.selectedIndexes.indexOf(s[e])&&t.push(o._items[s[e]]);for(let t=0;t<o.selectedIndexes.length;t++)0>s.indexOf(o.selectedIndexes[t])&&e.push(o._items[o.selectedIndexes[t]]);let i={addedItems:e,removedItems:t};if(0<o.selectedIndexes.length){const e=o._items[o.selectedIndexes[o.selectedIndexes.length-1]];e!==void 0&&(i.selected=e.selected,i.disabled=e.disabled,i.index=o._indexOf(e),i.label=e.label,i.value=e.value)}else i.selected=!1,i.disabled=!1,i.index=-1,i.label="",i.value="";o.$.fireEvent("change",i)}break}case"selectionMode":{const e="checkBox"===o.selectionMode||"radioButton"===o.selectionMode?o.selectionMode:"plain",t=o.selectedIndexes.slice(0),i=o.selectedValues.slice(0);o._propertyChanging=!0;const l=o.selectedValues;o.selectedValues=[],o.clearSelection();for(let e=0;e<l.length;e++){const t=l[e],i=o.getItem(t);i&&("oneOrManyExtended"===o.selectionMode?o._select(i):o.select(i))}if(o._items.forEach(t=>t.displayMode=e),o._recycle(),o._propertyChanging=!1,JSON.stringify(i)!==JSON.stringify(o.selectedValues.slice(0))){let e=[],l=[];for(let e=0;e<t.length;e++)0>o.selectedIndexes.indexOf(t[e])&&l.push(o._items[t[e]]);for(let l=0;l<o.selectedIndexes.length;l++)0>t.indexOf(o.selectedIndexes[l])&&e.push(o._items[o.selectedIndexes[l]]);let i={addedItems:e,removedItems:l};if(0<t.length){const e=o._items[t[t.length-1]];e&&(i.selected=e.selected,i.disabled=e.disabled,i.index=o._indexOf(e),i.label=e.label,i.value=e.value)}o.$.fireEvent("change",i)}break}case"topVisibleIndex":o._setTopVisibleIndex(l);break;case"autoSort":o._canSort=l;break;case"sortDirection":case"sorted":{o._canSort=!0,l?o._sort():o._unsort();const e=o.selectedValues;o.selectedValues=[],o._refreshSelection();for(let t=0;t<e.length;t++){const i=e[t],l=o.getItem(i);l&&("oneOrManyExtended"===o.selectionMode?o._select(l):o.select(l))}o._refreshLayout(),o._canSort=o.autoSort;break}}}_refreshSelection(){const e=this;if(e._items&&0!==e._items.length){const t=e.selectedValues;e.selectedIndexes=[],e.selectedValues=[];for(let l=0;l<e._items.length;l++){const i=e._items[l];i.selected=!1,-1<t.indexOf(i.value)&&e.select(i)}e._recycle()}}clearSelection(){const e=this;if(!e._items||0===e._items.length)return;let t=[];for(let l=0;l<e._items.length;l++)e._items[l].selected&&t.push(e._items[l]);e._items.map(e=>e.selected=!1);const i=e.selectedValues.slice(0),l=e.selectedIndexes.slice(0);if(e.selectedIndexes=[],e.selectedValues=[],e.$.hiddenInput.value=e.selectedValues.toString(),e._recycle(),e.context!==e){let i={addedItems:[],removedItems:t};if(0<l.length){const t=e._items[l[l.length-1]];t&&(i.selected=t.selected,i.disabled=t.disabled,i.index=e._indexOf(t),i.label=t.label,i.value=t.value)}e.$.fireEvent("change",i)}}ensureVisible(e){const t=this;if(e)return!("string"==typeof e&&(e=t.getItem(e),!e))&&(t.isVirtualized||t.$.itemsContainer.scrollTop===t.scrollTop||(t.scrollTop=t.$.itemsContainer.scrollTop),e.top+e.height>=t.scrollTop+t.offsetHeight&&(t.scrollTop+=e.height,!t.isVirtualized&&(t.$.itemsContainer.scrollTop=t.scrollTop)),(e.top<=t.scrollTop||e.top>=t.scrollTop+t.$.itemsContainer.offsetHeight)&&(t.scrollTop=e.top,!t.isVirtualized&&(t.$.itemsContainer.scrollTop=t.scrollTop)),0===t._indexOf(e)||1===t._indexOf(e)&&1<t._items.length&&t._items[0].grouped?(t.scrollTop=0,!t.isVirtualized&&(t.$.itemsContainer.scrollTop=t.scrollTop)):t._indexOf(e)===t._items.length-1&&(t.scrollTop=t.scrollHeight,!t.isVirtualized&&(t.$.itemsContainer.scrollTop=t.scrollTop)),!0)}get items(){const e=this;return e._filteredItems?e._filteredItems:e._items}ready(){super.ready();const e=this;if(e.enableShadowDOM&&"light"===e.shadowDomMode){const t=document.createDocumentFragment();[].slice.call(e.$.itemsInnerContainer.children).map(e=>t.appendChild(e)),e.appendChild(t),e.$.itemsInnerContainer.appendChild(document.createElement("slot"))}e._areCSSVarsSupported=Smart.Utilities.Core.CSSVariablesSupport(),e._keysPressed={},e._incrementalSearchQuery="",e._incrementalSearchItems=[],e._canSort=!0,e._previousEntry="",e.isUpdating=0,e._scrollView&&(e._scrollView=new Smart.Utilities.Scroll(e,e.$.horizontalScrollBar,e.$.verticalScrollBar),e._scrollView.hScrollBar.$.addClass("smart-hidden"),e._scrollView.vScrollBar.$.addClass("smart-hidden"));const t=e._scrollView.vScrollBar,i=e._scrollView.hScrollBar;t.hasStyleObserver=!1,i.hasStyleObserver=!1,t.hasResizeObserver=!1,i.hasResizeObserver=!1,t.wait=!1,i.wait=!1,e._setFocusable(),e._setLoadingIndicatorVisibility(),e._refreshFilter(),e._initializeInnerHTML(),e._dataBind()}attached(){const e=this;super.attached(),Smart.ListBox.DragDrop||(Smart.ListBox.DragDrop={ListBoxes:[]}),Smart.ListBox.DragDrop.ListBoxes.push(e),e._scrollView||(e._scrollView=new Smart.Utilities.Scroll(e,e.$.horizontalScrollBar,e.$.verticalScrollBar)),0<e.selectedIndexes.length&&e.ensureVisible(e._items[e.selectedIndexes[0]])}detached(){const e=this;if(super.detached(),e._scrollView&&(e._scrollView.unlisten(),delete e._scrollView),Smart.ListBox.DragDrop&&Smart.ListBox.DragDrop.ListBoxes){const t=Smart.ListBox.DragDrop.ListBoxes.indexOf(e);Smart.ListBox.DragDrop.ListBoxes.splice(t,1)}}_createItem(e,t,i){const l=this,o="checkBox"===l.selectionMode||"radioButton"===l.selectionMode?l.selectionMode:"plain",s=i?{}:document.createElement("smart-list-item");s.ownerListBox=l,"number"==typeof e&&(e=""+e);const n=function(t,i){return void 0===e[t]?e[i]:""+e[t]};let r="string"==typeof e?e:n(l.displayMember,"label"),a="string"==typeof e?e:n(l.valueMember,"value"),d=n(l.groupMember,"group");return void 0===r&&(void 0===t?r="":r=""+t),s.label=s.innerHTML=""+r,void 0===a&&(void 0===t?a=r:a=""+t),s.value=""+a,s.displayMode=o,s.selected=!!e.selected&&e.selected,s.disabled=!!e.disabled&&e.disabled,s.dataItem=s,void 0!==t&&(s.dataIndex=t),l._alternateItem(s),e.title&&(s.title=e.title),d&&(s.group=""+d),s}_alternateItem(e){const t=this,i=t.alternationStart,l=0<t.alternationEnd?t.alternationEnd:1/0;0>=t.alternationCount||(t._alternationIndexCounter===void 0&&(t._alternationIndexCounter=0),e.dataIndex>=i&&e.dataIndex<=l&&(e.alternationIndex=t._alternationIndexCounter++,t._alternationIndexCounter===t.alternationCount&&(t._alternationIndexCounter=0)))}_beginUpdate(){const e=this;e.isUpdating++}_isUpdating(){const e=this;return 0<e.isUpdating}_endUpdate(){const e=this;e.isUpdating--}get _scrollHeight(){const e=this;let t=0;if(e.isVirtualized){if(e.__scrollHeight)return e.__scrollHeight;if(0===e._items.length)return 0;e.isUpdating++;const l=e._createItem(e.dataSource[0]);e.$.itemsInnerContainer.appendChild(l);for(let o=0;o<e._items.length;o++){const i=e._items[o];if(i.hidden){i.height=0,i.top=t;continue}e.itemHeight?(32>e.itemHeight&&(e.itemHeight=32),i.height=e.itemHeight):(l.label=i.label,i.height=l.offsetHeight),i.top=t,t+=i.height}e.$.itemsInnerContainer.removeChild(l),e.__scrollHeight=t-e.$.itemsInnerContainer.offsetHeight,e.filterable&&(e.__scrollHeight+=e.$.filterInput.offsetHeight),t=e.__scrollHeight,e.isUpdating--}else{for(let l=0;l<e._items.length;l++){const i=e._items[l];if(i.hidden){i.height=0,i.top=t;continue}e.itemHeight?"auto"!==e.itemHeight&&(i.height=e.itemHeight,i.style.height=i.height+"px"):i.height=i.offsetHeight,i.top=i.offsetTop,t+=i.height}t=e.$.itemsInnerContainer.scrollHeight-e.$.itemsInnerContainer.offsetHeight,e.filterable&&0<t&&(t+=e.$.filterInput.offsetHeight),e.__scrollHeight=t}return 0+t}_initializeRecyclingItems(){const e=this;if(!e.dataSource||e.dataSource&&0===e.dataSource.length||!e.isVirtualized)return;let t=0,l=e.offsetHeight;e.$.itemsInnerContainer.innerHTML="",e._recyclingItems=[];const i=function(){for(let o=0;o<e.dataSource.length;o++){const i=e.dataSource[o],s=e._createItem(i);if(e.itemHeight&&"auto"!==e.itemHeight&&(s.style.height=e.itemHeight+"px"),e.$.itemsInnerContainer.appendChild(s),t+=s.offsetHeight,s.dataItem=e._items[o],e._recyclingItems.push(s),t>1.5*l)break}};i();for(let e=0;t<1.5*l&&5>++e;)i()}_dataBind(){const e=this;if(e._scrollView||(e._scrollView=new Smart.Utilities.Scroll(e,e.$.horizontalScrollBar,e.$.verticalScrollBar)),"function"==typeof e.dataSource&&(e._items=[]),"string"==typeof e.dataSource&&(e.dataSource=JSON.parse(e.dataSource)),null!==e.dataSource&&Array.isArray(e.dataSource)){e.isUpdating++;const t=t=>{e._items=[],e._groups=[];for(let l=0;l<e.dataSource.length;l++){const i=e.dataSource[l],o=t?e._createItem(i,l):e._createItem(i,l,!0);e._items[l]=o,t&&t.appendChild(o)}};if(e.isVirtualized)t(),e._initializeRecyclingItems();else{const i=document.createDocumentFragment();e.$.itemsInnerContainer.innerHTML="",t(i),e.$.itemsInnerContainer.appendChild(i)}e.isUpdating--}const t=e.enableShadowDOM?e.shadowRoot.querySelectorAll("smart-list-item"):e.querySelectorAll("smart-list-item"),i=function(){e.isUpdating++,e.dataSource||(e._initializeHtmlListItems(),e._initializeHtmlListGroups()),e.grouped&&e._group(),e.sorted&&e._sort(),e._refreshLayout(),e._initializeSelection(),e.isInitialized=!0,e._canSort=e.autoSort,e.isUpdating--,e.itemTemplate&&e._handleItemTemplate(e.itemTemplate)&&(e._items.map(t=>e._applyTemplate(t)),e._refreshLayout()),e.__onCompleted&&(e._onCompleted=e.__onCompleted,e.__onCompleted=null,e._onCompleted()),-1<e.topVisibleIndex&&e._setTopVisibleIndex(e.topVisibleIndex),e.$.fireEvent("bindingComplete"),e._updateTopVisibleIndex(),0===e._items.length&&e.clearItems()};0===t.length?i():(e._onCompleted&&(e.__onCompleted=e._onCompleted,e._onCompleted=null),e._ensureItemsReady(t,i))}_ensureItemsReady(e,t){const l=this,i=function(){const i=function(t){for(let l=0;l<e.length;l++)e[l].context="node"===t?e[l]:document};i("node"),t(),i()};if(0===e.length)i();else{l._nodesReadyListeners=0;for(let t=0;t<e.length;t++){const o=e[t],s=function(){l._nodesReadyListeners--,0===l._nodesReadyListeners&&(i(),delete l._nodesReadyListeners)}.bind(l);o.isCompleted||(l._nodesReadyListeners++,o._onCompleted=s)}0===l._nodesReadyListeners&&i()}}_initializeInnerHTML(){const e=this;0<=e.$.itemsInnerContainer.innerHTML.indexOf("<option")?e.$.itemsInnerContainer.innerHTML=e.$.itemsInnerContainer.innerHTML.replace(/<optgroup/ig,"<smart-list-items-group").replace(/<\/optgroup/ig,"</smart-list-items-group").replace(/<option/ig,"<smart-list-item").replace(/<\/option/ig,"</smart-list-item"):0<=e.$.itemsInnerContainer.innerHTML.indexOf("<ul")&&(e.$.itemsInnerContainer.innerHTML=e.$.itemsInnerContainer.innerHTML.replace(/<ul/ig,"<smart-list-items-group").replace(/<\/ul/ig,"</smart-list-items-group").replace(/<li/ig,"<smart-list-item").replace(/<\/li/ig,"</smart-list-item"))}_initializeHtmlListItems(){const e=this,t=e.enableShadowDOM&&"shadow"===e.shadowDomMode?e.shadowRoot.querySelectorAll("smart-list-item"):e.querySelectorAll("smart-list-item"),l="checkBox"===e.selectionMode||"radioButton"===e.selectionMode?e.selectionMode:"plain",o=function(e,t,i){return void 0===e[t]?e[i]:""+e[t]};e._items=[];let s=0;for(let n=0;n<t.length;n++){const i=t[n];i.dataIndex=n,i.label=i.innerHTML,i.dataItem=i,i.top||(i.top=s),i.height||(i.height=i.offsetHeight),s+=i.height,i.value||(i.value=""+n);const r=o(i,e.displayMember,"label"),a=o(i,e.valueMember,"value"),d=o(i,e.groupMember,"group");i.label!==r&&(i.label=r),i.value!==a&&(i.value=a),i.group!==d&&(i.group=d);const c=i.context;i.context=document,i.displayMode=l,i.context=c,e._alternateItem(i),i.selected&&(e.selectedIndexes.push(n),e.selectedValues.push(i.value)),e._items.push(i)}e.itemTemplate&&e._handleItemTemplate(e.itemTemplate)&&e._items.map(t=>e._applyTemplate(t))}_group(){const e=this;e.isUpdating++;let t=[],l=[];e._canSort&&e._unsort();for(let l=0;l<e._items.length;l++){const i=e._items[l];let o=i.group?i.group.trim():i.innerHTML.charAt(0)||i.label.charAt(0);o+=" ",t[o]?t[o].items.push(i):t[t.length++]=t[o]={items:[i],label:o}}if(!e.isVirtualized){for(;e.$.itemsInnerContainer.firstChild;)e.$.itemsInnerContainer.removeChild(e.$.itemsInnerContainer.firstChild);const o=document.createDocumentFragment();e._groups=[];for(let s=0;s<t.length;s++){const i=t[s],n=document.createElement("smart-list-items-group");n.label=i.label,n.dataIndex=s;for(let e=0;e<t[s].items.length;e++){const t=i.items[e];l.push(t),t.group=i.label,n.appendChild(t)}e._groups.push(n),o.appendChild(n)}e._items=l;const i=/Trident|Edge/.test(navigator.userAgent);i?setTimeout(function(){e.$.itemsInnerContainer.appendChild(o)},50):e.$.itemsInnerContainer.appendChild(o)}else{e._groups=[];for(let e=0;e<t.length;e++){const i=t[e];i.dataIndex=e,i.grouped=!0,i.hidden=!1,i.displayMode="plain",l.push(i);for(let o=0;o<t[e].items.length;o++){const e=i.items[o];e.group=i,l.push(e)}}e._groups=t,e._items=l}e.sorted&&e._sort(),e.isUpdating--}_ungroup(){const e=this;e.isUpdating++,e._groups=[],e._canSort&&e._unsort();let t=[];if(!e.isVirtualized){const l=document.createDocumentFragment();for(let o=0;o<e._items.length;o++){const i=e._items[o];l.appendChild(i),t.push(i)}0<t.length&&(e.$.itemsInnerContainer.innerHTML="",e.$.itemsInnerContainer.appendChild(l))}else for(let l=0;l<e._items.length;l++){const i=e._items[l];i.grouped||t.push(i)}e._items=t,e.sorted&&e._sort(),e.isUpdating--}_initializeHtmlListGroups(){const e=this,t=e.$.itemsInnerContainer.querySelectorAll("smart-list-items-group");e._groups=[];for(let l=0;l<t.length;l++){const i=t[l];i.dataIndex=l,e._groups.push(i)}}_initializeSelection(){const e=this,t=e.selectedIndexes.slice(0),l=e.selectedValues.slice(0);e.clearSelection(),"oneOrManyExtended"===e.selectionMode&&(e._keysPressed.Control=!0);for(let o=0;o<e._items.length;o++){const i=e._items[o];(0<=t.indexOf(o)||0<=l.indexOf(i.value||i.label))&&(e._focusedItem&&(e._focusedItem._focused=!1),e._focusedItem=null,e.select(i))}"oneOrManyExtended"===e.selectionMode&&(e._keysPressed.Control=!1)}onItemUpdated(){const e=this;!e.isInitialized||e._isUpdating()||(e.isUpdating++,e._refreshLayout(),e.isUpdating--)}_refreshItems(){const e=this;if(e.isInitialized&&!e._isUpdating()){if(e.isUpdating++,e.grouped?e._ungroup():e.sorted&&e._canSort&&e._unsort(),!e.isVirtualized){e._items=[];const t=e.enableShadowDOM?e.shadowRoot.querySelectorAll("smart-list-item"):e.querySelectorAll("smart-list-item");for(let l=0;l<t.length;l++)t[l].dataIndex=l,e._alternateItem(t[l]),e._items.push(t[l])}e.grouped?e._group():e.sorted&&e._sort(),e._refreshLayout(),e.isUpdating--}}_applyIncrementalSearch(e){const t=this;if(!(null===t.incrementalSearchDelay||isNaN(t.incrementalSearchDelay)))return-1<["Shift","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Control","Home","End","PageUp","PageDown"].indexOf(e)?void 0:(0!==t._incrementalSearchQuery.indexOf(e)&&(t._incrementalSearchQuery+=e),t._incrementalSearchTimer&&clearTimeout(t._incrementalSearchTimer),t._incrementalSearch(),void(t._incrementalSearchTimer=setTimeout(function(){t._incrementalSearchQuery=""},t.incrementalSearchDelay)))}select(e){const t=this;if(!("string"==typeof e&&(e=t.getItem(e),!e))&&!("number"==typeof e&&(e=t.getItem(e),!e))&&!(e.grouped||e.readonly)){if("none"===t.selectionMode)return t.selectedIndexes=[],void(t.selectedValues=[]);switch(!t._focusedItem!==e&&"none"!==t.selectionMode&&(t._focusedItem&&(t._focusedItem._focused=!1),t._focusedItem=e,e._focused=!0),t.selectionMode){case"one":return(1!==t.selectedIndexes.length||t.selectedIndexes[0]!==t._indexOf(e))&&(t._previouslySelectedIndexes=t.selectedIndexes,1<=t.selectedIndexes.length&&t.clearSelection(),t._select(e),delete t._previouslySelectedIndexes,!0);case"zeroOrOne":return 1===t.selectedIndexes.length&&t.selectedIndexes[0]===t._indexOf(e)?(t.unselect(e),!0):(t._previouslySelectedIndexes=t.selectedIndexes,1<=t.selectedIndexes.length&&t.clearSelection(),t._select(e),delete t._previouslySelectedIndexes,!0);case"radioButton":if(t._previouslySelectedIndexes=t.selectedIndexes,0<t.$.itemsInnerContainer.querySelectorAll("smart-list-items-group").length){const i=e.parentNode;if(!e.selected){for(let e in i.children){const l=i.children[e];l.selected&&t.unselect(l)}t._select(e)}return delete t._previouslySelectedIndexes,!0}if(t.isVirtualized&&0<t._groups.length){const i=e.group;if(!e.selected){for(let e in i.items){const l=i.items[e];l.selected&&t.unselect(l)}t._select(e)}return delete t._previouslySelectedIndexes,!0}return e.selected||(1<=t.selectedIndexes.length&&t.clearSelection(),t._select(e)),delete t._previouslySelectedIndexes,!0;case"oneOrMany":return e.selected?1<t.selectedIndexes.length&&t.unselect(e):t._select(e),!0;case"zeroOrMany":case"checkBox":return e.selected?t.unselect(e):t._select(e),!0;case"oneOrManyExtended":{const l=t.selectedValues;if(t._keysPressed.Control)return 1<t.selectedIndexes.length?e.selected?(t.unselect(e),t._focus(t._items[t.selectedIndexes[0]])):t._select(e):t._select(e),!0;if(t._keysPressed.Shift){const i=t._items[t.selectedIndexes[0]];let o;t.clearSelection();const s=0<=l.indexOf(i.value)||i.selected;if(t._select(i,s),t._indexOf(i)>t._indexOf(e))for(o=t._indexOf(i)-1;o>=t._indexOf(e);){const e=t._items[o],i=0<=l.indexOf(e.value)||e.selected;t._select(e,i),o--}else for(o=t._indexOf(i)+1;o<=t._indexOf(e);){const e=t._items[o],i=0<=l.indexOf(e.value)||e.selected;t._select(e,i),o++}const n=[];for(let e=0;e<l.length;e++)n.push(t.getItem(l[e]));if(0<n.length&&!t._propertyChanging){let o=[];for(let e=0;e<t.selectedValues.length;e++){const i=t.selectedValues[e];0>l.indexOf(i)&&o.push(t.getItem(i))}t.$.fireEvent("change",{addedItems:o,removedItems:n,selected:e.selected,disabled:e.disabled,index:t._indexOf(e),label:e.label,value:e.value})}return!0}for(let o=0;o<l.length;o++){const i=l[o],s=t.getItem(i);e!==s&&t.unselect(s)}return t.clearSelection(),t._select(e,0<=l.indexOf(e.value)),!0}}return!1}}_applyTemplate(e,t){const l=this;if(null===l.itemTemplate)return;if("function"==typeof l.itemTemplate)return void l.itemTemplate(e,{label:e.label,value:e.value,index:l._items.indexOf(e)});if(!l._bindingDetails||0===l._bindingDetails.length)return;const i=l._bindingDetails.length;let o,s,n=document.importNode(l._template.content,!0);for(let r=0;r<i;r++){o=n.childNodes[l._bindingDetails[r].childNodeIndex],s=l._bindingDetails[r].bindingString.length;for(let t=0;t<s;t++){const i=l._bindingDetails[r].bindingString[t],s=0<=i.indexOf("label")?e.label:e.value;o.innerHTML=o.innerHTML.replace(i,s)}}e.innerHTML="";for(let l=0;l<n.childNodes.length;l++)n.childNodes[l].outerHTML&&(e.innerHTML+=n.childNodes[l].outerHTML);!1===t||(l._scrollHeightTimer&&(clearInterval(l._scrollHeightTimer),l._scrollHeightCounter=0),l._scrollHeightTimer=setInterval(function(){(l._lastScrollHeight!==l.$.itemsInnerContainer.scrollHeight||10===l._scrollHeightCounter)&&(l._refreshLayout(),clearInterval(l._scrollHeightTimer)),l._lastScrollHeight=l.$.itemsInnerContainer.scrollHeight,l._scrollHeightCounter++},50))}_filterItems(e,t){const l=this,i=l.$.filterInput.value;let o,s;const n=function(){if(0===s.length)return l._filteredItems=[],void(t&&t());o=l._queryItems(i,l.filterMode);for(let e=0;e<s.length;e++)s[e].hidden=!0,s[e].$.addClass("smart-hidden");for(let e=0;e<o.length;e++){const t=o[e];t.hidden=!1,t.$.removeClass("smart-hidden")}if(l.grouped&&l.isVirtualized)for(let e=0;e<l._groups.length;e++){const t=l._groups[e],i=t.items;let o=!0;for(let e=0;e<i.length;e++)i[e].hidden||(o=!1);o&&(t.hidden=!0)}if(l.grouped&&!l.isVirtualized)for(let e=0;e<l._groups.length;e++){const t=l._groups[e],i=[].concat(...t.querySelectorAll("smart-list-item"));let o=!0;for(let e=0;e<i.length;e++)i[e].$.hasClass("smart-hidden")||(o=!1);o?t.$.addClass("smart-hidden"):t.$.removeClass("smart-hidden")}l._filteredItems=o,l._refreshLayout(),t&&t();e||l._refreshSelection()};if("function"!=typeof l.dataSource){if(s=l._items,0===s.length)return;n()}else if(i){const e=l.dataSource(i,function(e){i&&l.isAttached&&(l._updateListBoxAfterQuery=function(){o=s=l._items,n()},l.clearItems(),l.insert(0,e))});if(e){if(!i)return;l._updateListBoxAfterQuery=function(){o=s=l._items,n()},l.clearItems(),l.insert(0,e)}}else l.clearItems(),o=s=l._items,n()}_getNextItem(e){const t=this,i=t._items,l=t._items.length;for(let t=Math.max(e+1,0);t<l;){const e=i[t];if(!e.disabled&&!e.hidden&&!e.grouped&&!e.readonly)return e;t++}return i[e]}_getPreviousItem(e){const t=this,i=t._items;for(let t=Math.max(e-1,0);-1<t;){const e=i[t];if(!e.disabled&&!e.hidden&&!e.grouped&&!e.readonly)return e;t--}return i[e]}get _scrollWidth(){const e=this,t=e._items;return e.__scrollWidth?e.__scrollWidth:(e.__scrollWidth=(()=>{const e=this;let i,l="";for(let e=0;e<t.length;e++){if(t[e].hidden)continue;const i=t[e].label;i.length>l.length&&(l=i)}const o=e._createItem({label:l});e.$.itemsContainer.appendChild(o),o.label=l,o.style.width="auto",o.isCompleted&&(o.$.itemContainer.style.width="auto");const s=getComputedStyle(o),n=parseInt(s.paddingLeft)+parseInt(s.paddingRight);return i=(o.$.itemContainer||o).offsetWidth+n,o.parentNode.removeChild(o),i})(),e.__scrollWidth)}update(e,t){const i=this,l=i._items[e];if(l){if("string"==typeof t)l.label=t,void 0===l.value&&(l.value=t);else for(let e in t)"selected"==e&&l[e]!==t[e]?i.select(l):l[e]=t[e],"group"==e&&i._refreshItems();(i.sorted||i.grouped||i.isVirtualized)&&(i._refreshItems(),i._refreshSelection())}else i.error(i.localize("indexOutOfBound",{elementType:i.nodeName.toLowerCase(),method:"update"}))}insert(e,t){const l=this;let o=[];if(e||(e=0),Array.isArray(t)){l.isUpdating++;for(let s=0;s<t.length;s++){const i=t[s],n=l._createItem(i);o.push(n),e>=l._items.length||0===l._items.length?l.appendChild(n):l.insertBefore(n,l._items[e])}l.isUpdating--}else{const i=l._createItem(t);o.push(i),e>=l._items.length||0===l._items.length?l.appendChild(i):l.insertBefore(i,l._items[e])}0<o.length&&(o.map(e=>l._applyTemplate(e)),l._ensureItemsReady(o,function(){l._refreshItems(),0===l._items.length||(l._updateListBoxAfterQuery&&(l._updateListBoxAfterQuery(),delete l._updateListBoxAfterQuery),l._refreshSelection(),l.$.fireEvent("bindingComplete"))}))}remove(e){const t=this,i=t._items[e];i?(t.isVirtualized?t._items.splice(e,1):i.parentNode.removeChild(i),i.selected&&t.unselect(i),t._refreshItems(),t._refreshSelection(),0===t.selectedIndexes.length&&0<t._items.length&&("oneOrMany"===t.selectionMode||"one"===t.selectionMode||"oneOrManyExtended"===t.selectionMode)&&t.select(t._items[0])):t.error(t.localize("indexOutOfBound",{elementType:t.nodeName.toLowerCase(),method:"remove"}))}_queryItems(e,t){const l=this,o=[],s=function(i,o){if(i.grouped)return i;switch(t){case"startsWith":if(0===i.label.indexOf(o))return i;break;case"startsWithIgnoreCase":if(0===i.label.toLowerCase().indexOf(o.toLowerCase()))return i;break;case"doesNotContain":if(0>i.label.indexOf(o))return i;break;case"doesNotContainIgnoreCase":if(0>i.label.toLowerCase().indexOf(o.toLowerCase()))return i;break;case"contains":if(-1<i.label.indexOf(o))return i;break;case"containsIgnoreCase":if(-1<i.label.toLowerCase().indexOf(o.toLowerCase()))return i;break;case"equals":if(0===i.label.localeCompare(o))return i;break;case"equalsIgnoreCase":if(0===i.label.toLowerCase().localeCompare(o.toLowerCase()))return i;break;case"endsWith":if(i.label.endsWith(o))return i;break;case"endsWithIgnoreCase":if(i.label.toLowerCase().endsWith(o.toLowerCase()))return i;break;case"custom":if(l.filterCallback(i,e))return i;}return null};if(0===e.length)return l._items;for(let n=0;n<l._items.length;n++){const t=s(l._items[n],e);t&&o.push(t)}return o}_select(e,t){const l=this,i=l.selectedIndexes.indexOf(l._indexOf(e)),o=l.selectedIndexes.slice(0),s=l.selectedValues.slice(0);if(e.selected=!0,-1===i)o.push(l._indexOf(e)),s.push(e.value||e.label);else return l._recycle(),!1;if(l.selectedIndexes=o,l.selectedValues=s,l._recycle(),l.$.hiddenInput.value=s.toString(),l.isCompleted&&!t&&l.isInitialized&&!l._propertyChanging){let t=[];if(l._previouslySelectedIndexes){for(let e=0;e<l._previouslySelectedIndexes.length;e++)0>l.selectedIndexes.indexOf(l._previouslySelectedIndexes[e])&&t.push(l._items[l._previouslySelectedIndexes[e]]);delete l._previouslySelectedIndexes}return l.$.fireEvent("change",{addedItems:[e],removedItems:t,selected:e.selected,disabled:e.disabled,index:l._indexOf(e),label:e.label,value:e.value}),!0}}_setTopVisibleIndex(e){const t=this;return"number"==typeof e&&(t.topVisibleIndex=Math.max(0,e),e=t._items[t.topVisibleIndex]),!!e&&void(e.top!==t.scrollTop&&(t.scrollTop=e.top,!t.isVirtualized&&(t.$.itemsContainer.scrollTop=t.scrollTop),t.scrollHeight===t.scrollTop&&t._updateTopVisibleIndex()))}_updateTopVisibleIndex(){const e=this,t=e.scrollTop+e._scrollView.verticalScrollBar.offsetHeight-e.offsetHeight;let l;if(e.scrollTop<e.scrollHeight/2){for(let o=0;o<e._items.length;o++)if(e._items[o].top>t){l=e._items[o];break}}else for(let o=e._items.length-1;0<=o&&!(e._items[o].top<t);o--)l=e._items[o];l&&(e.topVisibleIndex=l.dataIndex)}unselect(e){const t=this;if(!e)return;if("string"==typeof e&&(e=t.getItem(e),!e))return;if("none"===t.selectionMode)return void t.clearSelection();const i=t.selectedIndexes.indexOf(t._indexOf(e)),l=t.selectedIndexes.slice(0),o=t.selectedValues.slice(0);if(e.selected=!1,0<=i)l.splice(i,1),o.splice(i,1);else return!1;return(t.selectedIndexes=l,t.selectedValues=o,t.$.hiddenInput.value=o.toString(),t.isCompleted&&!t._propertyChanging)?(t.$.fireEvent("change",{addedItems:[],removedItems:[e],selected:e.selected,disabled:e.disabled,index:t._indexOf(e),label:e.label,value:e.value}),t._recycle(),!0):void 0}_handleItemTemplate(e){if(null===e||!e)return;if("function"==typeof e)return e;const t=this;if(!("content"in document.createElement("template")))return t.error(t.localize("htmlTemplateNotSuported",{elementType:t.nodeName.toLowerCase()})),void(t.itemTemplate=null);if(e=document.getElementById(e),null===e||!("content"in e))return t.error(t.localize("invalidTemplate",{elementType:t.nodeName.toLowerCase(),property:"itemTemplate"})),void(t.itemTemplate=null);const l=e.content,o=l.childNodes.length,s=/{{\w+}}/g;let n,r;t._bindingDetails=[],t._template=e;for(let a=0;a<o;a++){for(r=[];n=s.exec(l.childNodes[a].innerHTML);)r.push(n[0]);0<r.length&&t._bindingDetails.push({childNodeIndex:a,bindingString:r})}return!0}_handleKeyStrokes(e){const t=this,i="radioButton"===t.selectionMode||"checkBox"===t.selectionMode||"zeroOrMany"===t.selectionMode||"oneOrMany"===t.selectionMode||"zeroOrOne"===t.selectionMode;let l=t._items;if(t.filterable&&0<t.$.filterInput.value.length&&(l=t._filteredItems),!(t.disabled||t.readonly)){switch(e){case"ArrowLeft":case"ArrowUp":t._handleArrowKeys(!0);break;case"ArrowRight":case"ArrowDown":t._handleArrowKeys(!1);break;case" ":{if(1>t.selectedIndexes.length&&!t._focusedItem)return;const e=t._focusedItem?t._focusedItem:t._items[t.selectedIndexes[t.selectedIndexes.length-1]],i=e=>{e.selected&&"radioButton"!==t.selectionMode?t.unselect(e):t.select(e)};if("oneOrMany"===t.selectionMode)return void(e.selected&&1<t.selectedIndexes.length?i(e):!e.selected&&i(e));i(e);break}case"Home":{if(0===l.length)return;i?t._focus(l[0]):(!t._keysPressed.Shift&&t.clearSelection(),t.select(l[0]),t._focus(l[0])),t.scrollTop=0;break}case"End":{if(0===l.length)return;i?t._focus(l[l.length-1]):(!t._keysPressed.Shift&&t.clearSelection(),t.select(l[l.length-1]),t._focus(l[l.length-1])),t.scrollTop=t.scrollHeight;break}case"PageUp":{t._pageUpKeyHandler(l);break}case"PageDown":{t._pageDownKeyHandler(l);break}}t._recycle()}}_horizontalScrollbarHandler(e){const t=this;e.stopPropagation(),t.isVirtualized?t._recycle():t.$.itemsContainer.scrollLeft=e.detail.value}_unsort(){const e=this;e.isUpdating++;const t=function(e,t){let i=e.dataIndex,l=t.dataIndex;return i<l?-1:i>l?1:0};if(!e.isVirtualized){if(0<e._groups.length){e._groups.sort(t);let l=[];for(let o=0;o<e._groups.length;o++){const i=e._groups[o],s=[].concat(...i.querySelectorAll("smart-list-item"));s.sort(t),l=l.concat(s)}e._items=l}else e._items.sort(t);e._applySortOrder()}else if(0<e._groups.length){e._groups.sort(t);let l=[];for(let o=0;o<e._groups.length;o++){const i=e._groups[o],s=[].concat(...i.items);s.sort(t),l.push(i),l=l.concat(s)}e._items=l}else e._items.sort(t);e.isUpdating--}_applySortOrder(){const e=this,t=function(e){for(let t=0;t<e.length;t++){const i=e[t],l=i.parentNode;l&&l.appendChild(i)}};t(e._items),t(e._groups)}_sort(){const e=this;if(e._canSort){e.isUpdating++;const t=function(t,i){let l=t.label,o=i.label;if("asc"===e.sortDirection){if(l<o)return-1;if(l>o)return 1}else{if(l<o)return 1;if(l>o)return-1}return 0};if(e._groups.sort(t),!e.isVirtualized){if(0<e._groups.length){let l=[];for(let o=0;o<e._groups.length;o++){const i=e._groups[o],s=[].concat(...i.querySelectorAll("smart-list-item"));s.sort(t),l=l.concat(s)}e._items=l}else e._items.sort(t);e._applySortOrder()}else if(0<e._groups.length){let l=[];for(let o=0;o<e._groups.length;o++){const i=e._groups[o],s=[].concat(...i.items);l.push(i),s.sort(t),l=l.concat(s)}e._items=l}else e._items.sort(t);e.isUpdating--}}getItem(e){const t=this;for(let l=0;l<t._items.length;l++)if(t._items[l].value===e)return t._items[l];return null}_focus(e){const t=this;!e||"none"===t.selectionMode||t.disabled||t.readonly||(t._focusedItem&&(t._focusedItem._focused=!1),t._focusedItem=e,t._focusedItem._focused=!0)}_keyDownHandler(e){const t=this,i=t.enableShadowDOM?t.shadowRoot.activeElement:document.activeElement;let l=e.key;if(!(t.disabled||t.readonly)&&!(t.filterable&&t.$.filterInput===i)&&t._focused&&!(0===t._items.length||t.disabled||t.displayLoadingIndicator)){if(t.editable){if("F2"===l)return void t._dblclickEventHandler({target:t._focusedItem});if(t.$.editInput===i)return}if("none"!==t.selectionMode){if(e.stopPropagation(),"Down"===l||"Right"===l||"Left"===l||"Up"===l?l="Arrow"+l:void 0,t.filterable)switch(l){case"ArrowLeft":case"ArrowRight":return;case"ArrowUp":case"ArrowDown":e.preventDefault();}if(t._applyIncrementalSearch(l),!(0>["Shift","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Control"," ","Home","End","PageUp","PageDown"].indexOf(l))){if(e.preventDefault(),!t._focusedItem&&0<t._items.length)return void("one"===t.selectionMode||"oneOrMany"===t.selectionMode||"oneOrManyExtended"===t.selectionMode?t.select(t._items[0]):t._focus(t._items[0]));switch(t.selectionMode){case"one":if("Shift"===l||"Control"===l||" "===l)return;t._handleKeyStrokes(l);break;case"oneOrMany":case"zeroOrOne":case"zeroOrMany":case"radioButton":case"checkBox":if("Shift"===l||"Control"===l)return;t._handleKeyStrokes(l);break;case"oneOrManyExtended":if(" "===l)return;t._keysPressed[l]="keydown"===e.type,t._handleKeyStrokes(l);}}}}}_keyUpHandler(e){const t=this,i=t.enableShadowDOM?t.shadowRoot.activeElement:document.activeElement;if(!(t.editable&&t.$.editInput===i)){if(t.filterable&&t.$.filterInput===i)return t._filterTimer&&clearTimeout(t._filterTimer),void(t._filterTimer=setTimeout(function(){const e=t.context;t.context=t,t._filterItems(),t.scrollTop=t.$.itemsContainer.scrollTop=0,t.scrollLeft=t.$.itemsContainer.scrollLeft=0,t.context=e},300));if(t._focused){if(t._focusedItem&&t._focusedItem.hidden&&0<t._filteredItems.length){let e=t._filteredItems[0];e.grouped&&1<t._filteredItems.length&&(e=t._filteredItems[1]),t._focus(e),t._recycle()}e.stopPropagation(),e.preventDefault(),t.disabled||0>["Shift","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Control"," ","PageUp","PageDown"].indexOf(e.key)||(t._keysPressed[e.key]=!1)}}}_mouseWheelHandler(e){const t=this;(t.computedHorizontalScrollBarVisibility||t.computedVerticalScrollBarVisibility)&&(t.disabled||!t.computedVerticalScrollBarVisibility||(e.stopPropagation(),e.preventDefault(),t.scrollTo(t.scrollTop+t._getScrollCoefficient(e,t.offsetHeight))))}_pageDownKeyHandler(e){const t=this;if(0===e.length)return;let i=t._items[t.selectedIndexes[t.selectedIndexes.length-1]];("checkBox"===t.selectionMode||"radioButton"===t.selectionMode||"zeroOrMany"===t.selectionMode||"oneOrMany"===t.selectionMode||"zeroOrOne"===t.selectionMode)&&t._focusedItem&&(i=t._focusedItem);let l;const o=t._indexOf(i);let s=i.top+t.$.itemsContainer.offsetHeight-i.height;for(let t=o;t<e.length;t++)if(e[t].top>=s){l=e[t];break}l||(l=e[e.length-1]),"checkBox"===t.selectionMode||"radioButton"===t.selectionMode||"zeroOrMany"===t.selectionMode||"oneOrMany"===t.selectionMode||"zeroOrOne"===t.selectionMode?t._focus(l):!l.selected&&(!t._keysPressed.Shift&&t.clearSelection(),t.select(l),t._focus(l)),(l.height+l.top>t.$.itemsContainer.scrollTop+t.$.itemsContainer.offsetHeight||l.top<t.$.itemsContainer.scrollTop)&&(t.scrollTop=l.top-t.$.itemsContainer.offsetHeight+l.height)}_pageUpKeyHandler(e){const t=this;if(0===e.length)return;let i=t._items[t.selectedIndexes[t.selectedIndexes.length-1]];("checkBox"===t.selectionMode||"radioButton"===t.selectionMode||"zeroOrMany"===t.selectionMode||"oneOrMany"===t.selectionMode||"zeroOrOne"===t.selectionMode)&&t._focusedItem&&(i=t._focusedItem);const l=i.top-t.$.itemsContainer.offsetHeight,o=t._indexOf(i);let s;for(let t=o;0<t;t--)if(e[t].top<=l){s=e[t];break}s||(s=e[0]),"checkBox"===t.selectionMode||"radioButton"===t.selectionMode||"zeroOrMany"===t.selectionMode||"oneOrMany"===t.selectionMode||"zeroOrOne"===t.selectionMode?t._focus(s):!s.selected&&(!t._keysPressed.Shift&&t.clearSelection(),t.select(s),t._focus(s)),t.scrollTop=s.top;const n=t._indexOf(s);0===n&&(t.scrollTop=0)}clearItems(){const e=this;e.$.itemsInnerContainer.innerHTML="",e.clearSelection(),e._items=[],e.$placeholder.removeClass("smart-hidden")}_resizeHandler(e){const t=this;e.target!==t||t._isUpdatingScrollBars||(t._isUpdatingScrollBars=!0,t._initializeRecyclingItems(),t._refreshLayout(),t._isUpdatingScrollBars=!1)}_indexOf(e){const t=this;if(!e)return-1;let i=t._items.indexOf(e);return-1===i&&(i=t._items.indexOf(t.getItem(e.value))),i}_incrementalSearch(){const e=this,t="radioButton"!==e.selectionMode&&"checkBox"!==e.selectionMode&&"zeroOrMany"!==e.selectionMode&&"oneOrMany"!==e.selectionMode&&"zeroOrOne"!==e.selectionMode;let l,o=0;switch(e.incrementalSearchMode){case"containsIgnoreCase":case"equalsIgnoreCase":case"startsWithIgnoreCase":case"endsWithIgnoreCase":l=e._incrementalSearchQuery.toLowerCase();break;default:l=e._incrementalSearchQuery;}const s=function(i){i.grouped||i.readonly||(t?(0<e.selectedIndexes.length&&e.clearSelection(),e._focus(i),e.select(i)):e._focus(i),(i.height+i.top>e.$.itemsContainer.scrollTop+e.$.itemsContainer.offsetHeight||i.top<e.scrollTop)&&(e.scrollTop=i.top),0===e._indexOf(i)&&(e.scrollTop=0),e._indexOf(i)===e._items.length-1&&(e.scrollTop=e.scrollHeight))};0!==e._previousEntry.localeCompare(l)&&(e._incrementalSearchItems=e._queryItems(e._incrementalSearchQuery,e.incrementalSearchMode),delete e._itemPosition),e._previousEntry=l;const n=e._incrementalSearchItems.length;if(0!==n){if(1===n)return void s(e._incrementalSearchItems[0]);for(void 0===e._itemPosition?t&&e.clearSelection():e._itemPosition<n-1?o=e._itemPosition:(o=0,t?(e._incrementalSearchItems[e._itemPosition].selected=!1,e.selectedIndexes=[],e.selectedValues=[]):e._incrementalSearchItems[e._itemPosition]._focused=!1),o;o<n;o++){if(e._incrementalSearchItems[o].selected&&t){e._incrementalSearchItems[o].selected=!1,e.selectedIndexes=[],e.selectedValues=[];continue}if(!t&&e._incrementalSearchItems[o]._focused){e._incrementalSearchItems[o]._focused=!1;continue}return s(e._incrementalSearchItems[o]),void(e._itemPosition=o)}}}_selectStartHandler(e){const t=this,i=t.enableShadowDOM?t.shadowRoot.activeElement:document.activeElement;t.$.filterInput===i||t.$.editInput===i||e.preventDefault()}_handleArrowKeys(e){const t=this,i="radioButton"!==t.selectionMode&&"checkBox"!==t.selectionMode&&"zeroOrMany"!==t.selectionMode&&"oneOrMany"!==t.selectionMode&&"zeroOrOne"!==t.selectionMode;if(t.disabled||t.readonly)return;let l;if(t._focusedItem&&!t._keysPressed.Shift)l=t._indexOf(t._focusedItem),t._focusedItem._focused=!1;else if(0!==t.selectedIndexes.length)l=t.selectedIndexes[t.selectedIndexes.length-1];else return;const o=e?t._getPreviousItem(l):t._getNextItem(l);t._focus(o),i&&(t._keysPressed.Shift?t.select(o):t._items[l]!==o&&(t.clearSelection(),t.select(o))),t.ensureVisible(o)}_refreshFilter(){const e=this;return e.filterable?(e.$.filterInput.disabled=!!(e.disabled||e.displayLoadingIndicator),e.$filterInputContainer.removeClass("smart-hidden"),void e.$itemsContainer.addClass("filter")):void(e.$.filterInput.disabled=!0,e.$filterInputContainer.addClass("smart-hidden"),e.$itemsContainer.removeClass("filter"))}_setFocusable(){const e=this;return e.disabled||e.unfocusable?void e.removeAttribute("tabindex"):void(e.tabIndex=0<e.tabIndex?e.tabIndex:0)}_setLoadingIndicatorVisibility(){const e=this;return e.displayLoadingIndicator?void(e.$loadingIndicatorContainer.hasClass("smart-visibility-hidden")?e.$loadingIndicatorContainer.removeClass("smart-visibility-hidden"):e.$loadingIndicatorContainer.removeClass("smart-hidden")):void(e._areCSSVarsSupported?e.$loadingIndicatorContainer.addClass("smart-hidden"):e.$loadingIndicatorContainer.addClass("smart-visibility-hidden"))}_refreshLayout(){var e=Math.max;const t=this,i=t._items;if(t.__scrollHeight=null,t.__scrollWidth=null,t._height=null,t._scrollView||(t._scrollView=new Smart.Utilities.Scroll(t,t.$.horizontalScrollBar,t.$.verticalScrollBar)),t.$itemsContainer.removeClass("hscroll"),t.$itemsContainer.removeClass("vscroll"),!i||null===i||0===i.length)return t.scrollWidth=0,t.scrollHeight=0,t.$filterInputContainer.removeClass("vscroll"),t.$placeholder.removeClass("smart-hidden"),void(t.isVirtualized&&t._recycle());t.$placeholder.addClass("smart-hidden");const l=2*(parseInt(getComputedStyle(t.$.itemsInnerContainer).getPropertyValue("--smart-list-item-horizontal-offset"))||0);let o=t._scrollWidth-t.$.itemsContainer.offsetWidth-l,s=t._scrollHeight;if(t._refreshHorizontalScrollBarVisibility(o),t._refreshVerticalScrollBarVisibility(s),t.$.itemsInnerContainer.style.width="hidden"===t.horizontalScrollBarVisibility?t.$.itemsContainer.offsetWidth-l:e(t.$.itemsContainer.offsetWidth-l,-l+t.__scrollWidth)+"px",t.computedVerticalScrollBarVisibility)return o=t._scrollWidth-t.$.itemsContainer.offsetWidth-t._scrollView.vScrollBar.offsetWidth,t._refreshHorizontalScrollBarVisibility(o),"hidden"!==t.horizontalScrollBarVisibility&&(t.$.itemsInnerContainer.style.width=e(t.$.itemsContainer.offsetWidth-l,-l+t.__scrollWidth-t._scrollView.vScrollBar.offsetWidth)+"px"),t.computedHorizontalScrollBarVisibility&&("visible"===t.horizontalScrollBarVisibility&&0===t.scrollWidth?"visible"===t.horizontalScrollBarVisibility&&(t.__scrollHeight+=t._scrollView.hScrollBar.offsetHeight):t.__scrollHeight+=t._scrollView.hScrollBar.offsetHeight,t.scrollHeight=t.__scrollHeight),void(t.isVirtualized&&t._recycle());o=t._scrollWidth-t.$.itemsContainer.offsetWidth-l,t._refreshHorizontalScrollBarVisibility(o),t.computedHorizontalScrollBarVisibility&&(t.scrollHeight=t._scrollHeight,t._refreshVerticalScrollBarVisibility(t.scrollHeight)),t.isVirtualized&&t._recycle();const n=/Trident|Edge/.test(navigator.userAgent);!t.isRefreshing&&n&&setTimeout(function(){t.isRefreshing=!0,t._refreshLayout(),t.isRefreshing=!1},50)}_styleChangedHandler(){const e=this;e._refreshLayout()}_swipeLeftHandler(){}_swipeRightHandler(){}_refreshHorizontalScrollBarVisibility(e){const t=this;t.scrollWidth=e,t.computedHorizontalScrollBarVisibility?(t.scrollLeft=t.$.itemsContainer.scrollLeft,t.$itemsContainer.addClass("hscroll")):t.$itemsContainer.removeClass("hscroll")}_refreshVerticalScrollBarVisibility(e){const t=this;t.scrollHeight=e,t.computedVerticalScrollBarVisibility?(t.$itemsContainer.addClass("vscroll"),t.$filterInputContainer.addClass("vscroll")):(t.$itemsContainer.removeClass("vscroll"),t.$filterInputContainer.removeClass("vscroll"))}_validateTemplate(e,t){if(null!==t&&t){const i=this;return"content"in document.createElement("template")?(t=document.getElementById(t),null!==t&&"content"in t?t:(i.error(i.localize("invalidTemplate",{elementType:i.nodeName.toLowerCase(),property:e})),void(i[e]=null))):(i.error(i.localize("htmlTemplateNotSuported",{elementType:i.nodeName.toLowerCase()})),void(i[e]=null))}}_getItemIndexByPosition(e){const t=this,i=t.filterable&&0<t.$.filterInput.value.length?t._filteredItems:t._items,l=(i=>{let l=0,o=i.length-1;if(0>=e)return 0;const s=i[i.length-1];if(s.top<=e)return i.length-1;for(;!0;){const s=Math.floor((l+o)/2),n=i[s];if(t._isItemInPosition(n,e))return s;n.top<e?l=s+1:n.top>e&&(o=s-1)}})(i);return l}_isItemInPosition(e,t){const i=e.top,l=e.top+e.height;return i<=t&&l>t}get isVirtualized(){const e=this;return e.virtualized&&e.dataSource&&0<e.dataSource.length}_recycle(){const e=this;if(!e._recyclingItems)return;let t=e._height;e._height||(t=e._height=e.$.itemsContainer.offsetHeight);let l=0;const i=e.scrollTop,o=e._getItemIndexByPosition(i),s=e.filterable&&0<e.$.filterInput.value.length?e._filteredItems:e._items,n=s[o];let r=n?n.top:0;if(e.$.itemsInnerContainer.style.left=-e.scrollLeft+"px",e.$.itemsInnerContainer.style.top=-i+r+"px",e.isUpdating++,0<=o)for(let n=o;n<s.length;n++){const o=s[n];if(0!==o.height){if(r+o.height>=i&&r<=i+t){const t=e._recyclingItems[l++];if(!t)break;t.context=document,t.dataItem=o,t.label=o.label,t.value=o.value,t.selected=o.selected,t._focused=o._focused,t.hidden=o.hidden,t.grouped=o.grouped,t.readonly=o.readonly,t.style.height=o.height+"px",e._alternateItem(t),t.title=o.title?o.title:"",t.displayMode=o.grouped?"plain":o.displayMode,0<e.scrollWidth&&(t.style.width=e.$.itemsInnerContainer.offsetWidth+e.scrollWidth+"px"),e.itemTemplate&&e._handleItemTemplate(e.itemTemplate)&&e._applyTemplate(t,!1)}else break;r+=o.height}}if(l<e._recyclingItems.length)for(let t=l;t<e._recyclingItems.length;t++){const t=e._recyclingItems[l++],i=t.context;t.context=document,t.hidden=!0,t.context=i}e.isUpdating--}_verticalScrollbarHandler(e){const t=this,i=e.detail.value;return e.stopPropagation(),t.isVirtualized?t._recycle():t.$.itemsContainer.scrollTop=i,t._updateTopVisibleIndex(),e.context.max===e.context.value?void t.$.fireEvent("scrollBottomReached"):void(e.context.min===e.context.value&&t.$.fireEvent("scrollTopReached"))}});