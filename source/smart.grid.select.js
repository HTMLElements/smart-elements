
/* Smart HTML Elements v3.2.0 (2019-June) 
Copyright (c) 2011-2019 jQWidgets. 
License: https://htmlelements.com/license/ */

Smart.Utilities.Assign("Grid.Select",class{_refreshSelection(){const e=this;if(e.selection.enabled){const l=e._selectionColumn;l.refresh()}}_toggleColumnSelection(e){const l=this;if(!l.selection.enabled||"none"===l.selection.checkBoxes.selectAllMode)return void(l._inputOverlay&&l._inputOverlay.parentNode&&l._inputOverlay.parentNode.removeChild(l._inputOverlay));let n=e.element.getAttribute("selected");n="indeterminate"===n||""!==n;let t=l.getVisibleRows();l.paging.enabled&&"page"===l.selection.checkBoxes.selectAllMode&&(t=t.slice(l.paging.pageIndex*l.paging.pageSize,(l.paging.pageIndex+1)*l.paging.pageSize)),l._selectionColumn._selecting=!0,l.beginUpdate();for(let l=0;l<t.length;l++){const e=t[l];e.selected=n}if(l._selectionColumn._selecting=!1,l.endUpdate(!1),l._recycle(!1),l.selection.enabled&&l.selection.checkBoxes.enabled&&"none"!==l.selection.checkBoxes.selectAllMode){const n=e.element,t=n.querySelector(".smart-input");l._inputOverlay?l._inputOverlay.parentNode!==l.$.columnHeader&&(l._inputOverlay.parentNode&&l._inputOverlay.parentNode.removeChild(l._inputOverlay),l._inputOverlay=document.createElement("div"),l.$.columnHeader.appendChild(l._inputOverlay)):(l._inputOverlay=document.createElement("div"),l.$.columnHeader.appendChild(l._inputOverlay)),l._inputOverlay.classList.add("smart-input-overlay"),l._inputOverlay.classList.add("smart-input-overlay-column"),l.appearance.allowCheckBoxesSelectionAnimation&&l._inputOverlay.classList.add("smart-animate"),l._inputOverlay.style.top=(n.offsetHeight-t.offsetHeight)/4+1+"px";const o=l._selectionColumn.element.parentElement.offsetLeft+l._selectionColumn.element.offsetLeft;l._inputOverlay.style.left=o+"px",l._inputOverlay.style.height=n.offsetWidth+"px",l._inputOverlay.style.width=n.offsetWidth+"px",l._inputOverlay.onmousedown=null,l._inputOverlay.classList.add("smart-input-overlay-on"),l._selectionColumn.refresh()}}_refreshCheckBoxColumnSelection(){const e=this;if(e.selection.enabled&&e.selection.checkBoxes.enabled){const l=e._selectionColumn.element;"none"===e.selection.checkBoxes.selectAllMode?(l.removeAttribute("checkbox"),l.label.classList.remove("smart-input")):(l.setAttribute("checkbox",""),l.label.classList.add("smart-input")),e._selectionColumn.refresh()}}_handleExtendedRowSelection(e,l){const n=this;if(!e)return;let t=n.getVisibleRows();if(n.paging.enabled&&"page"===n.selection.selectAllMode&&(t=t.slice(n.paging.pageIndex*n.paging.pageSize,(n.paging.pageIndex+1)*n.paging.pageSize)),l.ctrlKey||(n._selection.rows=[]),l.shiftKey||(n._rangeSelectionStartRow=e,n._rangeSelectionEndRow=e),l&&l.shiftKey){n._rangeSelectionEndRow=e;const l=t.indexOf(n._rangeSelectionStartRow),o=t.indexOf(n._rangeSelectionEndRow),a=Math.min(l,o),d=Math.max(l,o);for(let e=a;e<=d;e++){const l=t[e];l.selected=!0}}else e.selected=!l.ctrlKey||null===e.selected||!e.selected}_setSelection(e,l,n){const t=this;if(t.selection.enabled){t._lastColumnSelectionRange=null,t._lastRowSelectionRange=null;const o=function(){if((n.ctrlKey||n.shiftKey)&&"one"!==t.selection.mode||("many"!==t.selection.mode&&(t._selection.rows=[],t._selection.columns=[],t._selection.cells=[]),t._selection.focusedCell=null),t._selection.selectionRect){const e=t._selection.selectionRect;e.parentNode.removeChild(e);const l={down:"pointerdown",move:"pointermove",up:"pointerup"};Smart.Utilities.Core.isMobile&&(l.down="touchstart",l.move="touchmove",l.up="touchend"),document.removeEventListener(l.move,e.onMove),document.removeEventListener(l.up,e.onUp),document.removeEventListener(l.down,e.onDown),t._selection.selectionRect=null}};t.beginUpdate();const i=t.columnByDataField[l];if(t.selection.allowCellSelection&&void 0!==e&&null!==e&&i&&!i.autoGenerated){const i=t.rowById[e];let a=i.getCell(l);const d=t._getParentCell(i,l);d&&(a=d.row.getCell(d.column.dataField)),o(),n.ctrlKey||(t._selection.rows=[],t._selection.columns=[],"many"!==t.selection.mode&&(t._selection.cells=[])),a.selected="extended"===t.selection.mode?!n.ctrlKey||!a.selected:"one"===t.selection.mode||!a.selected,n.shiftKey&&t._selection.focusedCell||(t._selection.focusedCell=a),(n.shiftKey||t._selection.focusedCell===a)&&"extended"===t.selection.mode&&(d?t._renderCellSelectionRect(a.row,a.column,d.endRow,d.endColumn):t._renderCellSelectionRect(a.row,a.column,a.row,a.column))}else t.selection.allowRowHeaderSelection&&void 0!==e&&null!==e&&void 0===t.columnByDataField[l]?(o(),t._selectRow(e,n)):t.selection.checkBoxes.enabled&&void 0!==e&&null!==e&&"_checkBoxColumn"===l&&void 0===t.columnByDataField[l]?(o(),t._selectRow(e,n)):void 0!==e&&null!==e&&void 0!==t.columnByDataField[l]&&t.selection.allowRowSelection?(o(),t._selectRow(e,n)):t.selection.allowColumnHeaderSelection&&i&&(o(),t._selectColumn(l,n));t.endUpdate(!1),t._recycle(),void 0!==e&&null!==e&&t._renderInputOverlay(e,n)}}_renderCellSelectionRect(e,l,n,t){const o=this;let i=o.getVisibleRows();o.paging.enabled&&"page"===o.selection.selectAllMode&&(i=i.slice(o.paging.pageIndex*o.paging.pageSize,(o.paging.pageIndex+1)*o.paging.pageSize));const a=i.indexOf(e),d=i.indexOf(n),c=o.columns.indexOf(l),s=o.columns.indexOf(t);if(0<=a&&0<=d){if(!o._selection.selectionRect){const e=o._selection.selectionRect=function(e){const l=document.createElement("div"),n=document.createElement("div"),t=document.createElement("div");return t.classList.add("smart-selection-overlay"),t.appendChild(n),n.appendChild(l),l.classList.add("smart-selection-overlay-content"),n.classList.add("smart-selection-overlay-border-content"),o.selection.allowCellDragSelectionHandle&&e&&n.classList.add("handle"),o.$.scrollView.appendChild(t),t}(!0);if(o.selection.allowCellDragSelectionHandle){let l=null,n=null,t=null;e.onMove=function(e){var a=Math.abs;const d=o._selection.selectionRect;let c=e.clientX,s=e.clientY;e.touches&&(c=e.touches[0].clientX,s=e.touches[0].clientY);const r=function(){const e=document.elementsFromPoint(c,s);let l=null;for(let n=0;n<e.length;n++){const t=e[n];if(t.getAttribute("data-field")){l=t.getAttribute("data-field");break}}let n=null;for(let l=0;l<e.length;l++){const t=e[l];if(t.getAttribute("data-id")){n=t.row;break}}return{column:o.columnByDataField[l],row:n}};if(d.capturedDrag){const l={clientX:c,clientY:s};let n=r(l),t=r({clientX:c,clientY:s+d.top}).row,a=r({clientX:c+d.left,clientY:s}).column;t||(t=i[i.length-1]),a||(a=n.column),t&&a&&n.row&&n.column&&(d.row=n.row,d.column=n.column,d.endDragRow=d.endRow=t,d.endDragColumn=d.endColumn=a,o._dragSelectionStartDataField=d.column.dataField,o._dragSelectionStartRow=d.row,o._selection.focusedCell=d.row.getCell(d.column.dataField)),o._resizeSelectionRect(),e.preventDefault()}else if(d.captured){if(o._dragSelectionStartDataField=o._selection.focusedCell.column.dataField,o._dragSelectionStartRow=o._selection.focusedCell.row,null===n&&null===t&&(30<=a(c-l.left)?n=!0:30<=a(s-l.top)&&(t=!0)),d.lastPoint&&40<=a(d.lastPoint.top-s)?(n=null,t=!0):d.lastPoint&&40<=a(d.lastPoint.left-c)&&(t=null,n=!0),n){const e=d.endDragColumn.dataField,n=d.endDragRow,t={clientX:c,clientY:l.top-5},i=r(t);i.row&&i.column&&(d.endDragRow=d.endRow,d.endDragColumn=i.column,d.endDragColumn.dataField!==e&&(d.lastPoint={left:c,top:s}),o._resizeSelectionRect())}else if(t){const e=d.endDragColumn,n=d.endDragRow,t={clientX:l.left-5,clientY:s},i=r(t);i.row&&i.column&&(d.endDragRow=i.row,d.endDragColumn=d.endColumn,d.endDragRow.id&&d.endDragRow.id!==n.id&&(d.lastPoint={left:c,top:s}),o._resizeSelectionRect())}e.preventDefault()}d.captured&&o.selection.allowDragSelectionAutoScroll&&(o._autoScrollSelectionDragInterval&&clearInterval(o._autoScrollSelectionDragInterval),o.selection.isDragging=!0,e.preventDefault(),o._autoScrollSelectionDragInterval=setInterval(function(){const e=o.$.scrollView.getBoundingClientRect();c<=e.left+20?(o.scrollLeft-=15,o._resizeSelectionRect()):c>=e.left+e.width-20&&(o.scrollLeft+=15,o._resizeSelectionRect()),s<=e.top+20?(o.scrollTop-=15,o._resizeSelectionRect()):s>=e.top+e.height-20&&(o.scrollTop+=15,o._resizeSelectionRect())},5))},e.onUp=function(){if(e.captured){o._autoScrollSelectionDragInterval&&clearInterval(o._autoScrollSelectionDragInterval),e.capturedDrag=!1,e.captured=!1,n=null,t=null,l=null,e.lastPoint=null;const i=e.cellValues;e.minRow&&e.maxRow&&e.maxRow&&e.maxColumn&&(o._selectCellsRange(e.minRow,e.maxRow,e.minColumn.dataField,e.maxColumn.dataField),e.row=e.minRow,e.column=e.minColumn,e.endColumn=e.maxColumn,e.endRow=e.maxRow,e.cellValues=i,o._resizeSelectionRect(),o.selection.allowCellDragSelectionAutoFill&&o._pasteSelectedCells({row:e.row,endRow:e.endDragRow,column:e.column,endColumn:e.endColumn},i)),e.endDragColumn=null,e.endDragRow=null,e.minColumn=null,e.minRow=null,e.maxColumn=null,e.maxRow=null}},e.onDown=function(n){if(e.captured&&!l){let e=n.clientX,t=n.clientY;n.touches&&(e=n.touches[0].clientX,t=n.touches[0].clientY),l={left:e,top:t},n.preventDefault()}};const a={down:"pointerdown",move:"pointermove",up:"pointerup"};Smart.Utilities.Core.isMobile&&(a.down="touchstart",a.move="touchmove",a.up="touchend"),e["on"+a.down]=function(l){const n=e.getBoundingClientRect();let t=l.clientX,i=l.clientY;l.touches&&(t=l.touches[0].clientX,i=l.touches[0].clientY),t>=n.right-5&&i>=n.bottom-5?(e.captured=!0,e.endDragRow=e.endRow,e.endDragColumn=e.endColumn):o.selection.allowCellDragDropSelectionHandle&&i>=n.bottom-5?(e.captured=!0,e.capturedDrag=!0,e.endDragRow=e.endRow,e.endDragColumn=e.endColumn,e.left=e.endColumn.left-e.column.left,e.top=e.endRow.top-e.row.top):!e.captured&&o._rowDownHandler(l)},document.addEventListener(a.move,e.onMove,{passive:!1}),document.addEventListener(a.up,e.onUp,{passive:!1}),document.addEventListener(a.down,e.onDown,{passive:!1})}}const e=o._selection.selectionRect;e.row=o._selection.focusedCell.row,e.column=o._selection.focusedCell.column,e.endRow=n,e.endDragRow=n,e.endColumn=t,e.endDragColumn=t,o._refreshCellSelectionRect()}}_resizeSelectionRect(){var e=Math.max,l=Math.min;const n=this,t=n._selection.selectionRect;let o=n.getVisibleRows();n.paging.enabled&&"page"===n.selection.selectAllMode&&(o=o.slice(n.paging.pageIndex*n.paging.pageSize,(n.paging.pageIndex+1)*n.paging.pageSize));let i=t.row,a=t.endDragRow,d=t.column,c=t.endDragColumn;const s=o.indexOf(i),r=o.indexOf(a),u=o.indexOf(t.endRow),g=n.columns.indexOf(d),p=n.columns.indexOf(c),m=n.columns.indexOf(t.endColumn),_=l(u,l(s,r)),w=e(u,e(s,r)),S=l(m,l(g,p)),f=e(m,e(g,p));t.minRow=u<=l(s,r)?t.endRow:s<=r?i:a,t.maxRow=u>=e(s,r)?t.endRow:s>=r?i:a,t.minColumn=m<=l(g,p)?t.endColumn:g<=p?d:c,t.maxColumn=m>=e(g,p)?t.endColumn:g>=p?d:c;let x=0,R=0,h=0,y=0;for(let e=_;e<=w;e++){const l=o[e];e===_&&(x=l.top),e===w&&(R=l.top+l.height-x);for(let e=S;e<=f;e++){const t=n.columns[e].dataField,o=l.getCell(t);e===S&&(h=o.column.left),e===f&&(y=o.column.left+o.column.computedWidth-h)}}t.style.top=x-n.scrollTop-1+"px",t.style.left=h-n.scrollLeft+"px",t.style.height=R+1+"px",t.style.width=y+1+"px"}_pasteSelectedCells(e,l){var n=Math.max,t=Math.min;const o=this;o.beginUpdate();let a=o.getVisibleRows();o.paging.enabled&&"page"===o.selection.selectAllMode&&(a=a.slice(o.paging.pageIndex*o.paging.pageSize,(o.paging.pageIndex+1)*o.paging.pageSize));let i=e.row,d=e.endRow,c=e.column,s=e.endColumn;const r=a.indexOf(i),u=a.indexOf(d),g=a.indexOf(e.endRow),p=o.columns.indexOf(c),m=o.columns.indexOf(s),_=o.columns.indexOf(e.endColumn),w=t(g,t(r,u)),S=n(g,n(r,u)),f=t(_,t(p,m)),x=n(_,n(p,m));let R=0,h=0,y=0,C=0;for(let n in l){if(0==R)for(let e in l[n])h++;R++}const v=function(e,n){let t=[],o=0,a=[],d=[];const i={names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],namesAbbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],namesShort:["Su","Mo","Tu","We","Th","Fr","Sa"]},c={names:["January","February","March","April","May","June","July","August","September","October","November","December",""],namesAbbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""]},s=function(e){return void 0===e?void 0:isNaN(parseFloat(e))?0<=i.names.indexOf(e)?i.names.indexOf(e):0<=i.namesAbbr.indexOf(e)?i.namesAbbr.indexOf(e):0<=i.namesShort.indexOf(e)?i.namesShort.indexOf(e):0<=c.names.indexOf(e)?c.names.indexOf(e):0<=c.namesAbbr.indexOf(e)?c.namesAbbr.indexOf(e):parseFloat(e.toString().replace(/\D/g,"")):e};let r=0;for(let i in l){let e=l[i];for(let l in t[o]=[],r=0,e){let n=e[l];t[o].push(n),r++}let n=t[o][0],d=0;for(let e=0;e<t[o].length;e++){let l=s(t[o][e-1]),i=s(t[o][e]);0==e&&(l=i),n+=i,d+=i-l}n/=t[o].length,n-=t[o][0],n+=t[o][t[o].length-1],0!==d&&(d/=t[o].length-1),2>=t[o].length&&(n=t[o][t[o].length-1]+d),a.push({step:d,stepStart:n}),o++}for(let l=0;l<r;l++){let e=t[0][l],n=0;for(let o=1;o<t.length;o++){const i=s(t[o-1][l]),a=s(t[o][l]);e+=a,n+=a-i}e/=t.length,e-=t[0][l],e+=t[t.length-1][l],0!==n&&(n/=t.length-1),2>=t.length&&(e=t[t.length-1][l]+n),d.push({step:n,stepStart:e})}if(!t[e]){let l=t.length;for(let o=l;o<=e;o++){t[o]=[];for(let e=0;e<=n;e++)t[o][e]=o===l?d[e].stepStart:t[o-1][e]+d[e].step}return t[e][n]}if(!t[e][n]){let l=r;for(let o=l;o<=n;o++)o==l?t[e].push(a[e].stepStart):t[e].push(t[e][o]+a[e].stepStart);return t[e][n]}return 0};for(let n=w;n<=S;n++){const e=a[n];let t=0;y=0;for(let i=f;i<=x;i++){const a=o.columns[i].dataField,d=e.getCell(a);let c=0;for(let s in l){if(c===C){let t=0,c=l[s];for(let r in c){if(y===t){let t=c[r],u=!0;if(l[e.id]&&l[e.id][a]&&(u=!1),u&&"none"!==o.clipboard.autoFillMode)if(o.clipboard.onPasteValue){const e={value:t,oldValue:d.value,dataField:r,id:s};o.clipboard.onPasteValue(e),d.value=e.value}else{const e=d.column.dataType;if("copy"===o.clipboard.autoFillMode){if("string"===e)d.value=t;else if("bool"===e||"boolean"===e)(1===t||"1"===t||!0===t||"true"===t||"TRUE"===t||"True"===t)&&(d.value=!0);else if("date"===e||"time"===e||"dateTime"===e){const l=o.columnByDataField[r];d.value=l.dataType===e?t:null}else if("number"===e||"float"===e||"int"===e){const l=o.columnByDataField[r];d.value=l.dataType===e?"int"===e||"integer"===e?parseInt(t):parseFloat(t):null}}else if("fillSeries"===o.clipboard.autoFillMode)if("string"===e)d.value=t;else if("bool"===e||"boolean"===e)(1===t||"1"===t||!0===t||"true"===t||"TRUE"===t||"True"===t)&&(d.value=!0);else if("date"===e||"time"===e||"dateTime"===e){const l=o.columnByDataField[r];l.dataType!==e&&(d.value=null)}else if("number"===e||"float"===e||"int"===e){t=v(n-w,i-f);const l=o.columnByDataField[r];d.value=l.dataType===e?"int"===e||"integer"===e?parseInt(t):parseFloat(t):null}}}t++}}c++,t++,y++,y>=h&&(y=0)}}C++,C>=R&&(C=0)}o.endUpdate(!1),o._recycle(!1)}_refreshCellSelectionRect(){var e=Math.max,l=Math.min;const n=this,t=n._selection.selectionRect;if(t.captured)return;let o=n.getVisibleRows();n.paging.enabled&&"page"===n.selection.selectAllMode&&(o=o.slice(n.paging.pageIndex*n.paging.pageSize,(n.paging.pageIndex+1)*n.paging.pageSize));let i=t.row,a=t.endRow,d=t.column,c=t.endColumn;const s=o.indexOf(i),r=o.indexOf(a),u=n.columns.indexOf(d),g=n.columns.indexOf(c);let p=l(s,r),m=e(s,r),_=l(u,g),w=e(u,g);_=e(0,_),p=e(0,p);const S=function(t){const i=o.indexOf(t.row),a=o.indexOf(t.endRow),d=n.columns.indexOf(t.column),c=n.columns.indexOf(t.endColumn);p=l(p,i),p=l(p,a),p=e(0,p),m=e(m,i),m=e(m,a),_=l(_,d),_=l(_,c),_=e(0,_),w=e(w,d),w=e(w,c)},f=n._getParentCell(i,d.dataField),x=n._getParentCell(i,c.dataField),R=n._getParentCell(a,c.dataField),h=n._getParentCell(a,d.dataField);f&&S(f),x&&S(x),R&&S(R),h&&S(h);let y=0,C=0,v=0,D=0;t.cellValues=[];for(let e=p;e<=m;e++){const l=o[e];e===p&&(y=l.top),e===m&&(C=l.top+l.height-y),t.cellValues[l.id]=[];for(let e=_;e<=w;e++){const o=n.columns[e].dataField,i=l.getCell(o);t.cellValues[l.id][o]=i.value,e===_&&(v=i.column.left),e===w&&(D=i.column.left+i.column.computedWidth-v),i.selected=!0}}t.style.top=y-n.scrollTop-1+"px",t.style.left=v-n.scrollLeft+"px",t.style.height=C+1+"px",t.style.width=D+1+"px"}_renderInputOverlay(e,l,n){const t=this,o=t.rowById[e];if(o.allowSelect&&!o.label&&l&&t.selection.checkBoxes.enabled){t._inputOverlay&&t._inputOverlay.classList.contains("smart-input-overlay-column")&&(t._inputOverlay.parentNode&&t._inputOverlay.parentNode.removeChild(t._inputOverlay),t._inputOverlay=null),t._inputOverlay||(t._inputOverlay=document.createElement("div"),t.$.scrollView.appendChild(t._inputOverlay),t._inputOverlay.classList.add("smart-input-overlay")),t._inputOverlay.style.top=o.top-t.scrollTop+"px";const e=t._selectionColumn.element.parentElement.offsetLeft+t._selectionColumn.element.offsetLeft;t._inputOverlay.style.left=e+"px",t._inputOverlay.style.height=o.cellHeight+"px",t._inputOverlay.style.width=t._selectionColumn.computedWidth+"px",t._inputOverlay.row=o,t._inputOverlay.onpointerdown=function(){t._inputOverlay||(t._inputOverlay.onpointerdown=null);const e=t._inputOverlay.row;t.beginUpdate(),e.selected=!e.selected,t.endUpdate(!1),t._recycle(),t._renderInputOverlay(e.id,l,!0)},t.appearance.allowCheckBoxesSelectionAnimation&&void 0===n&&t._inputOverlay.classList.add("smart-animate"),requestAnimationFrame(()=>{t._inputOverlay&&t._inputOverlay.classList.add("smart-input-overlay-on")})}}_selectRow(e,l){const n=this,t=n.rowById[e];t&&n.selection.enabled&&(n._lastRowsSelectionRange=null,"extended"===n.selection.mode?n._handleExtendedRowSelection(t,l):"one"===n.selection.mode?t.selected=!0:t.selected=!t.selected)}_getParentCell(e,l){const n=this;let t=n.getVisibleRows();n.paging.enabled&&"page"===n.selection.selectAllMode&&(t=t.slice(n.paging.pageIndex*n.paging.pageSize,(n.paging.pageIndex+1)*n.paging.pageSize));for(let o=0;o<n._cellsMerge.length;o++){const i=n._cellsMerge[o];let a=[],d=[];if(a.push(i.row),1<i.rowSpan){const e=t.indexOf(i.row);if(0<=e)for(let l=e;l<e+i.rowSpan;l++)t[l]&&-1===a.indexOf(t[l])&&a.push(t[l])}if(d.push(i.column.dataField),1<i.colSpan){const e=n.columns.indexOf(n.columnByDataField[i.column.dataField]);for(let l=e;l<e+i.colSpan;l++)n.columns[l]&&-1===d.indexOf(n.columns[l].dataField)&&d.push(n.columns[l].dataField)}if(0<=a.indexOf(e)&&0<=d.indexOf(l))return{row:i.row,column:i.column,endRow:a[a.length-1],endColumn:n.columnByDataField[d[d.length-1]]}}return null}_selectCellsRange(e,l,n,t){var o=Math.max,i=Math.min;const a=this,d=a._selection.selectionRect;if(a._lastRowsSelectionRange&&a._lastRowsSelectionRange.id===e.id&&a._lastRowsSelectionRange.endId===l.id&&a._lastColumnSelectionRange&&a._lastColumnSelectionRange.dataField===n&&a._lastColumnSelectionRange.endDataField===t)return;a.beginUpdate(),a.clearSelection(),a._lastRowsSelectionRange={id:e.id,endId:l.id},a._lastColumnSelectionRange={dataField:n,endDataField:t},(!d||d&&!d.captured)&&a._selection.focusedCell&&a._renderCellSelectionRect(a._selection.focusedCell.row,a._selection.focusedCell.column,a.rowById[a._lastRowsSelectionRange.endId],a.columnByDataField[a._lastColumnSelectionRange.endDataField]);let c=a.getVisibleRows();a.paging.enabled&&"page"===a.selection.selectAllMode&&(c=c.slice(a.paging.pageIndex*a.paging.pageSize,(a.paging.pageIndex+1)*a.paging.pageSize));let s=-1,r=a.columns.length,u=c.indexOf(e),g=c.indexOf(l);for(let o=0;o<a.columns.length;o++){const e=a.columns[o];e.allowSelect&&(e.dataField===n&&(s=o),e.dataField===t&&(r=o))}let p=i(u,g),m=o(u,g),_=i(s,r),w=o(s,r);const S=function(e){const l=c.indexOf(e.row),n=c.indexOf(e.endRow),t=a.columns.indexOf(e.column),d=a.columns.indexOf(e.endColumn);p=i(p,l),p=i(p,n),m=o(m,l),m=o(m,n),_=i(_,t),_=i(_,d),w=o(w,t),w=o(w,d)},f=a._getParentCell(e,n),x=a._getParentCell(l,t);f&&S(f),x&&S(x);for(let o=p;o<=m;o++){const e=c[o];if(e.allowSelect)for(let l=0;l<a.columns.length;l++){const n=a.columns[l];if(n.allowSelect&&l>=_&&l<=w){const l=e.getCell(n.dataField);l.selected=!0}}}a.endUpdate(!1),a._recycle()}_selectRowsRange(e,l){const n=this;if(n._lastRowsSelectionRange&&n._lastRowsSelectionRange.id===e.id&&n._lastRowsSelectionRange.endId===l.id)return;n.beginUpdate(),n.clearSelection(),n._lastRowsSelectionRange={id:e.id,endId:l.id};let t=n.getVisibleRows();n.paging.enabled&&"page"===n.selection.selectAllMode&&(t=t.slice(n.paging.pageIndex*n.paging.pageSize,(n.paging.pageIndex+1)*n.paging.pageSize));const o=t.indexOf(e),i=t.indexOf(l),a=Math.min(o,i),d=Math.max(o,i);for(let n=a;n<=d;n++){const e=t[n];e.allowSelect&&(e.selected=!0)}n.endUpdate(!1),n._recycle()}_selectColumnsRange(e,l){const n=this;if(n._lastColumnSelectionRange&&n._lastColumnSelectionRange.dataField===e&&n._lastColumnSelectionRange.endDataField===l)return;n.beginUpdate(),n.clearSelection(),n._lastColumnSelectionRange={dataField:e,endDataField:l};let t=-1,o=n.columns.length;for(let a=0;a<n.columns.length;a++){const i=n.columns[a];i.allowSelect&&(i.dataField===e&&(t=a),i.dataField===l&&(o=a))}const a=Math.min(t,o),d=Math.max(t,o);for(let t=0;t<n.columns.length;t++){const e=n.columns[t];e.allowSelect&&t>=a&&t<=d&&(e.selected=!0)}n.endUpdate(!1),n._recycle()}_selectColumn(e,l){const n=this,t=n.columnByDataField[e];if(t&&n.selection.enabled&&t.allowSelect&&n.selection.allowColumnHeaderSelection&&l)if("extended"!==n.selection.mode)t.selected="one"===n.selection.mode||null===t.selected||!t.selected;else if(l.ctrlKey||l.shiftKey||(n._rangeSelectionStartColumn=t,n._rangeSelectionEndColumn=t),t.selected=!0,l&&l.shiftKey){n._rangeSelectionStartColumn||(n._rangeSelectionStartColumn=t),n._rangeSelectionEndColumn=t,n._selection.columns=[];const e=n.columns.indexOf(n._rangeSelectionStartColumn),l=n.columns.indexOf(n._rangeSelectionEndColumn),o=Math.min(e,l),a=Math.max(e,l);for(let e=o;e<=a;e++){const l=n.columns[e];l.selected=!0}}}_getSelectedRows(e,l){const n=this,t=[];let o=n.rows;e&&(o=n.getVisibleRows()),n.paging.enabled&&l&&(o=o.slice(n.paging.pageIndex*n.paging.pageSize,(n.paging.pageIndex+1)*n.paging.pageSize));for(let n=0;n<o.length;n++){const e=o[n];e.selected&&t.push(e)}return t}_dragSelectionEnd(){const e=this;e.selection.allowDragSelection&&(e.selection.isDragging=!1,e._autoScrollSelectionDragInterval&&(clearInterval(e._autoScrollSelectionDragInterval),!e.editing.isEditing&&e._recycle()),e._dragSelectionStartDataField=null,e._dragSelectionStartRow=null)}_dragSelection(e){const l=this;if("extended"===l.selection.mode&&!1!==l.selection.allowDragSelection&&(l._dragSelectionStartDataField||l._dragSelectionStartRow)){if(l.selection.allowCellSelection&&l._dragSelectionStartDataField&&!l._columnResizeLine&&!l._dragSelectionStartDataField.startsWith("_")&&l._dragSelectionStartRow&&!l._rowResizeLine){const n=document.elementsFromPoint(e.clientX,e.clientY);let t=null;for(let e=0;e<n.length;e++){const l=n[e];if(l.getAttribute("data-field")){t=l.getAttribute("data-field");break}}let o=null;for(let e=0;e<n.length;e++){const l=n[e];if(l.getAttribute("data-id")){o=l.row;break}}return t&&o&&l._selectCellsRange(l._dragSelectionStartRow,o,l._dragSelectionStartDataField,t),void(l.selection.allowDragSelectionAutoScroll&&(l._autoScrollSelectionDragInterval&&clearInterval(l._autoScrollSelectionDragInterval),l.selection.isDragging=!0,l._autoScrollSelectionDragInterval=setInterval(function(){const n=l.$.scrollView.getBoundingClientRect();e.clientX<=n.left+20?l.scrollLeft-=15:e.clientX>=n.left+n.width-20&&(l.scrollLeft+=15),e.clientY<=n.top+20?l.scrollTop-=15:e.clientY>=n.top+n.height-20&&(l.scrollTop+=15)},5)))}if(l._dragSelectionStartRow&&!l._rowResizeLine&&(l.selection.allowRowSelection&&!l._dragSelectionStartDataField.startsWith("_")||l.selection.allowRowHeaderSelection&&l._dragSelectionStartDataField.startsWith("_"))){const n=document.elementsFromPoint(e.clientX,e.clientY);let t=null;for(let e=0;e<n.length;e++){const l=n[e];if(l.getAttribute("data-id")){t=l.row,!t&&l.cell&&(t=l.cell.row);break}}t&&l._selectRowsRange(l._dragSelectionStartRow,t),l._autoScrollSelectionDragInterval&&clearInterval(l._autoScrollSelectionDragInterval),l.selection.isDragging=!0,l._autoScrollSelectionDragInterval=setInterval(function(){const n=l.$.scrollView.getBoundingClientRect();e.clientY<=n.top+20?l.scrollTop-=15:e.clientY>=n.top+n.height-20&&(l.scrollTop+=15)},5)}else if(l._dragSelectionStartDataField&&!l._columnResizeLine&&!l._dragSelectionStartDataField.startsWith("_")&&l.selection.allowColumnHeaderSelection){const n=document.elementsFromPoint(e.clientX,e.clientY);let t=null;for(let e=0;e<n.length;e++){const l=n[e];if(l.getAttribute("data-field")){t=l.getAttribute("data-field");break}}t&&l._selectColumnsRange(l._dragSelectionStartDataField,t),l._autoScrollSelectionDragInterval&&clearInterval(l._autoScrollSelectionDragInterval),l.selection.isDragging=!0,l._autoScrollSelectionDragInterval=setInterval(function(){const n=l.$.scrollView.getBoundingClientRect();e.clientX<=n.left+20?l.scrollLeft-=15:e.clientX>=n.left+n.width-20&&(l.scrollLeft+=15)},5)}}}select(){this}unselect(){this}clearSelection(){const e=this;e._selection.rows=[],e._selection.columns=[],e._selection.cells=[],e._recycle()}});