
/* Smart HTML Elements v6.0.0 (2020-Jan) 
Copyright (c) 2011-2020 jQWidgets. 
License: https://htmlelements.com/license/ */

Smart("smart-card-view",class extends Smart.BaseElement{static get properties(){return{addNewButton:{value:!1,type:"boolean"},allowDrag:{value:!1,type:"boolean"},cardHeight:{value:null,type:"number?"},cellOrientation:{value:"vertical",allowedValues:["horizontal","vertical"],type:"string"},collapsible:{value:!1,type:"boolean"},columns:{value:[],type:"object",reflectToAttribute:!1},coverField:{value:null,type:"string?"},coverMode:{value:"crop",allowedValues:["fit","crop"],type:"string"},dataSource:{value:null,type:"object?",reflectToAttribute:!1},editable:{value:!1,type:"boolean"},headerPosition:{value:"none",allowedValues:["none","top","bottom"],type:"string"},messages:{value:{en:{addFilter:"+ Add filter",addImage:"Add",and:"And",apply:"Apply",booleanFirst:"\u2610",booleanLast:"\u2611",cancel:"Cancel",CONTAINS:"contains",CONTAINS_CASE_SENSITIVE:"contains (case sensitive)",coverField:"Cover field",crop:"Crop",customizeCards:"Customize cards",dateFirst:"1",dateLast:"9",dateTabLabel:"DATE",DOES_NOT_CONTAIN:"does not contain",DOES_NOT_CONTAIN_CASE_SENSITIVE:"does not contain (case sensitive)",draggedRecord:"Record {{id}}",EMPTY:"empty",ENDS_WITH:"ends with",ENDS_WITH_CASE_SENSITIVE:"ends with (case sensitive)",EQUAL:"equal",EQUAL_CASE_SENSITIVE:"equal (case sensitive)",filter:"Filter",filteredByMultiple:"{{n}} filters",filteredByOne:"1 filter",filterValuePlaceholder:"Value",find:"Find a field",findInView:"Find in view",firstBy:"Sort by",fit:"Fit",found:"{{nth}} of {{n}}",from:"from",GREATER_THAN:"greater than",GREATER_THAN_OR_EQUAL:"greater than or equal",imageUrl:"New image URL:",incorrectStructure:"\"dataSource\" must be an instance of Smart.DataAdapter or an array of objects with key-value pairs.",LESS_THAN:"less than",LESS_THAN_OR_EQUAL:"less than or equal",nextRecord:"Next record",noCoverField:"No cover field",noData:"No data to display",noFilters:"No filters applied",noMatches:"No matched records",noSorting:"No sorting applied",noResults:"No results",NOT_EMPTY:"not empty",NOT_EQUAL:"not equal",NOT_NULL:"not null",now:"Now",NULL:"null",numberFirst:"1",numberLast:"9",ok:"OK",or:"Or",pickAnother:"Pick another field to sort by",previousRecord:"Previous record",removeImage:"Remove",sort:"Sort",sortedByMultiple:"Sorted by {{n}} fields",sortedByOne:"Sorted by 1 field",STARTS_WITH:"starts with",STARTS_WITH_CASE_SENSITIVE:"starts with (case sensitive)",stringFirst:"A",stringLast:"Z",thenBy:"then by",timeTabLabel:"TIME",toggleVisibility:"Toggle field visibility",where:"Where"}}},onRecordInserted:{value:null,type:"function?",reflectToAttribute:!1},onRecordRemoved:{value:null,type:"function?",reflectToAttribute:!1},scrolling:{value:"physical",allowedValues:["physical","virtual","infinite","deferred"],type:"string"},titleField:{value:null,type:"string?"}}}static get listeners(){return{click:"_clickHandler",move:"_moveHandler",resize:"_resizeHandler","addNewButton.click":"_addNewButtonClickHandler","cardContainer.down":"_cardContainerDownHandler","header.apply":"_applyHandler","header.cancel":"closePanel","headerDropDown.transitionend":"_headerDropDownTransitionendHandler","searchInput.keyup":"_searchInputKeyupHandler","document.move":"_documentMoveHandler","document.up":"_documentUpHandler"}}static get requires(){return{"Smart.Button":"smart.button.js","Smart.Card":"smart.card.js","Smart.Carousel":"smart.carousel.js","Smart.CheckBox":"smart.checkbox.js","Smart.ColumnPanel":"smart.gridpanel.js","Smart.DataAdapter":"smart.data.js","Smart.DateTimePicker":"smart.datetimepicker.js","Smart.Input":"smart.input.js","Smart.NumericTextBox":"smart.numerictextbox.js","Smart.ScrollBar":"smart.scrollbar.js","Smart.SwitchButton":"smart.switchbutton.js","Smart.Window":"smart.window.js","Smart.Utilities.DateTime":"smart.date.js"}}get hasStyleObserver(){return!1}get editInfo(){return this._editInfo}static get styleUrls(){return["smart.cardview.css"]}template(){return`<div id="container" role="presentation">
                    <div id="header" class="smart-card-view-header smart-hidden" role="toolbar">
                        <div id="customizeCardsButton" class="smart-card-view-header-button smart-card-view-customize-button smart-unselectable" role="button" aria-expanded="false" aria-haspopup="dialog" aria-label="Customize cards"><div role="presentation"></div></div>
                        <div id="filterButton" class="smart-card-view-header-button smart-card-view-filter-button smart-unselectable" role="button" aria-expanded="false" aria-haspopup="dialog" aria-label="Filter"><div role="presentation"></div></div>
                        <div id="sortButton" class="smart-card-view-header-button smart-card-view-sort-button smart-unselectable" role="button" aria-expanded="false" aria-haspopup="dialog" aria-label="Sort"><div role="presentation"></div></div>
                        <div id="searchButton" class="smart-card-view-header-button smart-card-view-search-button smart-unselectable" role="button" aria-expanded="false" aria-haspopup="dialog" aria-label="Search"></div>
                        <div id="headerDropDown" class="smart-card-view-header-drop-down smart-visibility-hidden" role="dialog">
                            <div id="customize" class="smart-hidden" role="presentation"></div>
                            <div id="filter" class="smart-hidden" role="presentation"></div>
                            <div id="sort" class="smart-hidden" role="presentation"></div>
                            <div id="search" class="smart-card-view-search-box smart-hidden" role="presentation">
                                <input type="text" id="searchInput" spellcheck="false" aria-label="Search" />
                                <div id="searchLabel" class="smart-card-view-search-label smart-unselectable"></div>
                                <div id="searchPrev" class="smart-card-view-search-prev" role="button" aria-label="Previous"></div>
                                <div id="searchNext" class="smart-card-view-search-next" role="button" aria-label="Next"></div>
                                <div id="searchClose" class="smart-card-view-search-close" role="button" aria-label="Close search box"></div>
                            </div>
                        </div>
                    </div>
                    <smart-scroll-viewer id="scrollViewer" animation="[[animation]]" horizontal-scroll-bar-visibility="hidden" right-to-left="[[rightToLeft]]">
                        <div id="cardContainer" class="smart-card-container" role="list"></div>
                    </smart-scroll-viewer>
                    <div id="loadingIndicatorContainer" class="smart-loader-container smart-hidden" aria-label="Loading">
                        <span id="loadingIndicator" class="smart-loader" role="presentation"></span>
                    </div>
                    <div id="addNewButton" class="smart-add-new-button" role="button" aria-label="Add new card"></div>
                </div>`}attached(){const e=this;super.attached(),e.isCompleted&&e._editInfo&&(e._addWindowHandlers(),document.body.appendChild(e._editInfo.window))}detached(){const e=this;if(super.detached(),!!e._editInfo){const t=e._editInfo.window;t.removeEventListener("open",e._windowEventHandler),t.removeEventListener("closing",e._windowEventHandler),t.removeEventListener("close",e._windowEventHandler),t.removeEventListener("click",e._windowClickHandler),t.removeEventListener("prev",e._prevNextHandler),t.removeEventListener("next",e._prevNextHandler),t.remove()}}ready(){super.ready()}render(){const e=this,t=e.dataSource,i=e.scrolling,a=getComputedStyle(e);e.$.headerDropDown.id||(e.$.headerDropDown.id=e.id+"HeaderDropDown"),e.setAttribute("role","group"),Smart.Utilities.NumberRenderer&&(e._numericFormatter=new Smart.Utilities.NumberRenderer),e.shadowRoot&&(e.importStyle(Smart.Utilities.Core.getScriptLocation()+Smart.StyleBaseUrl.replace("/scoped/","/smart.scrollviewer.css")),e.importStyle(Smart.Utilities.Core.getScriptLocation()+Smart.StyleBaseUrl.replace("/scoped/","/smart.carousel.css")),e.importStyle(Smart.Utilities.Core.getScriptLocation()+Smart.StyleBaseUrl.replace("/scoped/","/smart.button.css")),e.importStyle(Smart.Utilities.Core.getScriptLocation()+Smart.StyleBaseUrl.replace("/scoped/","/smart.sortable.css"))),e._gap=parseFloat(a.getPropertyValue("--smart-card-view-gap")),e._verticalOffset=parseFloat(a.getPropertyValue("--smart-card-view-vertical-offset")),e._cards=[],e._collapsed={},e._collapsedRows={},e._numberOfCollapsedRows=0,e._cardScrolling={},e._cardSelectedCover={},e._cardHeight=e.cardHeight,e._autoCardHeight=null===e._cardHeight,e._cachedWidth=e.offsetWidth,e._cachedHeight=e.offsetHeight,e._appliedFiltering={filters:[],operator:"and"},e._appliedSorting={dataFields:[],dataTypes:[],orderBy:[]},e._start={view:0,data:0},e._autoScrollCoefficient=Smart.Utilities.Core.Browser.Firefox?8:Smart.Utilities.Core.Browser.Edge?16:4,e._isMobile=Smart.Utilities.Core.isMobile,e._normalizeDataSource(),e._getVisibleRecords(),e._normalizeColumns(),e._handleHeaderPosition(),e._localizeHeader(),e._getInnerElementMessages(),"deferred"===i?e.$.scrollViewer.$.verticalScrollBar.mechanicalAction="switchWhenReleased":("virtual"===i||"infinite"===i)&&t&&t.onVirtualDataSourceRequested===void 0&&(e.scrolling="physical"),e._createTemplate(),"infinite"===i?e._requestInitialCards():e._createCards(),e.$.scrollViewer._verticalScrollbarHandler=e._onVerticalChange.bind(e),e.$.scrollViewer.hasStyleObserver=!1,e.$.scrollViewer.$.verticalScrollBar.hasStyleObserver=!1,e.$.scrollViewer.$.horizontalScrollBar.hasStyleObserver=!1,super.render()}addFilter(e,t="and"){const i=this;if(!Array.isArray(e)||0<e.length&&!Array.isArray(e[0]))return;let a;if(i.closePanel(),arguments[2]?a={filters:arguments[2],operator:t}:(a={filters:[],operator:t},e.forEach(e=>{e[1].filters.forEach(t=>{a.filters.push([e[0],t.condition,t.value])})})),JSON.stringify(a)!==JSON.stringify(i._appliedFiltering)){const r=a.filters.length;i._appliedFiltering=a;try{i.dataSource._filter(e,t)}catch(e){return}return i._getVisibleRecords(),i._fullRefresh(),i.$.fireEvent("filter"),0===r?(i.$.filterButton.firstElementChild.innerHTML=i.localize("filter"),void i.$.filterButton.classList.remove("filtered")):void(i.$.filterButton.firstElementChild.innerHTML=1===r?i.localize("filteredByOne"):i.localize("filteredByMultiple",{n:r}),i.$.filterButton.classList.add("filtered"))}}addRecord(e,t={},i="last"){function a(){"first"===i?(o.insert(0,t),o!==l._visibleSource&&l._visibleSource.unshift(o[0])):(i="last",o.insert(o.length,t),o!==l._visibleSource&&l._visibleSource.push(o[o.length-1])),l._closeSearchPanel(),l._fullRefresh()}function r(e){e&&a()}const l=this,o=l.dataSource,n=l.scrolling;if("object"==typeof t){if(0===l.dataSource.dataFields.length){const e=[t];return l.dataSource=e,void l.propertyChangedHandler("dataSource",null,e)}const d=o.id;return d&&(null!==e&&void 0!==e&&""!==e?t[d]=e:void 0===t[d]&&(o[0]&&!o[0].isEmpty&&"number"==typeof o[0].$.id?t[d]=Math.floor(Math.random()*(1e6-o.length))+o.length:t[d]=Math.random().toString(36).substring(7))),"physical"===n||"deferred"===n?void a():void(l.onRecordInserted&&l.onRecordInserted(d?t[d]:e,t,i,r))}}addSort(e,t){function i(e,i){const l=a.columns.find(t=>t.dataField===e);if(l){let a=Array.isArray(t)?t[i]:"string"==typeof t?t:"ascending";o.dataFields.push(e),o.dataTypes.push(r.dataFields.find(t=>t.name===e).dataType),a=-1===a.indexOf("desc")?"ascending":"descending",o.orderBy.push(a)}}const a=this,r=a.dataSource,l=JSON.stringify(a._appliedSorting);let o;if(0!==arguments.length&&r&&0!==r.length){if(a.closePanel(),1===arguments.length&&"object"==typeof e)o=e;else if(o={dataFields:[],dataTypes:[],orderBy:[]},Array.isArray(e))e.forEach(i);else if("string"==typeof e)i(e,0);else return;if(a.closePanel(),a._appliedSorting=o,l!==JSON.stringify(a._appliedSorting)){const e=a._appliedSorting.dataFields.length;if(r.sortBy(o.dataFields,o.dataTypes,o.orderBy),a._getVisibleRecords(),a._refreshCardContent(),a.$.fireEvent("sort"),0===e)return a.$.sortButton.firstElementChild.innerHTML=a.localize("sort"),void a.$.sortButton.classList.remove("sorted");a.$.sortButton.firstElementChild.innerHTML=1===e?a.localize("sortedByOne"):a.localize("sortedByMultiple",{n:e}),a.$.sortButton.classList.add("sorted")}}}beginEdit(e){const t=this;if(t.editable){const i=t._visibleSource.find(t=>t.$.id===e);if(i){const i=t.ensureVisible(e);"virtual"===t.scrolling?t._beginEditOnLoad=e:t._openEditDialog(i.dataId)}}}cancelEdit(){const e=this,t=e._editInfo;t&&t.window.opened&&t.window.close()}closePanel(){const e=this,t=e.$.headerDropDown;t.classList.add("smart-visibility-hidden"),e._closeSearchPanel(),t.controlledBy&&(t.controlledBy.removeAttribute("aria-controls"),t.controlledBy.setAttribute("aria-expanded",!1),delete t.controlledBy)}endEdit(){const e=this,t=e._editInfo;t&&t.window.opened&&(t.ok=!0,t.window.close())}ensureVisible(e){var t=Math.floor;const a=this,i=a._visibleSource,r=i.find(t=>t.$.id===e);if(!r)return;const l=i.indexOf(r),o=a._cardsPerRow,n=a._cardHeight+a._gap,d=a.$.scrollViewer.$.verticalScrollBar,s=t(l/o),c=Math.max(0,s*o);let h,m,g=0;if(0<a._numberOfCollapsedRows){const e=t((i.length-1)/o)+1;for(let t=0;t<e;t++){const e=t;if(e===s)break;g+=a._collapsedRows[e]?n-a._cardContentHeight:n}}else g=t(c/o)*n;return(g=Math.min(g,d.max),Math.abs(d.value-g)<a.$.scrollViewer.$.scrollViewerContainer.offsetHeight/50)?(h=a._cards.filter(e=>e.dataId===l&&!e.classList.contains("smart-hidden")),m=h[h.length-1],m):(d.value=g,a._onVerticalChange({detail:{value:g}}),h=a._cards.filter(e=>e.dataId===l&&!e.classList.contains("smart-hidden")),m=h[h.length-1],m)}hideColumn(e){this._toggleColumn(e,!1)}openCustomizePanel(){const e=this,t=e.dataSource;if(!t||0===t.length)return;const i=e.$.customize,a=e.columns.map(t=>{const i=Object.assign({},t);return i.disableToggle=-1!==[e.coverField,e.titleField].indexOf(i.dataField),i}),r=[e.localize("noCoverField")].concat(e.columns.filter(e=>e.image));let l,o,n;if(e._editInfo&&e._editInfo.window.close(),e.$.headerDropDown.classList.add("customize-panel"),e.$.headerDropDown.classList.remove("filter-panel","sort-panel","search-panel"),i.classList.remove("smart-hidden"),e.$.filter.classList.add("smart-hidden"),e.$.sort.classList.add("smart-hidden"),e.$.search.classList.add("smart-hidden"),e._closeSearchPanel(),!e._customizePartCreated){const t=document.createDocumentFragment(),i=document.createElement("div"),d=document.createElement("div"),s=document.createElement("div");l=document.createElement("smart-switch-button"),o=document.createElement("smart-input"),n=document.createElement("smart-column-panel"),s.id=e.id+"CoverFieldLabel",s.innerHTML=e.localize("coverField"),l.rightToLeft=e.rightToLeft,l.setAttribute("crop",e.localize("crop")),l.setAttribute("fit",e.localize("fit")),l.setAttribute("aria-labelledby",s.id),l.inverted=!0,l.animation=e.animation,l.theme=e.theme,o.dataSource=r,o.dropDownButtonPosition="right",o.rightToLeft=e.rightToLeft,o.readonly=!0,o.animation=e.animation,o.theme=e.theme,n.rightToLeft=e.rightToLeft,n.animation=e.animation,n.dataSource=a,n.locale=e.locale,n.messages=e._innerElementMessages.columnPanel,n.theme=e.theme,d.appendChild(s),d.appendChild(l),i.classList.add("smart-card-view-customize-top"),i.appendChild(d),i.appendChild(o),t.appendChild(i),t.appendChild(n),e.$.customize.appendChild(t),e._customizePartCreated=!0}else l=i.getElementsByTagName("smart-switch-button")[0],l.rightToLeft=e.rightToLeft,o=i.getElementsByTagName("smart-input")[0],o.dataSource=r,o.rightToLeft=e.rightToLeft,delete o.$.input.dataValue,n=i.children[1],n.set("dataSource",a),n.propertyChangedHandler("dataSource",void 0,a),n.rightToLeft=e.rightToLeft;l.checked="fit"===e.coverMode,o.value=e.coverField?e.columns.find(t=>t.dataField===e.coverField).label:e.localize("noCoverField"),e._changedVisibility=new Map,e._openHeaderDropDown(e.$.customizeCardsButton)}openFilterPanel(){const e=this,t=e.dataSource;if(!t||0===t.length)return;const i=e.columns.map(e=>{const i=Object.assign({},e);return i.dataType=t.dataFields.find(e=>e.name===i.dataField).dataType,i});let a;e._editInfo&&e._editInfo.window.close(),e.$.headerDropDown.classList.add("filter-panel"),e.$.headerDropDown.classList.remove("customize-panel","sort-panel","search-panel"),e.$.filter.classList.remove("smart-hidden"),e.$.customize.classList.add("smart-hidden"),e.$.sort.classList.add("smart-hidden"),e.$.search.classList.add("smart-hidden"),e._closeSearchPanel(),e._filterPartCreated?(a=e.$.filter.firstElementChild,a.set("operator",e._appliedFiltering.operator),a.set("value",e._appliedFiltering.filters),a._applyValue(),a.rightToLeft=e.rightToLeft):(a=document.createElement("smart-multi-column-filter-panel"),a.rightToLeft=e.rightToLeft,a.animation=e.animation,a.dataSource=i,a.locale=e.locale,a.messages=e._innerElementMessages.multiColumnFilterPanel,a.operator=e._appliedFiltering.operator,a.editorPlaceholder=e.localize("filterValuePlaceholder"),a.theme=e.theme,a.value=e._appliedFiltering.filters,e.$.filter.appendChild(a),e._filterPartCreated=!0),e._openHeaderDropDown(e.$.filterButton)}openSortPanel(){const e=this,t=e.dataSource;if(!t||0===t.length)return;const i=e.columns.map(i=>{const a=Object.assign({},i),r=e._appliedSorting.dataFields.indexOf(a.dataField);return a.dataType=t.dataFields.find(e=>e.name===a.dataField).dataType,a.sortIndex=r,-1!==r&&(a.sortDirection=e._appliedSorting.orderBy[r]),a});let a;e._editInfo&&e._editInfo.window.close(),e.$.headerDropDown.classList.add("sort-panel"),e.$.headerDropDown.classList.remove("customize-panel","filter-panel","search-panel"),e.$.sort.classList.remove("smart-hidden"),e.$.customize.classList.add("smart-hidden"),e.$.filter.classList.add("smart-hidden"),e.$.search.classList.add("smart-hidden"),e._closeSearchPanel(),e._sortPartCreated?(a=e.$.sort.firstElementChild,a.rightToLeft=e.rightToLeft,a.set("dataSource",i),a.propertyChangedHandler("dataSource",void 0,i)):(a=document.createElement("smart-sort-panel"),a.rightToLeft=e.rightToLeft,a.animation=e.animation,a.dataSource=i,a.locale=e.locale,a.messages=e._innerElementMessages.sortPanel,a.theme=e.theme,e.$.sort.appendChild(a),e._sortPartCreated=!0),e._openHeaderDropDown(e.$.sortButton)}removeFilter(){this.addFilter([])}removeRecord(e){function t(){const t=i.dataSource,a=t.find(t=>t.$.id===e);if(a){const e=t.indexOf(a),r=i._visibleSource.indexOf(a);if(t.remove(e),t!==i._visibleSource){if(-1===r)return;i._visibleSource.splice(r,1)}i._closeSearchPanel(),i._fullRefresh()}}const i=this,a=i.scrolling;return"physical"===a||"deferred"===a?void t():void(i.onRecordRemoved&&i.onRecordRemoved(e,function(e){e&&t()}))}removeSort(){this.addSort({dataFields:[],dataTypes:[],orderBy:[]})}showColumn(e){this._toggleColumn(e,!0)}propertyChangedHandler(e,t,i){super.propertyChangedHandler(e,t,i);const a=this;switch(e){case"allowDrag":case"coverMode":case"onRecordInserted":case"onRecordRemoved":break;case"addNewButton":i&&0===a.dataSource.dataFields.length&&(a.addNewButton=!1);break;case"animation":case"theme":if(a._cards.forEach(t=>{const a=t.getElementsByTagName("smart-carousel");a&&(a[e]=i)}),a._editInfo)for(let t in a._editInfo.window[e]=i,a._editInfo.editors)a._editInfo.editors[t].element[e]=i;a._customizePartCreated&&(a.$.customize.firstElementChild.firstElementChild.children[1][e]=i,a.$.customize.firstElementChild.children[1][e]=i,a.$.customize.children[1][e]=i),a._filterPartCreated&&(a.$.filter.firstElementChild[e]=i),a._sortPartCreated&&(a.$.sort.firstElementChild[e]=i);break;case"disabled":a.closePanel(),a._editInfo&&(a._editInfo.window.disabled=i);break;case"cardHeight":a._updateCardHeight(i);break;case"cellOrientation":case"collapsible":if(!a.dataSource||0===a.dataSource.length)return;a._fullRefresh();break;case"columns":a._updateColumns();break;case"coverField":case"titleField":{if(null!==i){const r=a.columns.find(e=>e.dataField===i);if(!r||"coverField"===e&&!r.image)return void(a[e]=t)}if(a._createTemplate(),!a.dataSource||0===a.dataSource.length)return;a._fullRefresh();break}case"dataSource":a._close(),a._normalizeDataSource(),a._getVisibleRecords(),a._clearFilterAndSortUI(),a._normalizeColumns(),a._createTemplate(),a._fullRefresh(!1);break;case"editable":!i&&a._editInfo&&a._editInfo.window.close();break;case"headerPosition":a._handleHeaderPosition(),("none"===i||"none"===t)&&a.dataSource&&0<a.dataSource.length&&a._partialRefresh();break;case"locale":case"messages":if(a.closePanel(),a._localizeHeader(),a._getInnerElementMessages(),a._editInfo){const e=a._editInfo.window;e.$.buttonsContainer.firstElementChild.title=a.localize("previousRecord"),e.$.buttonsContainer.children[1].title=a.localize("nextRecord"),e.$.footer.firstElementChild.innerHTML=a.localize("ok"),e.$.footer.children[1].innerHTML=a.localize("cancel"),Array.from(e.getElementsByClassName("toggle-visibility")).forEach(e=>e.title=a.localize("toggleVisibility")),Array.from(e.querySelectorAll(".smart-card-view-editor.image")).forEach(e=>{Array.from(e.firstElementChild.children).forEach(e=>e.title=a.localize("removeImage")),e.children[1].innerHTML=a.localize("imageUrl"),e.children[2].children[1].title=a.localize("addImage")}),Array.from(e.getElementsByTagName("smart-date-time-picker")).forEach(e=>{e.messages=a._innerElementMessages.dateTimePicker,e.locale=a.locale})}if(a._customizePartCreated){const e=a.$.customize.getElementsByTagName("smart-switch-button")[0];a.$.customize.firstElementChild.firstElementChild.firstElementChild.innerHTML=a.localize("coverField"),a.$.customize.children[1].messages=a._innerElementMessages.columnPanel,a.$.customize.children[1].locale=a.locale,e.setAttribute("crop",a.localize("crop")),e.setAttribute("fit",a.localize("fit"))}a._filterPartCreated&&(a.$.filter.firstElementChild.messages=a._innerElementMessages.multiColumnFilterPanel,a.$.filter.firstElementChild.locale=a.locale,a.$.filter.firstElementChild.editorPlaceholder=a.localize("filterValuePlaceholder")),a._sortPartCreated&&(a.$.sort.firstElementChild.messages=a._innerElementMessages.sortPanel,a.$.sort.firstElementChild.locale=a.locale);break;case"rightToLeft":a._editInfo&&!a._editInfo.updateWindowContent&&(a._editInfo.window.rightToLeft=i,a.columns.forEach(function(e){const t=a._editInfo.editors[e.dataField],r=t.element;"date"===t.type?r.calendarButtonPosition=i?"left":"right":"number"===t.type?i?(r.spinButtonsPosition="left",r.radixDisplayPosition="right"):(r.spinButtonsPosition="right",r.radixDisplayPosition="left"):"string"===t.type&&r instanceof HTMLTextAreaElement&&(a.rightToLeft?r.setAttribute("right-to-left",""):r.removeAttribute("right-to-left")),r.rightToLeft=a.rightToLeft})),a.closePanel();break;case"scrolling":{const e=["virtual","infinite"];if(-1!==e.indexOf(i)||-1!==e.indexOf(t))return void(a.scrolling=t);a.$.scrollViewer.$.verticalScrollBar.mechanicalAction="deferred"===i?"switchWhenReleased":"switchWhileDragging";break}}}_updateColumns(){const e=this;e._normalizeColumns(),e._createTemplate(),e._fullRefresh()}_addNewButtonClickHandler(){this._openEditDialog()}_clickHandler(e){const t=this,i=t.isInShadowDOM||t.shadowRoot?e.composedPath()[0]:e.target;if(t.$.header.contains(i))return void t._headerClickHandler(e);const a=i.closest("smart-card");if(!(!a||i.classList.contains("smart-indicator")||t._dragDetails&&t._dragDetails.feedbackShown)){if(t._dragDetails&&(delete t._dragDetails,t.$.scrollViewer._scrollView.disableSwipeScroll=!1),!i.classList.contains("smart-arrow-up"))return void(t.editable&&!t._clickToDrag&&t._openEditDialog(a.dataId));const e=a.getElementsByClassName("smart-card-view-content")[0],r=t._visibleSource[a.dataId].$.id;e.removeEventListener("transitionend",t._transitionendHandlerExpand),e.removeEventListener("transitionend",t._transitionendHandlerCollapse),t._collapsed[r]?(delete t._collapsed[r],t._getNumberOfCollapsedRows(),t.hasAnimation?t._expandDataContainer(e):(a.classList.remove("collapsed"),i.classList.remove("collapsed"),e.classList.remove("smart-visibility-hidden"),t._partialRefresh()),window.getSelection().removeAllRanges()):(t._collapsed[r]=!0,t._getNumberOfCollapsedRows(),a.classList.add("collapsed"),i.classList.add("collapsed"),t.hasAnimation?t._collapseDataContainer(e):(e.classList.add("smart-visibility-hidden"),t._partialRefresh()))}}_windowClickHandler(e){const t=this,i=t.ownerElement,a=e.target.shadowRoot?e.composedPath()[0]:e.target;if(a.closest(".ok"))i._editInfo.ok=!0,t.close();else if(a.closest(".cancel"))t.close();else if(a.closest(".add")){const e=a.closest(".container"),t=e.firstElementChild;if(""!==t.value.trim()){const a=document.createElement("div");a.className="thumbnail",a.style.backgroundImage=`url("${t.value}")`,a.title=i.localize("removeImage"),e.parentElement.firstElementChild.appendChild(a),t.value=""}}else if(a.classList.contains("thumbnail"))a.parentElement.removeChild(a);else if(a.classList.contains("toggle-visibility")){const e=i.columns.find(e=>a.parentElement.getAttribute("data-field")===e.dataField);a.classList.toggle("hidden"),i._changedVisibility.set(e,!a.classList.contains("hidden"))}}_expandDataContainer(e){const t=this,i=e.style.height,a=t._cardContentHeight-t._verticalOffset+"px";return e.style.height=a,e.classList.remove("smart-visibility-hidden"),e.previousElementSibling.children[1].classList.remove("collapsed"),i!==a&&(parseFloat(i)||parseFloat(a))?void e.addEventListener("transitionend",t._transitionendHandlerExpand):void t._transitionendHandlerExpand(t,e)}_transitionendHandlerExpand(){let e,t;1===arguments.length?(t=this,e=e=t.closest("smart-card-view")||(t.getRootNode()&&t.getRootNode().host?t.getRootNode().host.closest("smart-card-view"):void 0)):(e=arguments[0],t=arguments[1]),t.removeEventListener("transitionend",e._transitionendHandlerExpand),t.style.height=null,t.parentElement.parentElement.parentElement.classList.remove("collapsed"),e._partialRefresh()}_collapseDataContainer(e){const t=this,i=t._cardContentHeight-t._verticalOffset+"px";e.style.transition="none",requestAnimationFrame(function(){e.style.height=i,e.style.transition=null,requestAnimationFrame(function(){e.style.height="0px",e.classList.add("smart-visibility-hidden"),"0px"==i&&t._transitionendHandlerCollapse(t,e)})}),e.addEventListener("transitionend",t._transitionendHandlerCollapse)}_transitionendHandlerCollapse(){let e,t;1===arguments.length?(t=this,e=t.closest("smart-card-view")||(t.getRootNode()&&t.getRootNode().host?t.getRootNode().host.closest("smart-card-view"):void 0)):(e=arguments[0],t=arguments[1]),t.removeEventListener("transitionend",e._transitionendHandlerCollapse),t.style.height=null,e._partialRefresh()}_getNumberOfCollapsedRows(){const e=this,t=e._visibleSource,a=e._cardsPerRow,i=[],r={};let l=0;for(let o in e._collapsed){const n=t.findIndex?t.findIndex(e=>e.$.id.toString()===o):t.boundSource.findIndex(e=>e.$.id.toString()===o),d=Math.floor(n/a);if(-1!==i.indexOf(d))continue;const s=Math.max(0,d*a);let c=!0;i.push(d);for(let r=0;r<a;r++){const i=t[r+s];if(!i)break;if(!e._collapsed[i.$.id]){c=!1;break}}c&&(r[d]=!0,l++)}e._collapsedRows=r,e._numberOfCollapsedRows=l}_openEditDialog(e){const t=this,i=t._visibleSource,a=i[e],r=t.$.fireEvent("opening",{record:a});if(r.defaultPrevented)return;if(t.setAttribute("modal",""),t.closePanel(),t._changedVisibility=new Map,t._editInfo&&!t._editInfo.updateWindowContent)return void t._updateEditedView(e,!0);const l=document.createDocumentFragment(),o={};if(t.columns.forEach(function(e){const i=e.dataField,r=a?a[i]:"",n=document.createElement("div");let d;if(n.className=`smart-card-view-label${e.icon?" icon "+e.icon:""}`,n.setAttribute("data-field",i),n.innerHTML=`${e.label}<span class="toggle-visibility${!1===e.visible?" hidden":""}${i===t.coverField||i===t.titleField?" smart-hidden":""}" title="${t.localize("toggleVisibility")}" role="button" aria-label="Toggle field visibility"></span>`,l.appendChild(n),e.image)return d=document.createElement("div"),d.className="smart-card-view-editor image",d.setAttribute("aria-label",e.label),d.innerHTML=`<div>${t._updateImgThumbNails(r)}</div>
<div class="label">${t.localize("imageUrl")}</div>
<div class="container" role="presentation">
    <smart-input aria-label="New image URL"></smart-input>
    <smart-button class="add" title=${t.localize("addImage")} aria-label="Add image">+</smart-button>
</div>`,l.appendChild(d),void(o[i]={element:d,type:"image"});const s=t.dataSource.dataFields.find(t=>t.name===e.dataField).dataType;"date"===s?(d=document.createElement("smart-date-time-picker"),d.calendarButton=!0,d.calendarButtonPosition=t.rightToLeft?"left":"right",d.dropDownAppendTo="body",d.dropDownDisplayMode="auto",d.dropDownPosition="bottom",d.locale=t.locale,d.messages=t._innerElementMessages.dateTimePicker,d.nullable=!0,d.value=r||null,e.formatSettings&&e.formatSettings.formatString&&(d.formatString=e.formatSettings.formatString)):"number"===s?(d=document.createElement("smart-numeric-text-box"),d.inputFormat="floatingPoint",d.spinButtons=!0,d.nullable=!0,t.rightToLeft&&(d.spinButtonsPosition="left",d.radixDisplayPosition="right"),d.value=void 0!==r&&null!==r?r:null,e.formatSettings&&e.formatSettings.formatString&&(d.outputFormatString=e.formatSettings.formatString)):"boolean"===s?(d=document.createElement("smart-check-box"),d.checked=r||!1):("string"==typeof r&&50<r.length?(d=document.createElement("textarea"),t.rightToLeft&&d.setAttribute("right-to-left","")):d=document.createElement("smart-input"),d.value=void 0!==r&&null!==r?r.toString():""),d.className="smart-card-view-editor",d.setAttribute("aria-label",e.label),d.animation=t.animation,d.theme=t.theme,d.rightToLeft=t.rightToLeft,l.appendChild(d),o[i]={element:d,type:s}}),t._editInfo&&t._editInfo.updateWindowContent)return t._editInfo.window.clear(),t._editInfo.window.appendChild(l),t._openWindow(),t._editInfo.dataId=e,t._editInfo.editors=o,void delete t._editInfo.updateWindowContent;const n=document.createElement("smart-window"),d=document.createElement("template");d.innerHTML=`<smart-button class="ok primary">${t.localize("ok")}</smart-button>
                                    <smart-button class="cancel">${t.localize("cancel")}</smart-button>`,n.classList.add("smart-card-view-window","smart-visibility-hidden"),n.footerTemplate=d,n.headerButtons=["close","next","prev"],n.label=a?a[t.titleField]:"",n.animation=t.animation,n.rightToLeft=t.rightToLeft,n.theme=t.theme,n.ownerElement=t,n.appendChild(l),document.body.appendChild(n),t._editInfo={dataId:e,editors:o,window:n},t._addWindowHandlers(),n.whenRendered(()=>{t.setAttribute("aria-owns",n.id),n.$.buttonsContainer.firstElementChild.title=t.localize("previousRecord"),n.$.buttonsContainer.children[1].title=t.localize("nextRecord"),t._openWindow()})}_openWindow(){const e=this._editInfo.window,t=document.documentElement.clientWidth,i=document.documentElement.clientHeight,a=window.pageXOffset,r=window.pageYOffset;e.style.top=(i-e.offsetHeight)/2+r+"px",e.style.left=(t-e.offsetWidth)/2+a+"px",e.open()}_addWindowHandlers(){const e=this,t=e._editInfo.window;t.addEventListener("open",e._windowEventHandler),t.addEventListener("closing",e._windowEventHandler),t.addEventListener("close",e._windowEventHandler),t.addEventListener("click",e._windowClickHandler),t.addEventListener("prev",e._prevNextHandler),t.addEventListener("next",e._prevNextHandler)}_windowEventHandler(e){const t=this.ownerElement,i=e.type,a=t.context;if(e.target===this){if(t.context=t,"open"===i)t.$.fireEvent("open");else if("closing"===i){const i=t.$.fireEvent("closing");i.defaultPrevented&&e.preventDefault()}else"close"===i&&(t.$.fireEvent("close"),t._windowCloseHandler(e));t.context=a}}_updateEditedView(e,t){const i=this,a=i._visibleSource[e];a&&a.isEmpty||(i._editInfo.dataId=e,i.columns.forEach(function(e){const t=e.dataField,r=a?a[t]:"",l=i._editInfo.editors[t];"image"===l.type?l.element.firstElementChild.innerHTML=i._updateImgThumbNails(r):"boolean"===l.type?l.element.checked=r||!1:"date"===l.type?l.element.value=r||null:"number"===l.type?l.element.value=r!==void 0&&null!==r?r:null:(l.element instanceof HTMLTextAreaElement&&(i.rightToLeft?l.element.setAttribute("right-to-left",""):l.element.removeAttribute("right-to-left")),l.element.value=r!==void 0&&null!==r?r.toString():""),l.element.rightToLeft=i.rightToLeft}),i._editInfo.window.label=a?a[i.titleField]:"",t&&i._openWindow())}_updateImgThumbNails(e){if(""===e.trim())return"";const t=e.split(",").map(e=>e.trim());let i="";return t.forEach(e=>i+=`<div class="thumbnail" style="background-image: url('${e}');" title="${this.localize("removeImage")}" role="img"></div>`),i}_moveHandler(e){"touchmove"===e.originalEvent.type&&e.originalEvent.preventDefault()}_prevNextHandler(e){const t=this.ownerElement,i=t.context,a=t._editInfo.dataId,r="prev"===e.type?a-1:a+1;t._visibleSource[r]&&!t._visibleSource[r].isEmpty&&(t.context=t,t._saveChanges(),t._updateEditedView(r),t.context=i)}_saveChanges(){const e=this,t=e._editInfo.dataId;let i,a;if(t!==void 0){const r=e._cards.filter(e=>e.dataId===t);i=e._visibleSource[t],a=r[r.length-1]}else i={};e.columns.forEach(function(t){const r=t.dataField,l=e._editInfo.editors[r],o=l.element;if("image"===l.type){const t=[];if(Array.from(l.element.getElementsByClassName("thumbnail")).forEach(e=>{t.push(e.style.backgroundImage.replace(/url\(["'](.+)["']\)/g,"$1"))}),i[r]=t.join(","),a&&r===e.coverField)return void(a.firstElementChild.firstElementChild.dataSource=t)}else i[r]="boolean"===l.type?o.checked:"date"===l.type?o.value?o.value.toDate():null:o.value;if(a)if(r===e.titleField)a.getElementsByClassName("smart-card-view-title")[0].firstElementChild.innerHTML=e._formatValue(i[r],i,t);else if(t.visible){const l=a.querySelector(`[data-field="${r}"] > .smart-card-view-value`);l&&(l.innerHTML=e._formatValue(i[r],i,t))}}),t===void 0&&e.addRecord(null,i)}_close(){const e=this;e.closePanel(),e._editInfo&&e._editInfo.window.close()}_resizeHandler(){const e=this;e._suppressResizeHandler||e.hasAttribute("empty")||e.hasAttribute("no-matches")||(clearTimeout(e._resizeTimeout),e.$.loadingIndicatorContainer.classList.remove("smart-hidden"),e._resizeTimeout=setTimeout(function(){if(e.$.loadingIndicatorContainer.classList.add("smart-hidden"),e._cards.length===e._visibleSource.length){if(e.offsetWidth!==e._cachedWidth){const t=e._cardsPerRow;e._getCardsPerRow(),t!==e._cardsPerRow&&e._getNumberOfCollapsedRows(),e._cachedWidth=e.offsetWidth}else e._cachedHeight=e.offsetHeight;return void(0<e._cards.length&&(e._autoCardHeight&&e._updateCardHeight(null),e.$.scrollViewer.refresh()))}if(e.offsetHeight!==e._cachedHeight&&(e._cachedHeight=e.offsetHeight,20<=Math.abs(e._refreshedAtDimensions.height-e._cachedHeight)?(e._dataSourceProcessed=!0,e._partialRefresh(),delete e._dataSourceProcessed):e.$.scrollViewer.$.verticalScrollBar.max=Math.max(0,e._scrollHeight-e.$.scrollViewer.$.scrollViewerContainer.offsetHeight-e._numberOfCollapsedRows*e._cardContentHeight)),e.offsetWidth!==e._cachedWidth){const t=e._cardsPerRow;e._cachedWidth=e.offsetWidth,e._getCardsPerRow(),t!==e._cardsPerRow&&(e._dataSourceProcessed=!0,e._partialRefresh(),delete e._dataSourceProcessed)}},75))}_windowCloseHandler(){const e=this;return e.removeAttribute("modal"),e._editInfo.ok?(e._updateColumnsVisibility(function(){e._saveChanges()}),void delete e._editInfo.ok):void e._changedVisibility.forEach(function(t,i){i.visible!==t&&e._editInfo.window.querySelector(`[data-field="${i.dataField}"]`).firstElementChild.classList.toggle("hidden")})}_updateColumnsVisibility(e,t){const i=this;let a=!1;i._changedVisibility.forEach(function(r,l){if(!0!==t&&l.visible===r)return;const o=l.dataField;l.visible=r,r?(i._cardContent=i._cardContent.replace(`class="smart-card-view-cell smart-hidden" data-field="${o}"`,`class="smart-card-view-cell" data-field="${o}"`),!e&&i._editInfo&&i._editInfo.window.querySelector(`[data-field="${o}"]`).firstElementChild.classList.remove("hidden")):(i._cardContent=i._cardContent.replace(`class="smart-card-view-cell" data-field="${o}"`,`class="smart-card-view-cell smart-hidden" data-field="${o}"`),!e&&i._editInfo&&i._editInfo.window.querySelector(`[data-field="${o}"]`).firstElementChild.classList.add("hidden")),i._cards.forEach(e=>{const t=e.querySelector(`[data-field="${o}"]`);if(t.classList.toggle("smart-hidden"),r){const a=i._visibleSource[e.dataId];t.children[1].innerHTML=i._formatValue(a[o],a,l)}}),a=!0}),e&&e(),i._autoCardHeight&&a&&i._updateCardHeight(null)}_applyHandler(e){const t=this,i=e.target,a=e.detail,r=t.$.customize,l=t.columns;if(r.contains(i)){const e=r.getElementsByTagName("smart-switch-button")[0],i=r.getElementsByTagName("smart-input")[0],o=e.checked?"fit":"crop";let n=l.find(e=>e.label===i.value)||null,d=!1;o!==t.coverMode&&(t.coverMode=o),n&&(n=n.dataField),n!==t.coverField&&(t.coverField=n,d=!0),d||a.positionChanged?(a.positionChanged&&(t.columns=a.value),t._createTemplate(),t._fullRefresh(),a.positionChanged&&t._editInfo&&(t._editInfo.updateWindowContent=!0)):(a.value.forEach(e=>{const i=l.find(t=>t.dataField===e.dataField);i.visible!==e.visible&&t._changedVisibility.set(i,e.visible)}),t._updateColumnsVisibility())}else t.$.filter.contains(i)?t.addFilter(a.filters,a.operator,a.value):t.$.sort.contains(i)&&t.addSort(a.sortByInfo);t.closePanel()}_fullRefresh(e=!0){const t=this,i=t.$.cardContainer;let a;for(e&&(a=t._getFractionOfMax()),t._suppressResizeHandler=!0;i.firstChild;)i.removeChild(i.firstChild);t._cards=[],t._createCards(),0===t._visibleSource.length&&t.$.scrollViewer.refresh(),t._setFractionOfMax(a)}_normalizeDataSource(){function e(){if(0===t.columns.length)return t.addNewButton=!1,[];const e=[];return t.columns.forEach(t=>{try{e.push({name:t.dataField||t.label||t,dataType:"string"})}catch(e){}}),e}const t=this;let a=t.dataSource;if(a instanceof Smart.DataAdapter)return void(0===a.dataFields.length&&(a.dataFields=e()));if(!a)a=[];else if(!Array.isArray(a))if("object"==typeof a&&0<Object.keys(a).length)a=[a];else return void t.error(t.localize("incorrectStructure"));let r=[];if(0===a.length)r=e();else{let t=0,i=a[t],l=Object.keys(i);for(;i&&0===l.length;)t++,i=a[t],l=Object.keys(i);0===l.length?r=e():l.forEach(e=>{const t=i[e];let a;a=t.constructor===Date?"date":"boolean"==typeof t?"boolean":isNaN(t)||null===t||""===t?"string":"number",r.push(`${e}: ${a}`)})}t.dataSource=new Smart.DataAdapter({dataSource:a,dataFields:r})}_normalizeColumns(){const e=this,t=e.columns,i=e.dataSource.dataFields,a=[];(Array.isArray(t)||t instanceof Smart.ObservableArray)&&(t.forEach(t=>{let r,l,o,n,d,s,c,h;"object"==typeof t?(r=t.dataField,l=t.formatFunction,o=t.formatSettings,n=t.icon,d=t.image||!1,s=t.label||r,c=t.template,h=r===e.titleField||r===e.coverField||!(t.visible!==void 0)||t.visible):"string"==typeof t&&(r=t,d=!1,s=r,h=!0),i.find(e=>e.name===r)&&a.push({dataField:r,formatFunction:l,formatSettings:o,icon:n,image:d,label:s,template:c,visible:h})}),0===a.length&&i.forEach(e=>{a.push({dataField:e.name,image:!1,label:e.name,visible:!0})}),!a.find(t=>t.dataField===e.titleField)&&(e.titleField=null),!a.find(t=>t.dataField===e.coverField&&t.image)&&(e.coverField=null),e.columns=new Smart.ObservableArray(a),e.columns.canNotify=!0,e.columns.notify(function(t){if(e.context!==e&&t.newValue!==t.oldValue){if(e._close(),"update"===t.action){const i=t.target;switch(t.propertyName){case"dataField":e._updateColumns();break;case"formatFunction":case"formatSettings":case"template":e._createTemplate(),e._fullRefresh();break;case"icon":case"label":i.dataField!==e.coverField&&i.dataField!==e.titleField&&(e._createTemplate(),e._fullRefresh());break;case"image":t.newValue||e.coverField!==i.dataField?(e._createTemplate(),e._fullRefresh()):(e.coverField=null,e.propertyChangedHandler("coverField",i.dataField,null));break;case"visible":{const a=i.dataField;if(!t.newValue&&(a===e.coverField||a===e.titleField))return void(i.visible=!0);e._toggleColumn(a,t.newValue,!0);break}}}else e._updateColumns();e._editInfo&&(e._editInfo.updateWindowContent=!0)}}),e._editInfo&&(e._editInfo.updateWindowContent=!0))}_handleHeaderPosition(){const e=this,t=e.headerPosition,i=e.$.header;return"none"===t?void e.$header.addClass("smart-hidden"):void(e.$header.removeClass("smart-hidden"),"top"===t&&i.nextElementSibling!==e.$.scrollViewer?e.$.container.insertBefore(i,e.$.scrollViewer):"bottom"===t&&i.previousElementSibling!==e.$.scrollViewer&&e.$.container.insertBefore(i,e.$.loadingIndicatorContainer))}_localizeHeader(){const e=this;e.$.customizeCardsButton.firstElementChild.innerHTML=e.localize("customizeCards"),e.$.filterButton.firstElementChild.innerHTML=0===e._appliedFiltering.filters.length?e.localize("filter"):1===e._appliedFiltering.filters.length?e.localize("filteredByOne"):e.localize("filteredByMultiple",{n:e._appliedFiltering.filters.length}),e.$.sortButton.firstElementChild.innerHTML=0===e._appliedSorting.dataFields.length?e.localize("sort"):1===e._appliedSorting.dataFields.length?e.localize("sortedByOne"):e.localize("sortedByMultiple",{n:e._appliedSorting.dataFields.length}),e.$.searchInput.placeholder=e.localize("findInView"),e.$.cardContainer.setAttribute("no-data",e.localize("noData")),e.$.cardContainer.setAttribute("no-matches",e.localize("noMatches"))}_getInnerElementMessages(){const e=this,t=e.locale,i={};i.columnPanel={},i.multiColumnFilterPanel={},i.sortPanel={},i.dateTimePicker={},i.columnPanel[t]={apply:e.localize("apply"),cancel:e.localize("cancel"),find:e.localize("find"),noResults:e.localize("noResults")},i.multiColumnFilterPanel[t]={addFilter:e.localize("addFilter"),and:e.localize("and"),apply:e.localize("apply"),cancel:e.localize("cancel"),CONTAINS:e.localize("CONTAINS"),CONTAINS_CASE_SENSITIVE:e.localize("CONTAINS_CASE_SENSITIVE"),DOES_NOT_CONTAIN:e.localize("DOES_NOT_CONTAIN"),DOES_NOT_CONTAIN_CASE_SENSITIVE:e.localize("DOES_NOT_CONTAIN_CASE_SENSITIVE"),EMPTY:e.localize("EMPTY"),ENDS_WITH:e.localize("ENDS_WITH"),ENDS_WITH_CASE_SENSITIVE:e.localize("ENDS_WITH_CASE_SENSITIVE"),EQUAL:e.localize("EQUAL"),EQUAL_CASE_SENSITIVE:e.localize("EQUAL_CASE_SENSITIVE"),GREATER_THAN:e.localize("GREATER_THAN"),GREATER_THAN_OR_EQUAL:e.localize("GREATER_THAN_OR_EQUAL"),LESS_THAN:e.localize("LESS_THAN"),LESS_THAN_OR_EQUAL:e.localize("LESS_THAN_OR_EQUAL"),noFilters:e.localize("noFilters"),NOT_EMPTY:e.localize("NOT_EMPTY"),NOT_EQUAL:e.localize("NOT_EQUAL"),NOT_NULL:e.localize("NOT_NULL"),NULL:e.localize("NULL"),or:e.localize("or"),STARTS_WITH:e.localize("STARTS_WITH"),STARTS_WITH_CASE_SENSITIVE:e.localize("STARTS_WITH_CASE_SENSITIVE"),where:e.localize("where")},i.sortPanel[t]={apply:e.localize("apply"),booleanFirst:e.localize("booleanFirst"),booleanLast:e.localize("booleanLast"),cancel:e.localize("cancel"),dateFirst:e.localize("dateFirst"),dateLast:e.localize("dateLast"),firstBy:e.localize("firstBy"),from:e.localize("from"),numberFirst:e.localize("numberFirst"),numberLast:e.localize("numberLast"),noSorting:e.localize("noSorting"),pickAnother:e.localize("pickAnother"),stringFirst:e.localize("stringFirst"),stringLast:e.localize("stringLast"),thenBy:e.localize("thenBy")},i.dateTimePicker[t]={now:e.localize("now"),dateTabLabel:e.localize("dateTabLabel"),timeTabLabel:e.localize("timeTabLabel")},e._innerElementMessages=i}_headerClickHandler(e){function t(e,t,r){a.classList.contains("smart-visibility-hidden")||t.classList.contains("smart-hidden")?(a.controlledBy&&(a.controlledBy.removeAttribute("aria-controls"),a.controlledBy.setAttribute("aria-expanded",!1)),a.controlledBy=e,e.setAttribute("aria-controls",a.id),e.setAttribute("aria-expanded",!0),i[r]()):i.closePanel()}const i=this,a=i.$.headerDropDown,r=i.isInShadowDOM||i.shadowRoot?e.composedPath()[0]:e.target;if(i.$.customizeCardsButton.contains(r))t(i.$.customizeCardsButton,i.$.customize,"openCustomizePanel");else if(i.$.filterButton.contains(r))t(i.$.filterButton,i.$.filter,"openFilterPanel");else if(i.$.sortButton.contains(r))t(i.$.sortButton,i.$.sort,"openSortPanel");else if(r===i.$.searchButton)t(r,i.$.search,"_openSearchPanel");else if(r===i.$.searchClose)i.closePanel();else if(r===i.$.searchPrev||r===i.$.searchNext){const e=i._searchInfo,t=e.foundIdsArray,a=r===i.$.searchNext,l=t.length;let o;if(e.highlighted===void 0)o=a?0:l-1;else if(1===t.length)return;else{const r=t.indexOf(e.highlighted),n=Array.from(i.$.cardContainer.getElementsByClassName("highlighted"));n.forEach(e=>e.classList.remove("highlighted")),o=a?(r+1)%l:0<=r-1?r-1:l-1}e.highlighted=t[o];const n=i.ensureVisible(e.highlighted);n.classList.add("highlighted"),i.$.searchLabel.innerHTML=i.localize("found",{nth:o+1,n:t.length})}}_openSearchPanel(){const e=this;let t;if(e.$.headerDropDown.classList.add("search-panel"),e.$.headerDropDown.classList.remove("customize-panel","filter-panel","sort-panel"),e.$.search.classList.remove("smart-hidden"),e.$.customize.classList.add("smart-hidden"),e.$.filter.classList.add("smart-hidden"),e.$.sort.classList.add("smart-hidden"),e._openHeaderDropDown(e.$.searchButton),Array.isArray(e._visibleSource))t=new Smart.DataAdapter({dataSource:e._visibleSource,dataFields:e.dataSource.dataFields,id:"_id"});else{const i=e._appliedSorting;t=new Smart.DataAdapter({dataSource:e._visibleSource._dataSource,dataFields:e.dataSource.dataFields,id:e._visibleSource.id||void 0}),0<i.dataFields.length&&t.sortBy(i.dataFields,i.dataTypes,i.orderBy)}e._searchInfo={source:t,stringDataFields:e.dataSource.dataFields.filter(t=>"string"===t.dataType&&e.columns.find(e=>e.dataField===t.name&&!e.image)).map(e=>e.name)},""!==e.$.searchInput.value&&e._search(e.$.searchInput.value,!1)}_openHeaderDropDown(e){const t=this,i=t.$.headerDropDown;"top"===t.headerPosition?(i.style.bottom=null,i.style.top="100%"):(i.style.top=null,i.style.bottom="100%"),i.style.left=e===t.$.searchButton?(t.rightToLeft?e.offsetLeft:e.offsetLeft+e.offsetWidth-i.offsetWidth)+"px":e.offsetLeft-(t.rightToLeft?i.offsetWidth-e.offsetWidth:0)+"px",i.classList.remove("smart-visibility-hidden")}_createTemplate(){const e=this,t=e.titleField;let i="";i+=t?`<div class="smart-card-view-title" data-field="${t}" role="heading" aria-level="1"><div>{{${t}}}</div><div class="smart-arrow-up" role="button" aria-label="Toggle card"></div></div>`:"<div class=\"smart-card-view-title empty\" role=\"heading\" aria-level=\"1\"><div>&nbsp;</div><div class=\"smart-arrow-up\" role=\"button\" aria-label=\"Toggle card\"></div></div>",i+="<div class=\"smart-card-view-content\" role=\"grid\">",e.columns.forEach(a=>{const r=a.dataField;!1!==a.visible&&(a.visible=!0);r===t||r===e.coverField||(i+=`<div class="smart-card-view-cell${a.visible?"":" smart-hidden"}" data-field="${r}" role="row"><div class="smart-card-view-label${a.icon?" icon "+a.icon:""}" role="rowheader">${a.label}</div>
<div class="smart-card-view-value" role="gridcell">{{${r}}}</div></div>`)}),i+="</div>",e._cardContent=i}_requestInitialCards(){const e=this;e.setAttribute("loading",""),e.$.loadingIndicatorContainer.classList.remove("smart-hidden"),e.dataSource.onVirtualDataSourceRequested(function(){e._createCards(),e.removeAttribute("loading"),e.$.loadingIndicatorContainer.classList.add("smart-hidden")},{first:1/0,last:1/0,sorting:[],filtering:[],grouping:[],action:""})}_createCards(){var e=Math.max;const t=this,a=t._visibleSource;if(!a||0===a.length)return;const i=t.scrolling,r="virtual"===i,l=t.$.scrollViewer.$.scrollViewerContainer.offsetHeight;let o,n=a.length,d=1,s=0,c=0;t._ignoreVerticalChange=!0,t.removeAttribute("empty"),r&&t.setAttribute("loading","");for(let r=0;r<n;r++){const i=t._createCard(a[r],r);if(t._cards.push(i),t.$.cardContainer.appendChild(i),t.$.scrollViewer.refresh(),t._autoCardHeight&&(c=e(i.offsetHeight,c)),i.offsetTop>s&&(d++,s=i.offsetTop,!o&&(t._getCardsPerRow(),o=t._cardsPerRow)),3<=d&&0==t._cards.length%o&&t.$.cardContainer.offsetHeight>l+2*(t.cardHeight||c)&&t._cards.length+5<n)break}if(o=o||t._cards.length,"infinite"===i)for(;0!=t._cards.length%o;)t._createEmptyCard();t._autoCardHeight&&(t._cardHeight=c,t._cards.forEach(e=>e.style.height=c+"px")),t._cardContentHeight=t._cards[0].getElementsByClassName("smart-card-view-content")[0].offsetHeight+t._verticalOffset,t._cards.forEach(e=>t._toggleCard(e,e.firstElementChild.lastElementChild,t._visibleSource[e.dataId].$.id));const h=Math.ceil(n/o),m=(t._cardHeight+t._gap)*h-t._gap;t.$.scrollViewer.$.scrollViewerContentContainer.style.top=0,t.$.scrollViewer.$.verticalScrollBar.max=e(0,m-l-t._numberOfCollapsedRows*t._cardContentHeight),t._cardsPerRow=o,t._scrollHeight=m,t._refreshedAtDimensions={width:t._cachedWidth,height:t._cachedHeight},t._getNumberOfCollapsedRows(),delete t._ignoreVerticalChange,delete t._suppressResizeHandler,r&&(t.$.loadingIndicatorContainer.classList.remove("smart-hidden"),t.dataSource.onVirtualDataSourceRequested(t._virtualDataSourceRequestedCallback.bind(t,0,0,!0),{first:0,last:t._cards.length,sorting:[],filtering:[],grouping:[],action:""}))}_virtualDataSourceRequestedCallback(e,t,i){const a=this;if(a._ignoreVerticalChange=!0,a.$.loadingIndicatorContainer.classList.add("smart-hidden"),a._updateVisibleCards(e,t,i),a.removeAttribute("loading"),delete a._ignoreVerticalChange,a._beginEditOnLoad){const e=a._cards.filter(e=>e.dataId===a._beginEditOnLoad),t=e[e.length-1];t&&a._openEditDialog(t.dataId),delete a._beginEditOnLoad}}_createCard(e={},t){const i=this,a=i.coverField,r=i._visibleSource,l=document.createElement("smart-card"),o=document.createElement("div");if(requestAnimationFrame(()=>l.hasStyleObserver=!1),l.setAttribute("aria-setsize",r.length),l.setAttribute("aria-posinset",t+1),l.dataId=t,l.whenRendered(function(){l.setAttribute("role","listitem"),l.firstElementChild.onscroll=function(){const e=r[this.parentElement.dataId].$.id;i._cardScrolling[e]=this.scrollTop}}),i._autoCardHeight||(l.style.height=i._cardHeight+"px"),o.className="smart-card-data-container",o.setAttribute("role","presentation"),i._applyTemplate(e,l,o,!0),a){const t=document.createElement("smart-carousel");let o=e[a];i.shadowRoot&&(t._isInShadowDOM=!0),o="string"==typeof o?o.split(",").map(e=>e.trim()):[],t.dataSource=o,t.hideArrows=!0,t.unfocusable=!0,t.animation=i.animation,t.theme=i.theme,t.rightToLeft=i.rightToLeft,t.onIndexChange=function(e){i._cardSelectedCover[r[l.dataId].$.id]=e},t.whenReady(function(){t.hasStyleObserver=!1,t.$.arrowLeft.hasStyleObserver=!1,t.$.arrowRight.hasStyleObserver=!1}),l.appendChild(t)}return l.appendChild(o),l}_toggleCard(e,t,i){const a=this;e.setAttribute("updating",""),a._collapsed[i]?(e.classList.add("collapsed"),t.firstElementChild.children[1].classList.add("collapsed"),t.children[1].classList.add("smart-visibility-hidden")):(e.classList.remove("collapsed"),t.firstElementChild.children[1].classList.remove("collapsed"),t.children[1].classList.remove("smart-visibility-hidden")),setTimeout(function(){e.removeAttribute("updating")},100)}_createEmptyCard(e=!0){const t=this,i=t._createCard({});e&&i.classList.add("smart-hidden"),i.style.height=t._cardHeight+"px",t._cards.push(i),t.$.cardContainer.appendChild(i)}_applyTemplate(e,t,a,i){const r=this,l=r.columns,o=r.titleField;if(i){let n=r._cardContent;for(let t=0;t<l.length;t++){const i=l[t];if(!i.visible)continue;const a=i.dataField,o=new RegExp(`{{${a}}}`,"g"),d=r._formatValue(e[a],e,i);n=n.replace(o,d)}if(a.innerHTML=n.replace(/{{\w+}}/g,""),o){const i=r.id+"Title"+(e?e.$.id:"Empty"+Math.floor(1e3*Math.random()));a.firstElementChild.firstElementChild.id=i,t.setAttribute("aria-labelledby",i)}return}for(let n=0;n<l.length;n++){const t=l[n];if(!t.visible)continue;const i=t.dataField,d=a.querySelector(`[data-field="${i}"]`);if(d){const a=r._formatValue(e[i],e,t);i===o?d.firstElementChild.innerHTML=a:d.children[1].innerHTML=a}}}_formatValue(e,t,i){const a=this;if(0===Object.keys(t).length)return"";const r={column:i,record:t,template:i.template,value:e};if(i.formatFunction&&i.formatFunction(r),e=r.value,r.template)return a._applyCellTemplate(r.template,e,t,i);if(i.formatSettings){let t="";return i.formatSettings.prefix&&(t+=i.formatSettings.prefix),i.formatSettings.formatString&&void 0!==e&&null!==e&&(e.constructor===Date?e=new Smart.Utilities.DateTime(e).toString(i.formatSettings.formatString):e instanceof Smart.Utilities.DateTime?e=e.toString(i.formatSettings.formatString):!isNaN(e)&&a._numericFormatter&&(e=a._numericFormatter.formatNumber(e,i.formatSettings.formatString))),t+=e,i.formatSettings.sufix&&(t+=i.formatSettings.sufix),t}return e}_applyCellTemplate(e,t="",i,a){let r="";if("function"==typeof e){const r={column:a,record:i,template:null,value:t};if(e(r),t=r.value,null===r.template)return t;e=r.template}if(e.startsWith("#")){const a=document.querySelector(e);if(a&&a instanceof HTMLTemplateElement){const e=a.content.cloneNode(!0),l=document.createElement("div");return l.appendChild(e),t=t.toString(),t=t.replace(/'/ig,"\\'"),t=t.replace(/"/ig,"\\\""),r=l.innerHTML.replace(/{{value}}/ig,t).replace(/{{id}}/ig,i.$.id),0<=r.indexOf("{{value=")&&(t?(r=r.substring(0,r.indexOf("{{value="))+t+r.substring(r.indexOf("}")),r=r.replace(/}/ig,""),r=r.replace(/{/ig,"")):(r=r.replace(/{{value=/ig,""),r=r.replace(/}}/ig,""))),r}}return r=e.replace(/{{value}}/ig,t).replace(/{{id}}/ig,i.$.id),r}_getCardsPerRow(){const e=this,t=e._cards;if(0===t.length)return void(e._cardsPerRow=0);let a=t[0].offsetTop,r=1;for(let e=1;e<t.length&&!(t[e].offsetTop>a);e++)r++;e._cardsPerRow=r}_onVerticalChange(e){var t=Math.floor;const a=this;if(a._ignoreVerticalChange)return;const r=a._visibleSource,i=a.scrolling,l=a._cardHeight+a._gap,o=a._cardsPerRow;let n=e.detail.value;if(a._cards.length===r.length){const e=t(n/l)*o;return a._start={view:e,data:e},a._dataSourceProcessed&&a._refreshCardContent(),a.$.scrollViewer.$.scrollViewerContentContainer.style.top=-n+"px",void("infinite"===i&&a.$.scrollViewer.$.verticalScrollBar.value===a.$.scrollViewer.$.verticalScrollBar.max&&a._onScrollBottomReached(e,e))}let d,s;if(clearTimeout(a._scrollingTimeout),0<a._numberOfCollapsedRows){const e=t((r.length-1)/o)+1;let i,c=0;d=o;for(let t=0;t<e;t++){const e=t,r=c;if(c+=a._collapsedRows[e]?l-a._cardContentHeight:l,null==s&&n<=c){s=e*o,i=n-r;break}}n=i+l}else{for(n=n%(2*l)+l,n<l&&(n+=l);n+a.$.scrollViewer.$.scrollViewerContainer.offsetHeight>a.$.cardContainer.offsetHeight;)n-=l;d=t(n/l)*o,s=t(e.detail.value/l)*o,0>d&&(s-=d,d=0)}const c=Math.min(s+a._cards.length-d-1,r.length-1);if("virtual"===i&&(r[s].isEmpty||r[c].isEmpty)){const e=c-s;let t,l;for(let e=s;e<=c;e++)if(r[e].isEmpty){t=e,l=t;break}for(;r[l+1]&&r[l+1].isEmpty&&l-t<e;)l++;return a.setAttribute("loading",""),a.$.loadingIndicatorContainer.classList.remove("smart-hidden"),a.$.scrollViewer.$.scrollViewerContentContainer.style.top=-n+"px",void(a._scrollingTimeout=setTimeout(function(){a.dataSource.onVirtualDataSourceRequested(a._virtualDataSourceRequestedCallback.bind(a,d,s),{first:t,last:l,sorting:[],filtering:[],grouping:[],action:""})},300))}a.$.scrollViewer.$.scrollViewerContentContainer.style.top=-n+"px",a._updateVisibleCards(d,s),"virtual"===i?(a.removeAttribute("loading"),a.$.loadingIndicatorContainer.classList.add("smart-hidden")):"infinite"===i&&a.$.scrollViewer.$.verticalScrollBar.value===a.$.scrollViewer.$.verticalScrollBar.max&&a._onScrollBottomReached(d,s)}_onScrollBottomReached(e,t){const i=this;i.$.loadingIndicatorContainer.classList.remove("smart-hidden"),i.dataSource.onVirtualDataSourceRequested(function(){i._updateVisibleCards(e,t);const a=Math.ceil(i._visibleSource.length/i._cardsPerRow),r=(i._cardHeight+i._gap)*a-i._gap,l=i.$.scrollViewer.$.scrollViewerContainer.offsetHeight;i.$.scrollViewer.$.verticalScrollBar.max=Math.max(0,r-l-i._numberOfCollapsedRows*i._cardContentHeight),i._scrollHeight=r,i.$.loadingIndicatorContainer.classList.add("smart-hidden")},{first:1/0,last:1/0,sorting:[],filtering:[],grouping:[],action:""})}_updateVisibleCards(e,t,a){const r=this,l=r._visibleSource.length;for(let l=0;l<e;l++){const e=r._cards[l];e.setAttribute("aria-hidden",!0),e.classList.contains("collapsed")&&r._toggleCard(e,e.firstElementChild.lastElementChild)}for(let o=e;o<r._cards.length;o++){const i=r._cards[o],n=t-e+o;i.removeAttribute("aria-hidden"),n<r._visibleSource.length?(i.classList.remove("smart-hidden"),i.setAttribute("aria-setsize",l),i.setAttribute("aria-posinset",n+1),(i.dataId!==n||a||r._dataSourceProcessed)&&r._updateVirtualCard(i,n)):i.classList.add("smart-hidden")}r._start={view:e,data:t}}_toggleColumn(e,t,i){const a=this,r=a._visibleSource;if(e&&"string"==typeof e&&e!==a.coverField&&e!==a.titleField&&r&&0!==r.length){const r=a.columns.find(t=>t.dataField===e);r&&(a._close(),a._changedVisibility=new Map,a._changedVisibility.set(r,t),a._updateColumnsVisibility(void 0,i))}}_updateVirtualCard(e,t){const i=this,a=i._visibleSource[t],r=a.$.id,l=e.firstElementChild.lastElementChild,o=i.coverField;if(e.dataId=t,i._applyTemplate(a,e,l),e.firstElementChild.scrollTop=i._cardScrolling[r]||0,i._dragDetails&&(e.dataId===i._dragDetails.index?e.classList.add("dragged"):e.classList.remove("dragged")),i._searchInfo&&(i._searchInfo.foundIdsObject[r]?(e.classList.add("found"),i._searchInfo.highlighted===r?e.classList.add("highlighted"):e.classList.remove("highlighted")):e.classList.remove("found","highlighted")),i._toggleCard(e,l,r),o){const t=e.firstElementChild.firstElementChild;let l=a[o];if(l="string"==typeof l?l.split(",").map(e=>e.trim()):[],t.set("dataSource",l),0<l.length){const e=i._cardSelectedCover[r]||0;t._generateIndicators(),t._indicators[e].classList.add("smart-active"),t._generateItems(),t._items[e].classList.add("smart-active"),t._currentIndex=e}}}_updateCardHeight(e){const t=this,i=t._cards;if(null===e){let e=0,a=[];if(t._autoCardHeight=!0,0===t._cards.length)return;if(i.forEach(e=>{e.style.height=null,e.classList.contains("collapsed")&&(e.setAttribute("updating",""),e.classList.remove("collapsed"),e.getElementsByClassName("smart-card-view-content")[0].classList.remove("smart-visibility-hidden"),a.push(e))}),i.forEach(t=>e=Math.max(t.offsetHeight,e)),i.forEach(t=>t.style.height=e+"px"),t._cardContentHeight=t._cards[0].getElementsByClassName("smart-card-view-content")[0].offsetHeight+t._verticalOffset,0<a.length&&(a.forEach(e=>{e.classList.add("collapsed"),e.getElementsByClassName("smart-card-view-content")[0].classList.add("smart-visibility-hidden")}),setTimeout(function(){a.forEach(e=>e.removeAttribute("updating"))},100)),t._cardHeight===e)return;t._cardHeight=e}else{const a=t._cards[0];let r;if(t._autoCardHeight=!1,t._cardHeight===e)return;if(t._cardHeight=e,!a)return;i.forEach(t=>t.style.height=e+"px"),a.classList.contains("collapsed")&&(a.setAttribute("updating",""),a.classList.remove("collapsed"),a.getElementsByClassName("smart-card-view-content")[0].classList.remove("smart-visibility-hidden"),r=!0),t._cardContentHeight=t._cards[0].getElementsByClassName("smart-card-view-content")[0].offsetHeight+t._verticalOffset,r&&(a.classList.add("collapsed"),a.getElementsByClassName("smart-card-view-content")[0].classList.add("smart-visibility-hidden"),setTimeout(function(){a.removeAttribute("updating")},100))}t._partialRefresh()}_partialRefresh(){function e(){let e=(i+2*a)/a*l;for(e=e-e%l+l;0<r&&e*(a-t._cardContentHeight)<i+2*a;)e++;for(e=Math.min(e,t._visibleSource.length);t._cards.length<e;)t._createEmptyCard(!1);for(;t._cards.length>e;)t._cards[t._cards.length-1].remove(),t._cards.pop();for(;"infinite"===t.scrolling&&0!=t._cards.length%l;)t._createEmptyCard()}const t=this;if(t._refreshedAtDimensions={width:t._cachedWidth,height:t._cachedHeight},t._cards.length===t._visibleSource.length)return t._dataSourceProcessed&&t._refreshCardContent(),void t.$.scrollViewer.refresh();t._getCardsPerRow();const i=t.$.scrollViewer.$.scrollViewerContainer.offsetHeight,a=t._cardHeight+t._gap,r=Object.keys(t._collapsed).length;let l=t._cardsPerRow;e(),t._getCardsPerRow(),l!==t._cardsPerRow&&(l=t._cardsPerRow,e()),t._getNumberOfCollapsedRows();const o=t._getFractionOfMax(),n=Math.ceil(t._visibleSource.length/t._cardsPerRow),d=a*n-t._gap,s=Math.max(0,d-i-t._numberOfCollapsedRows*t._cardContentHeight);t.$.scrollViewer.$.verticalScrollBar.max=s,t._scrollHeight=d,0===s&&t.$.scrollViewer.refresh(),t._setFractionOfMax(o)}_getFractionOfMax(){const e=this.$.scrollViewer.$.verticalScrollBar,t=e.max;return 0===t?0:e.value/e.max}_setFractionOfMax(e){const t=this,i=this.$.scrollViewer.$.verticalScrollBar,a=i.max*e;i.value=a,t._onVerticalChange({detail:{value:a}})}_refreshCardContent(){const e=this;e._updateVisibleCards(e._start.view,e._start.data,!0)}_getVisibleRecords(){const e=this,t=e.dataSource;if(0===e._appliedFiltering.filters.length)e._visibleSource=t;else{e._visibleSource=[];for(let a=0;a<t.length;a++){const t=e.dataSource[a];!1!==t.$.filtered&&(e._visibleSource.push(t),e._visibleSource[e._visibleSource.length-1]._id=t.$.id)}}t&&0!==t.length?(e.removeAttribute("empty"),0===e._visibleSource.length?e.setAttribute("no-matches",""):e.removeAttribute("no-matches")):(e.setAttribute("empty",""),e.removeAttribute("no-matches"))}_clearFilterAndSortUI(){const e=this;e._appliedFiltering={filters:[],operator:"and"},e._appliedSorting={dataFields:[],dataTypes:[],orderBy:[]},e.$.filterButton.classList.remove("filtered"),e.$.sortButton.classList.remove("sorted"),e.$.filterButton.firstElementChild.innerHTML=e.localize("filter"),e.$.sortButton.firstElementChild.innerHTML=e.localize("sort")}_search(e,t=!0){const i=this;if(i._searchInfo.query=e,i._cards.forEach(e=>e.classList.remove("found","highlighted")),""===e)return i.$.search.classList.remove("matches","no-matches"),delete i._searchInfo.foundIdsArray,delete i._searchInfo.foundIdsObject,void delete i._searchInfo.highlighted;const a=i._searchInfo.source,r=[],l=[],o={};i._searchInfo.stringDataFields.forEach(t=>{const i=new Smart.Utilities.FilterGroup,a=i.createFilter("string",e,"CONTAINS");i.addFilter("or",a),r.push([t,i])}),a._filter(r,"or");for(let r=0;r<a.length;r++){const e=a[r];!1!==e.$.filtered&&(l.push(e.$.id),o[e.$.id]=!0)}let n=l[0];return i._searchInfo.foundIdsArray=l,i._searchInfo.foundIdsObject=o,0<l.length?(t&&(i._searchInfo.highlighted=n,i.ensureVisible(n)),i._cards.forEach(e=>{const a=i._visibleSource[e.dataId].$.id;o[a]&&(t&&n===a&&e.classList.add("highlighted"),e.classList.add("found"))}),i.$.search.classList.remove("no-matches"),i.$.search.classList.add("matches"),void(i.$.searchLabel.innerHTML=i.localize("found",{nth:t?1:0,n:l.length}))):void(i.$.search.classList.remove("matches"),i.$.search.classList.add("no-matches"),i.$.searchLabel.innerHTML=i.localize("found",{nth:0,n:0}))}_closeSearchPanel(){const e=this;e._searchInfo&&(e._cards.forEach(e=>e.classList.remove("found","highlighted")),delete e._searchInfo)}_searchInputKeyupHandler(){const e=this;clearTimeout(e._searchInputTimeout),e._searchInputTimeout=setTimeout(function(){e.$.searchInput.value!==e._searchInfo.query&&e._search(e.$.searchInput.value)},500)}_headerDropDownTransitionendHandler(e){const t=this;"visibility"===e.propertyName&&t.$.headerDropDown.classList.contains("search-panel")&&!t.$.headerDropDown.classList.contains("smart-visibility-hidden")&&t.$.searchInput.focus()}_cardContainerDownHandler(e){const t=this;if(delete t._clickToDrag,t.allowDrag&&(t._isMobile||0===e.button)){const i=e.originalEvent.target;if(i.closest(".smart-indicator")||i.closest(".smart-arrow-up"))return void(t._isMobile&&(t.$.scrollViewer._scrollView.disableSwipeScroll=!0));const a=e.originalEvent.target.closest("smart-card");a&&(t._dragDetails={card:a,coords:{x:e.pageX,y:e.pageY},index:a.dataId,originalEvent:e,record:t._visibleSource[a.dataId],startTime:new Date},t.$.scrollViewer._scrollView.disableSwipeScroll=!0,window.getSelection().removeAllRanges())}}_documentMoveHandler(e){var t=Math.abs,i=Math.min;const a=this,r=a._dragDetails;if(!r)return;if(!r.feedbackShown){const i=new Date,l=500<i.getTime()-r.startTime.getTime(),o=5<t(r.coords.x-e.pageX)||5<t(r.coords.y-e.pageY);if(o&&(!a._isMobile||a._isMobile&&l)){const t=a._startDragging(e);if(!t)return}else return void(a._isMobile&&o&&!l&&(delete a._dragDetails,a.$.scrollViewer._scrollView.disableSwipeScroll=!1))}const l=r.card,o=r.record,n=e.clientY,d=e.clientX;let s=e.originalEvent.target;if(a.$.fireEvent("dragging",{card:l,originalEvent:e,record:o}),r.feedback.style.left=e.pageX+10+"px",r.feedback.style.top=e.pageY+10+"px",a._isMobile){const e=document.elementFromPoint(d,n);e&&(s=e)}clearInterval(a._dragInterval),a._dragInterval=setInterval(function(){const e=a.$.scrollViewer.getBoundingClientRect();0<a.$.scrollViewer.scrollHeight&&e.left<=d&&e.left+e.width>=d?n>=e.top&&n<=e.top+36?a.$.scrollViewer.scrollTop-=a._autoScrollCoefficient:n>=e.top+e.height-36&&n<=e.top+e.height?a.$.scrollViewer.scrollTop+=a._autoScrollCoefficient:clearInterval(a._dragInterval):clearInterval(a._dragInterval)},2);let c,h=s.closest("smart-card");if(r.hoveredCard&&(r.hoveredCard.classList.remove("drop-target","left","right"),delete r.hoveredCard),!(h&&h.dataId===r.index)){if(h){const e=h.getBoundingClientRect(),i=t(d-e.left),a=t(d-e.right);c=i<a?"left":"right"}else if(s===a.$.addNewButton)return;else{let e,l;if(a._cards.forEach(a=>{var r=Math.pow;const o=a.getBoundingClientRect(),s=t(n-o.top),h=t(n-o.bottom),m=i(s,h),g=t(d-o.left),u=t(d-o.right),f=i(g,u),p=Math.sqrt(r(f,2)+r(m,2));(void 0===l||p<l)&&(e=a,l=p,c=g<u?"left":"right")}),h=e,h.dataId===r.index)return}h&&(h.classList.add(c,"drop-target"),r.hoveredCard=h,r.side=c)}}_startDragging(e){const t=this,i=t._dragDetails,a=i.card,r=i.record,l=t.$.fireEvent("dragStart",{card:a,originalEvent:e,record:r});return l.defaultPrevented?(delete t._dragDetails,t.$.scrollViewer._scrollView.disableSwipeScroll=!1,!1):(i.feedback=t._addDragFeedback(r),i.feedbackShown=!0,t.setAttribute("dragging",""),a.classList.add("dragged"),t.closePanel(),t._clickToDrag=!0,!0)}_addDragFeedback(e){const t=this,i=document.createElement("div");let a="";return i.className="smart-card-view-drag-feedback",t.coverField&&(a+=`<div class="drag-feedback-thumbnail" style="background-image: url('${e[t.coverField].split(",")[0].trim()}');"></div>`),t.titleField?a+=`<div class="drag-feedback-label">${e[t.titleField]}</div>`:!t.coverField&&(a+=`<div class="drag-feedback-label">${t.localize("draggedRecord",{id:e.$.id})}</div>`),i.innerHTML=a,t.rightToLeft&&i.setAttribute("right-to-left",""),document.body.appendChild(i),i}_documentUpHandler(e){const t=this,i=t._dragDetails;if(t.$.scrollViewer._scrollView.disableSwipeScroll=!1,!i){let i=e.originalEvent.target;const a=t.$.header;if(t.shadowRoot&&i===t&&(i=e.originalEvent.composedPath()[0]),"none"!==t.headerPosition&&!t.$.headerDropDown.classList.contains("smart-visibility-hidden")&&!t.$.headerDropDown.classList.contains("search-panel")&&(i===a||!a.contains(i))){const e=i.closest("smart-scroll-viewer"),r=i.closest(".smart-drop-down");e&&a.contains(e.ownerElement)||r&&(!r.ownerElement||a.contains(r.ownerElement))||t.closePanel()}return}const a=i.card,r=i.record,l=i.hoveredCard;if(delete t._dragDetails,!t.hasAttribute("dragging"))return;const o=t.$.cardContainer.getElementsByClassName("dragged");if(Array.from(o).forEach(e=>e.classList.remove("dragged")),t.removeAttribute("dragging"),i.feedback.remove(),clearInterval(t._dragInterval),window.getSelection().removeAllRanges(),!l)return void t.$.fireEvent("dragEnd",{card:a,originalEvent:e,record:r});const n=t._visibleSource[l.dataId],d=t.$.fireEvent("dragEnd",{card:a,originalEvent:e,record:r,targetCard:l,targetRecord:n,targetSide:i.side});if(l.classList.remove("drop-target","left","right"),d.defaultPrevented)return;const s=t.dataSource;let c,h;for(let t=0;t<s.length;t++){const e=s[t];if(!e.isEmpty&&(e===r?c=t:e===n&&(h=t),null!=c&&null!=h))break}(!t.rightToLeft&&"right"===i.side||t.rightToLeft&&"left"===i.side)&&h++,s.move(c,h),t._getVisibleRecords(),t._dataSourceProcessed=!0,t._partialRefresh(),delete t._dataSourceProcessed}});